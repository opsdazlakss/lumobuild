function e9(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in n)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(n,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();function Wf(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function t9(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function r(){var i=!1;try{i=this instanceof r}catch{}return i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}),t}var Lb={exports:{}},jh={};var hE;function n9(){if(hE)return jh;hE=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(r,i,s){var c=null;if(s!==void 0&&(c=""+s),i.key!==void 0&&(c=""+i.key),"key"in i){s={};for(var l in i)l!=="key"&&(s[l]=i[l])}else s=i;return i=s.ref,{$$typeof:n,type:r,key:c,ref:i!==void 0?i:null,props:s}}return jh.Fragment=e,jh.jsx=t,jh.jsxs=t,jh}var fE;function r9(){return fE||(fE=1,Lb.exports=n9()),Lb.exports}var f=r9(),Ub={exports:{}},pt={};var pE;function i9(){if(pE)return pt;pE=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),c=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),g=Symbol.for("react.activity"),b=Symbol.iterator;function _(q){return q===null||typeof q!="object"?null:(q=b&&q[b]||q["@@iterator"],typeof q=="function"?q:null)}var R={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},E=Object.assign,A={};function M(q,te,fe){this.props=q,this.context=te,this.refs=A,this.updater=fe||R}M.prototype.isReactComponent={},M.prototype.setState=function(q,te){if(typeof q!="object"&&typeof q!="function"&&q!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,q,te,"setState")},M.prototype.forceUpdate=function(q){this.updater.enqueueForceUpdate(this,q,"forceUpdate")};function F(){}F.prototype=M.prototype;function j(q,te,fe){this.props=q,this.context=te,this.refs=A,this.updater=fe||R}var C=j.prototype=new F;C.constructor=j,E(C,M.prototype),C.isPureReactComponent=!0;var N=Array.isArray;function D(){}var S={H:null,A:null,T:null,S:null},k=Object.prototype.hasOwnProperty;function P(q,te,fe){var Se=fe.ref;return{$$typeof:n,type:q,key:te,ref:Se!==void 0?Se:null,props:fe}}function L(q,te){return P(q.type,te,q.props)}function U(q){return typeof q=="object"&&q!==null&&q.$$typeof===n}function z(q){var te={"=":"=0",":":"=2"};return"$"+q.replace(/[=:]/g,function(fe){return te[fe]})}var V=/\/+/g;function le(q,te){return typeof q=="object"&&q!==null&&q.key!=null?z(""+q.key):te.toString(36)}function ve(q){switch(q.status){case"fulfilled":return q.value;case"rejected":throw q.reason;default:switch(typeof q.status=="string"?q.then(D,D):(q.status="pending",q.then(function(te){q.status==="pending"&&(q.status="fulfilled",q.value=te)},function(te){q.status==="pending"&&(q.status="rejected",q.reason=te)})),q.status){case"fulfilled":return q.value;case"rejected":throw q.reason}}throw q}function K(q,te,fe,Se,Oe){var Te=typeof q;(Te==="undefined"||Te==="boolean")&&(q=null);var we=!1;if(q===null)we=!0;else switch(Te){case"bigint":case"string":case"number":we=!0;break;case"object":switch(q.$$typeof){case n:case e:we=!0;break;case m:return we=q._init,K(we(q._payload),te,fe,Se,Oe)}}if(we)return Oe=Oe(q),we=Se===""?"."+le(q,0):Se,N(Oe)?(fe="",we!=null&&(fe=we.replace(V,"$&/")+"/"),K(Oe,te,fe,"",function(Ce){return Ce})):Oe!=null&&(U(Oe)&&(Oe=L(Oe,fe+(Oe.key==null||q&&q.key===Oe.key?"":(""+Oe.key).replace(V,"$&/")+"/")+we)),te.push(Oe)),1;we=0;var Ge=Se===""?".":Se+":";if(N(q))for(var Ke=0;Ke<q.length;Ke++)Se=q[Ke],Te=Ge+le(Se,Ke),we+=K(Se,te,fe,Te,Oe);else if(Ke=_(q),typeof Ke=="function")for(q=Ke.call(q),Ke=0;!(Se=q.next()).done;)Se=Se.value,Te=Ge+le(Se,Ke++),we+=K(Se,te,fe,Te,Oe);else if(Te==="object"){if(typeof q.then=="function")return K(ve(q),te,fe,Se,Oe);throw te=String(q),Error("Objects are not valid as a React child (found: "+(te==="[object Object]"?"object with keys {"+Object.keys(q).join(", ")+"}":te)+"). If you meant to render a collection of children, use an array instead.")}return we}function oe(q,te,fe){if(q==null)return q;var Se=[],Oe=0;return K(q,Se,"","",function(Te){return te.call(fe,Te,Oe++)}),Se}function ee(q){if(q._status===-1){var te=q._result;te=te(),te.then(function(fe){(q._status===0||q._status===-1)&&(q._status=1,q._result=fe)},function(fe){(q._status===0||q._status===-1)&&(q._status=2,q._result=fe)}),q._status===-1&&(q._status=0,q._result=te)}if(q._status===1)return q._result.default;throw q._result}var Me=typeof reportError=="function"?reportError:function(q){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var te=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof q=="object"&&q!==null&&typeof q.message=="string"?String(q.message):String(q),error:q});if(!window.dispatchEvent(te))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",q);return}console.error(q)},je={map:oe,forEach:function(q,te,fe){oe(q,function(){te.apply(this,arguments)},fe)},count:function(q){var te=0;return oe(q,function(){te++}),te},toArray:function(q){return oe(q,function(te){return te})||[]},only:function(q){if(!U(q))throw Error("React.Children.only expected to receive a single React element child.");return q}};return pt.Activity=g,pt.Children=je,pt.Component=M,pt.Fragment=t,pt.Profiler=i,pt.PureComponent=j,pt.StrictMode=r,pt.Suspense=d,pt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=S,pt.__COMPILER_RUNTIME={__proto__:null,c:function(q){return S.H.useMemoCache(q)}},pt.cache=function(q){return function(){return q.apply(null,arguments)}},pt.cacheSignal=function(){return null},pt.cloneElement=function(q,te,fe){if(q==null)throw Error("The argument must be a React element, but you passed "+q+".");var Se=E({},q.props),Oe=q.key;if(te!=null)for(Te in te.key!==void 0&&(Oe=""+te.key),te)!k.call(te,Te)||Te==="key"||Te==="__self"||Te==="__source"||Te==="ref"&&te.ref===void 0||(Se[Te]=te[Te]);var Te=arguments.length-2;if(Te===1)Se.children=fe;else if(1<Te){for(var we=Array(Te),Ge=0;Ge<Te;Ge++)we[Ge]=arguments[Ge+2];Se.children=we}return P(q.type,Oe,Se)},pt.createContext=function(q){return q={$$typeof:c,_currentValue:q,_currentValue2:q,_threadCount:0,Provider:null,Consumer:null},q.Provider=q,q.Consumer={$$typeof:s,_context:q},q},pt.createElement=function(q,te,fe){var Se,Oe={},Te=null;if(te!=null)for(Se in te.key!==void 0&&(Te=""+te.key),te)k.call(te,Se)&&Se!=="key"&&Se!=="__self"&&Se!=="__source"&&(Oe[Se]=te[Se]);var we=arguments.length-2;if(we===1)Oe.children=fe;else if(1<we){for(var Ge=Array(we),Ke=0;Ke<we;Ke++)Ge[Ke]=arguments[Ke+2];Oe.children=Ge}if(q&&q.defaultProps)for(Se in we=q.defaultProps,we)Oe[Se]===void 0&&(Oe[Se]=we[Se]);return P(q,Te,Oe)},pt.createRef=function(){return{current:null}},pt.forwardRef=function(q){return{$$typeof:l,render:q}},pt.isValidElement=U,pt.lazy=function(q){return{$$typeof:m,_payload:{_status:-1,_result:q},_init:ee}},pt.memo=function(q,te){return{$$typeof:h,type:q,compare:te===void 0?null:te}},pt.startTransition=function(q){var te=S.T,fe={};S.T=fe;try{var Se=q(),Oe=S.S;Oe!==null&&Oe(fe,Se),typeof Se=="object"&&Se!==null&&typeof Se.then=="function"&&Se.then(D,Me)}catch(Te){Me(Te)}finally{te!==null&&fe.types!==null&&(te.types=fe.types),S.T=te}},pt.unstable_useCacheRefresh=function(){return S.H.useCacheRefresh()},pt.use=function(q){return S.H.use(q)},pt.useActionState=function(q,te,fe){return S.H.useActionState(q,te,fe)},pt.useCallback=function(q,te){return S.H.useCallback(q,te)},pt.useContext=function(q){return S.H.useContext(q)},pt.useDebugValue=function(){},pt.useDeferredValue=function(q,te){return S.H.useDeferredValue(q,te)},pt.useEffect=function(q,te){return S.H.useEffect(q,te)},pt.useEffectEvent=function(q){return S.H.useEffectEvent(q)},pt.useId=function(){return S.H.useId()},pt.useImperativeHandle=function(q,te,fe){return S.H.useImperativeHandle(q,te,fe)},pt.useInsertionEffect=function(q,te){return S.H.useInsertionEffect(q,te)},pt.useLayoutEffect=function(q,te){return S.H.useLayoutEffect(q,te)},pt.useMemo=function(q,te){return S.H.useMemo(q,te)},pt.useOptimistic=function(q,te){return S.H.useOptimistic(q,te)},pt.useReducer=function(q,te,fe){return S.H.useReducer(q,te,fe)},pt.useRef=function(q){return S.H.useRef(q)},pt.useState=function(q){return S.H.useState(q)},pt.useSyncExternalStore=function(q,te,fe){return S.H.useSyncExternalStore(q,te,fe)},pt.useTransition=function(){return S.H.useTransition()},pt.version="19.2.3",pt}var mE;function Sc(){return mE||(mE=1,Ub.exports=i9()),Ub.exports}var T=Sc();const be=Wf(T);var Vb={exports:{}},Lh={},zb={exports:{}},Fb={};var gE;function s9(){return gE||(gE=1,(function(n){function e(K,oe){var ee=K.length;K.push(oe);e:for(;0<ee;){var Me=ee-1>>>1,je=K[Me];if(0<i(je,oe))K[Me]=oe,K[ee]=je,ee=Me;else break e}}function t(K){return K.length===0?null:K[0]}function r(K){if(K.length===0)return null;var oe=K[0],ee=K.pop();if(ee!==oe){K[0]=ee;e:for(var Me=0,je=K.length,q=je>>>1;Me<q;){var te=2*(Me+1)-1,fe=K[te],Se=te+1,Oe=K[Se];if(0>i(fe,ee))Se<je&&0>i(Oe,fe)?(K[Me]=Oe,K[Se]=ee,Me=Se):(K[Me]=fe,K[te]=ee,Me=te);else if(Se<je&&0>i(Oe,ee))K[Me]=Oe,K[Se]=ee,Me=Se;else break e}}return oe}function i(K,oe){var ee=K.sortIndex-oe.sortIndex;return ee!==0?ee:K.id-oe.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var c=Date,l=c.now();n.unstable_now=function(){return c.now()-l}}var d=[],h=[],m=1,g=null,b=3,_=!1,R=!1,E=!1,A=!1,M=typeof setTimeout=="function"?setTimeout:null,F=typeof clearTimeout=="function"?clearTimeout:null,j=typeof setImmediate<"u"?setImmediate:null;function C(K){for(var oe=t(h);oe!==null;){if(oe.callback===null)r(h);else if(oe.startTime<=K)r(h),oe.sortIndex=oe.expirationTime,e(d,oe);else break;oe=t(h)}}function N(K){if(E=!1,C(K),!R)if(t(d)!==null)R=!0,D||(D=!0,z());else{var oe=t(h);oe!==null&&ve(N,oe.startTime-K)}}var D=!1,S=-1,k=5,P=-1;function L(){return A?!0:!(n.unstable_now()-P<k)}function U(){if(A=!1,D){var K=n.unstable_now();P=K;var oe=!0;try{e:{R=!1,E&&(E=!1,F(S),S=-1),_=!0;var ee=b;try{t:{for(C(K),g=t(d);g!==null&&!(g.expirationTime>K&&L());){var Me=g.callback;if(typeof Me=="function"){g.callback=null,b=g.priorityLevel;var je=Me(g.expirationTime<=K);if(K=n.unstable_now(),typeof je=="function"){g.callback=je,C(K),oe=!0;break t}g===t(d)&&r(d),C(K)}else r(d);g=t(d)}if(g!==null)oe=!0;else{var q=t(h);q!==null&&ve(N,q.startTime-K),oe=!1}}break e}finally{g=null,b=ee,_=!1}oe=void 0}}finally{oe?z():D=!1}}}var z;if(typeof j=="function")z=function(){j(U)};else if(typeof MessageChannel<"u"){var V=new MessageChannel,le=V.port2;V.port1.onmessage=U,z=function(){le.postMessage(null)}}else z=function(){M(U,0)};function ve(K,oe){S=M(function(){K(n.unstable_now())},oe)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(K){K.callback=null},n.unstable_forceFrameRate=function(K){0>K||125<K?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):k=0<K?Math.floor(1e3/K):5},n.unstable_getCurrentPriorityLevel=function(){return b},n.unstable_next=function(K){switch(b){case 1:case 2:case 3:var oe=3;break;default:oe=b}var ee=b;b=oe;try{return K()}finally{b=ee}},n.unstable_requestPaint=function(){A=!0},n.unstable_runWithPriority=function(K,oe){switch(K){case 1:case 2:case 3:case 4:case 5:break;default:K=3}var ee=b;b=K;try{return oe()}finally{b=ee}},n.unstable_scheduleCallback=function(K,oe,ee){var Me=n.unstable_now();switch(typeof ee=="object"&&ee!==null?(ee=ee.delay,ee=typeof ee=="number"&&0<ee?Me+ee:Me):ee=Me,K){case 1:var je=-1;break;case 2:je=250;break;case 5:je=1073741823;break;case 4:je=1e4;break;default:je=5e3}return je=ee+je,K={id:m++,callback:oe,priorityLevel:K,startTime:ee,expirationTime:je,sortIndex:-1},ee>Me?(K.sortIndex=ee,e(h,K),t(d)===null&&K===t(h)&&(E?(F(S),S=-1):E=!0,ve(N,ee-Me))):(K.sortIndex=je,e(d,K),R||_||(R=!0,D||(D=!0,z()))),K},n.unstable_shouldYield=L,n.unstable_wrapCallback=function(K){var oe=b;return function(){var ee=b;b=oe;try{return K.apply(this,arguments)}finally{b=ee}}}})(Fb)),Fb}var vE;function a9(){return vE||(vE=1,zb.exports=s9()),zb.exports}var Bb={exports:{}},Ir={};var yE;function o9(){if(yE)return Ir;yE=1;var n=Sc();function e(d){var h="https://react.dev/errors/"+d;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var m=2;m<arguments.length;m++)h+="&args[]="+encodeURIComponent(arguments[m])}return"Minified React error #"+d+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var r={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},i=Symbol.for("react.portal");function s(d,h,m){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:g==null?null:""+g,children:d,containerInfo:h,implementation:m}}var c=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function l(d,h){if(d==="font")return"";if(typeof h=="string")return h==="use-credentials"?h:""}return Ir.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,Ir.createPortal=function(d,h){var m=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)throw Error(e(299));return s(d,h,null,m)},Ir.flushSync=function(d){var h=c.T,m=r.p;try{if(c.T=null,r.p=2,d)return d()}finally{c.T=h,r.p=m,r.d.f()}},Ir.preconnect=function(d,h){typeof d=="string"&&(h?(h=h.crossOrigin,h=typeof h=="string"?h==="use-credentials"?h:"":void 0):h=null,r.d.C(d,h))},Ir.prefetchDNS=function(d){typeof d=="string"&&r.d.D(d)},Ir.preinit=function(d,h){if(typeof d=="string"&&h&&typeof h.as=="string"){var m=h.as,g=l(m,h.crossOrigin),b=typeof h.integrity=="string"?h.integrity:void 0,_=typeof h.fetchPriority=="string"?h.fetchPriority:void 0;m==="style"?r.d.S(d,typeof h.precedence=="string"?h.precedence:void 0,{crossOrigin:g,integrity:b,fetchPriority:_}):m==="script"&&r.d.X(d,{crossOrigin:g,integrity:b,fetchPriority:_,nonce:typeof h.nonce=="string"?h.nonce:void 0})}},Ir.preinitModule=function(d,h){if(typeof d=="string")if(typeof h=="object"&&h!==null){if(h.as==null||h.as==="script"){var m=l(h.as,h.crossOrigin);r.d.M(d,{crossOrigin:m,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0})}}else h==null&&r.d.M(d)},Ir.preload=function(d,h){if(typeof d=="string"&&typeof h=="object"&&h!==null&&typeof h.as=="string"){var m=h.as,g=l(m,h.crossOrigin);r.d.L(d,m,{crossOrigin:g,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0,type:typeof h.type=="string"?h.type:void 0,fetchPriority:typeof h.fetchPriority=="string"?h.fetchPriority:void 0,referrerPolicy:typeof h.referrerPolicy=="string"?h.referrerPolicy:void 0,imageSrcSet:typeof h.imageSrcSet=="string"?h.imageSrcSet:void 0,imageSizes:typeof h.imageSizes=="string"?h.imageSizes:void 0,media:typeof h.media=="string"?h.media:void 0})}},Ir.preloadModule=function(d,h){if(typeof d=="string")if(h){var m=l(h.as,h.crossOrigin);r.d.m(d,{as:typeof h.as=="string"&&h.as!=="script"?h.as:void 0,crossOrigin:m,integrity:typeof h.integrity=="string"?h.integrity:void 0})}else r.d.m(d)},Ir.requestFormReset=function(d){r.d.r(d)},Ir.unstable_batchedUpdates=function(d,h){return d(h)},Ir.useFormState=function(d,h,m){return c.H.useFormState(d,h,m)},Ir.useFormStatus=function(){return c.H.useHostTransitionStatus()},Ir.version="19.2.3",Ir}var bE;function E_(){if(bE)return Bb.exports;bE=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),Bb.exports=o9(),Bb.exports}var xE;function c9(){if(xE)return Lh;xE=1;var n=a9(),e=Sc(),t=E_();function r(a){var o="https://react.dev/errors/"+a;if(1<arguments.length){o+="?args[]="+encodeURIComponent(arguments[1]);for(var u=2;u<arguments.length;u++)o+="&args[]="+encodeURIComponent(arguments[u])}return"Minified React error #"+a+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function s(a){var o=a,u=a;if(a.alternate)for(;o.return;)o=o.return;else{a=o;do o=a,(o.flags&4098)!==0&&(u=o.return),a=o.return;while(a)}return o.tag===3?u:null}function c(a){if(a.tag===13){var o=a.memoizedState;if(o===null&&(a=a.alternate,a!==null&&(o=a.memoizedState)),o!==null)return o.dehydrated}return null}function l(a){if(a.tag===31){var o=a.memoizedState;if(o===null&&(a=a.alternate,a!==null&&(o=a.memoizedState)),o!==null)return o.dehydrated}return null}function d(a){if(s(a)!==a)throw Error(r(188))}function h(a){var o=a.alternate;if(!o){if(o=s(a),o===null)throw Error(r(188));return o!==a?null:a}for(var u=a,p=o;;){var y=u.return;if(y===null)break;var x=y.alternate;if(x===null){if(p=y.return,p!==null){u=p;continue}break}if(y.child===x.child){for(x=y.child;x;){if(x===u)return d(y),a;if(x===p)return d(y),o;x=x.sibling}throw Error(r(188))}if(u.return!==p.return)u=y,p=x;else{for(var I=!1,B=y.child;B;){if(B===u){I=!0,u=y,p=x;break}if(B===p){I=!0,p=y,u=x;break}B=B.sibling}if(!I){for(B=x.child;B;){if(B===u){I=!0,u=x,p=y;break}if(B===p){I=!0,p=x,u=y;break}B=B.sibling}if(!I)throw Error(r(189))}}if(u.alternate!==p)throw Error(r(190))}if(u.tag!==3)throw Error(r(188));return u.stateNode.current===u?a:o}function m(a){var o=a.tag;if(o===5||o===26||o===27||o===6)return a;for(a=a.child;a!==null;){if(o=m(a),o!==null)return o;a=a.sibling}return null}var g=Object.assign,b=Symbol.for("react.element"),_=Symbol.for("react.transitional.element"),R=Symbol.for("react.portal"),E=Symbol.for("react.fragment"),A=Symbol.for("react.strict_mode"),M=Symbol.for("react.profiler"),F=Symbol.for("react.consumer"),j=Symbol.for("react.context"),C=Symbol.for("react.forward_ref"),N=Symbol.for("react.suspense"),D=Symbol.for("react.suspense_list"),S=Symbol.for("react.memo"),k=Symbol.for("react.lazy"),P=Symbol.for("react.activity"),L=Symbol.for("react.memo_cache_sentinel"),U=Symbol.iterator;function z(a){return a===null||typeof a!="object"?null:(a=U&&a[U]||a["@@iterator"],typeof a=="function"?a:null)}var V=Symbol.for("react.client.reference");function le(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===V?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case E:return"Fragment";case M:return"Profiler";case A:return"StrictMode";case N:return"Suspense";case D:return"SuspenseList";case P:return"Activity"}if(typeof a=="object")switch(a.$$typeof){case R:return"Portal";case j:return a.displayName||"Context";case F:return(a._context.displayName||"Context")+".Consumer";case C:var o=a.render;return a=a.displayName,a||(a=o.displayName||o.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case S:return o=a.displayName||null,o!==null?o:le(a.type)||"Memo";case k:o=a._payload,a=a._init;try{return le(a(o))}catch{}}return null}var ve=Array.isArray,K=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,oe=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ee={pending:!1,data:null,method:null,action:null},Me=[],je=-1;function q(a){return{current:a}}function te(a){0>je||(a.current=Me[je],Me[je]=null,je--)}function fe(a,o){je++,Me[je]=a.current,a.current=o}var Se=q(null),Oe=q(null),Te=q(null),we=q(null);function Ge(a,o){switch(fe(Te,o),fe(Oe,a),fe(Se,null),o.nodeType){case 9:case 11:a=(a=o.documentElement)&&(a=a.namespaceURI)?Ow(a):0;break;default:if(a=o.tagName,o=o.namespaceURI)o=Ow(o),a=jw(o,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}te(Se),fe(Se,a)}function Ke(){te(Se),te(Oe),te(Te)}function Ce(a){a.memoizedState!==null&&fe(we,a);var o=Se.current,u=jw(o,a.type);o!==u&&(fe(Oe,a),fe(Se,u))}function Re(a){Oe.current===a&&(te(Se),te(Oe)),we.current===a&&(te(we),Ph._currentValue=ee)}var He,de;function Ie(a){if(He===void 0)try{throw Error()}catch(u){var o=u.stack.trim().match(/\n( *(at )?)/);He=o&&o[1]||"",de=-1<u.stack.indexOf(`
    at`)?" (<anonymous>)":-1<u.stack.indexOf("@")?"@unknown:0:0":""}return`
`+He+a+de}var qe=!1;function ot(a,o){if(!a||qe)return"";qe=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var p={DetermineComponentFrameRoot:function(){try{if(o){var ke=function(){throw Error()};if(Object.defineProperty(ke.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ke,[])}catch(ue){var ae=ue}Reflect.construct(a,[],ke)}else{try{ke.call()}catch(ue){ae=ue}a.call(ke.prototype)}}else{try{throw Error()}catch(ue){ae=ue}(ke=a())&&typeof ke.catch=="function"&&ke.catch(function(){})}}catch(ue){if(ue&&ae&&typeof ue.stack=="string")return[ue.stack,ae.stack]}return[null,null]}};p.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var y=Object.getOwnPropertyDescriptor(p.DetermineComponentFrameRoot,"name");y&&y.configurable&&Object.defineProperty(p.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var x=p.DetermineComponentFrameRoot(),I=x[0],B=x[1];if(I&&B){var G=I.split(`
`),ie=B.split(`
`);for(y=p=0;p<G.length&&!G[p].includes("DetermineComponentFrameRoot");)p++;for(;y<ie.length&&!ie[y].includes("DetermineComponentFrameRoot");)y++;if(p===G.length||y===ie.length)for(p=G.length-1,y=ie.length-1;1<=p&&0<=y&&G[p]!==ie[y];)y--;for(;1<=p&&0<=y;p--,y--)if(G[p]!==ie[y]){if(p!==1||y!==1)do if(p--,y--,0>y||G[p]!==ie[y]){var ge=`
`+G[p].replace(" at new "," at ");return a.displayName&&ge.includes("<anonymous>")&&(ge=ge.replace("<anonymous>",a.displayName)),ge}while(1<=p&&0<=y);break}}}finally{qe=!1,Error.prepareStackTrace=u}return(u=a?a.displayName||a.name:"")?Ie(u):""}function $e(a,o){switch(a.tag){case 26:case 27:case 5:return Ie(a.type);case 16:return Ie("Lazy");case 13:return a.child!==o&&o!==null?Ie("Suspense Fallback"):Ie("Suspense");case 19:return Ie("SuspenseList");case 0:case 15:return ot(a.type,!1);case 11:return ot(a.type.render,!1);case 1:return ot(a.type,!0);case 31:return Ie("Activity");default:return""}}function Q(a){try{var o="",u=null;do o+=$e(a,u),u=a,a=a.return;while(a);return o}catch(p){return`
Error generating stack: `+p.message+`
`+p.stack}}var Pe=Object.prototype.hasOwnProperty,Fe=n.unstable_scheduleCallback,ht=n.unstable_cancelCallback,Vt=n.unstable_shouldYield,Lt=n.unstable_requestPaint,Yt=n.unstable_now,In=n.unstable_getCurrentPriorityLevel,fi=n.unstable_ImmediatePriority,Ni=n.unstable_UserBlockingPriority,pi=n.unstable_NormalPriority,ao=n.unstable_LowPriority,vn=n.unstable_IdlePriority,fa=n.log,pa=n.unstable_setDisableYieldValue,sn=null,Gt=null;function Nr(a){if(typeof fa=="function"&&pa(a),Gt&&typeof Gt.setStrictMode=="function")try{Gt.setStrictMode(sn,a)}catch{}}var ln=Math.clz32?Math.clz32:oo,Ts=Math.log,Ii=Math.LN2;function oo(a){return a>>>=0,a===0?32:31-(Ts(a)/Ii|0)|0}var W=256,Z=262144,X=4194304;function Ne(a){var o=a&42;if(o!==0)return o;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return a&261888;case 262144:case 524288:case 1048576:case 2097152:return a&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function Je(a,o,u){var p=a.pendingLanes;if(p===0)return 0;var y=0,x=a.suspendedLanes,I=a.pingedLanes;a=a.warmLanes;var B=p&134217727;return B!==0?(p=B&~x,p!==0?y=Ne(p):(I&=B,I!==0?y=Ne(I):u||(u=B&~a,u!==0&&(y=Ne(u))))):(B=p&~x,B!==0?y=Ne(B):I!==0?y=Ne(I):u||(u=p&~a,u!==0&&(y=Ne(u)))),y===0?0:o!==0&&o!==y&&(o&x)===0&&(x=y&-y,u=o&-o,x>=u||x===32&&(u&4194048)!==0)?o:y}function tt(a,o){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&o)===0}function xt(a,o){switch(a){case 1:case 2:case 4:case 8:case 64:return o+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function _n(){var a=X;return X<<=1,(X&62914560)===0&&(X=4194304),a}function un(a){for(var o=[],u=0;31>u;u++)o.push(a);return o}function Pi(a,o){a.pendingLanes|=o,o!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function zl(a,o,u,p,y,x){var I=a.pendingLanes;a.pendingLanes=u,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=u,a.entangledLanes&=u,a.errorRecoveryDisabledLanes&=u,a.shellSuspendCounter=0;var B=a.entanglements,G=a.expirationTimes,ie=a.hiddenUpdates;for(u=I&~u;0<u;){var ge=31-ln(u),ke=1<<ge;B[ge]=0,G[ge]=-1;var ae=ie[ge];if(ae!==null)for(ie[ge]=null,ge=0;ge<ae.length;ge++){var ue=ae[ge];ue!==null&&(ue.lane&=-536870913)}u&=~ke}p!==0&&Sn(a,p,0),x!==0&&y===0&&a.tag!==0&&(a.suspendedLanes|=x&~(I&~o))}function Sn(a,o,u){a.pendingLanes|=o,a.suspendedLanes&=~o;var p=31-ln(o);a.entangledLanes|=o,a.entanglements[p]=a.entanglements[p]|1073741824|u&261930}function Mi(a,o){var u=a.entangledLanes|=o;for(a=a.entanglements;u;){var p=31-ln(u),y=1<<p;y&o|a[p]&o&&(a[p]|=o),u&=~y}}function Pn(a,o){var u=o&-o;return u=(u&42)!==0?1:tr(u),(u&(a.suspendedLanes|o))!==0?0:u}function tr(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:a=128;break;case 268435456:a=134217728;break;default:a=0}return a}function mi(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function Fl(){var a=oe.p;return a!==0?a:(a=window.event,a===void 0?32:sE(a.type))}function Yr(a,o){var u=oe.p;try{return oe.p=a,o()}finally{oe.p=u}}var Qr=Math.random().toString(36).slice(2),Fn="__reactFiber$"+Qr,or="__reactProps$"+Qr,ks="__reactContainer$"+Qr,Bl="__reactEvents$"+Qr,$0="__reactListeners$"+Qr,vp="__reactHandles$"+Qr,yp="__reactResources$"+Qr,Cs="__reactMarker$"+Qr;function $l(a){delete a[Fn],delete a[or],delete a[Bl],delete a[$0],delete a[vp]}function ws(a){var o=a[Fn];if(o)return o;for(var u=a.parentNode;u;){if(o=u[ks]||u[Fn]){if(u=o.alternate,o.child!==null||u!==null&&u.child!==null)for(a=$w(a);a!==null;){if(u=a[Fn])return u;a=$w(a)}return o}a=u,u=a.parentNode}return null}function Di(a){if(a=a[Fn]||a[ks]){var o=a.tag;if(o===5||o===6||o===13||o===31||o===26||o===27||o===3)return a}return null}function gi(a){var o=a.tag;if(o===5||o===26||o===27||o===6)return a.stateNode;throw Error(r(33))}function Es(a){var o=a[yp];return o||(o=a[yp]={hoistableStyles:new Map,hoistableScripts:new Map}),o}function Bn(a){a[Cs]=!0}var Vd=new Set,zd={};function Rs(a,o){As(a,o),As(a+"Capture",o)}function As(a,o){for(zd[a]=o,a=0;a<o.length;a++)Vd.add(o[a])}var Fd=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Bd={},$d={};function bp(a){return Pe.call($d,a)?!0:Pe.call(Bd,a)?!1:Fd.test(a)?$d[a]=!0:(Bd[a]=!0,!1)}function ql(a,o,u){if(bp(o))if(u===null)a.removeAttribute(o);else{switch(typeof u){case"undefined":case"function":case"symbol":a.removeAttribute(o);return;case"boolean":var p=o.toLowerCase().slice(0,5);if(p!=="data-"&&p!=="aria-"){a.removeAttribute(o);return}}a.setAttribute(o,""+u)}}function vi(a,o,u){if(u===null)a.removeAttribute(o);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(o);return}a.setAttribute(o,""+u)}}function $n(a,o,u,p){if(p===null)a.removeAttribute(u);else{switch(typeof p){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(u);return}a.setAttributeNS(o,u,""+p)}}function cr(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function co(a){var o=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function qd(a,o,u){var p=Object.getOwnPropertyDescriptor(a.constructor.prototype,o);if(!a.hasOwnProperty(o)&&typeof p<"u"&&typeof p.get=="function"&&typeof p.set=="function"){var y=p.get,x=p.set;return Object.defineProperty(a,o,{configurable:!0,get:function(){return y.call(this)},set:function(I){u=""+I,x.call(this,I)}}),Object.defineProperty(a,o,{enumerable:p.enumerable}),{getValue:function(){return u},setValue:function(I){u=""+I},stopTracking:function(){a._valueTracker=null,delete a[o]}}}}function Qt(a){if(!a._valueTracker){var o=co(a)?"checked":"value";a._valueTracker=qd(a,o,""+a[o])}}function Nc(a){if(!a)return!1;var o=a._valueTracker;if(!o)return!0;var u=o.getValue(),p="";return a&&(p=co(a)?a.checked?"true":"false":a.value),a=p,a!==u?(o.setValue(a),!0):!1}function Ns(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var Ic=/[\n"\\]/g;function Xr(a){return a.replace(Ic,function(o){return"\\"+o.charCodeAt(0).toString(16)+" "})}function Hl(a,o,u,p,y,x,I,B){a.name="",I!=null&&typeof I!="function"&&typeof I!="symbol"&&typeof I!="boolean"?a.type=I:a.removeAttribute("type"),o!=null?I==="number"?(o===0&&a.value===""||a.value!=o)&&(a.value=""+cr(o)):a.value!==""+cr(o)&&(a.value=""+cr(o)):I!=="submit"&&I!=="reset"||a.removeAttribute("value"),o!=null?Hd(a,I,cr(o)):u!=null?Hd(a,I,cr(u)):p!=null&&a.removeAttribute("value"),y==null&&x!=null&&(a.defaultChecked=!!x),y!=null&&(a.checked=y&&typeof y!="function"&&typeof y!="symbol"),B!=null&&typeof B!="function"&&typeof B!="symbol"&&typeof B!="boolean"?a.name=""+cr(B):a.removeAttribute("name")}function xp(a,o,u,p,y,x,I,B){if(x!=null&&typeof x!="function"&&typeof x!="symbol"&&typeof x!="boolean"&&(a.type=x),o!=null||u!=null){if(!(x!=="submit"&&x!=="reset"||o!=null)){Qt(a);return}u=u!=null?""+cr(u):"",o=o!=null?""+cr(o):u,B||o===a.value||(a.value=o),a.defaultValue=o}p=p??y,p=typeof p!="function"&&typeof p!="symbol"&&!!p,a.checked=B?a.checked:!!p,a.defaultChecked=!!p,I!=null&&typeof I!="function"&&typeof I!="symbol"&&typeof I!="boolean"&&(a.name=I),Qt(a)}function Hd(a,o,u){o==="number"&&Ns(a.ownerDocument)===a||a.defaultValue===""+u||(a.defaultValue=""+u)}function lo(a,o,u,p){if(a=a.options,o){o={};for(var y=0;y<u.length;y++)o["$"+u[y]]=!0;for(u=0;u<a.length;u++)y=o.hasOwnProperty("$"+a[u].value),a[u].selected!==y&&(a[u].selected=y),y&&p&&(a[u].defaultSelected=!0)}else{for(u=""+cr(u),o=null,y=0;y<a.length;y++){if(a[y].value===u){a[y].selected=!0,p&&(a[y].defaultSelected=!0);return}o!==null||a[y].disabled||(o=a[y])}o!==null&&(o.selected=!0)}}function _p(a,o,u){if(o!=null&&(o=""+cr(o),o!==a.value&&(a.value=o),u==null)){a.defaultValue!==o&&(a.defaultValue=o);return}a.defaultValue=u!=null?""+cr(u):""}function uo(a,o,u,p){if(o==null){if(p!=null){if(u!=null)throw Error(r(92));if(ve(p)){if(1<p.length)throw Error(r(93));p=p[0]}u=p}u==null&&(u=""),o=u}u=cr(o),a.defaultValue=u,p=a.textContent,p===u&&p!==""&&p!==null&&(a.value=p),Qt(a)}function Jr(a,o){if(o){var u=a.firstChild;if(u&&u===a.lastChild&&u.nodeType===3){u.nodeValue=o;return}}a.textContent=o}var Sp=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Gd(a,o,u){var p=o.indexOf("--")===0;u==null||typeof u=="boolean"||u===""?p?a.setProperty(o,""):o==="float"?a.cssFloat="":a[o]="":p?a.setProperty(o,u):typeof u!="number"||u===0||Sp.has(o)?o==="float"?a.cssFloat=u:a[o]=(""+u).trim():a[o]=u+"px"}function Kd(a,o,u){if(o!=null&&typeof o!="object")throw Error(r(62));if(a=a.style,u!=null){for(var p in u)!u.hasOwnProperty(p)||o!=null&&o.hasOwnProperty(p)||(p.indexOf("--")===0?a.setProperty(p,""):p==="float"?a.cssFloat="":a[p]="");for(var y in o)p=o[y],o.hasOwnProperty(y)&&u[y]!==p&&Gd(a,y,p)}else for(var x in o)o.hasOwnProperty(x)&&Gd(a,x,o[x])}function Gl(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Tp=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),ho=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Kl(a){return ho.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}function es(){}var Wd=null;function Oi(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var fo=null,Is=null;function Pc(a){var o=Di(a);if(o&&(a=o.stateNode)){var u=a[or]||null;e:switch(a=o.stateNode,o.type){case"input":if(Hl(a,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name),o=u.name,u.type==="radio"&&o!=null){for(u=a;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll('input[name="'+Xr(""+o)+'"][type="radio"]'),o=0;o<u.length;o++){var p=u[o];if(p!==a&&p.form===a.form){var y=p[or]||null;if(!y)throw Error(r(90));Hl(p,y.value,y.defaultValue,y.defaultValue,y.checked,y.defaultChecked,y.type,y.name)}}for(o=0;o<u.length;o++)p=u[o],p.form===a.form&&Nc(p)}break e;case"textarea":_p(a,u.value,u.defaultValue);break e;case"select":o=u.value,o!=null&&lo(a,!!u.multiple,o,!1)}}}var Wl=!1;function po(a,o,u){if(Wl)return a(o,u);Wl=!0;try{var p=a(o);return p}finally{if(Wl=!1,(fo!==null||Is!==null)&&(gm(),fo&&(o=fo,a=Is,Is=fo=null,Pc(o),a)))for(o=0;o<a.length;o++)Pc(a[o])}}function ts(a,o){var u=a.stateNode;if(u===null)return null;var p=u[or]||null;if(p===null)return null;u=p[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(p=!p.disabled)||(a=a.type,p=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!p;break e;default:a=!1}if(a)return null;if(u&&typeof u!="function")throw Error(r(231,o,typeof u));return u}var ji=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Mc=!1;if(ji)try{var Zt={};Object.defineProperty(Zt,"passive",{get:function(){Mc=!0}}),window.addEventListener("test",Zt,Zt),window.removeEventListener("test",Zt,Zt)}catch{Mc=!1}var Ps=null,Yd=null,Dc=null;function Qd(){if(Dc)return Dc;var a,o=Yd,u=o.length,p,y="value"in Ps?Ps.value:Ps.textContent,x=y.length;for(a=0;a<u&&o[a]===y[a];a++);var I=u-a;for(p=1;p<=I&&o[u-p]===y[x-p];p++);return Dc=y.slice(a,1<p?1-p:void 0)}function Oc(a){var o=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&o===13&&(a=13)):a=o,a===10&&(a=13),32<=a||a===13?a:0}function ma(){return!0}function ns(){return!1}function vr(a){function o(u,p,y,x,I){this._reactName=u,this._targetInst=y,this.type=p,this.nativeEvent=x,this.target=I,this.currentTarget=null;for(var B in a)a.hasOwnProperty(B)&&(u=a[B],this[B]=u?u(x):x[B]);return this.isDefaultPrevented=(x.defaultPrevented!=null?x.defaultPrevented:x.returnValue===!1)?ma:ns,this.isPropagationStopped=ns,this}return g(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=ma)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=ma)},persist:function(){},isPersistent:ma}),o}var ga={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ms=vr(ga),mo=g({},ga,{view:0,detail:0}),Xd=vr(mo),go,Yl,Ds,Ql=g({},mo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:vo,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==Ds&&(Ds&&a.type==="mousemove"?(go=a.screenX-Ds.screenX,Yl=a.screenY-Ds.screenY):Yl=go=0,Ds=a),go)},movementY:function(a){return"movementY"in a?a.movementY:Yl}}),Jd=vr(Ql),jc=g({},Ql,{dataTransfer:0}),kp=vr(jc),Cp=g({},mo,{relatedTarget:0}),Lc=vr(Cp),Zd=g({},ga,{animationName:0,elapsedTime:0,pseudoElement:0}),wp=vr(Zd),Xl=g({},ga,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),Ep=vr(Xl),Rp=g({},ga,{data:0}),Os=vr(Rp),Ap={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Np={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Ip={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pp(a){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(a):(a=Ip[a])?!!o[a]:!1}function vo(){return Pp}var Ur=g({},mo,{key:function(a){if(a.key){var o=Ap[a.key]||a.key;if(o!=="Unidentified")return o}return a.type==="keypress"?(a=Oc(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?Np[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:vo,charCode:function(a){return a.type==="keypress"?Oc(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?Oc(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),Mp=vr(Ur),Dp=g({},Ql,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),va=vr(Dp),v=g({},mo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:vo}),w=vr(v),O=g({},ga,{propertyName:0,elapsedTime:0,pseudoElement:0}),$=vr(O),ne=g({},Ql,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),ce=vr(ne),Le=g({},ga,{newState:0,oldState:0}),vt=vr(Le),Mn=[9,13,27,32],$t=ji&&"CompositionEvent"in window,yn=null;ji&&"documentMode"in document&&(yn=document.documentMode);var Li=ji&&"TextEvent"in window&&!yn,js=ji&&(!$t||yn&&8<yn&&11>=yn),rs=" ",is=!1;function Uc(a,o){switch(a){case"keyup":return Mn.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Jl(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var Zl=!1;function k6(a,o){switch(a){case"compositionend":return Jl(o);case"keypress":return o.which!==32?null:(is=!0,rs);case"textInput":return a=o.data,a===rs&&is?null:a;default:return null}}function C6(a,o){if(Zl)return a==="compositionend"||!$t&&Uc(a,o)?(a=Qd(),Dc=Yd=Ps=null,Zl=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return js&&o.locale!=="ko"?null:o.data;default:return null}}var w6={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function GT(a){var o=a&&a.nodeName&&a.nodeName.toLowerCase();return o==="input"?!!w6[a.type]:o==="textarea"}function KT(a,o,u,p){fo?Is?Is.push(p):Is=[p]:fo=p,o=Tm(o,"onChange"),0<o.length&&(u=new Ms("onChange","change",null,u,p),a.push({event:u,listeners:o}))}var eh=null,th=null;function E6(a){Aw(a,0)}function Op(a){var o=gi(a);if(Nc(o))return a}function WT(a,o){if(a==="change")return o}var YT=!1;if(ji){var q0;if(ji){var H0="oninput"in document;if(!H0){var QT=document.createElement("div");QT.setAttribute("oninput","return;"),H0=typeof QT.oninput=="function"}q0=H0}else q0=!1;YT=q0&&(!document.documentMode||9<document.documentMode)}function XT(){eh&&(eh.detachEvent("onpropertychange",JT),th=eh=null)}function JT(a){if(a.propertyName==="value"&&Op(th)){var o=[];KT(o,th,a,Oi(a)),po(E6,o)}}function R6(a,o,u){a==="focusin"?(XT(),eh=o,th=u,eh.attachEvent("onpropertychange",JT)):a==="focusout"&&XT()}function A6(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return Op(th)}function N6(a,o){if(a==="click")return Op(o)}function I6(a,o){if(a==="input"||a==="change")return Op(o)}function P6(a,o){return a===o&&(a!==0||1/a===1/o)||a!==a&&o!==o}var yi=typeof Object.is=="function"?Object.is:P6;function nh(a,o){if(yi(a,o))return!0;if(typeof a!="object"||a===null||typeof o!="object"||o===null)return!1;var u=Object.keys(a),p=Object.keys(o);if(u.length!==p.length)return!1;for(p=0;p<u.length;p++){var y=u[p];if(!Pe.call(o,y)||!yi(a[y],o[y]))return!1}return!0}function ZT(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function ek(a,o){var u=ZT(a);a=0;for(var p;u;){if(u.nodeType===3){if(p=a+u.textContent.length,a<=o&&p>=o)return{node:u,offset:o-a};a=p}e:{for(;u;){if(u.nextSibling){u=u.nextSibling;break e}u=u.parentNode}u=void 0}u=ZT(u)}}function tk(a,o){return a&&o?a===o?!0:a&&a.nodeType===3?!1:o&&o.nodeType===3?tk(a,o.parentNode):"contains"in a?a.contains(o):a.compareDocumentPosition?!!(a.compareDocumentPosition(o)&16):!1:!1}function nk(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var o=Ns(a.document);o instanceof a.HTMLIFrameElement;){try{var u=typeof o.contentWindow.location.href=="string"}catch{u=!1}if(u)a=o.contentWindow;else break;o=Ns(a.document)}return o}function G0(a){var o=a&&a.nodeName&&a.nodeName.toLowerCase();return o&&(o==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||o==="textarea"||a.contentEditable==="true")}var M6=ji&&"documentMode"in document&&11>=document.documentMode,eu=null,K0=null,rh=null,W0=!1;function rk(a,o,u){var p=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;W0||eu==null||eu!==Ns(p)||(p=eu,"selectionStart"in p&&G0(p)?p={start:p.selectionStart,end:p.selectionEnd}:(p=(p.ownerDocument&&p.ownerDocument.defaultView||window).getSelection(),p={anchorNode:p.anchorNode,anchorOffset:p.anchorOffset,focusNode:p.focusNode,focusOffset:p.focusOffset}),rh&&nh(rh,p)||(rh=p,p=Tm(K0,"onSelect"),0<p.length&&(o=new Ms("onSelect","select",null,o,u),a.push({event:o,listeners:p}),o.target=eu)))}function Vc(a,o){var u={};return u[a.toLowerCase()]=o.toLowerCase(),u["Webkit"+a]="webkit"+o,u["Moz"+a]="moz"+o,u}var tu={animationend:Vc("Animation","AnimationEnd"),animationiteration:Vc("Animation","AnimationIteration"),animationstart:Vc("Animation","AnimationStart"),transitionrun:Vc("Transition","TransitionRun"),transitionstart:Vc("Transition","TransitionStart"),transitioncancel:Vc("Transition","TransitionCancel"),transitionend:Vc("Transition","TransitionEnd")},Y0={},ik={};ji&&(ik=document.createElement("div").style,"AnimationEvent"in window||(delete tu.animationend.animation,delete tu.animationiteration.animation,delete tu.animationstart.animation),"TransitionEvent"in window||delete tu.transitionend.transition);function zc(a){if(Y0[a])return Y0[a];if(!tu[a])return a;var o=tu[a],u;for(u in o)if(o.hasOwnProperty(u)&&u in ik)return Y0[a]=o[u];return a}var sk=zc("animationend"),ak=zc("animationiteration"),ok=zc("animationstart"),D6=zc("transitionrun"),O6=zc("transitionstart"),j6=zc("transitioncancel"),ck=zc("transitionend"),lk=new Map,Q0="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Q0.push("scrollEnd");function ss(a,o){lk.set(a,o),Rs(o,[a])}var jp=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var o=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(o))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)},Ui=[],nu=0,X0=0;function Lp(){for(var a=nu,o=X0=nu=0;o<a;){var u=Ui[o];Ui[o++]=null;var p=Ui[o];Ui[o++]=null;var y=Ui[o];Ui[o++]=null;var x=Ui[o];if(Ui[o++]=null,p!==null&&y!==null){var I=p.pending;I===null?y.next=y:(y.next=I.next,I.next=y),p.pending=y}x!==0&&uk(u,y,x)}}function Up(a,o,u,p){Ui[nu++]=a,Ui[nu++]=o,Ui[nu++]=u,Ui[nu++]=p,X0|=p,a.lanes|=p,a=a.alternate,a!==null&&(a.lanes|=p)}function J0(a,o,u,p){return Up(a,o,u,p),Vp(a)}function Fc(a,o){return Up(a,null,null,o),Vp(a)}function uk(a,o,u){a.lanes|=u;var p=a.alternate;p!==null&&(p.lanes|=u);for(var y=!1,x=a.return;x!==null;)x.childLanes|=u,p=x.alternate,p!==null&&(p.childLanes|=u),x.tag===22&&(a=x.stateNode,a===null||a._visibility&1||(y=!0)),a=x,x=x.return;return a.tag===3?(x=a.stateNode,y&&o!==null&&(y=31-ln(u),a=x.hiddenUpdates,p=a[y],p===null?a[y]=[o]:p.push(o),o.lane=u|536870912),x):null}function Vp(a){if(50<Ch)throw Ch=0,ob=null,Error(r(185));for(var o=a.return;o!==null;)a=o,o=a.return;return a.tag===3?a.stateNode:null}var ru={};function L6(a,o,u,p){this.tag=a,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=p,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function bi(a,o,u,p){return new L6(a,o,u,p)}function Z0(a){return a=a.prototype,!(!a||!a.isReactComponent)}function ya(a,o){var u=a.alternate;return u===null?(u=bi(a.tag,o,a.key,a.mode),u.elementType=a.elementType,u.type=a.type,u.stateNode=a.stateNode,u.alternate=a,a.alternate=u):(u.pendingProps=o,u.type=a.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=a.flags&65011712,u.childLanes=a.childLanes,u.lanes=a.lanes,u.child=a.child,u.memoizedProps=a.memoizedProps,u.memoizedState=a.memoizedState,u.updateQueue=a.updateQueue,o=a.dependencies,u.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},u.sibling=a.sibling,u.index=a.index,u.ref=a.ref,u.refCleanup=a.refCleanup,u}function dk(a,o){a.flags&=65011714;var u=a.alternate;return u===null?(a.childLanes=0,a.lanes=o,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=u.childLanes,a.lanes=u.lanes,a.child=u.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=u.memoizedProps,a.memoizedState=u.memoizedState,a.updateQueue=u.updateQueue,a.type=u.type,o=u.dependencies,a.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),a}function zp(a,o,u,p,y,x){var I=0;if(p=a,typeof a=="function")Z0(a)&&(I=1);else if(typeof a=="string")I=Bj(a,u,Se.current)?26:a==="html"||a==="head"||a==="body"?27:5;else e:switch(a){case P:return a=bi(31,u,o,y),a.elementType=P,a.lanes=x,a;case E:return Bc(u.children,y,x,o);case A:I=8,y|=24;break;case M:return a=bi(12,u,o,y|2),a.elementType=M,a.lanes=x,a;case N:return a=bi(13,u,o,y),a.elementType=N,a.lanes=x,a;case D:return a=bi(19,u,o,y),a.elementType=D,a.lanes=x,a;default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case j:I=10;break e;case F:I=9;break e;case C:I=11;break e;case S:I=14;break e;case k:I=16,p=null;break e}I=29,u=Error(r(130,a===null?"null":typeof a,"")),p=null}return o=bi(I,u,o,y),o.elementType=a,o.type=p,o.lanes=x,o}function Bc(a,o,u,p){return a=bi(7,a,p,o),a.lanes=u,a}function ey(a,o,u){return a=bi(6,a,null,o),a.lanes=u,a}function hk(a){var o=bi(18,null,null,0);return o.stateNode=a,o}function ty(a,o,u){return o=bi(4,a.children!==null?a.children:[],a.key,o),o.lanes=u,o.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},o}var fk=new WeakMap;function Vi(a,o){if(typeof a=="object"&&a!==null){var u=fk.get(a);return u!==void 0?u:(o={value:a,source:o,stack:Q(o)},fk.set(a,o),o)}return{value:a,source:o,stack:Q(o)}}var iu=[],su=0,Fp=null,ih=0,zi=[],Fi=0,yo=null,Ls=1,Us="";function ba(a,o){iu[su++]=ih,iu[su++]=Fp,Fp=a,ih=o}function pk(a,o,u){zi[Fi++]=Ls,zi[Fi++]=Us,zi[Fi++]=yo,yo=a;var p=Ls;a=Us;var y=32-ln(p)-1;p&=~(1<<y),u+=1;var x=32-ln(o)+y;if(30<x){var I=y-y%5;x=(p&(1<<I)-1).toString(32),p>>=I,y-=I,Ls=1<<32-ln(o)+y|u<<y|p,Us=x+a}else Ls=1<<x|u<<y|p,Us=a}function ny(a){a.return!==null&&(ba(a,1),pk(a,1,0))}function ry(a){for(;a===Fp;)Fp=iu[--su],iu[su]=null,ih=iu[--su],iu[su]=null;for(;a===yo;)yo=zi[--Fi],zi[Fi]=null,Us=zi[--Fi],zi[Fi]=null,Ls=zi[--Fi],zi[Fi]=null}function mk(a,o){zi[Fi++]=Ls,zi[Fi++]=Us,zi[Fi++]=yo,Ls=o.id,Us=o.overflow,yo=a}var yr=null,fn=null,jt=!1,bo=null,Bi=!1,iy=Error(r(519));function xo(a){var o=Error(r(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw sh(Vi(o,a)),iy}function gk(a){var o=a.stateNode,u=a.type,p=a.memoizedProps;switch(o[Fn]=a,o[or]=p,u){case"dialog":Rt("cancel",o),Rt("close",o);break;case"iframe":case"object":case"embed":Rt("load",o);break;case"video":case"audio":for(u=0;u<Eh.length;u++)Rt(Eh[u],o);break;case"source":Rt("error",o);break;case"img":case"image":case"link":Rt("error",o),Rt("load",o);break;case"details":Rt("toggle",o);break;case"input":Rt("invalid",o),xp(o,p.value,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name,!0);break;case"select":Rt("invalid",o);break;case"textarea":Rt("invalid",o),uo(o,p.value,p.defaultValue,p.children)}u=p.children,typeof u!="string"&&typeof u!="number"&&typeof u!="bigint"||o.textContent===""+u||p.suppressHydrationWarning===!0||Mw(o.textContent,u)?(p.popover!=null&&(Rt("beforetoggle",o),Rt("toggle",o)),p.onScroll!=null&&Rt("scroll",o),p.onScrollEnd!=null&&Rt("scrollend",o),p.onClick!=null&&(o.onclick=es),o=!0):o=!1,o||xo(a,!0)}function vk(a){for(yr=a.return;yr;)switch(yr.tag){case 5:case 31:case 13:Bi=!1;return;case 27:case 3:Bi=!0;return;default:yr=yr.return}}function au(a){if(a!==yr)return!1;if(!jt)return vk(a),jt=!0,!1;var o=a.tag,u;if((u=o!==3&&o!==27)&&((u=o===5)&&(u=a.type,u=!(u!=="form"&&u!=="button")||Sb(a.type,a.memoizedProps)),u=!u),u&&fn&&xo(a),vk(a),o===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(r(317));fn=Bw(a)}else if(o===31){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(r(317));fn=Bw(a)}else o===27?(o=fn,Do(a.type)?(a=Eb,Eb=null,fn=a):fn=o):fn=yr?qi(a.stateNode.nextSibling):null;return!0}function $c(){fn=yr=null,jt=!1}function sy(){var a=bo;return a!==null&&(ni===null?ni=a:ni.push.apply(ni,a),bo=null),a}function sh(a){bo===null?bo=[a]:bo.push(a)}var ay=q(null),qc=null,xa=null;function _o(a,o,u){fe(ay,o._currentValue),o._currentValue=u}function _a(a){a._currentValue=ay.current,te(ay)}function oy(a,o,u){for(;a!==null;){var p=a.alternate;if((a.childLanes&o)!==o?(a.childLanes|=o,p!==null&&(p.childLanes|=o)):p!==null&&(p.childLanes&o)!==o&&(p.childLanes|=o),a===u)break;a=a.return}}function cy(a,o,u,p){var y=a.child;for(y!==null&&(y.return=a);y!==null;){var x=y.dependencies;if(x!==null){var I=y.child;x=x.firstContext;e:for(;x!==null;){var B=x;x=y;for(var G=0;G<o.length;G++)if(B.context===o[G]){x.lanes|=u,B=x.alternate,B!==null&&(B.lanes|=u),oy(x.return,u,a),p||(I=null);break e}x=B.next}}else if(y.tag===18){if(I=y.return,I===null)throw Error(r(341));I.lanes|=u,x=I.alternate,x!==null&&(x.lanes|=u),oy(I,u,a),I=null}else I=y.child;if(I!==null)I.return=y;else for(I=y;I!==null;){if(I===a){I=null;break}if(y=I.sibling,y!==null){y.return=I.return,I=y;break}I=I.return}y=I}}function ou(a,o,u,p){a=null;for(var y=o,x=!1;y!==null;){if(!x){if((y.flags&524288)!==0)x=!0;else if((y.flags&262144)!==0)break}if(y.tag===10){var I=y.alternate;if(I===null)throw Error(r(387));if(I=I.memoizedProps,I!==null){var B=y.type;yi(y.pendingProps.value,I.value)||(a!==null?a.push(B):a=[B])}}else if(y===we.current){if(I=y.alternate,I===null)throw Error(r(387));I.memoizedState.memoizedState!==y.memoizedState.memoizedState&&(a!==null?a.push(Ph):a=[Ph])}y=y.return}a!==null&&cy(o,a,u,p),o.flags|=262144}function Bp(a){for(a=a.firstContext;a!==null;){if(!yi(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function Hc(a){qc=a,xa=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function br(a){return yk(qc,a)}function $p(a,o){return qc===null&&Hc(a),yk(a,o)}function yk(a,o){var u=o._currentValue;if(o={context:o,memoizedValue:u,next:null},xa===null){if(a===null)throw Error(r(308));xa=o,a.dependencies={lanes:0,firstContext:o},a.flags|=524288}else xa=xa.next=o;return u}var U6=typeof AbortController<"u"?AbortController:function(){var a=[],o=this.signal={aborted:!1,addEventListener:function(u,p){a.push(p)}};this.abort=function(){o.aborted=!0,a.forEach(function(u){return u()})}},V6=n.unstable_scheduleCallback,z6=n.unstable_NormalPriority,qn={$$typeof:j,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function ly(){return{controller:new U6,data:new Map,refCount:0}}function ah(a){a.refCount--,a.refCount===0&&V6(z6,function(){a.controller.abort()})}var oh=null,uy=0,cu=0,lu=null;function F6(a,o){if(oh===null){var u=oh=[];uy=0,cu=fb(),lu={status:"pending",value:void 0,then:function(p){u.push(p)}}}return uy++,o.then(bk,bk),o}function bk(){if(--uy===0&&oh!==null){lu!==null&&(lu.status="fulfilled");var a=oh;oh=null,cu=0,lu=null;for(var o=0;o<a.length;o++)(0,a[o])()}}function B6(a,o){var u=[],p={status:"pending",value:null,reason:null,then:function(y){u.push(y)}};return a.then(function(){p.status="fulfilled",p.value=o;for(var y=0;y<u.length;y++)(0,u[y])(o)},function(y){for(p.status="rejected",p.reason=y,y=0;y<u.length;y++)(0,u[y])(void 0)}),p}var xk=K.S;K.S=function(a,o){rw=Yt(),typeof o=="object"&&o!==null&&typeof o.then=="function"&&F6(a,o),xk!==null&&xk(a,o)};var Gc=q(null);function dy(){var a=Gc.current;return a!==null?a:an.pooledCache}function qp(a,o){o===null?fe(Gc,Gc.current):fe(Gc,o.pool)}function _k(){var a=dy();return a===null?null:{parent:qn._currentValue,pool:a}}var uu=Error(r(460)),hy=Error(r(474)),Hp=Error(r(542)),Gp={then:function(){}};function Sk(a){return a=a.status,a==="fulfilled"||a==="rejected"}function Tk(a,o,u){switch(u=a[u],u===void 0?a.push(o):u!==o&&(o.then(es,es),o=u),o.status){case"fulfilled":return o.value;case"rejected":throw a=o.reason,Ck(a),a;default:if(typeof o.status=="string")o.then(es,es);else{if(a=an,a!==null&&100<a.shellSuspendCounter)throw Error(r(482));a=o,a.status="pending",a.then(function(p){if(o.status==="pending"){var y=o;y.status="fulfilled",y.value=p}},function(p){if(o.status==="pending"){var y=o;y.status="rejected",y.reason=p}})}switch(o.status){case"fulfilled":return o.value;case"rejected":throw a=o.reason,Ck(a),a}throw Wc=o,uu}}function Kc(a){try{var o=a._init;return o(a._payload)}catch(u){throw u!==null&&typeof u=="object"&&typeof u.then=="function"?(Wc=u,uu):u}}var Wc=null;function kk(){if(Wc===null)throw Error(r(459));var a=Wc;return Wc=null,a}function Ck(a){if(a===uu||a===Hp)throw Error(r(483))}var du=null,ch=0;function Kp(a){var o=ch;return ch+=1,du===null&&(du=[]),Tk(du,a,o)}function lh(a,o){o=o.props.ref,a.ref=o!==void 0?o:null}function Wp(a,o){throw o.$$typeof===b?Error(r(525)):(a=Object.prototype.toString.call(o),Error(r(31,a==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":a)))}function wk(a){function o(J,Y){if(a){var re=J.deletions;re===null?(J.deletions=[Y],J.flags|=16):re.push(Y)}}function u(J,Y){if(!a)return null;for(;Y!==null;)o(J,Y),Y=Y.sibling;return null}function p(J){for(var Y=new Map;J!==null;)J.key!==null?Y.set(J.key,J):Y.set(J.index,J),J=J.sibling;return Y}function y(J,Y){return J=ya(J,Y),J.index=0,J.sibling=null,J}function x(J,Y,re){return J.index=re,a?(re=J.alternate,re!==null?(re=re.index,re<Y?(J.flags|=67108866,Y):re):(J.flags|=67108866,Y)):(J.flags|=1048576,Y)}function I(J){return a&&J.alternate===null&&(J.flags|=67108866),J}function B(J,Y,re,xe){return Y===null||Y.tag!==6?(Y=ey(re,J.mode,xe),Y.return=J,Y):(Y=y(Y,re),Y.return=J,Y)}function G(J,Y,re,xe){var rt=re.type;return rt===E?ge(J,Y,re.props.children,xe,re.key):Y!==null&&(Y.elementType===rt||typeof rt=="object"&&rt!==null&&rt.$$typeof===k&&Kc(rt)===Y.type)?(Y=y(Y,re.props),lh(Y,re),Y.return=J,Y):(Y=zp(re.type,re.key,re.props,null,J.mode,xe),lh(Y,re),Y.return=J,Y)}function ie(J,Y,re,xe){return Y===null||Y.tag!==4||Y.stateNode.containerInfo!==re.containerInfo||Y.stateNode.implementation!==re.implementation?(Y=ty(re,J.mode,xe),Y.return=J,Y):(Y=y(Y,re.children||[]),Y.return=J,Y)}function ge(J,Y,re,xe,rt){return Y===null||Y.tag!==7?(Y=Bc(re,J.mode,xe,rt),Y.return=J,Y):(Y=y(Y,re),Y.return=J,Y)}function ke(J,Y,re){if(typeof Y=="string"&&Y!==""||typeof Y=="number"||typeof Y=="bigint")return Y=ey(""+Y,J.mode,re),Y.return=J,Y;if(typeof Y=="object"&&Y!==null){switch(Y.$$typeof){case _:return re=zp(Y.type,Y.key,Y.props,null,J.mode,re),lh(re,Y),re.return=J,re;case R:return Y=ty(Y,J.mode,re),Y.return=J,Y;case k:return Y=Kc(Y),ke(J,Y,re)}if(ve(Y)||z(Y))return Y=Bc(Y,J.mode,re,null),Y.return=J,Y;if(typeof Y.then=="function")return ke(J,Kp(Y),re);if(Y.$$typeof===j)return ke(J,$p(J,Y),re);Wp(J,Y)}return null}function ae(J,Y,re,xe){var rt=Y!==null?Y.key:null;if(typeof re=="string"&&re!==""||typeof re=="number"||typeof re=="bigint")return rt!==null?null:B(J,Y,""+re,xe);if(typeof re=="object"&&re!==null){switch(re.$$typeof){case _:return re.key===rt?G(J,Y,re,xe):null;case R:return re.key===rt?ie(J,Y,re,xe):null;case k:return re=Kc(re),ae(J,Y,re,xe)}if(ve(re)||z(re))return rt!==null?null:ge(J,Y,re,xe,null);if(typeof re.then=="function")return ae(J,Y,Kp(re),xe);if(re.$$typeof===j)return ae(J,Y,$p(J,re),xe);Wp(J,re)}return null}function ue(J,Y,re,xe,rt){if(typeof xe=="string"&&xe!==""||typeof xe=="number"||typeof xe=="bigint")return J=J.get(re)||null,B(Y,J,""+xe,rt);if(typeof xe=="object"&&xe!==null){switch(xe.$$typeof){case _:return J=J.get(xe.key===null?re:xe.key)||null,G(Y,J,xe,rt);case R:return J=J.get(xe.key===null?re:xe.key)||null,ie(Y,J,xe,rt);case k:return xe=Kc(xe),ue(J,Y,re,xe,rt)}if(ve(xe)||z(xe))return J=J.get(re)||null,ge(Y,J,xe,rt,null);if(typeof xe.then=="function")return ue(J,Y,re,Kp(xe),rt);if(xe.$$typeof===j)return ue(J,Y,re,$p(Y,xe),rt);Wp(Y,xe)}return null}function Ye(J,Y,re,xe){for(var rt=null,Ft=null,et=Y,_t=Y=0,Pt=null;et!==null&&_t<re.length;_t++){et.index>_t?(Pt=et,et=null):Pt=et.sibling;var Bt=ae(J,et,re[_t],xe);if(Bt===null){et===null&&(et=Pt);break}a&&et&&Bt.alternate===null&&o(J,et),Y=x(Bt,Y,_t),Ft===null?rt=Bt:Ft.sibling=Bt,Ft=Bt,et=Pt}if(_t===re.length)return u(J,et),jt&&ba(J,_t),rt;if(et===null){for(;_t<re.length;_t++)et=ke(J,re[_t],xe),et!==null&&(Y=x(et,Y,_t),Ft===null?rt=et:Ft.sibling=et,Ft=et);return jt&&ba(J,_t),rt}for(et=p(et);_t<re.length;_t++)Pt=ue(et,J,_t,re[_t],xe),Pt!==null&&(a&&Pt.alternate!==null&&et.delete(Pt.key===null?_t:Pt.key),Y=x(Pt,Y,_t),Ft===null?rt=Pt:Ft.sibling=Pt,Ft=Pt);return a&&et.forEach(function(Vo){return o(J,Vo)}),jt&&ba(J,_t),rt}function st(J,Y,re,xe){if(re==null)throw Error(r(151));for(var rt=null,Ft=null,et=Y,_t=Y=0,Pt=null,Bt=re.next();et!==null&&!Bt.done;_t++,Bt=re.next()){et.index>_t?(Pt=et,et=null):Pt=et.sibling;var Vo=ae(J,et,Bt.value,xe);if(Vo===null){et===null&&(et=Pt);break}a&&et&&Vo.alternate===null&&o(J,et),Y=x(Vo,Y,_t),Ft===null?rt=Vo:Ft.sibling=Vo,Ft=Vo,et=Pt}if(Bt.done)return u(J,et),jt&&ba(J,_t),rt;if(et===null){for(;!Bt.done;_t++,Bt=re.next())Bt=ke(J,Bt.value,xe),Bt!==null&&(Y=x(Bt,Y,_t),Ft===null?rt=Bt:Ft.sibling=Bt,Ft=Bt);return jt&&ba(J,_t),rt}for(et=p(et);!Bt.done;_t++,Bt=re.next())Bt=ue(et,J,_t,Bt.value,xe),Bt!==null&&(a&&Bt.alternate!==null&&et.delete(Bt.key===null?_t:Bt.key),Y=x(Bt,Y,_t),Ft===null?rt=Bt:Ft.sibling=Bt,Ft=Bt);return a&&et.forEach(function(Zj){return o(J,Zj)}),jt&&ba(J,_t),rt}function nn(J,Y,re,xe){if(typeof re=="object"&&re!==null&&re.type===E&&re.key===null&&(re=re.props.children),typeof re=="object"&&re!==null){switch(re.$$typeof){case _:e:{for(var rt=re.key;Y!==null;){if(Y.key===rt){if(rt=re.type,rt===E){if(Y.tag===7){u(J,Y.sibling),xe=y(Y,re.props.children),xe.return=J,J=xe;break e}}else if(Y.elementType===rt||typeof rt=="object"&&rt!==null&&rt.$$typeof===k&&Kc(rt)===Y.type){u(J,Y.sibling),xe=y(Y,re.props),lh(xe,re),xe.return=J,J=xe;break e}u(J,Y);break}else o(J,Y);Y=Y.sibling}re.type===E?(xe=Bc(re.props.children,J.mode,xe,re.key),xe.return=J,J=xe):(xe=zp(re.type,re.key,re.props,null,J.mode,xe),lh(xe,re),xe.return=J,J=xe)}return I(J);case R:e:{for(rt=re.key;Y!==null;){if(Y.key===rt)if(Y.tag===4&&Y.stateNode.containerInfo===re.containerInfo&&Y.stateNode.implementation===re.implementation){u(J,Y.sibling),xe=y(Y,re.children||[]),xe.return=J,J=xe;break e}else{u(J,Y);break}else o(J,Y);Y=Y.sibling}xe=ty(re,J.mode,xe),xe.return=J,J=xe}return I(J);case k:return re=Kc(re),nn(J,Y,re,xe)}if(ve(re))return Ye(J,Y,re,xe);if(z(re)){if(rt=z(re),typeof rt!="function")throw Error(r(150));return re=rt.call(re),st(J,Y,re,xe)}if(typeof re.then=="function")return nn(J,Y,Kp(re),xe);if(re.$$typeof===j)return nn(J,Y,$p(J,re),xe);Wp(J,re)}return typeof re=="string"&&re!==""||typeof re=="number"||typeof re=="bigint"?(re=""+re,Y!==null&&Y.tag===6?(u(J,Y.sibling),xe=y(Y,re),xe.return=J,J=xe):(u(J,Y),xe=ey(re,J.mode,xe),xe.return=J,J=xe),I(J)):u(J,Y)}return function(J,Y,re,xe){try{ch=0;var rt=nn(J,Y,re,xe);return du=null,rt}catch(et){if(et===uu||et===Hp)throw et;var Ft=bi(29,et,null,J.mode);return Ft.lanes=xe,Ft.return=J,Ft}finally{}}}var Yc=wk(!0),Ek=wk(!1),So=!1;function fy(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function py(a,o){a=a.updateQueue,o.updateQueue===a&&(o.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function To(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function ko(a,o,u){var p=a.updateQueue;if(p===null)return null;if(p=p.shared,(qt&2)!==0){var y=p.pending;return y===null?o.next=o:(o.next=y.next,y.next=o),p.pending=o,o=Vp(a),uk(a,null,u),o}return Up(a,p,o,u),Vp(a)}function uh(a,o,u){if(o=o.updateQueue,o!==null&&(o=o.shared,(u&4194048)!==0)){var p=o.lanes;p&=a.pendingLanes,u|=p,o.lanes=u,Mi(a,u)}}function my(a,o){var u=a.updateQueue,p=a.alternate;if(p!==null&&(p=p.updateQueue,u===p)){var y=null,x=null;if(u=u.firstBaseUpdate,u!==null){do{var I={lane:u.lane,tag:u.tag,payload:u.payload,callback:null,next:null};x===null?y=x=I:x=x.next=I,u=u.next}while(u!==null);x===null?y=x=o:x=x.next=o}else y=x=o;u={baseState:p.baseState,firstBaseUpdate:y,lastBaseUpdate:x,shared:p.shared,callbacks:p.callbacks},a.updateQueue=u;return}a=u.lastBaseUpdate,a===null?u.firstBaseUpdate=o:a.next=o,u.lastBaseUpdate=o}var gy=!1;function dh(){if(gy){var a=lu;if(a!==null)throw a}}function hh(a,o,u,p){gy=!1;var y=a.updateQueue;So=!1;var x=y.firstBaseUpdate,I=y.lastBaseUpdate,B=y.shared.pending;if(B!==null){y.shared.pending=null;var G=B,ie=G.next;G.next=null,I===null?x=ie:I.next=ie,I=G;var ge=a.alternate;ge!==null&&(ge=ge.updateQueue,B=ge.lastBaseUpdate,B!==I&&(B===null?ge.firstBaseUpdate=ie:B.next=ie,ge.lastBaseUpdate=G))}if(x!==null){var ke=y.baseState;I=0,ge=ie=G=null,B=x;do{var ae=B.lane&-536870913,ue=ae!==B.lane;if(ue?(It&ae)===ae:(p&ae)===ae){ae!==0&&ae===cu&&(gy=!0),ge!==null&&(ge=ge.next={lane:0,tag:B.tag,payload:B.payload,callback:null,next:null});e:{var Ye=a,st=B;ae=o;var nn=u;switch(st.tag){case 1:if(Ye=st.payload,typeof Ye=="function"){ke=Ye.call(nn,ke,ae);break e}ke=Ye;break e;case 3:Ye.flags=Ye.flags&-65537|128;case 0:if(Ye=st.payload,ae=typeof Ye=="function"?Ye.call(nn,ke,ae):Ye,ae==null)break e;ke=g({},ke,ae);break e;case 2:So=!0}}ae=B.callback,ae!==null&&(a.flags|=64,ue&&(a.flags|=8192),ue=y.callbacks,ue===null?y.callbacks=[ae]:ue.push(ae))}else ue={lane:ae,tag:B.tag,payload:B.payload,callback:B.callback,next:null},ge===null?(ie=ge=ue,G=ke):ge=ge.next=ue,I|=ae;if(B=B.next,B===null){if(B=y.shared.pending,B===null)break;ue=B,B=ue.next,ue.next=null,y.lastBaseUpdate=ue,y.shared.pending=null}}while(!0);ge===null&&(G=ke),y.baseState=G,y.firstBaseUpdate=ie,y.lastBaseUpdate=ge,x===null&&(y.shared.lanes=0),Ao|=I,a.lanes=I,a.memoizedState=ke}}function Rk(a,o){if(typeof a!="function")throw Error(r(191,a));a.call(o)}function Ak(a,o){var u=a.callbacks;if(u!==null)for(a.callbacks=null,a=0;a<u.length;a++)Rk(u[a],o)}var hu=q(null),Yp=q(0);function Nk(a,o){a=Na,fe(Yp,a),fe(hu,o),Na=a|o.baseLanes}function vy(){fe(Yp,Na),fe(hu,hu.current)}function yy(){Na=Yp.current,te(hu),te(Yp)}var xi=q(null),$i=null;function Co(a){var o=a.alternate;fe(Dn,Dn.current&1),fe(xi,a),$i===null&&(o===null||hu.current!==null||o.memoizedState!==null)&&($i=a)}function by(a){fe(Dn,Dn.current),fe(xi,a),$i===null&&($i=a)}function Ik(a){a.tag===22?(fe(Dn,Dn.current),fe(xi,a),$i===null&&($i=a)):wo()}function wo(){fe(Dn,Dn.current),fe(xi,xi.current)}function _i(a){te(xi),$i===a&&($i=null),te(Dn)}var Dn=q(0);function Qp(a){for(var o=a;o!==null;){if(o.tag===13){var u=o.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||Cb(u)||wb(u)))return o}else if(o.tag===19&&(o.memoizedProps.revealOrder==="forwards"||o.memoizedProps.revealOrder==="backwards"||o.memoizedProps.revealOrder==="unstable_legacy-backwards"||o.memoizedProps.revealOrder==="together")){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===a)break;for(;o.sibling===null;){if(o.return===null||o.return===a)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var Sa=0,yt=null,en=null,Hn=null,Xp=!1,fu=!1,Qc=!1,Jp=0,fh=0,pu=null,$6=0;function Cn(){throw Error(r(321))}function xy(a,o){if(o===null)return!1;for(var u=0;u<o.length&&u<a.length;u++)if(!yi(a[u],o[u]))return!1;return!0}function _y(a,o,u,p,y,x){return Sa=x,yt=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,K.H=a===null||a.memoizedState===null?pC:jy,Qc=!1,x=u(p,y),Qc=!1,fu&&(x=Mk(o,u,p,y)),Pk(a),x}function Pk(a){K.H=gh;var o=en!==null&&en.next!==null;if(Sa=0,Hn=en=yt=null,Xp=!1,fh=0,pu=null,o)throw Error(r(300));a===null||Gn||(a=a.dependencies,a!==null&&Bp(a)&&(Gn=!0))}function Mk(a,o,u,p){yt=a;var y=0;do{if(fu&&(pu=null),fh=0,fu=!1,25<=y)throw Error(r(301));if(y+=1,Hn=en=null,a.updateQueue!=null){var x=a.updateQueue;x.lastEffect=null,x.events=null,x.stores=null,x.memoCache!=null&&(x.memoCache.index=0)}K.H=mC,x=o(u,p)}while(fu);return x}function q6(){var a=K.H,o=a.useState()[0];return o=typeof o.then=="function"?ph(o):o,a=a.useState()[0],(en!==null?en.memoizedState:null)!==a&&(yt.flags|=1024),o}function Sy(){var a=Jp!==0;return Jp=0,a}function Ty(a,o,u){o.updateQueue=a.updateQueue,o.flags&=-2053,a.lanes&=~u}function ky(a){if(Xp){for(a=a.memoizedState;a!==null;){var o=a.queue;o!==null&&(o.pending=null),a=a.next}Xp=!1}Sa=0,Hn=en=yt=null,fu=!1,fh=Jp=0,pu=null}function Vr(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Hn===null?yt.memoizedState=Hn=a:Hn=Hn.next=a,Hn}function On(){if(en===null){var a=yt.alternate;a=a!==null?a.memoizedState:null}else a=en.next;var o=Hn===null?yt.memoizedState:Hn.next;if(o!==null)Hn=o,en=a;else{if(a===null)throw yt.alternate===null?Error(r(467)):Error(r(310));en=a,a={memoizedState:en.memoizedState,baseState:en.baseState,baseQueue:en.baseQueue,queue:en.queue,next:null},Hn===null?yt.memoizedState=Hn=a:Hn=Hn.next=a}return Hn}function Zp(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function ph(a){var o=fh;return fh+=1,pu===null&&(pu=[]),a=Tk(pu,a,o),o=yt,(Hn===null?o.memoizedState:Hn.next)===null&&(o=o.alternate,K.H=o===null||o.memoizedState===null?pC:jy),a}function em(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return ph(a);if(a.$$typeof===j)return br(a)}throw Error(r(438,String(a)))}function Cy(a){var o=null,u=yt.updateQueue;if(u!==null&&(o=u.memoCache),o==null){var p=yt.alternate;p!==null&&(p=p.updateQueue,p!==null&&(p=p.memoCache,p!=null&&(o={data:p.data.map(function(y){return y.slice()}),index:0})))}if(o==null&&(o={data:[],index:0}),u===null&&(u=Zp(),yt.updateQueue=u),u.memoCache=o,u=o.data[o.index],u===void 0)for(u=o.data[o.index]=Array(a),p=0;p<a;p++)u[p]=L;return o.index++,u}function Ta(a,o){return typeof o=="function"?o(a):o}function tm(a){var o=On();return wy(o,en,a)}function wy(a,o,u){var p=a.queue;if(p===null)throw Error(r(311));p.lastRenderedReducer=u;var y=a.baseQueue,x=p.pending;if(x!==null){if(y!==null){var I=y.next;y.next=x.next,x.next=I}o.baseQueue=y=x,p.pending=null}if(x=a.baseState,y===null)a.memoizedState=x;else{o=y.next;var B=I=null,G=null,ie=o,ge=!1;do{var ke=ie.lane&-536870913;if(ke!==ie.lane?(It&ke)===ke:(Sa&ke)===ke){var ae=ie.revertLane;if(ae===0)G!==null&&(G=G.next={lane:0,revertLane:0,gesture:null,action:ie.action,hasEagerState:ie.hasEagerState,eagerState:ie.eagerState,next:null}),ke===cu&&(ge=!0);else if((Sa&ae)===ae){ie=ie.next,ae===cu&&(ge=!0);continue}else ke={lane:0,revertLane:ie.revertLane,gesture:null,action:ie.action,hasEagerState:ie.hasEagerState,eagerState:ie.eagerState,next:null},G===null?(B=G=ke,I=x):G=G.next=ke,yt.lanes|=ae,Ao|=ae;ke=ie.action,Qc&&u(x,ke),x=ie.hasEagerState?ie.eagerState:u(x,ke)}else ae={lane:ke,revertLane:ie.revertLane,gesture:ie.gesture,action:ie.action,hasEagerState:ie.hasEagerState,eagerState:ie.eagerState,next:null},G===null?(B=G=ae,I=x):G=G.next=ae,yt.lanes|=ke,Ao|=ke;ie=ie.next}while(ie!==null&&ie!==o);if(G===null?I=x:G.next=B,!yi(x,a.memoizedState)&&(Gn=!0,ge&&(u=lu,u!==null)))throw u;a.memoizedState=x,a.baseState=I,a.baseQueue=G,p.lastRenderedState=x}return y===null&&(p.lanes=0),[a.memoizedState,p.dispatch]}function Ey(a){var o=On(),u=o.queue;if(u===null)throw Error(r(311));u.lastRenderedReducer=a;var p=u.dispatch,y=u.pending,x=o.memoizedState;if(y!==null){u.pending=null;var I=y=y.next;do x=a(x,I.action),I=I.next;while(I!==y);yi(x,o.memoizedState)||(Gn=!0),o.memoizedState=x,o.baseQueue===null&&(o.baseState=x),u.lastRenderedState=x}return[x,p]}function Dk(a,o,u){var p=yt,y=On(),x=jt;if(x){if(u===void 0)throw Error(r(407));u=u()}else u=o();var I=!yi((en||y).memoizedState,u);if(I&&(y.memoizedState=u,Gn=!0),y=y.queue,Ny(Lk.bind(null,p,y,a),[a]),y.getSnapshot!==o||I||Hn!==null&&Hn.memoizedState.tag&1){if(p.flags|=2048,mu(9,{destroy:void 0},jk.bind(null,p,y,u,o),null),an===null)throw Error(r(349));x||(Sa&127)!==0||Ok(p,o,u)}return u}function Ok(a,o,u){a.flags|=16384,a={getSnapshot:o,value:u},o=yt.updateQueue,o===null?(o=Zp(),yt.updateQueue=o,o.stores=[a]):(u=o.stores,u===null?o.stores=[a]:u.push(a))}function jk(a,o,u,p){o.value=u,o.getSnapshot=p,Uk(o)&&Vk(a)}function Lk(a,o,u){return u(function(){Uk(o)&&Vk(a)})}function Uk(a){var o=a.getSnapshot;a=a.value;try{var u=o();return!yi(a,u)}catch{return!0}}function Vk(a){var o=Fc(a,2);o!==null&&ri(o,a,2)}function Ry(a){var o=Vr();if(typeof a=="function"){var u=a;if(a=u(),Qc){Nr(!0);try{u()}finally{Nr(!1)}}}return o.memoizedState=o.baseState=a,o.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ta,lastRenderedState:a},o}function zk(a,o,u,p){return a.baseState=u,wy(a,en,typeof p=="function"?p:Ta)}function H6(a,o,u,p,y){if(im(a))throw Error(r(485));if(a=o.action,a!==null){var x={payload:y,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(I){x.listeners.push(I)}};K.T!==null?u(!0):x.isTransition=!1,p(x),u=o.pending,u===null?(x.next=o.pending=x,Fk(o,x)):(x.next=u.next,o.pending=u.next=x)}}function Fk(a,o){var u=o.action,p=o.payload,y=a.state;if(o.isTransition){var x=K.T,I={};K.T=I;try{var B=u(y,p),G=K.S;G!==null&&G(I,B),Bk(a,o,B)}catch(ie){Ay(a,o,ie)}finally{x!==null&&I.types!==null&&(x.types=I.types),K.T=x}}else try{x=u(y,p),Bk(a,o,x)}catch(ie){Ay(a,o,ie)}}function Bk(a,o,u){u!==null&&typeof u=="object"&&typeof u.then=="function"?u.then(function(p){$k(a,o,p)},function(p){return Ay(a,o,p)}):$k(a,o,u)}function $k(a,o,u){o.status="fulfilled",o.value=u,qk(o),a.state=u,o=a.pending,o!==null&&(u=o.next,u===o?a.pending=null:(u=u.next,o.next=u,Fk(a,u)))}function Ay(a,o,u){var p=a.pending;if(a.pending=null,p!==null){p=p.next;do o.status="rejected",o.reason=u,qk(o),o=o.next;while(o!==p)}a.action=null}function qk(a){a=a.listeners;for(var o=0;o<a.length;o++)(0,a[o])()}function Hk(a,o){return o}function Gk(a,o){if(jt){var u=an.formState;if(u!==null){e:{var p=yt;if(jt){if(fn){t:{for(var y=fn,x=Bi;y.nodeType!==8;){if(!x){y=null;break t}if(y=qi(y.nextSibling),y===null){y=null;break t}}x=y.data,y=x==="F!"||x==="F"?y:null}if(y){fn=qi(y.nextSibling),p=y.data==="F!";break e}}xo(p)}p=!1}p&&(o=u[0])}}return u=Vr(),u.memoizedState=u.baseState=o,p={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Hk,lastRenderedState:o},u.queue=p,u=dC.bind(null,yt,p),p.dispatch=u,p=Ry(!1),x=Oy.bind(null,yt,!1,p.queue),p=Vr(),y={state:o,dispatch:null,action:a,pending:null},p.queue=y,u=H6.bind(null,yt,y,x,u),y.dispatch=u,p.memoizedState=a,[o,u,!1]}function Kk(a){var o=On();return Wk(o,en,a)}function Wk(a,o,u){if(o=wy(a,o,Hk)[0],a=tm(Ta)[0],typeof o=="object"&&o!==null&&typeof o.then=="function")try{var p=ph(o)}catch(I){throw I===uu?Hp:I}else p=o;o=On();var y=o.queue,x=y.dispatch;return u!==o.memoizedState&&(yt.flags|=2048,mu(9,{destroy:void 0},G6.bind(null,y,u),null)),[p,x,a]}function G6(a,o){a.action=o}function Yk(a){var o=On(),u=en;if(u!==null)return Wk(o,u,a);On(),o=o.memoizedState,u=On();var p=u.queue.dispatch;return u.memoizedState=a,[o,p,!1]}function mu(a,o,u,p){return a={tag:a,create:u,deps:p,inst:o,next:null},o=yt.updateQueue,o===null&&(o=Zp(),yt.updateQueue=o),u=o.lastEffect,u===null?o.lastEffect=a.next=a:(p=u.next,u.next=a,a.next=p,o.lastEffect=a),a}function Qk(){return On().memoizedState}function nm(a,o,u,p){var y=Vr();yt.flags|=a,y.memoizedState=mu(1|o,{destroy:void 0},u,p===void 0?null:p)}function rm(a,o,u,p){var y=On();p=p===void 0?null:p;var x=y.memoizedState.inst;en!==null&&p!==null&&xy(p,en.memoizedState.deps)?y.memoizedState=mu(o,x,u,p):(yt.flags|=a,y.memoizedState=mu(1|o,x,u,p))}function Xk(a,o){nm(8390656,8,a,o)}function Ny(a,o){rm(2048,8,a,o)}function K6(a){yt.flags|=4;var o=yt.updateQueue;if(o===null)o=Zp(),yt.updateQueue=o,o.events=[a];else{var u=o.events;u===null?o.events=[a]:u.push(a)}}function Jk(a){var o=On().memoizedState;return K6({ref:o,nextImpl:a}),function(){if((qt&2)!==0)throw Error(r(440));return o.impl.apply(void 0,arguments)}}function Zk(a,o){return rm(4,2,a,o)}function eC(a,o){return rm(4,4,a,o)}function tC(a,o){if(typeof o=="function"){a=a();var u=o(a);return function(){typeof u=="function"?u():o(null)}}if(o!=null)return a=a(),o.current=a,function(){o.current=null}}function nC(a,o,u){u=u!=null?u.concat([a]):null,rm(4,4,tC.bind(null,o,a),u)}function Iy(){}function rC(a,o){var u=On();o=o===void 0?null:o;var p=u.memoizedState;return o!==null&&xy(o,p[1])?p[0]:(u.memoizedState=[a,o],a)}function iC(a,o){var u=On();o=o===void 0?null:o;var p=u.memoizedState;if(o!==null&&xy(o,p[1]))return p[0];if(p=a(),Qc){Nr(!0);try{a()}finally{Nr(!1)}}return u.memoizedState=[p,o],p}function Py(a,o,u){return u===void 0||(Sa&1073741824)!==0&&(It&261930)===0?a.memoizedState=o:(a.memoizedState=u,a=sw(),yt.lanes|=a,Ao|=a,u)}function sC(a,o,u,p){return yi(u,o)?u:hu.current!==null?(a=Py(a,u,p),yi(a,o)||(Gn=!0),a):(Sa&42)===0||(Sa&1073741824)!==0&&(It&261930)===0?(Gn=!0,a.memoizedState=u):(a=sw(),yt.lanes|=a,Ao|=a,o)}function aC(a,o,u,p,y){var x=oe.p;oe.p=x!==0&&8>x?x:8;var I=K.T,B={};K.T=B,Oy(a,!1,o,u);try{var G=y(),ie=K.S;if(ie!==null&&ie(B,G),G!==null&&typeof G=="object"&&typeof G.then=="function"){var ge=B6(G,p);mh(a,o,ge,ki(a))}else mh(a,o,p,ki(a))}catch(ke){mh(a,o,{then:function(){},status:"rejected",reason:ke},ki())}finally{oe.p=x,I!==null&&B.types!==null&&(I.types=B.types),K.T=I}}function W6(){}function My(a,o,u,p){if(a.tag!==5)throw Error(r(476));var y=oC(a).queue;aC(a,y,o,ee,u===null?W6:function(){return cC(a),u(p)})}function oC(a){var o=a.memoizedState;if(o!==null)return o;o={memoizedState:ee,baseState:ee,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ta,lastRenderedState:ee},next:null};var u={};return o.next={memoizedState:u,baseState:u,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ta,lastRenderedState:u},next:null},a.memoizedState=o,a=a.alternate,a!==null&&(a.memoizedState=o),o}function cC(a){var o=oC(a);o.next===null&&(o=a.alternate.memoizedState),mh(a,o.next.queue,{},ki())}function Dy(){return br(Ph)}function lC(){return On().memoizedState}function uC(){return On().memoizedState}function Y6(a){for(var o=a.return;o!==null;){switch(o.tag){case 24:case 3:var u=ki();a=To(u);var p=ko(o,a,u);p!==null&&(ri(p,o,u),uh(p,o,u)),o={cache:ly()},a.payload=o;return}o=o.return}}function Q6(a,o,u){var p=ki();u={lane:p,revertLane:0,gesture:null,action:u,hasEagerState:!1,eagerState:null,next:null},im(a)?hC(o,u):(u=J0(a,o,u,p),u!==null&&(ri(u,a,p),fC(u,o,p)))}function dC(a,o,u){var p=ki();mh(a,o,u,p)}function mh(a,o,u,p){var y={lane:p,revertLane:0,gesture:null,action:u,hasEagerState:!1,eagerState:null,next:null};if(im(a))hC(o,y);else{var x=a.alternate;if(a.lanes===0&&(x===null||x.lanes===0)&&(x=o.lastRenderedReducer,x!==null))try{var I=o.lastRenderedState,B=x(I,u);if(y.hasEagerState=!0,y.eagerState=B,yi(B,I))return Up(a,o,y,0),an===null&&Lp(),!1}catch{}finally{}if(u=J0(a,o,y,p),u!==null)return ri(u,a,p),fC(u,o,p),!0}return!1}function Oy(a,o,u,p){if(p={lane:2,revertLane:fb(),gesture:null,action:p,hasEagerState:!1,eagerState:null,next:null},im(a)){if(o)throw Error(r(479))}else o=J0(a,u,p,2),o!==null&&ri(o,a,2)}function im(a){var o=a.alternate;return a===yt||o!==null&&o===yt}function hC(a,o){fu=Xp=!0;var u=a.pending;u===null?o.next=o:(o.next=u.next,u.next=o),a.pending=o}function fC(a,o,u){if((u&4194048)!==0){var p=o.lanes;p&=a.pendingLanes,u|=p,o.lanes=u,Mi(a,u)}}var gh={readContext:br,use:em,useCallback:Cn,useContext:Cn,useEffect:Cn,useImperativeHandle:Cn,useLayoutEffect:Cn,useInsertionEffect:Cn,useMemo:Cn,useReducer:Cn,useRef:Cn,useState:Cn,useDebugValue:Cn,useDeferredValue:Cn,useTransition:Cn,useSyncExternalStore:Cn,useId:Cn,useHostTransitionStatus:Cn,useFormState:Cn,useActionState:Cn,useOptimistic:Cn,useMemoCache:Cn,useCacheRefresh:Cn};gh.useEffectEvent=Cn;var pC={readContext:br,use:em,useCallback:function(a,o){return Vr().memoizedState=[a,o===void 0?null:o],a},useContext:br,useEffect:Xk,useImperativeHandle:function(a,o,u){u=u!=null?u.concat([a]):null,nm(4194308,4,tC.bind(null,o,a),u)},useLayoutEffect:function(a,o){return nm(4194308,4,a,o)},useInsertionEffect:function(a,o){nm(4,2,a,o)},useMemo:function(a,o){var u=Vr();o=o===void 0?null:o;var p=a();if(Qc){Nr(!0);try{a()}finally{Nr(!1)}}return u.memoizedState=[p,o],p},useReducer:function(a,o,u){var p=Vr();if(u!==void 0){var y=u(o);if(Qc){Nr(!0);try{u(o)}finally{Nr(!1)}}}else y=o;return p.memoizedState=p.baseState=y,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:y},p.queue=a,a=a.dispatch=Q6.bind(null,yt,a),[p.memoizedState,a]},useRef:function(a){var o=Vr();return a={current:a},o.memoizedState=a},useState:function(a){a=Ry(a);var o=a.queue,u=dC.bind(null,yt,o);return o.dispatch=u,[a.memoizedState,u]},useDebugValue:Iy,useDeferredValue:function(a,o){var u=Vr();return Py(u,a,o)},useTransition:function(){var a=Ry(!1);return a=aC.bind(null,yt,a.queue,!0,!1),Vr().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,o,u){var p=yt,y=Vr();if(jt){if(u===void 0)throw Error(r(407));u=u()}else{if(u=o(),an===null)throw Error(r(349));(It&127)!==0||Ok(p,o,u)}y.memoizedState=u;var x={value:u,getSnapshot:o};return y.queue=x,Xk(Lk.bind(null,p,x,a),[a]),p.flags|=2048,mu(9,{destroy:void 0},jk.bind(null,p,x,u,o),null),u},useId:function(){var a=Vr(),o=an.identifierPrefix;if(jt){var u=Us,p=Ls;u=(p&~(1<<32-ln(p)-1)).toString(32)+u,o="_"+o+"R_"+u,u=Jp++,0<u&&(o+="H"+u.toString(32)),o+="_"}else u=$6++,o="_"+o+"r_"+u.toString(32)+"_";return a.memoizedState=o},useHostTransitionStatus:Dy,useFormState:Gk,useActionState:Gk,useOptimistic:function(a){var o=Vr();o.memoizedState=o.baseState=a;var u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return o.queue=u,o=Oy.bind(null,yt,!0,u),u.dispatch=o,[a,o]},useMemoCache:Cy,useCacheRefresh:function(){return Vr().memoizedState=Y6.bind(null,yt)},useEffectEvent:function(a){var o=Vr(),u={impl:a};return o.memoizedState=u,function(){if((qt&2)!==0)throw Error(r(440));return u.impl.apply(void 0,arguments)}}},jy={readContext:br,use:em,useCallback:rC,useContext:br,useEffect:Ny,useImperativeHandle:nC,useInsertionEffect:Zk,useLayoutEffect:eC,useMemo:iC,useReducer:tm,useRef:Qk,useState:function(){return tm(Ta)},useDebugValue:Iy,useDeferredValue:function(a,o){var u=On();return sC(u,en.memoizedState,a,o)},useTransition:function(){var a=tm(Ta)[0],o=On().memoizedState;return[typeof a=="boolean"?a:ph(a),o]},useSyncExternalStore:Dk,useId:lC,useHostTransitionStatus:Dy,useFormState:Kk,useActionState:Kk,useOptimistic:function(a,o){var u=On();return zk(u,en,a,o)},useMemoCache:Cy,useCacheRefresh:uC};jy.useEffectEvent=Jk;var mC={readContext:br,use:em,useCallback:rC,useContext:br,useEffect:Ny,useImperativeHandle:nC,useInsertionEffect:Zk,useLayoutEffect:eC,useMemo:iC,useReducer:Ey,useRef:Qk,useState:function(){return Ey(Ta)},useDebugValue:Iy,useDeferredValue:function(a,o){var u=On();return en===null?Py(u,a,o):sC(u,en.memoizedState,a,o)},useTransition:function(){var a=Ey(Ta)[0],o=On().memoizedState;return[typeof a=="boolean"?a:ph(a),o]},useSyncExternalStore:Dk,useId:lC,useHostTransitionStatus:Dy,useFormState:Yk,useActionState:Yk,useOptimistic:function(a,o){var u=On();return en!==null?zk(u,en,a,o):(u.baseState=a,[a,u.queue.dispatch])},useMemoCache:Cy,useCacheRefresh:uC};mC.useEffectEvent=Jk;function Ly(a,o,u,p){o=a.memoizedState,u=u(p,o),u=u==null?o:g({},o,u),a.memoizedState=u,a.lanes===0&&(a.updateQueue.baseState=u)}var Uy={enqueueSetState:function(a,o,u){a=a._reactInternals;var p=ki(),y=To(p);y.payload=o,u!=null&&(y.callback=u),o=ko(a,y,p),o!==null&&(ri(o,a,p),uh(o,a,p))},enqueueReplaceState:function(a,o,u){a=a._reactInternals;var p=ki(),y=To(p);y.tag=1,y.payload=o,u!=null&&(y.callback=u),o=ko(a,y,p),o!==null&&(ri(o,a,p),uh(o,a,p))},enqueueForceUpdate:function(a,o){a=a._reactInternals;var u=ki(),p=To(u);p.tag=2,o!=null&&(p.callback=o),o=ko(a,p,u),o!==null&&(ri(o,a,u),uh(o,a,u))}};function gC(a,o,u,p,y,x,I){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(p,x,I):o.prototype&&o.prototype.isPureReactComponent?!nh(u,p)||!nh(y,x):!0}function vC(a,o,u,p){a=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(u,p),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(u,p),o.state!==a&&Uy.enqueueReplaceState(o,o.state,null)}function Xc(a,o){var u=o;if("ref"in o){u={};for(var p in o)p!=="ref"&&(u[p]=o[p])}if(a=a.defaultProps){u===o&&(u=g({},u));for(var y in a)u[y]===void 0&&(u[y]=a[y])}return u}function yC(a){jp(a)}function bC(a){console.error(a)}function xC(a){jp(a)}function sm(a,o){try{var u=a.onUncaughtError;u(o.value,{componentStack:o.stack})}catch(p){setTimeout(function(){throw p})}}function _C(a,o,u){try{var p=a.onCaughtError;p(u.value,{componentStack:u.stack,errorBoundary:o.tag===1?o.stateNode:null})}catch(y){setTimeout(function(){throw y})}}function Vy(a,o,u){return u=To(u),u.tag=3,u.payload={element:null},u.callback=function(){sm(a,o)},u}function SC(a){return a=To(a),a.tag=3,a}function TC(a,o,u,p){var y=u.type.getDerivedStateFromError;if(typeof y=="function"){var x=p.value;a.payload=function(){return y(x)},a.callback=function(){_C(o,u,p)}}var I=u.stateNode;I!==null&&typeof I.componentDidCatch=="function"&&(a.callback=function(){_C(o,u,p),typeof y!="function"&&(No===null?No=new Set([this]):No.add(this));var B=p.stack;this.componentDidCatch(p.value,{componentStack:B!==null?B:""})})}function X6(a,o,u,p,y){if(u.flags|=32768,p!==null&&typeof p=="object"&&typeof p.then=="function"){if(o=u.alternate,o!==null&&ou(o,u,y,!0),u=xi.current,u!==null){switch(u.tag){case 31:case 13:return $i===null?vm():u.alternate===null&&wn===0&&(wn=3),u.flags&=-257,u.flags|=65536,u.lanes=y,p===Gp?u.flags|=16384:(o=u.updateQueue,o===null?u.updateQueue=new Set([p]):o.add(p),ub(a,p,y)),!1;case 22:return u.flags|=65536,p===Gp?u.flags|=16384:(o=u.updateQueue,o===null?(o={transitions:null,markerInstances:null,retryQueue:new Set([p])},u.updateQueue=o):(u=o.retryQueue,u===null?o.retryQueue=new Set([p]):u.add(p)),ub(a,p,y)),!1}throw Error(r(435,u.tag))}return ub(a,p,y),vm(),!1}if(jt)return o=xi.current,o!==null?((o.flags&65536)===0&&(o.flags|=256),o.flags|=65536,o.lanes=y,p!==iy&&(a=Error(r(422),{cause:p}),sh(Vi(a,u)))):(p!==iy&&(o=Error(r(423),{cause:p}),sh(Vi(o,u))),a=a.current.alternate,a.flags|=65536,y&=-y,a.lanes|=y,p=Vi(p,u),y=Vy(a.stateNode,p,y),my(a,y),wn!==4&&(wn=2)),!1;var x=Error(r(520),{cause:p});if(x=Vi(x,u),kh===null?kh=[x]:kh.push(x),wn!==4&&(wn=2),o===null)return!0;p=Vi(p,u),u=o;do{switch(u.tag){case 3:return u.flags|=65536,a=y&-y,u.lanes|=a,a=Vy(u.stateNode,p,a),my(u,a),!1;case 1:if(o=u.type,x=u.stateNode,(u.flags&128)===0&&(typeof o.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(No===null||!No.has(x))))return u.flags|=65536,y&=-y,u.lanes|=y,y=SC(y),TC(y,a,u,p),my(u,y),!1}u=u.return}while(u!==null);return!1}var zy=Error(r(461)),Gn=!1;function xr(a,o,u,p){o.child=a===null?Ek(o,null,u,p):Yc(o,a.child,u,p)}function kC(a,o,u,p,y){u=u.render;var x=o.ref;if("ref"in p){var I={};for(var B in p)B!=="ref"&&(I[B]=p[B])}else I=p;return Hc(o),p=_y(a,o,u,I,x,y),B=Sy(),a!==null&&!Gn?(Ty(a,o,y),ka(a,o,y)):(jt&&B&&ny(o),o.flags|=1,xr(a,o,p,y),o.child)}function CC(a,o,u,p,y){if(a===null){var x=u.type;return typeof x=="function"&&!Z0(x)&&x.defaultProps===void 0&&u.compare===null?(o.tag=15,o.type=x,wC(a,o,x,p,y)):(a=zp(u.type,null,p,o,o.mode,y),a.ref=o.ref,a.return=o,o.child=a)}if(x=a.child,!Wy(a,y)){var I=x.memoizedProps;if(u=u.compare,u=u!==null?u:nh,u(I,p)&&a.ref===o.ref)return ka(a,o,y)}return o.flags|=1,a=ya(x,p),a.ref=o.ref,a.return=o,o.child=a}function wC(a,o,u,p,y){if(a!==null){var x=a.memoizedProps;if(nh(x,p)&&a.ref===o.ref)if(Gn=!1,o.pendingProps=p=x,Wy(a,y))(a.flags&131072)!==0&&(Gn=!0);else return o.lanes=a.lanes,ka(a,o,y)}return Fy(a,o,u,p,y)}function EC(a,o,u,p){var y=p.children,x=a!==null?a.memoizedState:null;if(a===null&&o.stateNode===null&&(o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),p.mode==="hidden"){if((o.flags&128)!==0){if(x=x!==null?x.baseLanes|u:u,a!==null){for(p=o.child=a.child,y=0;p!==null;)y=y|p.lanes|p.childLanes,p=p.sibling;p=y&~x}else p=0,o.child=null;return RC(a,o,x,u,p)}if((u&536870912)!==0)o.memoizedState={baseLanes:0,cachePool:null},a!==null&&qp(o,x!==null?x.cachePool:null),x!==null?Nk(o,x):vy(),Ik(o);else return p=o.lanes=536870912,RC(a,o,x!==null?x.baseLanes|u:u,u,p)}else x!==null?(qp(o,x.cachePool),Nk(o,x),wo(),o.memoizedState=null):(a!==null&&qp(o,null),vy(),wo());return xr(a,o,y,u),o.child}function vh(a,o){return a!==null&&a.tag===22||o.stateNode!==null||(o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),o.sibling}function RC(a,o,u,p,y){var x=dy();return x=x===null?null:{parent:qn._currentValue,pool:x},o.memoizedState={baseLanes:u,cachePool:x},a!==null&&qp(o,null),vy(),Ik(o),a!==null&&ou(a,o,p,!0),o.childLanes=y,null}function am(a,o){return o=cm({mode:o.mode,children:o.children},a.mode),o.ref=a.ref,a.child=o,o.return=a,o}function AC(a,o,u){return Yc(o,a.child,null,u),a=am(o,o.pendingProps),a.flags|=2,_i(o),o.memoizedState=null,a}function J6(a,o,u){var p=o.pendingProps,y=(o.flags&128)!==0;if(o.flags&=-129,a===null){if(jt){if(p.mode==="hidden")return a=am(o,p),o.lanes=536870912,vh(null,a);if(by(o),(a=fn)?(a=Fw(a,Bi),a=a!==null&&a.data==="&"?a:null,a!==null&&(o.memoizedState={dehydrated:a,treeContext:yo!==null?{id:Ls,overflow:Us}:null,retryLane:536870912,hydrationErrors:null},u=hk(a),u.return=o,o.child=u,yr=o,fn=null)):a=null,a===null)throw xo(o);return o.lanes=536870912,null}return am(o,p)}var x=a.memoizedState;if(x!==null){var I=x.dehydrated;if(by(o),y)if(o.flags&256)o.flags&=-257,o=AC(a,o,u);else if(o.memoizedState!==null)o.child=a.child,o.flags|=128,o=null;else throw Error(r(558));else if(Gn||ou(a,o,u,!1),y=(u&a.childLanes)!==0,Gn||y){if(p=an,p!==null&&(I=Pn(p,u),I!==0&&I!==x.retryLane))throw x.retryLane=I,Fc(a,I),ri(p,a,I),zy;vm(),o=AC(a,o,u)}else a=x.treeContext,fn=qi(I.nextSibling),yr=o,jt=!0,bo=null,Bi=!1,a!==null&&mk(o,a),o=am(o,p),o.flags|=4096;return o}return a=ya(a.child,{mode:p.mode,children:p.children}),a.ref=o.ref,o.child=a,a.return=o,a}function om(a,o){var u=o.ref;if(u===null)a!==null&&a.ref!==null&&(o.flags|=4194816);else{if(typeof u!="function"&&typeof u!="object")throw Error(r(284));(a===null||a.ref!==u)&&(o.flags|=4194816)}}function Fy(a,o,u,p,y){return Hc(o),u=_y(a,o,u,p,void 0,y),p=Sy(),a!==null&&!Gn?(Ty(a,o,y),ka(a,o,y)):(jt&&p&&ny(o),o.flags|=1,xr(a,o,u,y),o.child)}function NC(a,o,u,p,y,x){return Hc(o),o.updateQueue=null,u=Mk(o,p,u,y),Pk(a),p=Sy(),a!==null&&!Gn?(Ty(a,o,x),ka(a,o,x)):(jt&&p&&ny(o),o.flags|=1,xr(a,o,u,x),o.child)}function IC(a,o,u,p,y){if(Hc(o),o.stateNode===null){var x=ru,I=u.contextType;typeof I=="object"&&I!==null&&(x=br(I)),x=new u(p,x),o.memoizedState=x.state!==null&&x.state!==void 0?x.state:null,x.updater=Uy,o.stateNode=x,x._reactInternals=o,x=o.stateNode,x.props=p,x.state=o.memoizedState,x.refs={},fy(o),I=u.contextType,x.context=typeof I=="object"&&I!==null?br(I):ru,x.state=o.memoizedState,I=u.getDerivedStateFromProps,typeof I=="function"&&(Ly(o,u,I,p),x.state=o.memoizedState),typeof u.getDerivedStateFromProps=="function"||typeof x.getSnapshotBeforeUpdate=="function"||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(I=x.state,typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount(),I!==x.state&&Uy.enqueueReplaceState(x,x.state,null),hh(o,p,x,y),dh(),x.state=o.memoizedState),typeof x.componentDidMount=="function"&&(o.flags|=4194308),p=!0}else if(a===null){x=o.stateNode;var B=o.memoizedProps,G=Xc(u,B);x.props=G;var ie=x.context,ge=u.contextType;I=ru,typeof ge=="object"&&ge!==null&&(I=br(ge));var ke=u.getDerivedStateFromProps;ge=typeof ke=="function"||typeof x.getSnapshotBeforeUpdate=="function",B=o.pendingProps!==B,ge||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||(B||ie!==I)&&vC(o,x,p,I),So=!1;var ae=o.memoizedState;x.state=ae,hh(o,p,x,y),dh(),ie=o.memoizedState,B||ae!==ie||So?(typeof ke=="function"&&(Ly(o,u,ke,p),ie=o.memoizedState),(G=So||gC(o,u,G,p,ae,ie,I))?(ge||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount()),typeof x.componentDidMount=="function"&&(o.flags|=4194308)):(typeof x.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=p,o.memoizedState=ie),x.props=p,x.state=ie,x.context=I,p=G):(typeof x.componentDidMount=="function"&&(o.flags|=4194308),p=!1)}else{x=o.stateNode,py(a,o),I=o.memoizedProps,ge=Xc(u,I),x.props=ge,ke=o.pendingProps,ae=x.context,ie=u.contextType,G=ru,typeof ie=="object"&&ie!==null&&(G=br(ie)),B=u.getDerivedStateFromProps,(ie=typeof B=="function"||typeof x.getSnapshotBeforeUpdate=="function")||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||(I!==ke||ae!==G)&&vC(o,x,p,G),So=!1,ae=o.memoizedState,x.state=ae,hh(o,p,x,y),dh();var ue=o.memoizedState;I!==ke||ae!==ue||So||a!==null&&a.dependencies!==null&&Bp(a.dependencies)?(typeof B=="function"&&(Ly(o,u,B,p),ue=o.memoizedState),(ge=So||gC(o,u,ge,p,ae,ue,G)||a!==null&&a.dependencies!==null&&Bp(a.dependencies))?(ie||typeof x.UNSAFE_componentWillUpdate!="function"&&typeof x.componentWillUpdate!="function"||(typeof x.componentWillUpdate=="function"&&x.componentWillUpdate(p,ue,G),typeof x.UNSAFE_componentWillUpdate=="function"&&x.UNSAFE_componentWillUpdate(p,ue,G)),typeof x.componentDidUpdate=="function"&&(o.flags|=4),typeof x.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof x.componentDidUpdate!="function"||I===a.memoizedProps&&ae===a.memoizedState||(o.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||I===a.memoizedProps&&ae===a.memoizedState||(o.flags|=1024),o.memoizedProps=p,o.memoizedState=ue),x.props=p,x.state=ue,x.context=G,p=ge):(typeof x.componentDidUpdate!="function"||I===a.memoizedProps&&ae===a.memoizedState||(o.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||I===a.memoizedProps&&ae===a.memoizedState||(o.flags|=1024),p=!1)}return x=p,om(a,o),p=(o.flags&128)!==0,x||p?(x=o.stateNode,u=p&&typeof u.getDerivedStateFromError!="function"?null:x.render(),o.flags|=1,a!==null&&p?(o.child=Yc(o,a.child,null,y),o.child=Yc(o,null,u,y)):xr(a,o,u,y),o.memoizedState=x.state,a=o.child):a=ka(a,o,y),a}function PC(a,o,u,p){return $c(),o.flags|=256,xr(a,o,u,p),o.child}var By={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function $y(a){return{baseLanes:a,cachePool:_k()}}function qy(a,o,u){return a=a!==null?a.childLanes&~u:0,o&&(a|=Ti),a}function MC(a,o,u){var p=o.pendingProps,y=!1,x=(o.flags&128)!==0,I;if((I=x)||(I=a!==null&&a.memoizedState===null?!1:(Dn.current&2)!==0),I&&(y=!0,o.flags&=-129),I=(o.flags&32)!==0,o.flags&=-33,a===null){if(jt){if(y?Co(o):wo(),(a=fn)?(a=Fw(a,Bi),a=a!==null&&a.data!=="&"?a:null,a!==null&&(o.memoizedState={dehydrated:a,treeContext:yo!==null?{id:Ls,overflow:Us}:null,retryLane:536870912,hydrationErrors:null},u=hk(a),u.return=o,o.child=u,yr=o,fn=null)):a=null,a===null)throw xo(o);return wb(a)?o.lanes=32:o.lanes=536870912,null}var B=p.children;return p=p.fallback,y?(wo(),y=o.mode,B=cm({mode:"hidden",children:B},y),p=Bc(p,y,u,null),B.return=o,p.return=o,B.sibling=p,o.child=B,p=o.child,p.memoizedState=$y(u),p.childLanes=qy(a,I,u),o.memoizedState=By,vh(null,p)):(Co(o),Hy(o,B))}var G=a.memoizedState;if(G!==null&&(B=G.dehydrated,B!==null)){if(x)o.flags&256?(Co(o),o.flags&=-257,o=Gy(a,o,u)):o.memoizedState!==null?(wo(),o.child=a.child,o.flags|=128,o=null):(wo(),B=p.fallback,y=o.mode,p=cm({mode:"visible",children:p.children},y),B=Bc(B,y,u,null),B.flags|=2,p.return=o,B.return=o,p.sibling=B,o.child=p,Yc(o,a.child,null,u),p=o.child,p.memoizedState=$y(u),p.childLanes=qy(a,I,u),o.memoizedState=By,o=vh(null,p));else if(Co(o),wb(B)){if(I=B.nextSibling&&B.nextSibling.dataset,I)var ie=I.dgst;I=ie,p=Error(r(419)),p.stack="",p.digest=I,sh({value:p,source:null,stack:null}),o=Gy(a,o,u)}else if(Gn||ou(a,o,u,!1),I=(u&a.childLanes)!==0,Gn||I){if(I=an,I!==null&&(p=Pn(I,u),p!==0&&p!==G.retryLane))throw G.retryLane=p,Fc(a,p),ri(I,a,p),zy;Cb(B)||vm(),o=Gy(a,o,u)}else Cb(B)?(o.flags|=192,o.child=a.child,o=null):(a=G.treeContext,fn=qi(B.nextSibling),yr=o,jt=!0,bo=null,Bi=!1,a!==null&&mk(o,a),o=Hy(o,p.children),o.flags|=4096);return o}return y?(wo(),B=p.fallback,y=o.mode,G=a.child,ie=G.sibling,p=ya(G,{mode:"hidden",children:p.children}),p.subtreeFlags=G.subtreeFlags&65011712,ie!==null?B=ya(ie,B):(B=Bc(B,y,u,null),B.flags|=2),B.return=o,p.return=o,p.sibling=B,o.child=p,vh(null,p),p=o.child,B=a.child.memoizedState,B===null?B=$y(u):(y=B.cachePool,y!==null?(G=qn._currentValue,y=y.parent!==G?{parent:G,pool:G}:y):y=_k(),B={baseLanes:B.baseLanes|u,cachePool:y}),p.memoizedState=B,p.childLanes=qy(a,I,u),o.memoizedState=By,vh(a.child,p)):(Co(o),u=a.child,a=u.sibling,u=ya(u,{mode:"visible",children:p.children}),u.return=o,u.sibling=null,a!==null&&(I=o.deletions,I===null?(o.deletions=[a],o.flags|=16):I.push(a)),o.child=u,o.memoizedState=null,u)}function Hy(a,o){return o=cm({mode:"visible",children:o},a.mode),o.return=a,a.child=o}function cm(a,o){return a=bi(22,a,null,o),a.lanes=0,a}function Gy(a,o,u){return Yc(o,a.child,null,u),a=Hy(o,o.pendingProps.children),a.flags|=2,o.memoizedState=null,a}function DC(a,o,u){a.lanes|=o;var p=a.alternate;p!==null&&(p.lanes|=o),oy(a.return,o,u)}function Ky(a,o,u,p,y,x){var I=a.memoizedState;I===null?a.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:p,tail:u,tailMode:y,treeForkCount:x}:(I.isBackwards=o,I.rendering=null,I.renderingStartTime=0,I.last=p,I.tail=u,I.tailMode=y,I.treeForkCount=x)}function OC(a,o,u){var p=o.pendingProps,y=p.revealOrder,x=p.tail;p=p.children;var I=Dn.current,B=(I&2)!==0;if(B?(I=I&1|2,o.flags|=128):I&=1,fe(Dn,I),xr(a,o,p,u),p=jt?ih:0,!B&&a!==null&&(a.flags&128)!==0)e:for(a=o.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&DC(a,u,o);else if(a.tag===19)DC(a,u,o);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===o)break e;for(;a.sibling===null;){if(a.return===null||a.return===o)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}switch(y){case"forwards":for(u=o.child,y=null;u!==null;)a=u.alternate,a!==null&&Qp(a)===null&&(y=u),u=u.sibling;u=y,u===null?(y=o.child,o.child=null):(y=u.sibling,u.sibling=null),Ky(o,!1,y,u,x,p);break;case"backwards":case"unstable_legacy-backwards":for(u=null,y=o.child,o.child=null;y!==null;){if(a=y.alternate,a!==null&&Qp(a)===null){o.child=y;break}a=y.sibling,y.sibling=u,u=y,y=a}Ky(o,!0,u,null,x,p);break;case"together":Ky(o,!1,null,null,void 0,p);break;default:o.memoizedState=null}return o.child}function ka(a,o,u){if(a!==null&&(o.dependencies=a.dependencies),Ao|=o.lanes,(u&o.childLanes)===0)if(a!==null){if(ou(a,o,u,!1),(u&o.childLanes)===0)return null}else return null;if(a!==null&&o.child!==a.child)throw Error(r(153));if(o.child!==null){for(a=o.child,u=ya(a,a.pendingProps),o.child=u,u.return=o;a.sibling!==null;)a=a.sibling,u=u.sibling=ya(a,a.pendingProps),u.return=o;u.sibling=null}return o.child}function Wy(a,o){return(a.lanes&o)!==0?!0:(a=a.dependencies,!!(a!==null&&Bp(a)))}function Z6(a,o,u){switch(o.tag){case 3:Ge(o,o.stateNode.containerInfo),_o(o,qn,a.memoizedState.cache),$c();break;case 27:case 5:Ce(o);break;case 4:Ge(o,o.stateNode.containerInfo);break;case 10:_o(o,o.type,o.memoizedProps.value);break;case 31:if(o.memoizedState!==null)return o.flags|=128,by(o),null;break;case 13:var p=o.memoizedState;if(p!==null)return p.dehydrated!==null?(Co(o),o.flags|=128,null):(u&o.child.childLanes)!==0?MC(a,o,u):(Co(o),a=ka(a,o,u),a!==null?a.sibling:null);Co(o);break;case 19:var y=(a.flags&128)!==0;if(p=(u&o.childLanes)!==0,p||(ou(a,o,u,!1),p=(u&o.childLanes)!==0),y){if(p)return OC(a,o,u);o.flags|=128}if(y=o.memoizedState,y!==null&&(y.rendering=null,y.tail=null,y.lastEffect=null),fe(Dn,Dn.current),p)break;return null;case 22:return o.lanes=0,EC(a,o,u,o.pendingProps);case 24:_o(o,qn,a.memoizedState.cache)}return ka(a,o,u)}function jC(a,o,u){if(a!==null)if(a.memoizedProps!==o.pendingProps)Gn=!0;else{if(!Wy(a,u)&&(o.flags&128)===0)return Gn=!1,Z6(a,o,u);Gn=(a.flags&131072)!==0}else Gn=!1,jt&&(o.flags&1048576)!==0&&pk(o,ih,o.index);switch(o.lanes=0,o.tag){case 16:e:{var p=o.pendingProps;if(a=Kc(o.elementType),o.type=a,typeof a=="function")Z0(a)?(p=Xc(a,p),o.tag=1,o=IC(null,o,a,p,u)):(o.tag=0,o=Fy(null,o,a,p,u));else{if(a!=null){var y=a.$$typeof;if(y===C){o.tag=11,o=kC(null,o,a,p,u);break e}else if(y===S){o.tag=14,o=CC(null,o,a,p,u);break e}}throw o=le(a)||a,Error(r(306,o,""))}}return o;case 0:return Fy(a,o,o.type,o.pendingProps,u);case 1:return p=o.type,y=Xc(p,o.pendingProps),IC(a,o,p,y,u);case 3:e:{if(Ge(o,o.stateNode.containerInfo),a===null)throw Error(r(387));p=o.pendingProps;var x=o.memoizedState;y=x.element,py(a,o),hh(o,p,null,u);var I=o.memoizedState;if(p=I.cache,_o(o,qn,p),p!==x.cache&&cy(o,[qn],u,!0),dh(),p=I.element,x.isDehydrated)if(x={element:p,isDehydrated:!1,cache:I.cache},o.updateQueue.baseState=x,o.memoizedState=x,o.flags&256){o=PC(a,o,p,u);break e}else if(p!==y){y=Vi(Error(r(424)),o),sh(y),o=PC(a,o,p,u);break e}else{switch(a=o.stateNode.containerInfo,a.nodeType){case 9:a=a.body;break;default:a=a.nodeName==="HTML"?a.ownerDocument.body:a}for(fn=qi(a.firstChild),yr=o,jt=!0,bo=null,Bi=!0,u=Ek(o,null,p,u),o.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling}else{if($c(),p===y){o=ka(a,o,u);break e}xr(a,o,p,u)}o=o.child}return o;case 26:return om(a,o),a===null?(u=Kw(o.type,null,o.pendingProps,null))?o.memoizedState=u:jt||(u=o.type,a=o.pendingProps,p=km(Te.current).createElement(u),p[Fn]=o,p[or]=a,_r(p,u,a),Bn(p),o.stateNode=p):o.memoizedState=Kw(o.type,a.memoizedProps,o.pendingProps,a.memoizedState),null;case 27:return Ce(o),a===null&&jt&&(p=o.stateNode=qw(o.type,o.pendingProps,Te.current),yr=o,Bi=!0,y=fn,Do(o.type)?(Eb=y,fn=qi(p.firstChild)):fn=y),xr(a,o,o.pendingProps.children,u),om(a,o),a===null&&(o.flags|=4194304),o.child;case 5:return a===null&&jt&&((y=p=fn)&&(p=Aj(p,o.type,o.pendingProps,Bi),p!==null?(o.stateNode=p,yr=o,fn=qi(p.firstChild),Bi=!1,y=!0):y=!1),y||xo(o)),Ce(o),y=o.type,x=o.pendingProps,I=a!==null?a.memoizedProps:null,p=x.children,Sb(y,x)?p=null:I!==null&&Sb(y,I)&&(o.flags|=32),o.memoizedState!==null&&(y=_y(a,o,q6,null,null,u),Ph._currentValue=y),om(a,o),xr(a,o,p,u),o.child;case 6:return a===null&&jt&&((a=u=fn)&&(u=Nj(u,o.pendingProps,Bi),u!==null?(o.stateNode=u,yr=o,fn=null,a=!0):a=!1),a||xo(o)),null;case 13:return MC(a,o,u);case 4:return Ge(o,o.stateNode.containerInfo),p=o.pendingProps,a===null?o.child=Yc(o,null,p,u):xr(a,o,p,u),o.child;case 11:return kC(a,o,o.type,o.pendingProps,u);case 7:return xr(a,o,o.pendingProps,u),o.child;case 8:return xr(a,o,o.pendingProps.children,u),o.child;case 12:return xr(a,o,o.pendingProps.children,u),o.child;case 10:return p=o.pendingProps,_o(o,o.type,p.value),xr(a,o,p.children,u),o.child;case 9:return y=o.type._context,p=o.pendingProps.children,Hc(o),y=br(y),p=p(y),o.flags|=1,xr(a,o,p,u),o.child;case 14:return CC(a,o,o.type,o.pendingProps,u);case 15:return wC(a,o,o.type,o.pendingProps,u);case 19:return OC(a,o,u);case 31:return J6(a,o,u);case 22:return EC(a,o,u,o.pendingProps);case 24:return Hc(o),p=br(qn),a===null?(y=dy(),y===null&&(y=an,x=ly(),y.pooledCache=x,x.refCount++,x!==null&&(y.pooledCacheLanes|=u),y=x),o.memoizedState={parent:p,cache:y},fy(o),_o(o,qn,y)):((a.lanes&u)!==0&&(py(a,o),hh(o,null,null,u),dh()),y=a.memoizedState,x=o.memoizedState,y.parent!==p?(y={parent:p,cache:p},o.memoizedState=y,o.lanes===0&&(o.memoizedState=o.updateQueue.baseState=y),_o(o,qn,p)):(p=x.cache,_o(o,qn,p),p!==y.cache&&cy(o,[qn],u,!0))),xr(a,o,o.pendingProps.children,u),o.child;case 29:throw o.pendingProps}throw Error(r(156,o.tag))}function Ca(a){a.flags|=4}function Yy(a,o,u,p,y){if((o=(a.mode&32)!==0)&&(o=!1),o){if(a.flags|=16777216,(y&335544128)===y)if(a.stateNode.complete)a.flags|=8192;else if(lw())a.flags|=8192;else throw Wc=Gp,hy}else a.flags&=-16777217}function LC(a,o){if(o.type!=="stylesheet"||(o.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!Jw(o))if(lw())a.flags|=8192;else throw Wc=Gp,hy}function lm(a,o){o!==null&&(a.flags|=4),a.flags&16384&&(o=a.tag!==22?_n():536870912,a.lanes|=o,bu|=o)}function yh(a,o){if(!jt)switch(a.tailMode){case"hidden":o=a.tail;for(var u=null;o!==null;)o.alternate!==null&&(u=o),o=o.sibling;u===null?a.tail=null:u.sibling=null;break;case"collapsed":u=a.tail;for(var p=null;u!==null;)u.alternate!==null&&(p=u),u=u.sibling;p===null?o||a.tail===null?a.tail=null:a.tail.sibling=null:p.sibling=null}}function pn(a){var o=a.alternate!==null&&a.alternate.child===a.child,u=0,p=0;if(o)for(var y=a.child;y!==null;)u|=y.lanes|y.childLanes,p|=y.subtreeFlags&65011712,p|=y.flags&65011712,y.return=a,y=y.sibling;else for(y=a.child;y!==null;)u|=y.lanes|y.childLanes,p|=y.subtreeFlags,p|=y.flags,y.return=a,y=y.sibling;return a.subtreeFlags|=p,a.childLanes=u,o}function ej(a,o,u){var p=o.pendingProps;switch(ry(o),o.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return pn(o),null;case 1:return pn(o),null;case 3:return u=o.stateNode,p=null,a!==null&&(p=a.memoizedState.cache),o.memoizedState.cache!==p&&(o.flags|=2048),_a(qn),Ke(),u.pendingContext&&(u.context=u.pendingContext,u.pendingContext=null),(a===null||a.child===null)&&(au(o)?Ca(o):a===null||a.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,sy())),pn(o),null;case 26:var y=o.type,x=o.memoizedState;return a===null?(Ca(o),x!==null?(pn(o),LC(o,x)):(pn(o),Yy(o,y,null,p,u))):x?x!==a.memoizedState?(Ca(o),pn(o),LC(o,x)):(pn(o),o.flags&=-16777217):(a=a.memoizedProps,a!==p&&Ca(o),pn(o),Yy(o,y,a,p,u)),null;case 27:if(Re(o),u=Te.current,y=o.type,a!==null&&o.stateNode!=null)a.memoizedProps!==p&&Ca(o);else{if(!p){if(o.stateNode===null)throw Error(r(166));return pn(o),null}a=Se.current,au(o)?gk(o):(a=qw(y,p,u),o.stateNode=a,Ca(o))}return pn(o),null;case 5:if(Re(o),y=o.type,a!==null&&o.stateNode!=null)a.memoizedProps!==p&&Ca(o);else{if(!p){if(o.stateNode===null)throw Error(r(166));return pn(o),null}if(x=Se.current,au(o))gk(o);else{var I=km(Te.current);switch(x){case 1:x=I.createElementNS("http://www.w3.org/2000/svg",y);break;case 2:x=I.createElementNS("http://www.w3.org/1998/Math/MathML",y);break;default:switch(y){case"svg":x=I.createElementNS("http://www.w3.org/2000/svg",y);break;case"math":x=I.createElementNS("http://www.w3.org/1998/Math/MathML",y);break;case"script":x=I.createElement("div"),x.innerHTML="<script><\/script>",x=x.removeChild(x.firstChild);break;case"select":x=typeof p.is=="string"?I.createElement("select",{is:p.is}):I.createElement("select"),p.multiple?x.multiple=!0:p.size&&(x.size=p.size);break;default:x=typeof p.is=="string"?I.createElement(y,{is:p.is}):I.createElement(y)}}x[Fn]=o,x[or]=p;e:for(I=o.child;I!==null;){if(I.tag===5||I.tag===6)x.appendChild(I.stateNode);else if(I.tag!==4&&I.tag!==27&&I.child!==null){I.child.return=I,I=I.child;continue}if(I===o)break e;for(;I.sibling===null;){if(I.return===null||I.return===o)break e;I=I.return}I.sibling.return=I.return,I=I.sibling}o.stateNode=x;e:switch(_r(x,y,p),y){case"button":case"input":case"select":case"textarea":p=!!p.autoFocus;break e;case"img":p=!0;break e;default:p=!1}p&&Ca(o)}}return pn(o),Yy(o,o.type,a===null?null:a.memoizedProps,o.pendingProps,u),null;case 6:if(a&&o.stateNode!=null)a.memoizedProps!==p&&Ca(o);else{if(typeof p!="string"&&o.stateNode===null)throw Error(r(166));if(a=Te.current,au(o)){if(a=o.stateNode,u=o.memoizedProps,p=null,y=yr,y!==null)switch(y.tag){case 27:case 5:p=y.memoizedProps}a[Fn]=o,a=!!(a.nodeValue===u||p!==null&&p.suppressHydrationWarning===!0||Mw(a.nodeValue,u)),a||xo(o,!0)}else a=km(a).createTextNode(p),a[Fn]=o,o.stateNode=a}return pn(o),null;case 31:if(u=o.memoizedState,a===null||a.memoizedState!==null){if(p=au(o),u!==null){if(a===null){if(!p)throw Error(r(318));if(a=o.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(r(557));a[Fn]=o}else $c(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;pn(o),a=!1}else u=sy(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=u),a=!0;if(!a)return o.flags&256?(_i(o),o):(_i(o),null);if((o.flags&128)!==0)throw Error(r(558))}return pn(o),null;case 13:if(p=o.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(y=au(o),p!==null&&p.dehydrated!==null){if(a===null){if(!y)throw Error(r(318));if(y=o.memoizedState,y=y!==null?y.dehydrated:null,!y)throw Error(r(317));y[Fn]=o}else $c(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;pn(o),y=!1}else y=sy(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=y),y=!0;if(!y)return o.flags&256?(_i(o),o):(_i(o),null)}return _i(o),(o.flags&128)!==0?(o.lanes=u,o):(u=p!==null,a=a!==null&&a.memoizedState!==null,u&&(p=o.child,y=null,p.alternate!==null&&p.alternate.memoizedState!==null&&p.alternate.memoizedState.cachePool!==null&&(y=p.alternate.memoizedState.cachePool.pool),x=null,p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(x=p.memoizedState.cachePool.pool),x!==y&&(p.flags|=2048)),u!==a&&u&&(o.child.flags|=8192),lm(o,o.updateQueue),pn(o),null);case 4:return Ke(),a===null&&vb(o.stateNode.containerInfo),pn(o),null;case 10:return _a(o.type),pn(o),null;case 19:if(te(Dn),p=o.memoizedState,p===null)return pn(o),null;if(y=(o.flags&128)!==0,x=p.rendering,x===null)if(y)yh(p,!1);else{if(wn!==0||a!==null&&(a.flags&128)!==0)for(a=o.child;a!==null;){if(x=Qp(a),x!==null){for(o.flags|=128,yh(p,!1),a=x.updateQueue,o.updateQueue=a,lm(o,a),o.subtreeFlags=0,a=u,u=o.child;u!==null;)dk(u,a),u=u.sibling;return fe(Dn,Dn.current&1|2),jt&&ba(o,p.treeForkCount),o.child}a=a.sibling}p.tail!==null&&Yt()>pm&&(o.flags|=128,y=!0,yh(p,!1),o.lanes=4194304)}else{if(!y)if(a=Qp(x),a!==null){if(o.flags|=128,y=!0,a=a.updateQueue,o.updateQueue=a,lm(o,a),yh(p,!0),p.tail===null&&p.tailMode==="hidden"&&!x.alternate&&!jt)return pn(o),null}else 2*Yt()-p.renderingStartTime>pm&&u!==536870912&&(o.flags|=128,y=!0,yh(p,!1),o.lanes=4194304);p.isBackwards?(x.sibling=o.child,o.child=x):(a=p.last,a!==null?a.sibling=x:o.child=x,p.last=x)}return p.tail!==null?(a=p.tail,p.rendering=a,p.tail=a.sibling,p.renderingStartTime=Yt(),a.sibling=null,u=Dn.current,fe(Dn,y?u&1|2:u&1),jt&&ba(o,p.treeForkCount),a):(pn(o),null);case 22:case 23:return _i(o),yy(),p=o.memoizedState!==null,a!==null?a.memoizedState!==null!==p&&(o.flags|=8192):p&&(o.flags|=8192),p?(u&536870912)!==0&&(o.flags&128)===0&&(pn(o),o.subtreeFlags&6&&(o.flags|=8192)):pn(o),u=o.updateQueue,u!==null&&lm(o,u.retryQueue),u=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(u=a.memoizedState.cachePool.pool),p=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(p=o.memoizedState.cachePool.pool),p!==u&&(o.flags|=2048),a!==null&&te(Gc),null;case 24:return u=null,a!==null&&(u=a.memoizedState.cache),o.memoizedState.cache!==u&&(o.flags|=2048),_a(qn),pn(o),null;case 25:return null;case 30:return null}throw Error(r(156,o.tag))}function tj(a,o){switch(ry(o),o.tag){case 1:return a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 3:return _a(qn),Ke(),a=o.flags,(a&65536)!==0&&(a&128)===0?(o.flags=a&-65537|128,o):null;case 26:case 27:case 5:return Re(o),null;case 31:if(o.memoizedState!==null){if(_i(o),o.alternate===null)throw Error(r(340));$c()}return a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 13:if(_i(o),a=o.memoizedState,a!==null&&a.dehydrated!==null){if(o.alternate===null)throw Error(r(340));$c()}return a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 19:return te(Dn),null;case 4:return Ke(),null;case 10:return _a(o.type),null;case 22:case 23:return _i(o),yy(),a!==null&&te(Gc),a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 24:return _a(qn),null;case 25:return null;default:return null}}function UC(a,o){switch(ry(o),o.tag){case 3:_a(qn),Ke();break;case 26:case 27:case 5:Re(o);break;case 4:Ke();break;case 31:o.memoizedState!==null&&_i(o);break;case 13:_i(o);break;case 19:te(Dn);break;case 10:_a(o.type);break;case 22:case 23:_i(o),yy(),a!==null&&te(Gc);break;case 24:_a(qn)}}function bh(a,o){try{var u=o.updateQueue,p=u!==null?u.lastEffect:null;if(p!==null){var y=p.next;u=y;do{if((u.tag&a)===a){p=void 0;var x=u.create,I=u.inst;p=x(),I.destroy=p}u=u.next}while(u!==y)}}catch(B){Jt(o,o.return,B)}}function Eo(a,o,u){try{var p=o.updateQueue,y=p!==null?p.lastEffect:null;if(y!==null){var x=y.next;p=x;do{if((p.tag&a)===a){var I=p.inst,B=I.destroy;if(B!==void 0){I.destroy=void 0,y=o;var G=u,ie=B;try{ie()}catch(ge){Jt(y,G,ge)}}}p=p.next}while(p!==x)}}catch(ge){Jt(o,o.return,ge)}}function VC(a){var o=a.updateQueue;if(o!==null){var u=a.stateNode;try{Ak(o,u)}catch(p){Jt(a,a.return,p)}}}function zC(a,o,u){u.props=Xc(a.type,a.memoizedProps),u.state=a.memoizedState;try{u.componentWillUnmount()}catch(p){Jt(a,o,p)}}function xh(a,o){try{var u=a.ref;if(u!==null){switch(a.tag){case 26:case 27:case 5:var p=a.stateNode;break;case 30:p=a.stateNode;break;default:p=a.stateNode}typeof u=="function"?a.refCleanup=u(p):u.current=p}}catch(y){Jt(a,o,y)}}function Vs(a,o){var u=a.ref,p=a.refCleanup;if(u!==null)if(typeof p=="function")try{p()}catch(y){Jt(a,o,y)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof u=="function")try{u(null)}catch(y){Jt(a,o,y)}else u.current=null}function FC(a){var o=a.type,u=a.memoizedProps,p=a.stateNode;try{e:switch(o){case"button":case"input":case"select":case"textarea":u.autoFocus&&p.focus();break e;case"img":u.src?p.src=u.src:u.srcSet&&(p.srcset=u.srcSet)}}catch(y){Jt(a,a.return,y)}}function Qy(a,o,u){try{var p=a.stateNode;Tj(p,a.type,u,o),p[or]=o}catch(y){Jt(a,a.return,y)}}function BC(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27&&Do(a.type)||a.tag===4}function Xy(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||BC(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.tag===27&&Do(a.type)||a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function Jy(a,o,u){var p=a.tag;if(p===5||p===6)a=a.stateNode,o?(u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u).insertBefore(a,o):(o=u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u,o.appendChild(a),u=u._reactRootContainer,u!=null||o.onclick!==null||(o.onclick=es));else if(p!==4&&(p===27&&Do(a.type)&&(u=a.stateNode,o=null),a=a.child,a!==null))for(Jy(a,o,u),a=a.sibling;a!==null;)Jy(a,o,u),a=a.sibling}function um(a,o,u){var p=a.tag;if(p===5||p===6)a=a.stateNode,o?u.insertBefore(a,o):u.appendChild(a);else if(p!==4&&(p===27&&Do(a.type)&&(u=a.stateNode),a=a.child,a!==null))for(um(a,o,u),a=a.sibling;a!==null;)um(a,o,u),a=a.sibling}function $C(a){var o=a.stateNode,u=a.memoizedProps;try{for(var p=a.type,y=o.attributes;y.length;)o.removeAttributeNode(y[0]);_r(o,p,u),o[Fn]=a,o[or]=u}catch(x){Jt(a,a.return,x)}}var wa=!1,Kn=!1,Zy=!1,qC=typeof WeakSet=="function"?WeakSet:Set,lr=null;function nj(a,o){if(a=a.containerInfo,xb=Im,a=nk(a),G0(a)){if("selectionStart"in a)var u={start:a.selectionStart,end:a.selectionEnd};else e:{u=(u=a.ownerDocument)&&u.defaultView||window;var p=u.getSelection&&u.getSelection();if(p&&p.rangeCount!==0){u=p.anchorNode;var y=p.anchorOffset,x=p.focusNode;p=p.focusOffset;try{u.nodeType,x.nodeType}catch{u=null;break e}var I=0,B=-1,G=-1,ie=0,ge=0,ke=a,ae=null;t:for(;;){for(var ue;ke!==u||y!==0&&ke.nodeType!==3||(B=I+y),ke!==x||p!==0&&ke.nodeType!==3||(G=I+p),ke.nodeType===3&&(I+=ke.nodeValue.length),(ue=ke.firstChild)!==null;)ae=ke,ke=ue;for(;;){if(ke===a)break t;if(ae===u&&++ie===y&&(B=I),ae===x&&++ge===p&&(G=I),(ue=ke.nextSibling)!==null)break;ke=ae,ae=ke.parentNode}ke=ue}u=B===-1||G===-1?null:{start:B,end:G}}else u=null}u=u||{start:0,end:0}}else u=null;for(_b={focusedElem:a,selectionRange:u},Im=!1,lr=o;lr!==null;)if(o=lr,a=o.child,(o.subtreeFlags&1028)!==0&&a!==null)a.return=o,lr=a;else for(;lr!==null;){switch(o=lr,x=o.alternate,a=o.flags,o.tag){case 0:if((a&4)!==0&&(a=o.updateQueue,a=a!==null?a.events:null,a!==null))for(u=0;u<a.length;u++)y=a[u],y.ref.impl=y.nextImpl;break;case 11:case 15:break;case 1:if((a&1024)!==0&&x!==null){a=void 0,u=o,y=x.memoizedProps,x=x.memoizedState,p=u.stateNode;try{var Ye=Xc(u.type,y);a=p.getSnapshotBeforeUpdate(Ye,x),p.__reactInternalSnapshotBeforeUpdate=a}catch(st){Jt(u,u.return,st)}}break;case 3:if((a&1024)!==0){if(a=o.stateNode.containerInfo,u=a.nodeType,u===9)kb(a);else if(u===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":kb(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(r(163))}if(a=o.sibling,a!==null){a.return=o.return,lr=a;break}lr=o.return}}function HC(a,o,u){var p=u.flags;switch(u.tag){case 0:case 11:case 15:Ra(a,u),p&4&&bh(5,u);break;case 1:if(Ra(a,u),p&4)if(a=u.stateNode,o===null)try{a.componentDidMount()}catch(I){Jt(u,u.return,I)}else{var y=Xc(u.type,o.memoizedProps);o=o.memoizedState;try{a.componentDidUpdate(y,o,a.__reactInternalSnapshotBeforeUpdate)}catch(I){Jt(u,u.return,I)}}p&64&&VC(u),p&512&&xh(u,u.return);break;case 3:if(Ra(a,u),p&64&&(a=u.updateQueue,a!==null)){if(o=null,u.child!==null)switch(u.child.tag){case 27:case 5:o=u.child.stateNode;break;case 1:o=u.child.stateNode}try{Ak(a,o)}catch(I){Jt(u,u.return,I)}}break;case 27:o===null&&p&4&&$C(u);case 26:case 5:Ra(a,u),o===null&&p&4&&FC(u),p&512&&xh(u,u.return);break;case 12:Ra(a,u);break;case 31:Ra(a,u),p&4&&WC(a,u);break;case 13:Ra(a,u),p&4&&YC(a,u),p&64&&(a=u.memoizedState,a!==null&&(a=a.dehydrated,a!==null&&(u=dj.bind(null,u),Ij(a,u))));break;case 22:if(p=u.memoizedState!==null||wa,!p){o=o!==null&&o.memoizedState!==null||Kn,y=wa;var x=Kn;wa=p,(Kn=o)&&!x?Aa(a,u,(u.subtreeFlags&8772)!==0):Ra(a,u),wa=y,Kn=x}break;case 30:break;default:Ra(a,u)}}function GC(a){var o=a.alternate;o!==null&&(a.alternate=null,GC(o)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(o=a.stateNode,o!==null&&$l(o)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var bn=null,Zr=!1;function Ea(a,o,u){for(u=u.child;u!==null;)KC(a,o,u),u=u.sibling}function KC(a,o,u){if(Gt&&typeof Gt.onCommitFiberUnmount=="function")try{Gt.onCommitFiberUnmount(sn,u)}catch{}switch(u.tag){case 26:Kn||Vs(u,o),Ea(a,o,u),u.memoizedState?u.memoizedState.count--:u.stateNode&&(u=u.stateNode,u.parentNode.removeChild(u));break;case 27:Kn||Vs(u,o);var p=bn,y=Zr;Do(u.type)&&(bn=u.stateNode,Zr=!1),Ea(a,o,u),Ah(u.stateNode),bn=p,Zr=y;break;case 5:Kn||Vs(u,o);case 6:if(p=bn,y=Zr,bn=null,Ea(a,o,u),bn=p,Zr=y,bn!==null)if(Zr)try{(bn.nodeType===9?bn.body:bn.nodeName==="HTML"?bn.ownerDocument.body:bn).removeChild(u.stateNode)}catch(x){Jt(u,o,x)}else try{bn.removeChild(u.stateNode)}catch(x){Jt(u,o,x)}break;case 18:bn!==null&&(Zr?(a=bn,Vw(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,u.stateNode),Eu(a)):Vw(bn,u.stateNode));break;case 4:p=bn,y=Zr,bn=u.stateNode.containerInfo,Zr=!0,Ea(a,o,u),bn=p,Zr=y;break;case 0:case 11:case 14:case 15:Eo(2,u,o),Kn||Eo(4,u,o),Ea(a,o,u);break;case 1:Kn||(Vs(u,o),p=u.stateNode,typeof p.componentWillUnmount=="function"&&zC(u,o,p)),Ea(a,o,u);break;case 21:Ea(a,o,u);break;case 22:Kn=(p=Kn)||u.memoizedState!==null,Ea(a,o,u),Kn=p;break;default:Ea(a,o,u)}}function WC(a,o){if(o.memoizedState===null&&(a=o.alternate,a!==null&&(a=a.memoizedState,a!==null))){a=a.dehydrated;try{Eu(a)}catch(u){Jt(o,o.return,u)}}}function YC(a,o){if(o.memoizedState===null&&(a=o.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{Eu(a)}catch(u){Jt(o,o.return,u)}}function rj(a){switch(a.tag){case 31:case 13:case 19:var o=a.stateNode;return o===null&&(o=a.stateNode=new qC),o;case 22:return a=a.stateNode,o=a._retryCache,o===null&&(o=a._retryCache=new qC),o;default:throw Error(r(435,a.tag))}}function dm(a,o){var u=rj(a);o.forEach(function(p){if(!u.has(p)){u.add(p);var y=hj.bind(null,a,p);p.then(y,y)}})}function ei(a,o){var u=o.deletions;if(u!==null)for(var p=0;p<u.length;p++){var y=u[p],x=a,I=o,B=I;e:for(;B!==null;){switch(B.tag){case 27:if(Do(B.type)){bn=B.stateNode,Zr=!1;break e}break;case 5:bn=B.stateNode,Zr=!1;break e;case 3:case 4:bn=B.stateNode.containerInfo,Zr=!0;break e}B=B.return}if(bn===null)throw Error(r(160));KC(x,I,y),bn=null,Zr=!1,x=y.alternate,x!==null&&(x.return=null),y.return=null}if(o.subtreeFlags&13886)for(o=o.child;o!==null;)QC(o,a),o=o.sibling}var as=null;function QC(a,o){var u=a.alternate,p=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:ei(o,a),ti(a),p&4&&(Eo(3,a,a.return),bh(3,a),Eo(5,a,a.return));break;case 1:ei(o,a),ti(a),p&512&&(Kn||u===null||Vs(u,u.return)),p&64&&wa&&(a=a.updateQueue,a!==null&&(p=a.callbacks,p!==null&&(u=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=u===null?p:u.concat(p))));break;case 26:var y=as;if(ei(o,a),ti(a),p&512&&(Kn||u===null||Vs(u,u.return)),p&4){var x=u!==null?u.memoizedState:null;if(p=a.memoizedState,u===null)if(p===null)if(a.stateNode===null){e:{p=a.type,u=a.memoizedProps,y=y.ownerDocument||y;t:switch(p){case"title":x=y.getElementsByTagName("title")[0],(!x||x[Cs]||x[Fn]||x.namespaceURI==="http://www.w3.org/2000/svg"||x.hasAttribute("itemprop"))&&(x=y.createElement(p),y.head.insertBefore(x,y.querySelector("head > title"))),_r(x,p,u),x[Fn]=a,Bn(x),p=x;break e;case"link":var I=Qw("link","href",y).get(p+(u.href||""));if(I){for(var B=0;B<I.length;B++)if(x=I[B],x.getAttribute("href")===(u.href==null||u.href===""?null:u.href)&&x.getAttribute("rel")===(u.rel==null?null:u.rel)&&x.getAttribute("title")===(u.title==null?null:u.title)&&x.getAttribute("crossorigin")===(u.crossOrigin==null?null:u.crossOrigin)){I.splice(B,1);break t}}x=y.createElement(p),_r(x,p,u),y.head.appendChild(x);break;case"meta":if(I=Qw("meta","content",y).get(p+(u.content||""))){for(B=0;B<I.length;B++)if(x=I[B],x.getAttribute("content")===(u.content==null?null:""+u.content)&&x.getAttribute("name")===(u.name==null?null:u.name)&&x.getAttribute("property")===(u.property==null?null:u.property)&&x.getAttribute("http-equiv")===(u.httpEquiv==null?null:u.httpEquiv)&&x.getAttribute("charset")===(u.charSet==null?null:u.charSet)){I.splice(B,1);break t}}x=y.createElement(p),_r(x,p,u),y.head.appendChild(x);break;default:throw Error(r(468,p))}x[Fn]=a,Bn(x),p=x}a.stateNode=p}else Xw(y,a.type,a.stateNode);else a.stateNode=Yw(y,p,a.memoizedProps);else x!==p?(x===null?u.stateNode!==null&&(u=u.stateNode,u.parentNode.removeChild(u)):x.count--,p===null?Xw(y,a.type,a.stateNode):Yw(y,p,a.memoizedProps)):p===null&&a.stateNode!==null&&Qy(a,a.memoizedProps,u.memoizedProps)}break;case 27:ei(o,a),ti(a),p&512&&(Kn||u===null||Vs(u,u.return)),u!==null&&p&4&&Qy(a,a.memoizedProps,u.memoizedProps);break;case 5:if(ei(o,a),ti(a),p&512&&(Kn||u===null||Vs(u,u.return)),a.flags&32){y=a.stateNode;try{Jr(y,"")}catch(Ye){Jt(a,a.return,Ye)}}p&4&&a.stateNode!=null&&(y=a.memoizedProps,Qy(a,y,u!==null?u.memoizedProps:y)),p&1024&&(Zy=!0);break;case 6:if(ei(o,a),ti(a),p&4){if(a.stateNode===null)throw Error(r(162));p=a.memoizedProps,u=a.stateNode;try{u.nodeValue=p}catch(Ye){Jt(a,a.return,Ye)}}break;case 3:if(Em=null,y=as,as=Cm(o.containerInfo),ei(o,a),as=y,ti(a),p&4&&u!==null&&u.memoizedState.isDehydrated)try{Eu(o.containerInfo)}catch(Ye){Jt(a,a.return,Ye)}Zy&&(Zy=!1,XC(a));break;case 4:p=as,as=Cm(a.stateNode.containerInfo),ei(o,a),ti(a),as=p;break;case 12:ei(o,a),ti(a);break;case 31:ei(o,a),ti(a),p&4&&(p=a.updateQueue,p!==null&&(a.updateQueue=null,dm(a,p)));break;case 13:ei(o,a),ti(a),a.child.flags&8192&&a.memoizedState!==null!=(u!==null&&u.memoizedState!==null)&&(fm=Yt()),p&4&&(p=a.updateQueue,p!==null&&(a.updateQueue=null,dm(a,p)));break;case 22:y=a.memoizedState!==null;var G=u!==null&&u.memoizedState!==null,ie=wa,ge=Kn;if(wa=ie||y,Kn=ge||G,ei(o,a),Kn=ge,wa=ie,ti(a),p&8192)e:for(o=a.stateNode,o._visibility=y?o._visibility&-2:o._visibility|1,y&&(u===null||G||wa||Kn||Jc(a)),u=null,o=a;;){if(o.tag===5||o.tag===26){if(u===null){G=u=o;try{if(x=G.stateNode,y)I=x.style,typeof I.setProperty=="function"?I.setProperty("display","none","important"):I.display="none";else{B=G.stateNode;var ke=G.memoizedProps.style,ae=ke!=null&&ke.hasOwnProperty("display")?ke.display:null;B.style.display=ae==null||typeof ae=="boolean"?"":(""+ae).trim()}}catch(Ye){Jt(G,G.return,Ye)}}}else if(o.tag===6){if(u===null){G=o;try{G.stateNode.nodeValue=y?"":G.memoizedProps}catch(Ye){Jt(G,G.return,Ye)}}}else if(o.tag===18){if(u===null){G=o;try{var ue=G.stateNode;y?zw(ue,!0):zw(G.stateNode,!1)}catch(Ye){Jt(G,G.return,Ye)}}}else if((o.tag!==22&&o.tag!==23||o.memoizedState===null||o===a)&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===a)break e;for(;o.sibling===null;){if(o.return===null||o.return===a)break e;u===o&&(u=null),o=o.return}u===o&&(u=null),o.sibling.return=o.return,o=o.sibling}p&4&&(p=a.updateQueue,p!==null&&(u=p.retryQueue,u!==null&&(p.retryQueue=null,dm(a,u))));break;case 19:ei(o,a),ti(a),p&4&&(p=a.updateQueue,p!==null&&(a.updateQueue=null,dm(a,p)));break;case 30:break;case 21:break;default:ei(o,a),ti(a)}}function ti(a){var o=a.flags;if(o&2){try{for(var u,p=a.return;p!==null;){if(BC(p)){u=p;break}p=p.return}if(u==null)throw Error(r(160));switch(u.tag){case 27:var y=u.stateNode,x=Xy(a);um(a,x,y);break;case 5:var I=u.stateNode;u.flags&32&&(Jr(I,""),u.flags&=-33);var B=Xy(a);um(a,B,I);break;case 3:case 4:var G=u.stateNode.containerInfo,ie=Xy(a);Jy(a,ie,G);break;default:throw Error(r(161))}}catch(ge){Jt(a,a.return,ge)}a.flags&=-3}o&4096&&(a.flags&=-4097)}function XC(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var o=a;XC(o),o.tag===5&&o.flags&1024&&o.stateNode.reset(),a=a.sibling}}function Ra(a,o){if(o.subtreeFlags&8772)for(o=o.child;o!==null;)HC(a,o.alternate,o),o=o.sibling}function Jc(a){for(a=a.child;a!==null;){var o=a;switch(o.tag){case 0:case 11:case 14:case 15:Eo(4,o,o.return),Jc(o);break;case 1:Vs(o,o.return);var u=o.stateNode;typeof u.componentWillUnmount=="function"&&zC(o,o.return,u),Jc(o);break;case 27:Ah(o.stateNode);case 26:case 5:Vs(o,o.return),Jc(o);break;case 22:o.memoizedState===null&&Jc(o);break;case 30:Jc(o);break;default:Jc(o)}a=a.sibling}}function Aa(a,o,u){for(u=u&&(o.subtreeFlags&8772)!==0,o=o.child;o!==null;){var p=o.alternate,y=a,x=o,I=x.flags;switch(x.tag){case 0:case 11:case 15:Aa(y,x,u),bh(4,x);break;case 1:if(Aa(y,x,u),p=x,y=p.stateNode,typeof y.componentDidMount=="function")try{y.componentDidMount()}catch(ie){Jt(p,p.return,ie)}if(p=x,y=p.updateQueue,y!==null){var B=p.stateNode;try{var G=y.shared.hiddenCallbacks;if(G!==null)for(y.shared.hiddenCallbacks=null,y=0;y<G.length;y++)Rk(G[y],B)}catch(ie){Jt(p,p.return,ie)}}u&&I&64&&VC(x),xh(x,x.return);break;case 27:$C(x);case 26:case 5:Aa(y,x,u),u&&p===null&&I&4&&FC(x),xh(x,x.return);break;case 12:Aa(y,x,u);break;case 31:Aa(y,x,u),u&&I&4&&WC(y,x);break;case 13:Aa(y,x,u),u&&I&4&&YC(y,x);break;case 22:x.memoizedState===null&&Aa(y,x,u),xh(x,x.return);break;case 30:break;default:Aa(y,x,u)}o=o.sibling}}function eb(a,o){var u=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(u=a.memoizedState.cachePool.pool),a=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(a=o.memoizedState.cachePool.pool),a!==u&&(a!=null&&a.refCount++,u!=null&&ah(u))}function tb(a,o){a=null,o.alternate!==null&&(a=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==a&&(o.refCount++,a!=null&&ah(a))}function os(a,o,u,p){if(o.subtreeFlags&10256)for(o=o.child;o!==null;)JC(a,o,u,p),o=o.sibling}function JC(a,o,u,p){var y=o.flags;switch(o.tag){case 0:case 11:case 15:os(a,o,u,p),y&2048&&bh(9,o);break;case 1:os(a,o,u,p);break;case 3:os(a,o,u,p),y&2048&&(a=null,o.alternate!==null&&(a=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==a&&(o.refCount++,a!=null&&ah(a)));break;case 12:if(y&2048){os(a,o,u,p),a=o.stateNode;try{var x=o.memoizedProps,I=x.id,B=x.onPostCommit;typeof B=="function"&&B(I,o.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch(G){Jt(o,o.return,G)}}else os(a,o,u,p);break;case 31:os(a,o,u,p);break;case 13:os(a,o,u,p);break;case 23:break;case 22:x=o.stateNode,I=o.alternate,o.memoizedState!==null?x._visibility&2?os(a,o,u,p):_h(a,o):x._visibility&2?os(a,o,u,p):(x._visibility|=2,gu(a,o,u,p,(o.subtreeFlags&10256)!==0||!1)),y&2048&&eb(I,o);break;case 24:os(a,o,u,p),y&2048&&tb(o.alternate,o);break;default:os(a,o,u,p)}}function gu(a,o,u,p,y){for(y=y&&((o.subtreeFlags&10256)!==0||!1),o=o.child;o!==null;){var x=a,I=o,B=u,G=p,ie=I.flags;switch(I.tag){case 0:case 11:case 15:gu(x,I,B,G,y),bh(8,I);break;case 23:break;case 22:var ge=I.stateNode;I.memoizedState!==null?ge._visibility&2?gu(x,I,B,G,y):_h(x,I):(ge._visibility|=2,gu(x,I,B,G,y)),y&&ie&2048&&eb(I.alternate,I);break;case 24:gu(x,I,B,G,y),y&&ie&2048&&tb(I.alternate,I);break;default:gu(x,I,B,G,y)}o=o.sibling}}function _h(a,o){if(o.subtreeFlags&10256)for(o=o.child;o!==null;){var u=a,p=o,y=p.flags;switch(p.tag){case 22:_h(u,p),y&2048&&eb(p.alternate,p);break;case 24:_h(u,p),y&2048&&tb(p.alternate,p);break;default:_h(u,p)}o=o.sibling}}var Sh=8192;function vu(a,o,u){if(a.subtreeFlags&Sh)for(a=a.child;a!==null;)ZC(a,o,u),a=a.sibling}function ZC(a,o,u){switch(a.tag){case 26:vu(a,o,u),a.flags&Sh&&a.memoizedState!==null&&$j(u,as,a.memoizedState,a.memoizedProps);break;case 5:vu(a,o,u);break;case 3:case 4:var p=as;as=Cm(a.stateNode.containerInfo),vu(a,o,u),as=p;break;case 22:a.memoizedState===null&&(p=a.alternate,p!==null&&p.memoizedState!==null?(p=Sh,Sh=16777216,vu(a,o,u),Sh=p):vu(a,o,u));break;default:vu(a,o,u)}}function ew(a){var o=a.alternate;if(o!==null&&(a=o.child,a!==null)){o.child=null;do o=a.sibling,a.sibling=null,a=o;while(a!==null)}}function Th(a){var o=a.deletions;if((a.flags&16)!==0){if(o!==null)for(var u=0;u<o.length;u++){var p=o[u];lr=p,nw(p,a)}ew(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)tw(a),a=a.sibling}function tw(a){switch(a.tag){case 0:case 11:case 15:Th(a),a.flags&2048&&Eo(9,a,a.return);break;case 3:Th(a);break;case 12:Th(a);break;case 22:var o=a.stateNode;a.memoizedState!==null&&o._visibility&2&&(a.return===null||a.return.tag!==13)?(o._visibility&=-3,hm(a)):Th(a);break;default:Th(a)}}function hm(a){var o=a.deletions;if((a.flags&16)!==0){if(o!==null)for(var u=0;u<o.length;u++){var p=o[u];lr=p,nw(p,a)}ew(a)}for(a=a.child;a!==null;){switch(o=a,o.tag){case 0:case 11:case 15:Eo(8,o,o.return),hm(o);break;case 22:u=o.stateNode,u._visibility&2&&(u._visibility&=-3,hm(o));break;default:hm(o)}a=a.sibling}}function nw(a,o){for(;lr!==null;){var u=lr;switch(u.tag){case 0:case 11:case 15:Eo(8,u,o);break;case 23:case 22:if(u.memoizedState!==null&&u.memoizedState.cachePool!==null){var p=u.memoizedState.cachePool.pool;p!=null&&p.refCount++}break;case 24:ah(u.memoizedState.cache)}if(p=u.child,p!==null)p.return=u,lr=p;else e:for(u=a;lr!==null;){p=lr;var y=p.sibling,x=p.return;if(GC(p),p===u){lr=null;break e}if(y!==null){y.return=x,lr=y;break e}lr=x}}}var ij={getCacheForType:function(a){var o=br(qn),u=o.data.get(a);return u===void 0&&(u=a(),o.data.set(a,u)),u},cacheSignal:function(){return br(qn).controller.signal}},sj=typeof WeakMap=="function"?WeakMap:Map,qt=0,an=null,Et=null,It=0,Xt=0,Si=null,Ro=!1,yu=!1,nb=!1,Na=0,wn=0,Ao=0,Zc=0,rb=0,Ti=0,bu=0,kh=null,ni=null,ib=!1,fm=0,rw=0,pm=1/0,mm=null,No=null,nr=0,Io=null,xu=null,Ia=0,sb=0,ab=null,iw=null,Ch=0,ob=null;function ki(){return(qt&2)!==0&&It!==0?It&-It:K.T!==null?fb():Fl()}function sw(){if(Ti===0)if((It&536870912)===0||jt){var a=Z;Z<<=1,(Z&3932160)===0&&(Z=262144),Ti=a}else Ti=536870912;return a=xi.current,a!==null&&(a.flags|=32),Ti}function ri(a,o,u){(a===an&&(Xt===2||Xt===9)||a.cancelPendingCommit!==null)&&(_u(a,0),Po(a,It,Ti,!1)),Pi(a,u),((qt&2)===0||a!==an)&&(a===an&&((qt&2)===0&&(Zc|=u),wn===4&&Po(a,It,Ti,!1)),zs(a))}function aw(a,o,u){if((qt&6)!==0)throw Error(r(327));var p=!u&&(o&127)===0&&(o&a.expiredLanes)===0||tt(a,o),y=p?cj(a,o):lb(a,o,!0),x=p;do{if(y===0){yu&&!p&&Po(a,o,0,!1);break}else{if(u=a.current.alternate,x&&!aj(u)){y=lb(a,o,!1),x=!1;continue}if(y===2){if(x=o,a.errorRecoveryDisabledLanes&x)var I=0;else I=a.pendingLanes&-536870913,I=I!==0?I:I&536870912?536870912:0;if(I!==0){o=I;e:{var B=a;y=kh;var G=B.current.memoizedState.isDehydrated;if(G&&(_u(B,I).flags|=256),I=lb(B,I,!1),I!==2){if(nb&&!G){B.errorRecoveryDisabledLanes|=x,Zc|=x,y=4;break e}x=ni,ni=y,x!==null&&(ni===null?ni=x:ni.push.apply(ni,x))}y=I}if(x=!1,y!==2)continue}}if(y===1){_u(a,0),Po(a,o,0,!0);break}e:{switch(p=a,x=y,x){case 0:case 1:throw Error(r(345));case 4:if((o&4194048)!==o)break;case 6:Po(p,o,Ti,!Ro);break e;case 2:ni=null;break;case 3:case 5:break;default:throw Error(r(329))}if((o&62914560)===o&&(y=fm+300-Yt(),10<y)){if(Po(p,o,Ti,!Ro),Je(p,0,!0)!==0)break e;Ia=o,p.timeoutHandle=Lw(ow.bind(null,p,u,ni,mm,ib,o,Ti,Zc,bu,Ro,x,"Throttled",-0,0),y);break e}ow(p,u,ni,mm,ib,o,Ti,Zc,bu,Ro,x,null,-0,0)}}break}while(!0);zs(a)}function ow(a,o,u,p,y,x,I,B,G,ie,ge,ke,ae,ue){if(a.timeoutHandle=-1,ke=o.subtreeFlags,ke&8192||(ke&16785408)===16785408){ke={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:es},ZC(o,x,ke);var Ye=(x&62914560)===x?fm-Yt():(x&4194048)===x?rw-Yt():0;if(Ye=qj(ke,Ye),Ye!==null){Ia=x,a.cancelPendingCommit=Ye(mw.bind(null,a,o,x,u,p,y,I,B,G,ge,ke,null,ae,ue)),Po(a,x,I,!ie);return}}mw(a,o,x,u,p,y,I,B,G)}function aj(a){for(var o=a;;){var u=o.tag;if((u===0||u===11||u===15)&&o.flags&16384&&(u=o.updateQueue,u!==null&&(u=u.stores,u!==null)))for(var p=0;p<u.length;p++){var y=u[p],x=y.getSnapshot;y=y.value;try{if(!yi(x(),y))return!1}catch{return!1}}if(u=o.child,o.subtreeFlags&16384&&u!==null)u.return=o,o=u;else{if(o===a)break;for(;o.sibling===null;){if(o.return===null||o.return===a)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function Po(a,o,u,p){o&=~rb,o&=~Zc,a.suspendedLanes|=o,a.pingedLanes&=~o,p&&(a.warmLanes|=o),p=a.expirationTimes;for(var y=o;0<y;){var x=31-ln(y),I=1<<x;p[x]=-1,y&=~I}u!==0&&Sn(a,u,o)}function gm(){return(qt&6)===0?(wh(0),!1):!0}function cb(){if(Et!==null){if(Xt===0)var a=Et.return;else a=Et,xa=qc=null,ky(a),du=null,ch=0,a=Et;for(;a!==null;)UC(a.alternate,a),a=a.return;Et=null}}function _u(a,o){var u=a.timeoutHandle;u!==-1&&(a.timeoutHandle=-1,wj(u)),u=a.cancelPendingCommit,u!==null&&(a.cancelPendingCommit=null,u()),Ia=0,cb(),an=a,Et=u=ya(a.current,null),It=o,Xt=0,Si=null,Ro=!1,yu=tt(a,o),nb=!1,bu=Ti=rb=Zc=Ao=wn=0,ni=kh=null,ib=!1,(o&8)!==0&&(o|=o&32);var p=a.entangledLanes;if(p!==0)for(a=a.entanglements,p&=o;0<p;){var y=31-ln(p),x=1<<y;o|=a[y],p&=~x}return Na=o,Lp(),u}function cw(a,o){yt=null,K.H=gh,o===uu||o===Hp?(o=kk(),Xt=3):o===hy?(o=kk(),Xt=4):Xt=o===zy?8:o!==null&&typeof o=="object"&&typeof o.then=="function"?6:1,Si=o,Et===null&&(wn=1,sm(a,Vi(o,a.current)))}function lw(){var a=xi.current;return a===null?!0:(It&4194048)===It?$i===null:(It&62914560)===It||(It&536870912)!==0?a===$i:!1}function uw(){var a=K.H;return K.H=gh,a===null?gh:a}function dw(){var a=K.A;return K.A=ij,a}function vm(){wn=4,Ro||(It&4194048)!==It&&xi.current!==null||(yu=!0),(Ao&134217727)===0&&(Zc&134217727)===0||an===null||Po(an,It,Ti,!1)}function lb(a,o,u){var p=qt;qt|=2;var y=uw(),x=dw();(an!==a||It!==o)&&(mm=null,_u(a,o)),o=!1;var I=wn;e:do try{if(Xt!==0&&Et!==null){var B=Et,G=Si;switch(Xt){case 8:cb(),I=6;break e;case 3:case 2:case 9:case 6:xi.current===null&&(o=!0);var ie=Xt;if(Xt=0,Si=null,Su(a,B,G,ie),u&&yu){I=0;break e}break;default:ie=Xt,Xt=0,Si=null,Su(a,B,G,ie)}}oj(),I=wn;break}catch(ge){cw(a,ge)}while(!0);return o&&a.shellSuspendCounter++,xa=qc=null,qt=p,K.H=y,K.A=x,Et===null&&(an=null,It=0,Lp()),I}function oj(){for(;Et!==null;)hw(Et)}function cj(a,o){var u=qt;qt|=2;var p=uw(),y=dw();an!==a||It!==o?(mm=null,pm=Yt()+500,_u(a,o)):yu=tt(a,o);e:do try{if(Xt!==0&&Et!==null){o=Et;var x=Si;t:switch(Xt){case 1:Xt=0,Si=null,Su(a,o,x,1);break;case 2:case 9:if(Sk(x)){Xt=0,Si=null,fw(o);break}o=function(){Xt!==2&&Xt!==9||an!==a||(Xt=7),zs(a)},x.then(o,o);break e;case 3:Xt=7;break e;case 4:Xt=5;break e;case 7:Sk(x)?(Xt=0,Si=null,fw(o)):(Xt=0,Si=null,Su(a,o,x,7));break;case 5:var I=null;switch(Et.tag){case 26:I=Et.memoizedState;case 5:case 27:var B=Et;if(I?Jw(I):B.stateNode.complete){Xt=0,Si=null;var G=B.sibling;if(G!==null)Et=G;else{var ie=B.return;ie!==null?(Et=ie,ym(ie)):Et=null}break t}}Xt=0,Si=null,Su(a,o,x,5);break;case 6:Xt=0,Si=null,Su(a,o,x,6);break;case 8:cb(),wn=6;break e;default:throw Error(r(462))}}lj();break}catch(ge){cw(a,ge)}while(!0);return xa=qc=null,K.H=p,K.A=y,qt=u,Et!==null?0:(an=null,It=0,Lp(),wn)}function lj(){for(;Et!==null&&!Vt();)hw(Et)}function hw(a){var o=jC(a.alternate,a,Na);a.memoizedProps=a.pendingProps,o===null?ym(a):Et=o}function fw(a){var o=a,u=o.alternate;switch(o.tag){case 15:case 0:o=NC(u,o,o.pendingProps,o.type,void 0,It);break;case 11:o=NC(u,o,o.pendingProps,o.type.render,o.ref,It);break;case 5:ky(o);default:UC(u,o),o=Et=dk(o,Na),o=jC(u,o,Na)}a.memoizedProps=a.pendingProps,o===null?ym(a):Et=o}function Su(a,o,u,p){xa=qc=null,ky(o),du=null,ch=0;var y=o.return;try{if(X6(a,y,o,u,It)){wn=1,sm(a,Vi(u,a.current)),Et=null;return}}catch(x){if(y!==null)throw Et=y,x;wn=1,sm(a,Vi(u,a.current)),Et=null;return}o.flags&32768?(jt||p===1?a=!0:yu||(It&536870912)!==0?a=!1:(Ro=a=!0,(p===2||p===9||p===3||p===6)&&(p=xi.current,p!==null&&p.tag===13&&(p.flags|=16384))),pw(o,a)):ym(o)}function ym(a){var o=a;do{if((o.flags&32768)!==0){pw(o,Ro);return}a=o.return;var u=ej(o.alternate,o,Na);if(u!==null){Et=u;return}if(o=o.sibling,o!==null){Et=o;return}Et=o=a}while(o!==null);wn===0&&(wn=5)}function pw(a,o){do{var u=tj(a.alternate,a);if(u!==null){u.flags&=32767,Et=u;return}if(u=a.return,u!==null&&(u.flags|=32768,u.subtreeFlags=0,u.deletions=null),!o&&(a=a.sibling,a!==null)){Et=a;return}Et=a=u}while(a!==null);wn=6,Et=null}function mw(a,o,u,p,y,x,I,B,G){a.cancelPendingCommit=null;do bm();while(nr!==0);if((qt&6)!==0)throw Error(r(327));if(o!==null){if(o===a.current)throw Error(r(177));if(x=o.lanes|o.childLanes,x|=X0,zl(a,u,x,I,B,G),a===an&&(Et=an=null,It=0),xu=o,Io=a,Ia=u,sb=x,ab=y,iw=p,(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?(a.callbackNode=null,a.callbackPriority=0,fj(pi,function(){return xw(),null})):(a.callbackNode=null,a.callbackPriority=0),p=(o.flags&13878)!==0,(o.subtreeFlags&13878)!==0||p){p=K.T,K.T=null,y=oe.p,oe.p=2,I=qt,qt|=4;try{nj(a,o,u)}finally{qt=I,oe.p=y,K.T=p}}nr=1,gw(),vw(),yw()}}function gw(){if(nr===1){nr=0;var a=Io,o=xu,u=(o.flags&13878)!==0;if((o.subtreeFlags&13878)!==0||u){u=K.T,K.T=null;var p=oe.p;oe.p=2;var y=qt;qt|=4;try{QC(o,a);var x=_b,I=nk(a.containerInfo),B=x.focusedElem,G=x.selectionRange;if(I!==B&&B&&B.ownerDocument&&tk(B.ownerDocument.documentElement,B)){if(G!==null&&G0(B)){var ie=G.start,ge=G.end;if(ge===void 0&&(ge=ie),"selectionStart"in B)B.selectionStart=ie,B.selectionEnd=Math.min(ge,B.value.length);else{var ke=B.ownerDocument||document,ae=ke&&ke.defaultView||window;if(ae.getSelection){var ue=ae.getSelection(),Ye=B.textContent.length,st=Math.min(G.start,Ye),nn=G.end===void 0?st:Math.min(G.end,Ye);!ue.extend&&st>nn&&(I=nn,nn=st,st=I);var J=ek(B,st),Y=ek(B,nn);if(J&&Y&&(ue.rangeCount!==1||ue.anchorNode!==J.node||ue.anchorOffset!==J.offset||ue.focusNode!==Y.node||ue.focusOffset!==Y.offset)){var re=ke.createRange();re.setStart(J.node,J.offset),ue.removeAllRanges(),st>nn?(ue.addRange(re),ue.extend(Y.node,Y.offset)):(re.setEnd(Y.node,Y.offset),ue.addRange(re))}}}}for(ke=[],ue=B;ue=ue.parentNode;)ue.nodeType===1&&ke.push({element:ue,left:ue.scrollLeft,top:ue.scrollTop});for(typeof B.focus=="function"&&B.focus(),B=0;B<ke.length;B++){var xe=ke[B];xe.element.scrollLeft=xe.left,xe.element.scrollTop=xe.top}}Im=!!xb,_b=xb=null}finally{qt=y,oe.p=p,K.T=u}}a.current=o,nr=2}}function vw(){if(nr===2){nr=0;var a=Io,o=xu,u=(o.flags&8772)!==0;if((o.subtreeFlags&8772)!==0||u){u=K.T,K.T=null;var p=oe.p;oe.p=2;var y=qt;qt|=4;try{HC(a,o.alternate,o)}finally{qt=y,oe.p=p,K.T=u}}nr=3}}function yw(){if(nr===4||nr===3){nr=0,Lt();var a=Io,o=xu,u=Ia,p=iw;(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?nr=5:(nr=0,xu=Io=null,bw(a,a.pendingLanes));var y=a.pendingLanes;if(y===0&&(No=null),mi(u),o=o.stateNode,Gt&&typeof Gt.onCommitFiberRoot=="function")try{Gt.onCommitFiberRoot(sn,o,void 0,(o.current.flags&128)===128)}catch{}if(p!==null){o=K.T,y=oe.p,oe.p=2,K.T=null;try{for(var x=a.onRecoverableError,I=0;I<p.length;I++){var B=p[I];x(B.value,{componentStack:B.stack})}}finally{K.T=o,oe.p=y}}(Ia&3)!==0&&bm(),zs(a),y=a.pendingLanes,(u&261930)!==0&&(y&42)!==0?a===ob?Ch++:(Ch=0,ob=a):Ch=0,wh(0)}}function bw(a,o){(a.pooledCacheLanes&=o)===0&&(o=a.pooledCache,o!=null&&(a.pooledCache=null,ah(o)))}function bm(){return gw(),vw(),yw(),xw()}function xw(){if(nr!==5)return!1;var a=Io,o=sb;sb=0;var u=mi(Ia),p=K.T,y=oe.p;try{oe.p=32>u?32:u,K.T=null,u=ab,ab=null;var x=Io,I=Ia;if(nr=0,xu=Io=null,Ia=0,(qt&6)!==0)throw Error(r(331));var B=qt;if(qt|=4,tw(x.current),JC(x,x.current,I,u),qt=B,wh(0,!1),Gt&&typeof Gt.onPostCommitFiberRoot=="function")try{Gt.onPostCommitFiberRoot(sn,x)}catch{}return!0}finally{oe.p=y,K.T=p,bw(a,o)}}function _w(a,o,u){o=Vi(u,o),o=Vy(a.stateNode,o,2),a=ko(a,o,2),a!==null&&(Pi(a,2),zs(a))}function Jt(a,o,u){if(a.tag===3)_w(a,a,u);else for(;o!==null;){if(o.tag===3){_w(o,a,u);break}else if(o.tag===1){var p=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof p.componentDidCatch=="function"&&(No===null||!No.has(p))){a=Vi(u,a),u=SC(2),p=ko(o,u,2),p!==null&&(TC(u,p,o,a),Pi(p,2),zs(p));break}}o=o.return}}function ub(a,o,u){var p=a.pingCache;if(p===null){p=a.pingCache=new sj;var y=new Set;p.set(o,y)}else y=p.get(o),y===void 0&&(y=new Set,p.set(o,y));y.has(u)||(nb=!0,y.add(u),a=uj.bind(null,a,o,u),o.then(a,a))}function uj(a,o,u){var p=a.pingCache;p!==null&&p.delete(o),a.pingedLanes|=a.suspendedLanes&u,a.warmLanes&=~u,an===a&&(It&u)===u&&(wn===4||wn===3&&(It&62914560)===It&&300>Yt()-fm?(qt&2)===0&&_u(a,0):rb|=u,bu===It&&(bu=0)),zs(a)}function Sw(a,o){o===0&&(o=_n()),a=Fc(a,o),a!==null&&(Pi(a,o),zs(a))}function dj(a){var o=a.memoizedState,u=0;o!==null&&(u=o.retryLane),Sw(a,u)}function hj(a,o){var u=0;switch(a.tag){case 31:case 13:var p=a.stateNode,y=a.memoizedState;y!==null&&(u=y.retryLane);break;case 19:p=a.stateNode;break;case 22:p=a.stateNode._retryCache;break;default:throw Error(r(314))}p!==null&&p.delete(o),Sw(a,u)}function fj(a,o){return Fe(a,o)}var xm=null,Tu=null,db=!1,_m=!1,hb=!1,Mo=0;function zs(a){a!==Tu&&a.next===null&&(Tu===null?xm=Tu=a:Tu=Tu.next=a),_m=!0,db||(db=!0,mj())}function wh(a,o){if(!hb&&_m){hb=!0;do for(var u=!1,p=xm;p!==null;){if(a!==0){var y=p.pendingLanes;if(y===0)var x=0;else{var I=p.suspendedLanes,B=p.pingedLanes;x=(1<<31-ln(42|a)+1)-1,x&=y&~(I&~B),x=x&201326741?x&201326741|1:x?x|2:0}x!==0&&(u=!0,ww(p,x))}else x=It,x=Je(p,p===an?x:0,p.cancelPendingCommit!==null||p.timeoutHandle!==-1),(x&3)===0||tt(p,x)||(u=!0,ww(p,x));p=p.next}while(u);hb=!1}}function pj(){Tw()}function Tw(){_m=db=!1;var a=0;Mo!==0&&Cj()&&(a=Mo);for(var o=Yt(),u=null,p=xm;p!==null;){var y=p.next,x=kw(p,o);x===0?(p.next=null,u===null?xm=y:u.next=y,y===null&&(Tu=u)):(u=p,(a!==0||(x&3)!==0)&&(_m=!0)),p=y}nr!==0&&nr!==5||wh(a),Mo!==0&&(Mo=0)}function kw(a,o){for(var u=a.suspendedLanes,p=a.pingedLanes,y=a.expirationTimes,x=a.pendingLanes&-62914561;0<x;){var I=31-ln(x),B=1<<I,G=y[I];G===-1?((B&u)===0||(B&p)!==0)&&(y[I]=xt(B,o)):G<=o&&(a.expiredLanes|=B),x&=~B}if(o=an,u=It,u=Je(a,a===o?u:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),p=a.callbackNode,u===0||a===o&&(Xt===2||Xt===9)||a.cancelPendingCommit!==null)return p!==null&&p!==null&&ht(p),a.callbackNode=null,a.callbackPriority=0;if((u&3)===0||tt(a,u)){if(o=u&-u,o===a.callbackPriority)return o;switch(p!==null&&ht(p),mi(u)){case 2:case 8:u=Ni;break;case 32:u=pi;break;case 268435456:u=vn;break;default:u=pi}return p=Cw.bind(null,a),u=Fe(u,p),a.callbackPriority=o,a.callbackNode=u,o}return p!==null&&p!==null&&ht(p),a.callbackPriority=2,a.callbackNode=null,2}function Cw(a,o){if(nr!==0&&nr!==5)return a.callbackNode=null,a.callbackPriority=0,null;var u=a.callbackNode;if(bm()&&a.callbackNode!==u)return null;var p=It;return p=Je(a,a===an?p:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),p===0?null:(aw(a,p,o),kw(a,Yt()),a.callbackNode!=null&&a.callbackNode===u?Cw.bind(null,a):null)}function ww(a,o){if(bm())return null;aw(a,o,!0)}function mj(){Ej(function(){(qt&6)!==0?Fe(fi,pj):Tw()})}function fb(){if(Mo===0){var a=cu;a===0&&(a=W,W<<=1,(W&261888)===0&&(W=256)),Mo=a}return Mo}function Ew(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:Kl(""+a)}function Rw(a,o){var u=o.ownerDocument.createElement("input");return u.name=o.name,u.value=o.value,a.id&&u.setAttribute("form",a.id),o.parentNode.insertBefore(u,o),a=new FormData(a),u.parentNode.removeChild(u),a}function gj(a,o,u,p,y){if(o==="submit"&&u&&u.stateNode===y){var x=Ew((y[or]||null).action),I=p.submitter;I&&(o=(o=I[or]||null)?Ew(o.formAction):I.getAttribute("formAction"),o!==null&&(x=o,I=null));var B=new Ms("action","action",null,p,y);a.push({event:B,listeners:[{instance:null,listener:function(){if(p.defaultPrevented){if(Mo!==0){var G=I?Rw(y,I):new FormData(y);My(u,{pending:!0,data:G,method:y.method,action:x},null,G)}}else typeof x=="function"&&(B.preventDefault(),G=I?Rw(y,I):new FormData(y),My(u,{pending:!0,data:G,method:y.method,action:x},x,G))},currentTarget:y}]})}}for(var pb=0;pb<Q0.length;pb++){var mb=Q0[pb],vj=mb.toLowerCase(),yj=mb[0].toUpperCase()+mb.slice(1);ss(vj,"on"+yj)}ss(sk,"onAnimationEnd"),ss(ak,"onAnimationIteration"),ss(ok,"onAnimationStart"),ss("dblclick","onDoubleClick"),ss("focusin","onFocus"),ss("focusout","onBlur"),ss(D6,"onTransitionRun"),ss(O6,"onTransitionStart"),ss(j6,"onTransitionCancel"),ss(ck,"onTransitionEnd"),As("onMouseEnter",["mouseout","mouseover"]),As("onMouseLeave",["mouseout","mouseover"]),As("onPointerEnter",["pointerout","pointerover"]),As("onPointerLeave",["pointerout","pointerover"]),Rs("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Rs("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Rs("onBeforeInput",["compositionend","keypress","textInput","paste"]),Rs("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Rs("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Rs("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Eh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),bj=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Eh));function Aw(a,o){o=(o&4)!==0;for(var u=0;u<a.length;u++){var p=a[u],y=p.event;p=p.listeners;e:{var x=void 0;if(o)for(var I=p.length-1;0<=I;I--){var B=p[I],G=B.instance,ie=B.currentTarget;if(B=B.listener,G!==x&&y.isPropagationStopped())break e;x=B,y.currentTarget=ie;try{x(y)}catch(ge){jp(ge)}y.currentTarget=null,x=G}else for(I=0;I<p.length;I++){if(B=p[I],G=B.instance,ie=B.currentTarget,B=B.listener,G!==x&&y.isPropagationStopped())break e;x=B,y.currentTarget=ie;try{x(y)}catch(ge){jp(ge)}y.currentTarget=null,x=G}}}}function Rt(a,o){var u=o[Bl];u===void 0&&(u=o[Bl]=new Set);var p=a+"__bubble";u.has(p)||(Nw(o,a,2,!1),u.add(p))}function gb(a,o,u){var p=0;o&&(p|=4),Nw(u,a,p,o)}var Sm="_reactListening"+Math.random().toString(36).slice(2);function vb(a){if(!a[Sm]){a[Sm]=!0,Vd.forEach(function(u){u!=="selectionchange"&&(bj.has(u)||gb(u,!1,a),gb(u,!0,a))});var o=a.nodeType===9?a:a.ownerDocument;o===null||o[Sm]||(o[Sm]=!0,gb("selectionchange",!1,o))}}function Nw(a,o,u,p){switch(sE(o)){case 2:var y=Kj;break;case 8:y=Wj;break;default:y=Pb}u=y.bind(null,o,u,a),y=void 0,!Mc||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(y=!0),p?y!==void 0?a.addEventListener(o,u,{capture:!0,passive:y}):a.addEventListener(o,u,!0):y!==void 0?a.addEventListener(o,u,{passive:y}):a.addEventListener(o,u,!1)}function yb(a,o,u,p,y){var x=p;if((o&1)===0&&(o&2)===0&&p!==null)e:for(;;){if(p===null)return;var I=p.tag;if(I===3||I===4){var B=p.stateNode.containerInfo;if(B===y)break;if(I===4)for(I=p.return;I!==null;){var G=I.tag;if((G===3||G===4)&&I.stateNode.containerInfo===y)return;I=I.return}for(;B!==null;){if(I=ws(B),I===null)return;if(G=I.tag,G===5||G===6||G===26||G===27){p=x=I;continue e}B=B.parentNode}}p=p.return}po(function(){var ie=x,ge=Oi(u),ke=[];e:{var ae=lk.get(a);if(ae!==void 0){var ue=Ms,Ye=a;switch(a){case"keypress":if(Oc(u)===0)break e;case"keydown":case"keyup":ue=Mp;break;case"focusin":Ye="focus",ue=Lc;break;case"focusout":Ye="blur",ue=Lc;break;case"beforeblur":case"afterblur":ue=Lc;break;case"click":if(u.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ue=Jd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ue=kp;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ue=w;break;case sk:case ak:case ok:ue=wp;break;case ck:ue=$;break;case"scroll":case"scrollend":ue=Xd;break;case"wheel":ue=ce;break;case"copy":case"cut":case"paste":ue=Ep;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ue=va;break;case"toggle":case"beforetoggle":ue=vt}var st=(o&4)!==0,nn=!st&&(a==="scroll"||a==="scrollend"),J=st?ae!==null?ae+"Capture":null:ae;st=[];for(var Y=ie,re;Y!==null;){var xe=Y;if(re=xe.stateNode,xe=xe.tag,xe!==5&&xe!==26&&xe!==27||re===null||J===null||(xe=ts(Y,J),xe!=null&&st.push(Rh(Y,xe,re))),nn)break;Y=Y.return}0<st.length&&(ae=new ue(ae,Ye,null,u,ge),ke.push({event:ae,listeners:st}))}}if((o&7)===0){e:{if(ae=a==="mouseover"||a==="pointerover",ue=a==="mouseout"||a==="pointerout",ae&&u!==Wd&&(Ye=u.relatedTarget||u.fromElement)&&(ws(Ye)||Ye[ks]))break e;if((ue||ae)&&(ae=ge.window===ge?ge:(ae=ge.ownerDocument)?ae.defaultView||ae.parentWindow:window,ue?(Ye=u.relatedTarget||u.toElement,ue=ie,Ye=Ye?ws(Ye):null,Ye!==null&&(nn=s(Ye),st=Ye.tag,Ye!==nn||st!==5&&st!==27&&st!==6)&&(Ye=null)):(ue=null,Ye=ie),ue!==Ye)){if(st=Jd,xe="onMouseLeave",J="onMouseEnter",Y="mouse",(a==="pointerout"||a==="pointerover")&&(st=va,xe="onPointerLeave",J="onPointerEnter",Y="pointer"),nn=ue==null?ae:gi(ue),re=Ye==null?ae:gi(Ye),ae=new st(xe,Y+"leave",ue,u,ge),ae.target=nn,ae.relatedTarget=re,xe=null,ws(ge)===ie&&(st=new st(J,Y+"enter",Ye,u,ge),st.target=re,st.relatedTarget=nn,xe=st),nn=xe,ue&&Ye)t:{for(st=xj,J=ue,Y=Ye,re=0,xe=J;xe;xe=st(xe))re++;xe=0;for(var rt=Y;rt;rt=st(rt))xe++;for(;0<re-xe;)J=st(J),re--;for(;0<xe-re;)Y=st(Y),xe--;for(;re--;){if(J===Y||Y!==null&&J===Y.alternate){st=J;break t}J=st(J),Y=st(Y)}st=null}else st=null;ue!==null&&Iw(ke,ae,ue,st,!1),Ye!==null&&nn!==null&&Iw(ke,nn,Ye,st,!0)}}e:{if(ae=ie?gi(ie):window,ue=ae.nodeName&&ae.nodeName.toLowerCase(),ue==="select"||ue==="input"&&ae.type==="file")var Ft=WT;else if(GT(ae))if(YT)Ft=I6;else{Ft=A6;var et=R6}else ue=ae.nodeName,!ue||ue.toLowerCase()!=="input"||ae.type!=="checkbox"&&ae.type!=="radio"?ie&&Gl(ie.elementType)&&(Ft=WT):Ft=N6;if(Ft&&(Ft=Ft(a,ie))){KT(ke,Ft,u,ge);break e}et&&et(a,ae,ie),a==="focusout"&&ie&&ae.type==="number"&&ie.memoizedProps.value!=null&&Hd(ae,"number",ae.value)}switch(et=ie?gi(ie):window,a){case"focusin":(GT(et)||et.contentEditable==="true")&&(eu=et,K0=ie,rh=null);break;case"focusout":rh=K0=eu=null;break;case"mousedown":W0=!0;break;case"contextmenu":case"mouseup":case"dragend":W0=!1,rk(ke,u,ge);break;case"selectionchange":if(M6)break;case"keydown":case"keyup":rk(ke,u,ge)}var _t;if($t)e:{switch(a){case"compositionstart":var Pt="onCompositionStart";break e;case"compositionend":Pt="onCompositionEnd";break e;case"compositionupdate":Pt="onCompositionUpdate";break e}Pt=void 0}else Zl?Uc(a,u)&&(Pt="onCompositionEnd"):a==="keydown"&&u.keyCode===229&&(Pt="onCompositionStart");Pt&&(js&&u.locale!=="ko"&&(Zl||Pt!=="onCompositionStart"?Pt==="onCompositionEnd"&&Zl&&(_t=Qd()):(Ps=ge,Yd="value"in Ps?Ps.value:Ps.textContent,Zl=!0)),et=Tm(ie,Pt),0<et.length&&(Pt=new Os(Pt,a,null,u,ge),ke.push({event:Pt,listeners:et}),_t?Pt.data=_t:(_t=Jl(u),_t!==null&&(Pt.data=_t)))),(_t=Li?k6(a,u):C6(a,u))&&(Pt=Tm(ie,"onBeforeInput"),0<Pt.length&&(et=new Os("onBeforeInput","beforeinput",null,u,ge),ke.push({event:et,listeners:Pt}),et.data=_t)),gj(ke,a,ie,u,ge)}Aw(ke,o)})}function Rh(a,o,u){return{instance:a,listener:o,currentTarget:u}}function Tm(a,o){for(var u=o+"Capture",p=[];a!==null;){var y=a,x=y.stateNode;if(y=y.tag,y!==5&&y!==26&&y!==27||x===null||(y=ts(a,u),y!=null&&p.unshift(Rh(a,y,x)),y=ts(a,o),y!=null&&p.push(Rh(a,y,x))),a.tag===3)return p;a=a.return}return[]}function xj(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function Iw(a,o,u,p,y){for(var x=o._reactName,I=[];u!==null&&u!==p;){var B=u,G=B.alternate,ie=B.stateNode;if(B=B.tag,G!==null&&G===p)break;B!==5&&B!==26&&B!==27||ie===null||(G=ie,y?(ie=ts(u,x),ie!=null&&I.unshift(Rh(u,ie,G))):y||(ie=ts(u,x),ie!=null&&I.push(Rh(u,ie,G)))),u=u.return}I.length!==0&&a.push({event:o,listeners:I})}var _j=/\r\n?/g,Sj=/\u0000|\uFFFD/g;function Pw(a){return(typeof a=="string"?a:""+a).replace(_j,`
`).replace(Sj,"")}function Mw(a,o){return o=Pw(o),Pw(a)===o}function tn(a,o,u,p,y,x){switch(u){case"children":typeof p=="string"?o==="body"||o==="textarea"&&p===""||Jr(a,p):(typeof p=="number"||typeof p=="bigint")&&o!=="body"&&Jr(a,""+p);break;case"className":vi(a,"class",p);break;case"tabIndex":vi(a,"tabindex",p);break;case"dir":case"role":case"viewBox":case"width":case"height":vi(a,u,p);break;case"style":Kd(a,p,x);break;case"data":if(o!=="object"){vi(a,"data",p);break}case"src":case"href":if(p===""&&(o!=="a"||u!=="href")){a.removeAttribute(u);break}if(p==null||typeof p=="function"||typeof p=="symbol"||typeof p=="boolean"){a.removeAttribute(u);break}p=Kl(""+p),a.setAttribute(u,p);break;case"action":case"formAction":if(typeof p=="function"){a.setAttribute(u,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof x=="function"&&(u==="formAction"?(o!=="input"&&tn(a,o,"name",y.name,y,null),tn(a,o,"formEncType",y.formEncType,y,null),tn(a,o,"formMethod",y.formMethod,y,null),tn(a,o,"formTarget",y.formTarget,y,null)):(tn(a,o,"encType",y.encType,y,null),tn(a,o,"method",y.method,y,null),tn(a,o,"target",y.target,y,null)));if(p==null||typeof p=="symbol"||typeof p=="boolean"){a.removeAttribute(u);break}p=Kl(""+p),a.setAttribute(u,p);break;case"onClick":p!=null&&(a.onclick=es);break;case"onScroll":p!=null&&Rt("scroll",a);break;case"onScrollEnd":p!=null&&Rt("scrollend",a);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(r(61));if(u=p.__html,u!=null){if(y.children!=null)throw Error(r(60));a.innerHTML=u}}break;case"multiple":a.multiple=p&&typeof p!="function"&&typeof p!="symbol";break;case"muted":a.muted=p&&typeof p!="function"&&typeof p!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(p==null||typeof p=="function"||typeof p=="boolean"||typeof p=="symbol"){a.removeAttribute("xlink:href");break}u=Kl(""+p),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",u);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":p!=null&&typeof p!="function"&&typeof p!="symbol"?a.setAttribute(u,""+p):a.removeAttribute(u);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":p&&typeof p!="function"&&typeof p!="symbol"?a.setAttribute(u,""):a.removeAttribute(u);break;case"capture":case"download":p===!0?a.setAttribute(u,""):p!==!1&&p!=null&&typeof p!="function"&&typeof p!="symbol"?a.setAttribute(u,p):a.removeAttribute(u);break;case"cols":case"rows":case"size":case"span":p!=null&&typeof p!="function"&&typeof p!="symbol"&&!isNaN(p)&&1<=p?a.setAttribute(u,p):a.removeAttribute(u);break;case"rowSpan":case"start":p==null||typeof p=="function"||typeof p=="symbol"||isNaN(p)?a.removeAttribute(u):a.setAttribute(u,p);break;case"popover":Rt("beforetoggle",a),Rt("toggle",a),ql(a,"popover",p);break;case"xlinkActuate":$n(a,"http://www.w3.org/1999/xlink","xlink:actuate",p);break;case"xlinkArcrole":$n(a,"http://www.w3.org/1999/xlink","xlink:arcrole",p);break;case"xlinkRole":$n(a,"http://www.w3.org/1999/xlink","xlink:role",p);break;case"xlinkShow":$n(a,"http://www.w3.org/1999/xlink","xlink:show",p);break;case"xlinkTitle":$n(a,"http://www.w3.org/1999/xlink","xlink:title",p);break;case"xlinkType":$n(a,"http://www.w3.org/1999/xlink","xlink:type",p);break;case"xmlBase":$n(a,"http://www.w3.org/XML/1998/namespace","xml:base",p);break;case"xmlLang":$n(a,"http://www.w3.org/XML/1998/namespace","xml:lang",p);break;case"xmlSpace":$n(a,"http://www.w3.org/XML/1998/namespace","xml:space",p);break;case"is":ql(a,"is",p);break;case"innerText":case"textContent":break;default:(!(2<u.length)||u[0]!=="o"&&u[0]!=="O"||u[1]!=="n"&&u[1]!=="N")&&(u=Tp.get(u)||u,ql(a,u,p))}}function bb(a,o,u,p,y,x){switch(u){case"style":Kd(a,p,x);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(r(61));if(u=p.__html,u!=null){if(y.children!=null)throw Error(r(60));a.innerHTML=u}}break;case"children":typeof p=="string"?Jr(a,p):(typeof p=="number"||typeof p=="bigint")&&Jr(a,""+p);break;case"onScroll":p!=null&&Rt("scroll",a);break;case"onScrollEnd":p!=null&&Rt("scrollend",a);break;case"onClick":p!=null&&(a.onclick=es);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!zd.hasOwnProperty(u))e:{if(u[0]==="o"&&u[1]==="n"&&(y=u.endsWith("Capture"),o=u.slice(2,y?u.length-7:void 0),x=a[or]||null,x=x!=null?x[u]:null,typeof x=="function"&&a.removeEventListener(o,x,y),typeof p=="function")){typeof x!="function"&&x!==null&&(u in a?a[u]=null:a.hasAttribute(u)&&a.removeAttribute(u)),a.addEventListener(o,p,y);break e}u in a?a[u]=p:p===!0?a.setAttribute(u,""):ql(a,u,p)}}}function _r(a,o,u){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Rt("error",a),Rt("load",a);var p=!1,y=!1,x;for(x in u)if(u.hasOwnProperty(x)){var I=u[x];if(I!=null)switch(x){case"src":p=!0;break;case"srcSet":y=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,o));default:tn(a,o,x,I,u,null)}}y&&tn(a,o,"srcSet",u.srcSet,u,null),p&&tn(a,o,"src",u.src,u,null);return;case"input":Rt("invalid",a);var B=x=I=y=null,G=null,ie=null;for(p in u)if(u.hasOwnProperty(p)){var ge=u[p];if(ge!=null)switch(p){case"name":y=ge;break;case"type":I=ge;break;case"checked":G=ge;break;case"defaultChecked":ie=ge;break;case"value":x=ge;break;case"defaultValue":B=ge;break;case"children":case"dangerouslySetInnerHTML":if(ge!=null)throw Error(r(137,o));break;default:tn(a,o,p,ge,u,null)}}xp(a,x,B,G,ie,I,y,!1);return;case"select":Rt("invalid",a),p=I=x=null;for(y in u)if(u.hasOwnProperty(y)&&(B=u[y],B!=null))switch(y){case"value":x=B;break;case"defaultValue":I=B;break;case"multiple":p=B;default:tn(a,o,y,B,u,null)}o=x,u=I,a.multiple=!!p,o!=null?lo(a,!!p,o,!1):u!=null&&lo(a,!!p,u,!0);return;case"textarea":Rt("invalid",a),x=y=p=null;for(I in u)if(u.hasOwnProperty(I)&&(B=u[I],B!=null))switch(I){case"value":p=B;break;case"defaultValue":y=B;break;case"children":x=B;break;case"dangerouslySetInnerHTML":if(B!=null)throw Error(r(91));break;default:tn(a,o,I,B,u,null)}uo(a,p,y,x);return;case"option":for(G in u)if(u.hasOwnProperty(G)&&(p=u[G],p!=null))switch(G){case"selected":a.selected=p&&typeof p!="function"&&typeof p!="symbol";break;default:tn(a,o,G,p,u,null)}return;case"dialog":Rt("beforetoggle",a),Rt("toggle",a),Rt("cancel",a),Rt("close",a);break;case"iframe":case"object":Rt("load",a);break;case"video":case"audio":for(p=0;p<Eh.length;p++)Rt(Eh[p],a);break;case"image":Rt("error",a),Rt("load",a);break;case"details":Rt("toggle",a);break;case"embed":case"source":case"link":Rt("error",a),Rt("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ie in u)if(u.hasOwnProperty(ie)&&(p=u[ie],p!=null))switch(ie){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,o));default:tn(a,o,ie,p,u,null)}return;default:if(Gl(o)){for(ge in u)u.hasOwnProperty(ge)&&(p=u[ge],p!==void 0&&bb(a,o,ge,p,u,void 0));return}}for(B in u)u.hasOwnProperty(B)&&(p=u[B],p!=null&&tn(a,o,B,p,u,null))}function Tj(a,o,u,p){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var y=null,x=null,I=null,B=null,G=null,ie=null,ge=null;for(ue in u){var ke=u[ue];if(u.hasOwnProperty(ue)&&ke!=null)switch(ue){case"checked":break;case"value":break;case"defaultValue":G=ke;default:p.hasOwnProperty(ue)||tn(a,o,ue,null,p,ke)}}for(var ae in p){var ue=p[ae];if(ke=u[ae],p.hasOwnProperty(ae)&&(ue!=null||ke!=null))switch(ae){case"type":x=ue;break;case"name":y=ue;break;case"checked":ie=ue;break;case"defaultChecked":ge=ue;break;case"value":I=ue;break;case"defaultValue":B=ue;break;case"children":case"dangerouslySetInnerHTML":if(ue!=null)throw Error(r(137,o));break;default:ue!==ke&&tn(a,o,ae,ue,p,ke)}}Hl(a,I,B,G,ie,ge,x,y);return;case"select":ue=I=B=ae=null;for(x in u)if(G=u[x],u.hasOwnProperty(x)&&G!=null)switch(x){case"value":break;case"multiple":ue=G;default:p.hasOwnProperty(x)||tn(a,o,x,null,p,G)}for(y in p)if(x=p[y],G=u[y],p.hasOwnProperty(y)&&(x!=null||G!=null))switch(y){case"value":ae=x;break;case"defaultValue":B=x;break;case"multiple":I=x;default:x!==G&&tn(a,o,y,x,p,G)}o=B,u=I,p=ue,ae!=null?lo(a,!!u,ae,!1):!!p!=!!u&&(o!=null?lo(a,!!u,o,!0):lo(a,!!u,u?[]:"",!1));return;case"textarea":ue=ae=null;for(B in u)if(y=u[B],u.hasOwnProperty(B)&&y!=null&&!p.hasOwnProperty(B))switch(B){case"value":break;case"children":break;default:tn(a,o,B,null,p,y)}for(I in p)if(y=p[I],x=u[I],p.hasOwnProperty(I)&&(y!=null||x!=null))switch(I){case"value":ae=y;break;case"defaultValue":ue=y;break;case"children":break;case"dangerouslySetInnerHTML":if(y!=null)throw Error(r(91));break;default:y!==x&&tn(a,o,I,y,p,x)}_p(a,ae,ue);return;case"option":for(var Ye in u)if(ae=u[Ye],u.hasOwnProperty(Ye)&&ae!=null&&!p.hasOwnProperty(Ye))switch(Ye){case"selected":a.selected=!1;break;default:tn(a,o,Ye,null,p,ae)}for(G in p)if(ae=p[G],ue=u[G],p.hasOwnProperty(G)&&ae!==ue&&(ae!=null||ue!=null))switch(G){case"selected":a.selected=ae&&typeof ae!="function"&&typeof ae!="symbol";break;default:tn(a,o,G,ae,p,ue)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var st in u)ae=u[st],u.hasOwnProperty(st)&&ae!=null&&!p.hasOwnProperty(st)&&tn(a,o,st,null,p,ae);for(ie in p)if(ae=p[ie],ue=u[ie],p.hasOwnProperty(ie)&&ae!==ue&&(ae!=null||ue!=null))switch(ie){case"children":case"dangerouslySetInnerHTML":if(ae!=null)throw Error(r(137,o));break;default:tn(a,o,ie,ae,p,ue)}return;default:if(Gl(o)){for(var nn in u)ae=u[nn],u.hasOwnProperty(nn)&&ae!==void 0&&!p.hasOwnProperty(nn)&&bb(a,o,nn,void 0,p,ae);for(ge in p)ae=p[ge],ue=u[ge],!p.hasOwnProperty(ge)||ae===ue||ae===void 0&&ue===void 0||bb(a,o,ge,ae,p,ue);return}}for(var J in u)ae=u[J],u.hasOwnProperty(J)&&ae!=null&&!p.hasOwnProperty(J)&&tn(a,o,J,null,p,ae);for(ke in p)ae=p[ke],ue=u[ke],!p.hasOwnProperty(ke)||ae===ue||ae==null&&ue==null||tn(a,o,ke,ae,p,ue)}function Dw(a){switch(a){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function kj(){if(typeof performance.getEntriesByType=="function"){for(var a=0,o=0,u=performance.getEntriesByType("resource"),p=0;p<u.length;p++){var y=u[p],x=y.transferSize,I=y.initiatorType,B=y.duration;if(x&&B&&Dw(I)){for(I=0,B=y.responseEnd,p+=1;p<u.length;p++){var G=u[p],ie=G.startTime;if(ie>B)break;var ge=G.transferSize,ke=G.initiatorType;ge&&Dw(ke)&&(G=G.responseEnd,I+=ge*(G<B?1:(B-ie)/(G-ie)))}if(--p,o+=8*(x+I)/(y.duration/1e3),a++,10<a)break}}if(0<a)return o/a/1e6}return navigator.connection&&(a=navigator.connection.downlink,typeof a=="number")?a:5}var xb=null,_b=null;function km(a){return a.nodeType===9?a:a.ownerDocument}function Ow(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function jw(a,o){if(a===0)switch(o){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&o==="foreignObject"?0:a}function Sb(a,o){return a==="textarea"||a==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.children=="bigint"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var Tb=null;function Cj(){var a=window.event;return a&&a.type==="popstate"?a===Tb?!1:(Tb=a,!0):(Tb=null,!1)}var Lw=typeof setTimeout=="function"?setTimeout:void 0,wj=typeof clearTimeout=="function"?clearTimeout:void 0,Uw=typeof Promise=="function"?Promise:void 0,Ej=typeof queueMicrotask=="function"?queueMicrotask:typeof Uw<"u"?function(a){return Uw.resolve(null).then(a).catch(Rj)}:Lw;function Rj(a){setTimeout(function(){throw a})}function Do(a){return a==="head"}function Vw(a,o){var u=o,p=0;do{var y=u.nextSibling;if(a.removeChild(u),y&&y.nodeType===8)if(u=y.data,u==="/$"||u==="/&"){if(p===0){a.removeChild(y),Eu(o);return}p--}else if(u==="$"||u==="$?"||u==="$~"||u==="$!"||u==="&")p++;else if(u==="html")Ah(a.ownerDocument.documentElement);else if(u==="head"){u=a.ownerDocument.head,Ah(u);for(var x=u.firstChild;x;){var I=x.nextSibling,B=x.nodeName;x[Cs]||B==="SCRIPT"||B==="STYLE"||B==="LINK"&&x.rel.toLowerCase()==="stylesheet"||u.removeChild(x),x=I}}else u==="body"&&Ah(a.ownerDocument.body);u=y}while(u);Eu(o)}function zw(a,o){var u=a;a=0;do{var p=u.nextSibling;if(u.nodeType===1?o?(u._stashedDisplay=u.style.display,u.style.display="none"):(u.style.display=u._stashedDisplay||"",u.getAttribute("style")===""&&u.removeAttribute("style")):u.nodeType===3&&(o?(u._stashedText=u.nodeValue,u.nodeValue=""):u.nodeValue=u._stashedText||""),p&&p.nodeType===8)if(u=p.data,u==="/$"){if(a===0)break;a--}else u!=="$"&&u!=="$?"&&u!=="$~"&&u!=="$!"||a++;u=p}while(u)}function kb(a){var o=a.firstChild;for(o&&o.nodeType===10&&(o=o.nextSibling);o;){var u=o;switch(o=o.nextSibling,u.nodeName){case"HTML":case"HEAD":case"BODY":kb(u),$l(u);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(u.rel.toLowerCase()==="stylesheet")continue}a.removeChild(u)}}function Aj(a,o,u,p){for(;a.nodeType===1;){var y=u;if(a.nodeName.toLowerCase()!==o.toLowerCase()){if(!p&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(p){if(!a[Cs])switch(o){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(x=a.getAttribute("rel"),x==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(x!==y.rel||a.getAttribute("href")!==(y.href==null||y.href===""?null:y.href)||a.getAttribute("crossorigin")!==(y.crossOrigin==null?null:y.crossOrigin)||a.getAttribute("title")!==(y.title==null?null:y.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(x=a.getAttribute("src"),(x!==(y.src==null?null:y.src)||a.getAttribute("type")!==(y.type==null?null:y.type)||a.getAttribute("crossorigin")!==(y.crossOrigin==null?null:y.crossOrigin))&&x&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(o==="input"&&a.type==="hidden"){var x=y.name==null?null:""+y.name;if(y.type==="hidden"&&a.getAttribute("name")===x)return a}else return a;if(a=qi(a.nextSibling),a===null)break}return null}function Nj(a,o,u){if(o==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!u||(a=qi(a.nextSibling),a===null))return null;return a}function Fw(a,o){for(;a.nodeType!==8;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!o||(a=qi(a.nextSibling),a===null))return null;return a}function Cb(a){return a.data==="$?"||a.data==="$~"}function wb(a){return a.data==="$!"||a.data==="$?"&&a.ownerDocument.readyState!=="loading"}function Ij(a,o){var u=a.ownerDocument;if(a.data==="$~")a._reactRetry=o;else if(a.data!=="$?"||u.readyState!=="loading")o();else{var p=function(){o(),u.removeEventListener("DOMContentLoaded",p)};u.addEventListener("DOMContentLoaded",p),a._reactRetry=p}}function qi(a){for(;a!=null;a=a.nextSibling){var o=a.nodeType;if(o===1||o===3)break;if(o===8){if(o=a.data,o==="$"||o==="$!"||o==="$?"||o==="$~"||o==="&"||o==="F!"||o==="F")break;if(o==="/$"||o==="/&")return null}}return a}var Eb=null;function Bw(a){a=a.nextSibling;for(var o=0;a;){if(a.nodeType===8){var u=a.data;if(u==="/$"||u==="/&"){if(o===0)return qi(a.nextSibling);o--}else u!=="$"&&u!=="$!"&&u!=="$?"&&u!=="$~"&&u!=="&"||o++}a=a.nextSibling}return null}function $w(a){a=a.previousSibling;for(var o=0;a;){if(a.nodeType===8){var u=a.data;if(u==="$"||u==="$!"||u==="$?"||u==="$~"||u==="&"){if(o===0)return a;o--}else u!=="/$"&&u!=="/&"||o++}a=a.previousSibling}return null}function qw(a,o,u){switch(o=km(u),a){case"html":if(a=o.documentElement,!a)throw Error(r(452));return a;case"head":if(a=o.head,!a)throw Error(r(453));return a;case"body":if(a=o.body,!a)throw Error(r(454));return a;default:throw Error(r(451))}}function Ah(a){for(var o=a.attributes;o.length;)a.removeAttributeNode(o[0]);$l(a)}var Hi=new Map,Hw=new Set;function Cm(a){return typeof a.getRootNode=="function"?a.getRootNode():a.nodeType===9?a:a.ownerDocument}var Pa=oe.d;oe.d={f:Pj,r:Mj,D:Dj,C:Oj,L:jj,m:Lj,X:Vj,S:Uj,M:zj};function Pj(){var a=Pa.f(),o=gm();return a||o}function Mj(a){var o=Di(a);o!==null&&o.tag===5&&o.type==="form"?cC(o):Pa.r(a)}var ku=typeof document>"u"?null:document;function Gw(a,o,u){var p=ku;if(p&&typeof o=="string"&&o){var y=Xr(o);y='link[rel="'+a+'"][href="'+y+'"]',typeof u=="string"&&(y+='[crossorigin="'+u+'"]'),Hw.has(y)||(Hw.add(y),a={rel:a,crossOrigin:u,href:o},p.querySelector(y)===null&&(o=p.createElement("link"),_r(o,"link",a),Bn(o),p.head.appendChild(o)))}}function Dj(a){Pa.D(a),Gw("dns-prefetch",a,null)}function Oj(a,o){Pa.C(a,o),Gw("preconnect",a,o)}function jj(a,o,u){Pa.L(a,o,u);var p=ku;if(p&&a&&o){var y='link[rel="preload"][as="'+Xr(o)+'"]';o==="image"&&u&&u.imageSrcSet?(y+='[imagesrcset="'+Xr(u.imageSrcSet)+'"]',typeof u.imageSizes=="string"&&(y+='[imagesizes="'+Xr(u.imageSizes)+'"]')):y+='[href="'+Xr(a)+'"]';var x=y;switch(o){case"style":x=Cu(a);break;case"script":x=wu(a)}Hi.has(x)||(a=g({rel:"preload",href:o==="image"&&u&&u.imageSrcSet?void 0:a,as:o},u),Hi.set(x,a),p.querySelector(y)!==null||o==="style"&&p.querySelector(Nh(x))||o==="script"&&p.querySelector(Ih(x))||(o=p.createElement("link"),_r(o,"link",a),Bn(o),p.head.appendChild(o)))}}function Lj(a,o){Pa.m(a,o);var u=ku;if(u&&a){var p=o&&typeof o.as=="string"?o.as:"script",y='link[rel="modulepreload"][as="'+Xr(p)+'"][href="'+Xr(a)+'"]',x=y;switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":x=wu(a)}if(!Hi.has(x)&&(a=g({rel:"modulepreload",href:a},o),Hi.set(x,a),u.querySelector(y)===null)){switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(u.querySelector(Ih(x)))return}p=u.createElement("link"),_r(p,"link",a),Bn(p),u.head.appendChild(p)}}}function Uj(a,o,u){Pa.S(a,o,u);var p=ku;if(p&&a){var y=Es(p).hoistableStyles,x=Cu(a);o=o||"default";var I=y.get(x);if(!I){var B={loading:0,preload:null};if(I=p.querySelector(Nh(x)))B.loading=5;else{a=g({rel:"stylesheet",href:a,"data-precedence":o},u),(u=Hi.get(x))&&Rb(a,u);var G=I=p.createElement("link");Bn(G),_r(G,"link",a),G._p=new Promise(function(ie,ge){G.onload=ie,G.onerror=ge}),G.addEventListener("load",function(){B.loading|=1}),G.addEventListener("error",function(){B.loading|=2}),B.loading|=4,wm(I,o,p)}I={type:"stylesheet",instance:I,count:1,state:B},y.set(x,I)}}}function Vj(a,o){Pa.X(a,o);var u=ku;if(u&&a){var p=Es(u).hoistableScripts,y=wu(a),x=p.get(y);x||(x=u.querySelector(Ih(y)),x||(a=g({src:a,async:!0},o),(o=Hi.get(y))&&Ab(a,o),x=u.createElement("script"),Bn(x),_r(x,"link",a),u.head.appendChild(x)),x={type:"script",instance:x,count:1,state:null},p.set(y,x))}}function zj(a,o){Pa.M(a,o);var u=ku;if(u&&a){var p=Es(u).hoistableScripts,y=wu(a),x=p.get(y);x||(x=u.querySelector(Ih(y)),x||(a=g({src:a,async:!0,type:"module"},o),(o=Hi.get(y))&&Ab(a,o),x=u.createElement("script"),Bn(x),_r(x,"link",a),u.head.appendChild(x)),x={type:"script",instance:x,count:1,state:null},p.set(y,x))}}function Kw(a,o,u,p){var y=(y=Te.current)?Cm(y):null;if(!y)throw Error(r(446));switch(a){case"meta":case"title":return null;case"style":return typeof u.precedence=="string"&&typeof u.href=="string"?(o=Cu(u.href),u=Es(y).hoistableStyles,p=u.get(o),p||(p={type:"style",instance:null,count:0,state:null},u.set(o,p)),p):{type:"void",instance:null,count:0,state:null};case"link":if(u.rel==="stylesheet"&&typeof u.href=="string"&&typeof u.precedence=="string"){a=Cu(u.href);var x=Es(y).hoistableStyles,I=x.get(a);if(I||(y=y.ownerDocument||y,I={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},x.set(a,I),(x=y.querySelector(Nh(a)))&&!x._p&&(I.instance=x,I.state.loading=5),Hi.has(a)||(u={rel:"preload",as:"style",href:u.href,crossOrigin:u.crossOrigin,integrity:u.integrity,media:u.media,hrefLang:u.hrefLang,referrerPolicy:u.referrerPolicy},Hi.set(a,u),x||Fj(y,a,u,I.state))),o&&p===null)throw Error(r(528,""));return I}if(o&&p!==null)throw Error(r(529,""));return null;case"script":return o=u.async,u=u.src,typeof u=="string"&&o&&typeof o!="function"&&typeof o!="symbol"?(o=wu(u),u=Es(y).hoistableScripts,p=u.get(o),p||(p={type:"script",instance:null,count:0,state:null},u.set(o,p)),p):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,a))}}function Cu(a){return'href="'+Xr(a)+'"'}function Nh(a){return'link[rel="stylesheet"]['+a+"]"}function Ww(a){return g({},a,{"data-precedence":a.precedence,precedence:null})}function Fj(a,o,u,p){a.querySelector('link[rel="preload"][as="style"]['+o+"]")?p.loading=1:(o=a.createElement("link"),p.preload=o,o.addEventListener("load",function(){return p.loading|=1}),o.addEventListener("error",function(){return p.loading|=2}),_r(o,"link",u),Bn(o),a.head.appendChild(o))}function wu(a){return'[src="'+Xr(a)+'"]'}function Ih(a){return"script[async]"+a}function Yw(a,o,u){if(o.count++,o.instance===null)switch(o.type){case"style":var p=a.querySelector('style[data-href~="'+Xr(u.href)+'"]');if(p)return o.instance=p,Bn(p),p;var y=g({},u,{"data-href":u.href,"data-precedence":u.precedence,href:null,precedence:null});return p=(a.ownerDocument||a).createElement("style"),Bn(p),_r(p,"style",y),wm(p,u.precedence,a),o.instance=p;case"stylesheet":y=Cu(u.href);var x=a.querySelector(Nh(y));if(x)return o.state.loading|=4,o.instance=x,Bn(x),x;p=Ww(u),(y=Hi.get(y))&&Rb(p,y),x=(a.ownerDocument||a).createElement("link"),Bn(x);var I=x;return I._p=new Promise(function(B,G){I.onload=B,I.onerror=G}),_r(x,"link",p),o.state.loading|=4,wm(x,u.precedence,a),o.instance=x;case"script":return x=wu(u.src),(y=a.querySelector(Ih(x)))?(o.instance=y,Bn(y),y):(p=u,(y=Hi.get(x))&&(p=g({},u),Ab(p,y)),a=a.ownerDocument||a,y=a.createElement("script"),Bn(y),_r(y,"link",p),a.head.appendChild(y),o.instance=y);case"void":return null;default:throw Error(r(443,o.type))}else o.type==="stylesheet"&&(o.state.loading&4)===0&&(p=o.instance,o.state.loading|=4,wm(p,u.precedence,a));return o.instance}function wm(a,o,u){for(var p=u.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),y=p.length?p[p.length-1]:null,x=y,I=0;I<p.length;I++){var B=p[I];if(B.dataset.precedence===o)x=B;else if(x!==y)break}x?x.parentNode.insertBefore(a,x.nextSibling):(o=u.nodeType===9?u.head:u,o.insertBefore(a,o.firstChild))}function Rb(a,o){a.crossOrigin==null&&(a.crossOrigin=o.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=o.referrerPolicy),a.title==null&&(a.title=o.title)}function Ab(a,o){a.crossOrigin==null&&(a.crossOrigin=o.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=o.referrerPolicy),a.integrity==null&&(a.integrity=o.integrity)}var Em=null;function Qw(a,o,u){if(Em===null){var p=new Map,y=Em=new Map;y.set(u,p)}else y=Em,p=y.get(u),p||(p=new Map,y.set(u,p));if(p.has(a))return p;for(p.set(a,null),u=u.getElementsByTagName(a),y=0;y<u.length;y++){var x=u[y];if(!(x[Cs]||x[Fn]||a==="link"&&x.getAttribute("rel")==="stylesheet")&&x.namespaceURI!=="http://www.w3.org/2000/svg"){var I=x.getAttribute(o)||"";I=a+I;var B=p.get(I);B?B.push(x):p.set(I,[x])}}return p}function Xw(a,o,u){a=a.ownerDocument||a,a.head.insertBefore(u,o==="title"?a.querySelector("head > title"):null)}function Bj(a,o,u){if(u===1||o.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof o.precedence!="string"||typeof o.href!="string"||o.href==="")break;return!0;case"link":if(typeof o.rel!="string"||typeof o.href!="string"||o.href===""||o.onLoad||o.onError)break;switch(o.rel){case"stylesheet":return a=o.disabled,typeof o.precedence=="string"&&a==null;default:return!0}case"script":if(o.async&&typeof o.async!="function"&&typeof o.async!="symbol"&&!o.onLoad&&!o.onError&&o.src&&typeof o.src=="string")return!0}return!1}function Jw(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}function $j(a,o,u,p){if(u.type==="stylesheet"&&(typeof p.media!="string"||matchMedia(p.media).matches!==!1)&&(u.state.loading&4)===0){if(u.instance===null){var y=Cu(p.href),x=o.querySelector(Nh(y));if(x){o=x._p,o!==null&&typeof o=="object"&&typeof o.then=="function"&&(a.count++,a=Rm.bind(a),o.then(a,a)),u.state.loading|=4,u.instance=x,Bn(x);return}x=o.ownerDocument||o,p=Ww(p),(y=Hi.get(y))&&Rb(p,y),x=x.createElement("link"),Bn(x);var I=x;I._p=new Promise(function(B,G){I.onload=B,I.onerror=G}),_r(x,"link",p),u.instance=x}a.stylesheets===null&&(a.stylesheets=new Map),a.stylesheets.set(u,o),(o=u.state.preload)&&(u.state.loading&3)===0&&(a.count++,u=Rm.bind(a),o.addEventListener("load",u),o.addEventListener("error",u))}}var Nb=0;function qj(a,o){return a.stylesheets&&a.count===0&&Nm(a,a.stylesheets),0<a.count||0<a.imgCount?function(u){var p=setTimeout(function(){if(a.stylesheets&&Nm(a,a.stylesheets),a.unsuspend){var x=a.unsuspend;a.unsuspend=null,x()}},6e4+o);0<a.imgBytes&&Nb===0&&(Nb=62500*kj());var y=setTimeout(function(){if(a.waitingForImages=!1,a.count===0&&(a.stylesheets&&Nm(a,a.stylesheets),a.unsuspend)){var x=a.unsuspend;a.unsuspend=null,x()}},(a.imgBytes>Nb?50:800)+o);return a.unsuspend=u,function(){a.unsuspend=null,clearTimeout(p),clearTimeout(y)}}:null}function Rm(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Nm(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var Am=null;function Nm(a,o){a.stylesheets=null,a.unsuspend!==null&&(a.count++,Am=new Map,o.forEach(Hj,a),Am=null,Rm.call(a))}function Hj(a,o){if(!(o.state.loading&4)){var u=Am.get(a);if(u)var p=u.get(null);else{u=new Map,Am.set(a,u);for(var y=a.querySelectorAll("link[data-precedence],style[data-precedence]"),x=0;x<y.length;x++){var I=y[x];(I.nodeName==="LINK"||I.getAttribute("media")!=="not all")&&(u.set(I.dataset.precedence,I),p=I)}p&&u.set(null,p)}y=o.instance,I=y.getAttribute("data-precedence"),x=u.get(I)||p,x===p&&u.set(null,y),u.set(I,y),this.count++,p=Rm.bind(this),y.addEventListener("load",p),y.addEventListener("error",p),x?x.parentNode.insertBefore(y,x.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(y,a.firstChild)),o.state.loading|=4}}var Ph={$$typeof:j,Provider:null,Consumer:null,_currentValue:ee,_currentValue2:ee,_threadCount:0};function Gj(a,o,u,p,y,x,I,B,G){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=un(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=un(0),this.hiddenUpdates=un(null),this.identifierPrefix=p,this.onUncaughtError=y,this.onCaughtError=x,this.onRecoverableError=I,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=G,this.incompleteTransitions=new Map}function Zw(a,o,u,p,y,x,I,B,G,ie,ge,ke){return a=new Gj(a,o,u,I,G,ie,ge,ke,B),o=1,x===!0&&(o|=24),x=bi(3,null,null,o),a.current=x,x.stateNode=a,o=ly(),o.refCount++,a.pooledCache=o,o.refCount++,x.memoizedState={element:p,isDehydrated:u,cache:o},fy(x),a}function eE(a){return a?(a=ru,a):ru}function tE(a,o,u,p,y,x){y=eE(y),p.context===null?p.context=y:p.pendingContext=y,p=To(o),p.payload={element:u},x=x===void 0?null:x,x!==null&&(p.callback=x),u=ko(a,p,o),u!==null&&(ri(u,a,o),uh(u,a,o))}function nE(a,o){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var u=a.retryLane;a.retryLane=u!==0&&u<o?u:o}}function Ib(a,o){nE(a,o),(a=a.alternate)&&nE(a,o)}function rE(a){if(a.tag===13||a.tag===31){var o=Fc(a,67108864);o!==null&&ri(o,a,67108864),Ib(a,67108864)}}function iE(a){if(a.tag===13||a.tag===31){var o=ki();o=tr(o);var u=Fc(a,o);u!==null&&ri(u,a,o),Ib(a,o)}}var Im=!0;function Kj(a,o,u,p){var y=K.T;K.T=null;var x=oe.p;try{oe.p=2,Pb(a,o,u,p)}finally{oe.p=x,K.T=y}}function Wj(a,o,u,p){var y=K.T;K.T=null;var x=oe.p;try{oe.p=8,Pb(a,o,u,p)}finally{oe.p=x,K.T=y}}function Pb(a,o,u,p){if(Im){var y=Mb(p);if(y===null)yb(a,o,p,Pm,u),aE(a,p);else if(Qj(y,a,o,u,p))p.stopPropagation();else if(aE(a,p),o&4&&-1<Yj.indexOf(a)){for(;y!==null;){var x=Di(y);if(x!==null)switch(x.tag){case 3:if(x=x.stateNode,x.current.memoizedState.isDehydrated){var I=Ne(x.pendingLanes);if(I!==0){var B=x;for(B.pendingLanes|=2,B.entangledLanes|=2;I;){var G=1<<31-ln(I);B.entanglements[1]|=G,I&=~G}zs(x),(qt&6)===0&&(pm=Yt()+500,wh(0))}}break;case 31:case 13:B=Fc(x,2),B!==null&&ri(B,x,2),gm(),Ib(x,2)}if(x=Mb(p),x===null&&yb(a,o,p,Pm,u),x===y)break;y=x}y!==null&&p.stopPropagation()}else yb(a,o,p,null,u)}}function Mb(a){return a=Oi(a),Db(a)}var Pm=null;function Db(a){if(Pm=null,a=ws(a),a!==null){var o=s(a);if(o===null)a=null;else{var u=o.tag;if(u===13){if(a=c(o),a!==null)return a;a=null}else if(u===31){if(a=l(o),a!==null)return a;a=null}else if(u===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;a=null}else o!==a&&(a=null)}}return Pm=a,null}function sE(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(In()){case fi:return 2;case Ni:return 8;case pi:case ao:return 32;case vn:return 268435456;default:return 32}default:return 32}}var Ob=!1,Oo=null,jo=null,Lo=null,Mh=new Map,Dh=new Map,Uo=[],Yj="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function aE(a,o){switch(a){case"focusin":case"focusout":Oo=null;break;case"dragenter":case"dragleave":jo=null;break;case"mouseover":case"mouseout":Lo=null;break;case"pointerover":case"pointerout":Mh.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":Dh.delete(o.pointerId)}}function Oh(a,o,u,p,y,x){return a===null||a.nativeEvent!==x?(a={blockedOn:o,domEventName:u,eventSystemFlags:p,nativeEvent:x,targetContainers:[y]},o!==null&&(o=Di(o),o!==null&&rE(o)),a):(a.eventSystemFlags|=p,o=a.targetContainers,y!==null&&o.indexOf(y)===-1&&o.push(y),a)}function Qj(a,o,u,p,y){switch(o){case"focusin":return Oo=Oh(Oo,a,o,u,p,y),!0;case"dragenter":return jo=Oh(jo,a,o,u,p,y),!0;case"mouseover":return Lo=Oh(Lo,a,o,u,p,y),!0;case"pointerover":var x=y.pointerId;return Mh.set(x,Oh(Mh.get(x)||null,a,o,u,p,y)),!0;case"gotpointercapture":return x=y.pointerId,Dh.set(x,Oh(Dh.get(x)||null,a,o,u,p,y)),!0}return!1}function oE(a){var o=ws(a.target);if(o!==null){var u=s(o);if(u!==null){if(o=u.tag,o===13){if(o=c(u),o!==null){a.blockedOn=o,Yr(a.priority,function(){iE(u)});return}}else if(o===31){if(o=l(u),o!==null){a.blockedOn=o,Yr(a.priority,function(){iE(u)});return}}else if(o===3&&u.stateNode.current.memoizedState.isDehydrated){a.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}a.blockedOn=null}function Mm(a){if(a.blockedOn!==null)return!1;for(var o=a.targetContainers;0<o.length;){var u=Mb(a.nativeEvent);if(u===null){u=a.nativeEvent;var p=new u.constructor(u.type,u);Wd=p,u.target.dispatchEvent(p),Wd=null}else return o=Di(u),o!==null&&rE(o),a.blockedOn=u,!1;o.shift()}return!0}function cE(a,o,u){Mm(a)&&u.delete(o)}function Xj(){Ob=!1,Oo!==null&&Mm(Oo)&&(Oo=null),jo!==null&&Mm(jo)&&(jo=null),Lo!==null&&Mm(Lo)&&(Lo=null),Mh.forEach(cE),Dh.forEach(cE)}function Dm(a,o){a.blockedOn===o&&(a.blockedOn=null,Ob||(Ob=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,Xj)))}var Om=null;function lE(a){Om!==a&&(Om=a,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){Om===a&&(Om=null);for(var o=0;o<a.length;o+=3){var u=a[o],p=a[o+1],y=a[o+2];if(typeof p!="function"){if(Db(p||u)===null)continue;break}var x=Di(u);x!==null&&(a.splice(o,3),o-=3,My(x,{pending:!0,data:y,method:u.method,action:p},p,y))}}))}function Eu(a){function o(G){return Dm(G,a)}Oo!==null&&Dm(Oo,a),jo!==null&&Dm(jo,a),Lo!==null&&Dm(Lo,a),Mh.forEach(o),Dh.forEach(o);for(var u=0;u<Uo.length;u++){var p=Uo[u];p.blockedOn===a&&(p.blockedOn=null)}for(;0<Uo.length&&(u=Uo[0],u.blockedOn===null);)oE(u),u.blockedOn===null&&Uo.shift();if(u=(a.ownerDocument||a).$$reactFormReplay,u!=null)for(p=0;p<u.length;p+=3){var y=u[p],x=u[p+1],I=y[or]||null;if(typeof x=="function")I||lE(u);else if(I){var B=null;if(x&&x.hasAttribute("formAction")){if(y=x,I=x[or]||null)B=I.formAction;else if(Db(y)!==null)continue}else B=I.action;typeof B=="function"?u[p+1]=B:(u.splice(p,3),p-=3),lE(u)}}}function uE(){function a(x){x.canIntercept&&x.info==="react-transition"&&x.intercept({handler:function(){return new Promise(function(I){return y=I})},focusReset:"manual",scroll:"manual"})}function o(){y!==null&&(y(),y=null),p||setTimeout(u,20)}function u(){if(!p&&!navigation.transition){var x=navigation.currentEntry;x&&x.url!=null&&navigation.navigate(x.url,{state:x.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var p=!1,y=null;return navigation.addEventListener("navigate",a),navigation.addEventListener("navigatesuccess",o),navigation.addEventListener("navigateerror",o),setTimeout(u,100),function(){p=!0,navigation.removeEventListener("navigate",a),navigation.removeEventListener("navigatesuccess",o),navigation.removeEventListener("navigateerror",o),y!==null&&(y(),y=null)}}}function jb(a){this._internalRoot=a}jm.prototype.render=jb.prototype.render=function(a){var o=this._internalRoot;if(o===null)throw Error(r(409));var u=o.current,p=ki();tE(u,p,a,o,null,null)},jm.prototype.unmount=jb.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var o=a.containerInfo;tE(a.current,2,null,a,null,null),gm(),o[ks]=null}};function jm(a){this._internalRoot=a}jm.prototype.unstable_scheduleHydration=function(a){if(a){var o=Fl();a={blockedOn:null,target:a,priority:o};for(var u=0;u<Uo.length&&o!==0&&o<Uo[u].priority;u++);Uo.splice(u,0,a),u===0&&oE(a)}};var dE=e.version;if(dE!=="19.2.3")throw Error(r(527,dE,"19.2.3"));oe.findDOMNode=function(a){var o=a._reactInternals;if(o===void 0)throw typeof a.render=="function"?Error(r(188)):(a=Object.keys(a).join(","),Error(r(268,a)));return a=h(o),a=a!==null?m(a):null,a=a===null?null:a.stateNode,a};var Jj={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:K,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Lm=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Lm.isDisabled&&Lm.supportsFiber)try{sn=Lm.inject(Jj),Gt=Lm}catch{}}return Lh.createRoot=function(a,o){if(!i(a))throw Error(r(299));var u=!1,p="",y=yC,x=bC,I=xC;return o!=null&&(o.unstable_strictMode===!0&&(u=!0),o.identifierPrefix!==void 0&&(p=o.identifierPrefix),o.onUncaughtError!==void 0&&(y=o.onUncaughtError),o.onCaughtError!==void 0&&(x=o.onCaughtError),o.onRecoverableError!==void 0&&(I=o.onRecoverableError)),o=Zw(a,1,!1,null,null,u,p,null,y,x,I,uE),a[ks]=o.current,vb(a),new jb(o)},Lh.hydrateRoot=function(a,o,u){if(!i(a))throw Error(r(299));var p=!1,y="",x=yC,I=bC,B=xC,G=null;return u!=null&&(u.unstable_strictMode===!0&&(p=!0),u.identifierPrefix!==void 0&&(y=u.identifierPrefix),u.onUncaughtError!==void 0&&(x=u.onUncaughtError),u.onCaughtError!==void 0&&(I=u.onCaughtError),u.onRecoverableError!==void 0&&(B=u.onRecoverableError),u.formState!==void 0&&(G=u.formState)),o=Zw(a,1,!0,o,u??null,p,y,G,x,I,B,uE),o.context=eE(null),u=o.current,p=ki(),p=tr(p),y=To(p),y.callback=null,ko(u,y,p),u=p,o.current.lanes=u,Pi(o,u),zs(o),a[ks]=o.current,vb(a),new jm(o)},Lh.version="19.2.3",Lh}var _E;function l9(){if(_E)return Vb.exports;_E=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),Vb.exports=c9(),Vb.exports}var u9=l9();const d9=()=>{};var SE={};const hN=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},h9=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=n[t++];e[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){const s=n[t++],c=n[t++],l=n[t++],d=((i&7)<<18|(s&63)<<12|(c&63)<<6|l&63)-65536;e[r++]=String.fromCharCode(55296+(d>>10)),e[r++]=String.fromCharCode(56320+(d&1023))}else{const s=n[t++],c=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|c&63)}}return e.join("")},fN={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){const s=n[i],c=i+1<n.length,l=c?n[i+1]:0,d=i+2<n.length,h=d?n[i+2]:0,m=s>>2,g=(s&3)<<4|l>>4;let b=(l&15)<<2|h>>6,_=h&63;d||(_=64,c||(b=64)),r.push(t[m],t[g],t[b],t[_])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(hN(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):h9(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){const s=t[n.charAt(i++)],l=i<n.length?t[n.charAt(i)]:0;++i;const h=i<n.length?t[n.charAt(i)]:64;++i;const g=i<n.length?t[n.charAt(i)]:64;if(++i,s==null||l==null||h==null||g==null)throw new f9;const b=s<<2|l>>4;if(r.push(b),h!==64){const _=l<<4&240|h>>2;if(r.push(_),g!==64){const R=h<<6&192|g;r.push(R)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class f9 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const p9=function(n){const e=hN(n);return fN.encodeByteArray(e,!0)},Hg=function(n){return p9(n).replace(/\./g,"")},pN=function(n){try{return fN.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function m9(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const g9=()=>m9().__FIREBASE_DEFAULTS__,v9=()=>{if(typeof process>"u"||typeof SE>"u")return;const n=SE.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},y9=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&pN(n[1]);return e&&JSON.parse(e)},qv=()=>{try{return d9()||g9()||v9()||y9()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},mN=n=>qv()?.emulatorHosts?.[n],gN=n=>{const e=mN(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},vN=()=>qv()?.config,yN=n=>qv()?.[`_${n}`];class b9{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}function Rl(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function R_(n){return(await fetch(n,{credentials:"include"})).ok}function bN(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",i=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const c={iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}},...n};return[Hg(JSON.stringify(t)),Hg(JSON.stringify(c)),""].join(".")}const cf={};function x9(){const n={prod:[],emulator:[]};for(const e of Object.keys(cf))cf[e]?n.emulator.push(e):n.prod.push(e);return n}function _9(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let TE=!1;function A_(n,e){if(typeof window>"u"||typeof document>"u"||!Rl(window.location.host)||cf[n]===e||cf[n]||TE)return;cf[n]=e;function t(b){return`__firebase__banner__${b}`}const r="__firebase__banner",s=x9().prod.length>0;function c(){const b=document.getElementById(r);b&&b.remove()}function l(b){b.style.display="flex",b.style.background="#7faaf0",b.style.position="fixed",b.style.bottom="5px",b.style.left="5px",b.style.padding=".5em",b.style.borderRadius="5px",b.style.alignItems="center"}function d(b,_){b.setAttribute("width","24"),b.setAttribute("id",_),b.setAttribute("height","24"),b.setAttribute("viewBox","0 0 24 24"),b.setAttribute("fill","none"),b.style.marginLeft="-6px"}function h(){const b=document.createElement("span");return b.style.cursor="pointer",b.style.marginLeft="16px",b.style.fontSize="24px",b.innerHTML=" &times;",b.onclick=()=>{TE=!0,c()},b}function m(b,_){b.setAttribute("id",_),b.innerText="Learn more",b.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",b.setAttribute("target","__blank"),b.style.paddingLeft="5px",b.style.textDecoration="underline"}function g(){const b=_9(r),_=t("text"),R=document.getElementById(_)||document.createElement("span"),E=t("learnmore"),A=document.getElementById(E)||document.createElement("a"),M=t("preprendIcon"),F=document.getElementById(M)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(b.created){const j=b.element;l(j),m(A,E);const C=h();d(F,M),j.append(F,R,A,C),document.body.appendChild(j)}s?(R.innerText="Preview backend disconnected.",F.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(F.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,R.innerText="Preview backend running in this workspace."),R.setAttribute("id",_)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",g):g()}function jr(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function S9(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(jr())}function T9(){const n=qv()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function k9(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function C9(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function w9(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function E9(){const n=jr();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function R9(){return!T9()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function A9(){try{return typeof indexedDB=="object"}catch{return!1}}function N9(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{e(i.error?.message||"")}}catch(t){e(t)}})}const I9="FirebaseError";class oa extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=I9,Object.setPrototypeOf(this,oa.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Yf.prototype.create)}}class Yf{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],c=s?P9(s,r):"Error",l=`${this.serviceName}: ${c} (${i}).`;return new oa(i,l,r)}}function P9(n,e){return n.replace(M9,(t,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const M9=/\{\$([^}]+)}/g;function D9(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Wa(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const i of t){if(!r.includes(i))return!1;const s=n[i],c=e[i];if(kE(s)&&kE(c)){if(!Wa(s,c))return!1}else if(s!==c)return!1}for(const i of r)if(!t.includes(i))return!1;return!0}function kE(n){return n!==null&&typeof n=="object"}function Qf(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Qh(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[i,s]=r.split("=");e[decodeURIComponent(i)]=decodeURIComponent(s)}}),e}function Xh(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function O9(n,e){const t=new j9(n,e);return t.subscribe.bind(t)}class j9{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let i;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");L9(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:r},i.next===void 0&&(i.next=$b),i.error===void 0&&(i.error=$b),i.complete===void 0&&(i.complete=$b);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function L9(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function $b(){}function hn(n){return n&&n._delegate?n._delegate:n}class fc{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const nl="[DEFAULT]";class U9{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new b9;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(i){if(r)return null;throw i}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(z9(e))try{this.getOrInitializeService({instanceIdentifier:nl})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch{}}}}clearInstance(e=nl){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=nl){return this.instances.has(e)}getOptions(e=nl){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[s,c]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(s);r===l&&c.resolve(i)}return i}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),i=this.onInitCallbacks.get(r)??new Set;i.add(e),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:V9(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=nl){return this.component?this.component.multipleInstances?e:nl:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function V9(n){return n===nl?void 0:n}function z9(n){return n.instantiationMode==="EAGER"}class F9{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new U9(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var Mt;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Mt||(Mt={}));const B9={debug:Mt.DEBUG,verbose:Mt.VERBOSE,info:Mt.INFO,warn:Mt.WARN,error:Mt.ERROR,silent:Mt.SILENT},$9=Mt.INFO,q9={[Mt.DEBUG]:"log",[Mt.VERBOSE]:"log",[Mt.INFO]:"info",[Mt.WARN]:"warn",[Mt.ERROR]:"error"},H9=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),i=q9[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};let N_=class{constructor(e){this.name=e,this._logLevel=$9,this._logHandler=H9,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Mt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?B9[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Mt.DEBUG,...e),this._logHandler(this,Mt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Mt.VERBOSE,...e),this._logHandler(this,Mt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Mt.INFO,...e),this._logHandler(this,Mt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Mt.WARN,...e),this._logHandler(this,Mt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Mt.ERROR,...e),this._logHandler(this,Mt.ERROR,...e)}};const G9=(n,e)=>e.some(t=>n instanceof t);let CE,wE;function K9(){return CE||(CE=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function W9(){return wE||(wE=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const xN=new WeakMap,G1=new WeakMap,_N=new WeakMap,qb=new WeakMap,I_=new WeakMap;function Y9(n){const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("success",s),n.removeEventListener("error",c)},s=()=>{t(ic(n.result)),i()},c=()=>{r(n.error),i()};n.addEventListener("success",s),n.addEventListener("error",c)});return e.then(t=>{t instanceof IDBCursor&&xN.set(t,n)}).catch(()=>{}),I_.set(e,n),e}function Q9(n){if(G1.has(n))return;const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",c),n.removeEventListener("abort",c)},s=()=>{t(),i()},c=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",s),n.addEventListener("error",c),n.addEventListener("abort",c)});G1.set(n,e)}let K1={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return G1.get(n);if(e==="objectStoreNames")return n.objectStoreNames||_N.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return ic(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function X9(n){K1=n(K1)}function J9(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(Hb(this),e,...t);return _N.set(r,e.sort?e.sort():[e]),ic(r)}:W9().includes(n)?function(...e){return n.apply(Hb(this),e),ic(xN.get(this))}:function(...e){return ic(n.apply(Hb(this),e))}}function Z9(n){return typeof n=="function"?J9(n):(n instanceof IDBTransaction&&Q9(n),G9(n,K9())?new Proxy(n,K1):n)}function ic(n){if(n instanceof IDBRequest)return Y9(n);if(qb.has(n))return qb.get(n);const e=Z9(n);return e!==n&&(qb.set(n,e),I_.set(e,n)),e}const Hb=n=>I_.get(n);function eL(n,e,{blocked:t,upgrade:r,blocking:i,terminated:s}={}){const c=indexedDB.open(n,e),l=ic(c);return r&&c.addEventListener("upgradeneeded",d=>{r(ic(c.result),d.oldVersion,d.newVersion,ic(c.transaction),d)}),t&&c.addEventListener("blocked",d=>t(d.oldVersion,d.newVersion,d)),l.then(d=>{s&&d.addEventListener("close",()=>s()),i&&d.addEventListener("versionchange",h=>i(h.oldVersion,h.newVersion,h))}).catch(()=>{}),l}const tL=["get","getKey","getAll","getAllKeys","count"],nL=["put","add","delete","clear"],Gb=new Map;function EE(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Gb.get(e))return Gb.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,i=nL.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||tL.includes(t)))return;const s=async function(c,...l){const d=this.transaction(c,i?"readwrite":"readonly");let h=d.store;return r&&(h=h.index(l.shift())),(await Promise.all([h[t](...l),i&&d.done]))[0]};return Gb.set(e,s),s}X9(n=>({...n,get:(e,t,r)=>EE(e,t)||n.get(e,t,r),has:(e,t)=>!!EE(e,t)||n.has(e,t)}));class rL{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(iL(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function iL(n){return n.getComponent()?.type==="VERSION"}const W1="@firebase/app",RE="0.14.6";const Ya=new N_("@firebase/app"),sL="@firebase/app-compat",aL="@firebase/analytics-compat",oL="@firebase/analytics",cL="@firebase/app-check-compat",lL="@firebase/app-check",uL="@firebase/auth",dL="@firebase/auth-compat",hL="@firebase/database",fL="@firebase/data-connect",pL="@firebase/database-compat",mL="@firebase/functions",gL="@firebase/functions-compat",vL="@firebase/installations",yL="@firebase/installations-compat",bL="@firebase/messaging",xL="@firebase/messaging-compat",_L="@firebase/performance",SL="@firebase/performance-compat",TL="@firebase/remote-config",kL="@firebase/remote-config-compat",CL="@firebase/storage",wL="@firebase/storage-compat",EL="@firebase/firestore",RL="@firebase/ai",AL="@firebase/firestore-compat",NL="firebase",IL="12.6.0";const Y1="[DEFAULT]",PL={[W1]:"fire-core",[sL]:"fire-core-compat",[oL]:"fire-analytics",[aL]:"fire-analytics-compat",[lL]:"fire-app-check",[cL]:"fire-app-check-compat",[uL]:"fire-auth",[dL]:"fire-auth-compat",[hL]:"fire-rtdb",[fL]:"fire-data-connect",[pL]:"fire-rtdb-compat",[mL]:"fire-fn",[gL]:"fire-fn-compat",[vL]:"fire-iid",[yL]:"fire-iid-compat",[bL]:"fire-fcm",[xL]:"fire-fcm-compat",[_L]:"fire-perf",[SL]:"fire-perf-compat",[TL]:"fire-rc",[kL]:"fire-rc-compat",[CL]:"fire-gcs",[wL]:"fire-gcs-compat",[EL]:"fire-fst",[AL]:"fire-fst-compat",[RL]:"fire-vertex","fire-js":"fire-js",[NL]:"fire-js-all"};const Gg=new Map,ML=new Map,Q1=new Map;function AE(n,e){try{n.container.addComponent(e)}catch(t){Ya.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function pl(n){const e=n.name;if(Q1.has(e))return Ya.debug(`There were multiple attempts to register component ${e}.`),!1;Q1.set(e,n);for(const t of Gg.values())AE(t,n);for(const t of ML.values())AE(t,n);return!0}function Hv(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Ei(n){return n==null?!1:n.settings!==void 0}const DL={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},sc=new Yf("app","Firebase",DL);class OL{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new fc("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw sc.create("app-deleted",{appName:this._name})}}const Al=IL;function SN(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r={name:Y1,automaticDataCollectionEnabled:!0,...e},i=r.name;if(typeof i!="string"||!i)throw sc.create("bad-app-name",{appName:String(i)});if(t||(t=vN()),!t)throw sc.create("no-options");const s=Gg.get(i);if(s){if(Wa(t,s.options)&&Wa(r,s.config))return s;throw sc.create("duplicate-app",{appName:i})}const c=new F9(i);for(const d of Q1.values())c.addComponent(d);const l=new OL(t,r,c);return Gg.set(i,l),l}function P_(n=Y1){const e=Gg.get(n);if(!e&&n===Y1&&vN())return SN();if(!e)throw sc.create("no-app",{appName:n});return e}function Ks(n,e,t){let r=PL[n]??n;t&&(r+=`-${t}`);const i=r.match(/\s|\//),s=e.match(/\s|\//);if(i||s){const c=[`Unable to register library "${r}" with version "${e}":`];i&&c.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&s&&c.push("and"),s&&c.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Ya.warn(c.join(" "));return}pl(new fc(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}const jL="firebase-heartbeat-database",LL=1,bf="firebase-heartbeat-store";let Kb=null;function TN(){return Kb||(Kb=eL(jL,LL,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(bf)}catch(t){console.warn(t)}}}}).catch(n=>{throw sc.create("idb-open",{originalErrorMessage:n.message})})),Kb}async function UL(n){try{const t=(await TN()).transaction(bf),r=await t.objectStore(bf).get(kN(n));return await t.done,r}catch(e){if(e instanceof oa)Ya.warn(e.message);else{const t=sc.create("idb-get",{originalErrorMessage:e?.message});Ya.warn(t.message)}}}async function NE(n,e){try{const r=(await TN()).transaction(bf,"readwrite");await r.objectStore(bf).put(e,kN(n)),await r.done}catch(t){if(t instanceof oa)Ya.warn(t.message);else{const r=sc.create("idb-set",{originalErrorMessage:t?.message});Ya.warn(r.message)}}}function kN(n){return`${n.name}!${n.options.appId}`}const VL=1024,zL=30;class FL{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new $L(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=IE();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(i=>i.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:t}),this._heartbeatsCache.heartbeats.length>zL){const i=qL(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(i,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){Ya.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=IE(),{heartbeatsToSend:t,unsentEntries:r}=BL(this._heartbeatsCache.heartbeats),i=Hg(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return Ya.warn(e),""}}}function IE(){return new Date().toISOString().substring(0,10)}function BL(n,e=VL){const t=[];let r=n.slice();for(const i of n){const s=t.find(c=>c.agent===i.agent);if(s){if(s.dates.push(i.date),PE(t)>e){s.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),PE(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class $L{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return A9()?N9().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await UL(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return NE(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return NE(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function PE(n){return Hg(JSON.stringify({version:2,heartbeats:n})).length}function qL(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}function HL(n){pl(new fc("platform-logger",e=>new rL(e),"PRIVATE")),pl(new fc("heartbeat",e=>new FL(e),"PRIVATE")),Ks(W1,RE,n),Ks(W1,RE,"esm2020"),Ks("fire-js","")}HL("");var GL="firebase",KL="12.6.0";Ks(GL,KL,"app");function CN(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const WL=CN,wN=new Yf("auth","Firebase",CN());const Kg=new N_("@firebase/auth");function YL(n,...e){Kg.logLevel<=Mt.WARN&&Kg.warn(`Auth (${Al}): ${n}`,...e)}function cg(n,...e){Kg.logLevel<=Mt.ERROR&&Kg.error(`Auth (${Al}): ${n}`,...e)}function bs(n,...e){throw M_(n,...e)}function Ws(n,...e){return M_(n,...e)}function EN(n,e,t){const r={...WL(),[e]:t};return new Yf("auth","Firebase",r).create(e,{appName:n.name})}function Ha(n){return EN(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function M_(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return wN.create(n,...e)}function ct(n,e,...t){if(!n)throw M_(e,...t)}function Ba(n){const e="INTERNAL ASSERTION FAILED: "+n;throw cg(e),new Error(e)}function Qa(n,e){n||Ba(e)}function X1(){return typeof self<"u"&&self.location?.href||""}function QL(){return ME()==="http:"||ME()==="https:"}function ME(){return typeof self<"u"&&self.location?.protocol||null}function XL(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(QL()||C9()||"connection"in navigator)?navigator.onLine:!0}function JL(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}class Xf{constructor(e,t){this.shortDelay=e,this.longDelay=t,Qa(t>e,"Short delay should be less than long delay!"),this.isMobile=S9()||w9()}get(){return XL()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function D_(n,e){Qa(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}class RN{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Ba("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Ba("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Ba("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const ZL={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const e8=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],t8=new Xf(3e4,6e4);function ro(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function ca(n,e,t,r,i={}){return AN(n,i,async()=>{let s={},c={};r&&(e==="GET"?c=r:s={body:JSON.stringify(r)});const l=Qf({key:n.config.apiKey,...c}).slice(1),d=await n._getAdditionalHeaders();d["Content-Type"]="application/json",n.languageCode&&(d["X-Firebase-Locale"]=n.languageCode);const h={method:e,headers:d,...s};return k9()||(h.referrerPolicy="no-referrer"),n.emulatorConfig&&Rl(n.emulatorConfig.host)&&(h.credentials="include"),RN.fetch()(await NN(n,n.config.apiHost,t,l),h)})}async function AN(n,e,t){n._canInitEmulator=!1;const r={...ZL,...e};try{const i=new r8(n),s=await Promise.race([t(),i.promise]);i.clearNetworkTimeout();const c=await s.json();if("needConfirmation"in c)throw Um(n,"account-exists-with-different-credential",c);if(s.ok&&!("errorMessage"in c))return c;{const l=s.ok?c.errorMessage:c.error.message,[d,h]=l.split(" : ");if(d==="FEDERATED_USER_ID_ALREADY_LINKED")throw Um(n,"credential-already-in-use",c);if(d==="EMAIL_EXISTS")throw Um(n,"email-already-in-use",c);if(d==="USER_DISABLED")throw Um(n,"user-disabled",c);const m=r[d]||d.toLowerCase().replace(/[_\s]+/g,"-");if(h)throw EN(n,m,h);bs(n,m)}}catch(i){if(i instanceof oa)throw i;bs(n,"network-request-failed",{message:String(i)})}}async function Jf(n,e,t,r,i={}){const s=await ca(n,e,t,r,i);return"mfaPendingCredential"in s&&bs(n,"multi-factor-auth-required",{_serverResponse:s}),s}async function NN(n,e,t,r){const i=`${e}${t}?${r}`,s=n,c=s.config.emulator?D_(n.config,i):`${n.config.apiScheme}://${i}`;return e8.includes(t)&&(await s._persistenceManagerAvailable,s._getPersistenceType()==="COOKIE")?s._getPersistence()._getFinalTarget(c).toString():c}function n8(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class r8{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(Ws(this.auth,"network-request-failed")),t8.get())})}}function Um(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const i=Ws(n,e,r);return i.customData._tokenResponse=t,i}function DE(n){return n!==void 0&&n.enterprise!==void 0}class i8{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return n8(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function s8(n,e){return ca(n,"GET","/v2/recaptchaConfig",ro(n,e))}async function a8(n,e){return ca(n,"POST","/v1/accounts:delete",e)}async function Wg(n,e){return ca(n,"POST","/v1/accounts:lookup",e)}function lf(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function o8(n,e=!1){const t=hn(n),r=await t.getIdToken(e),i=O_(r);ct(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");const s=typeof i.firebase=="object"?i.firebase:void 0,c=s?.sign_in_provider;return{claims:i,token:r,authTime:lf(Wb(i.auth_time)),issuedAtTime:lf(Wb(i.iat)),expirationTime:lf(Wb(i.exp)),signInProvider:c||null,signInSecondFactor:s?.sign_in_second_factor||null}}function Wb(n){return Number(n)*1e3}function O_(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return cg("JWT malformed, contained fewer than 3 sections"),null;try{const i=pN(t);return i?JSON.parse(i):(cg("Failed to decode base64 JWT payload"),null)}catch(i){return cg("Caught error parsing JWT payload as JSON",i?.toString()),null}}function OE(n){const e=O_(n);return ct(e,"internal-error"),ct(typeof e.exp<"u","internal-error"),ct(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function sd(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof oa&&c8(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function c8({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}class l8{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class J1{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=lf(this.lastLoginAt),this.creationTime=lf(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Yg(n){const e=n.auth,t=await n.getIdToken(),r=await sd(n,Wg(e,{idToken:t}));ct(r?.users.length,e,"internal-error");const i=r.users[0];n._notifyReloadListener(i);const s=i.providerUserInfo?.length?IN(i.providerUserInfo):[],c=d8(n.providerData,s),l=n.isAnonymous,d=!(n.email&&i.passwordHash)&&!c?.length,h=l?d:!1,m={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:c,metadata:new J1(i.createdAt,i.lastLoginAt),isAnonymous:h};Object.assign(n,m)}async function u8(n){const e=hn(n);await Yg(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function d8(n,e){return[...n.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function IN(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function h8(n,e){const t=await AN(n,{},async()=>{const r=Qf({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:s}=n.config,c=await NN(n,i,"/v1/token",`key=${s}`),l=await n._getAdditionalHeaders();l["Content-Type"]="application/x-www-form-urlencoded";const d={method:"POST",headers:l,body:r};return n.emulatorConfig&&Rl(n.emulatorConfig.host)&&(d.credentials="include"),RN.fetch()(c,d)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function f8(n,e){return ca(n,"POST","/v2/accounts:revokeToken",ro(n,e))}class $u{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){ct(e.idToken,"internal-error"),ct(typeof e.idToken<"u","internal-error"),ct(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):OE(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){ct(e.length!==0,"internal-error");const t=OE(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(ct(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:i,expiresIn:s}=await h8(e,t);this.updateTokensAndExpiration(r,i,Number(s))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:i,expirationTime:s}=t,c=new $u;return r&&(ct(typeof r=="string","internal-error",{appName:e}),c.refreshToken=r),i&&(ct(typeof i=="string","internal-error",{appName:e}),c.accessToken=i),s&&(ct(typeof s=="number","internal-error",{appName:e}),c.expirationTime=s),c}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new $u,this.toJSON())}_performRefresh(){return Ba("not implemented")}}function zo(n,e){ct(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class ms{constructor({uid:e,auth:t,stsTokenManager:r,...i}){this.providerId="firebase",this.proactiveRefresh=new l8(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new J1(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await sd(this,this.stsTokenManager.getToken(this.auth,e));return ct(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return o8(this,e)}reload(){return u8(this)}_assign(e){this!==e&&(ct(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new ms({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){ct(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Yg(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Ei(this.auth.app))return Promise.reject(Ha(this.auth));const e=await this.getIdToken();return await sd(this,a8(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const r=t.displayName??void 0,i=t.email??void 0,s=t.phoneNumber??void 0,c=t.photoURL??void 0,l=t.tenantId??void 0,d=t._redirectEventId??void 0,h=t.createdAt??void 0,m=t.lastLoginAt??void 0,{uid:g,emailVerified:b,isAnonymous:_,providerData:R,stsTokenManager:E}=t;ct(g&&E,e,"internal-error");const A=$u.fromJSON(this.name,E);ct(typeof g=="string",e,"internal-error"),zo(r,e.name),zo(i,e.name),ct(typeof b=="boolean",e,"internal-error"),ct(typeof _=="boolean",e,"internal-error"),zo(s,e.name),zo(c,e.name),zo(l,e.name),zo(d,e.name),zo(h,e.name),zo(m,e.name);const M=new ms({uid:g,auth:e,email:i,emailVerified:b,displayName:r,isAnonymous:_,photoURL:c,phoneNumber:s,tenantId:l,stsTokenManager:A,createdAt:h,lastLoginAt:m});return R&&Array.isArray(R)&&(M.providerData=R.map(F=>({...F}))),d&&(M._redirectEventId=d),M}static async _fromIdTokenResponse(e,t,r=!1){const i=new $u;i.updateFromServerResponse(t);const s=new ms({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:r});return await Yg(s),s}static async _fromGetAccountInfoResponse(e,t,r){const i=t.users[0];ct(i.localId!==void 0,"internal-error");const s=i.providerUserInfo!==void 0?IN(i.providerUserInfo):[],c=!(i.email&&i.passwordHash)&&!s?.length,l=new $u;l.updateFromIdToken(r);const d=new ms({uid:i.localId,auth:e,stsTokenManager:l,isAnonymous:c}),h={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:s,metadata:new J1(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!s?.length};return Object.assign(d,h),d}}const jE=new Map;function $a(n){Qa(n instanceof Function,"Expected a class definition");let e=jE.get(n);return e?(Qa(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,jE.set(n,e),e)}class PN{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}PN.type="NONE";const LE=PN;function lg(n,e,t){return`firebase:${n}:${e}:${t}`}class qu{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:i,name:s}=this.auth;this.fullUserKey=lg(this.userKey,i.apiKey,s),this.fullPersistenceKey=lg("persistence",i.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await Wg(this.auth,{idToken:e}).catch(()=>{});return t?ms._fromGetAccountInfoResponse(this.auth,t,e):null}return ms._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new qu($a(LE),e,r);const i=(await Promise.all(t.map(async h=>{if(await h._isAvailable())return h}))).filter(h=>h);let s=i[0]||$a(LE);const c=lg(r,e.config.apiKey,e.name);let l=null;for(const h of t)try{const m=await h._get(c);if(m){let g;if(typeof m=="string"){const b=await Wg(e,{idToken:m}).catch(()=>{});if(!b)break;g=await ms._fromGetAccountInfoResponse(e,b,m)}else g=ms._fromJSON(e,m);h!==s&&(l=g),s=h;break}}catch{}const d=i.filter(h=>h._shouldAllowMigration);return!s._shouldAllowMigration||!d.length?new qu(s,e,r):(s=d[0],l&&await s._set(c,l.toJSON()),await Promise.all(t.map(async h=>{if(h!==s)try{await h._remove(c)}catch{}})),new qu(s,e,r))}}function UE(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(jN(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(MN(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(UN(e))return"Blackberry";if(VN(e))return"Webos";if(DN(e))return"Safari";if((e.includes("chrome/")||ON(e))&&!e.includes("edge/"))return"Chrome";if(LN(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function MN(n=jr()){return/firefox\//i.test(n)}function DN(n=jr()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function ON(n=jr()){return/crios\//i.test(n)}function jN(n=jr()){return/iemobile/i.test(n)}function LN(n=jr()){return/android/i.test(n)}function UN(n=jr()){return/blackberry/i.test(n)}function VN(n=jr()){return/webos/i.test(n)}function j_(n=jr()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function p8(n=jr()){return j_(n)&&!!window.navigator?.standalone}function m8(){return E9()&&document.documentMode===10}function zN(n=jr()){return j_(n)||LN(n)||VN(n)||UN(n)||/windows phone/i.test(n)||jN(n)}function FN(n,e=[]){let t;switch(n){case"Browser":t=UE(jr());break;case"Worker":t=`${UE(jr())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Al}/${r}`}class g8{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=s=>new Promise((c,l)=>{try{const d=e(s);c(d)}catch(d){l(d)}});r.onAbort=t,this.queue.push(r);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}}}async function v8(n,e={}){return ca(n,"GET","/v2/passwordPolicy",ro(n,e))}const y8=6;class b8{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??y8,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,i,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}}class x8{constructor(e,t,r,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new VE(this),this.idTokenSubscription=new VE(this),this.beforeStateQueue=new g8(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=wN,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(s=>this._resolvePersistenceManagerAvailable=s)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=$a(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await qu.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await Wg(this,{idToken:e}),r=await ms._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(Ei(this.app)){const s=this.app.settings.authIdToken;return s?new Promise(c=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(s).then(c,c))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let r=t,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const s=this.redirectUser?._redirectEventId,c=r?._redirectEventId,l=await this.tryRedirectSignIn(e);(!s||s===c)&&l?.user&&(r=l.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(s){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(s))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return ct(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Yg(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=JL()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Ei(this.app))return Promise.reject(Ha(this));const t=e?hn(e):null;return t&&ct(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&ct(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Ei(this.app)?Promise.reject(Ha(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Ei(this.app)?Promise.reject(Ha(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence($a(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await v8(this),t=new b8(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Yf("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await f8(this,r)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&$a(e)||this._popupRedirectResolver;ct(t,this,"argument-error"),this.redirectPersistenceManager=await qu.create(this,[$a(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,i){if(this._deleted)return()=>{};const s=typeof t=="function"?t:t.next.bind(t);let c=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(ct(l,this,"internal-error"),l.then(()=>{c||s(this.currentUser)}),typeof t=="function"){const d=e.addObserver(t,r,i);return()=>{c=!0,d()}}else{const d=e.addObserver(t);return()=>{c=!0,d()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return ct(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=FN(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(Ei(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&YL(`Error while retrieving App Check token: ${e.error}`),e?.token}}function Tc(n){return hn(n)}class VE{constructor(e){this.auth=e,this.observer=null,this.addObserver=O9(t=>this.observer=t)}get next(){return ct(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Gv={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function _8(n){Gv=n}function BN(n){return Gv.loadJS(n)}function S8(){return Gv.recaptchaEnterpriseScript}function T8(){return Gv.gapiScript}function k8(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class C8{constructor(){this.enterprise=new w8}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class w8{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const E8="recaptcha-enterprise",$N="NO_RECAPTCHA";class R8{constructor(e){this.type=E8,this.auth=Tc(e)}async verify(e="verify",t=!1){async function r(s){if(!t){if(s.tenantId==null&&s._agentRecaptchaConfig!=null)return s._agentRecaptchaConfig.siteKey;if(s.tenantId!=null&&s._tenantRecaptchaConfigs[s.tenantId]!==void 0)return s._tenantRecaptchaConfigs[s.tenantId].siteKey}return new Promise(async(c,l)=>{s8(s,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(d=>{if(d.recaptchaKey===void 0)l(new Error("recaptcha Enterprise site key undefined"));else{const h=new i8(d);return s.tenantId==null?s._agentRecaptchaConfig=h:s._tenantRecaptchaConfigs[s.tenantId]=h,c(h.siteKey)}}).catch(d=>{l(d)})})}function i(s,c,l){const d=window.grecaptcha;DE(d)?d.enterprise.ready(()=>{d.enterprise.execute(s,{action:e}).then(h=>{c(h)}).catch(()=>{c($N)})}):l(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new C8().execute("siteKey",{action:"verify"}):new Promise((s,c)=>{r(this.auth).then(l=>{if(!t&&DE(window.grecaptcha))i(l,s,c);else{if(typeof window>"u"){c(new Error("RecaptchaVerifier is only supported in browser"));return}let d=S8();d.length!==0&&(d+=l),BN(d).then(()=>{i(l,s,c)}).catch(h=>{c(h)})}}).catch(l=>{c(l)})})}}async function zE(n,e,t,r=!1,i=!1){const s=new R8(n);let c;if(i)c=$N;else try{c=await s.verify(t)}catch{c=await s.verify(t,!0)}const l={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in l){const d=l.phoneEnrollmentInfo.phoneNumber,h=l.phoneEnrollmentInfo.recaptchaToken;Object.assign(l,{phoneEnrollmentInfo:{phoneNumber:d,recaptchaToken:h,captchaResponse:c,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in l){const d=l.phoneSignInInfo.recaptchaToken;Object.assign(l,{phoneSignInInfo:{recaptchaToken:d,captchaResponse:c,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return l}return r?Object.assign(l,{captchaResp:c}):Object.assign(l,{captchaResponse:c}),Object.assign(l,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(l,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),l}async function Qg(n,e,t,r,i){if(n._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const s=await zE(n,e,t,t==="getOobCode");return r(n,s)}else return r(n,e).catch(async s=>{if(s.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const c=await zE(n,e,t,t==="getOobCode");return r(n,c)}else return Promise.reject(s)})}function A8(n,e){const t=Hv(n,"auth");if(t.isInitialized()){const i=t.getImmediate(),s=t.getOptions();if(Wa(s,e??{}))return i;bs(i,"already-initialized")}return t.initialize({options:e})}function N8(n,e){const t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map($a);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}function I8(n,e,t){const r=Tc(n);ct(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const i=!1,s=qN(e),{host:c,port:l}=P8(e),d=l===null?"":`:${l}`,h={url:`${s}//${c}${d}/`},m=Object.freeze({host:c,port:l,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator){ct(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),ct(Wa(h,r.config.emulator)&&Wa(m,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=h,r.emulatorConfig=m,r.settings.appVerificationDisabledForTesting=!0,Rl(c)?(R_(`${s}//${c}${d}`),A_("Auth",!0)):M8()}function qN(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function P8(n){const e=qN(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const s=i[1];return{host:s,port:FE(r.substr(s.length+1))}}else{const[s,c]=r.split(":");return{host:s,port:FE(c)}}}function FE(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function M8(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}class L_{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Ba("not implemented")}_getIdTokenResponse(e){return Ba("not implemented")}_linkToIdToken(e,t){return Ba("not implemented")}_getReauthenticationResolver(e){return Ba("not implemented")}}async function D8(n,e){return ca(n,"POST","/v1/accounts:update",e)}async function O8(n,e){return ca(n,"POST","/v1/accounts:signUp",e)}async function j8(n,e){return Jf(n,"POST","/v1/accounts:signInWithPassword",ro(n,e))}async function HN(n,e){return ca(n,"POST","/v1/accounts:sendOobCode",ro(n,e))}async function L8(n,e){return HN(n,e)}async function U8(n,e){return HN(n,e)}async function V8(n,e){return Jf(n,"POST","/v1/accounts:signInWithEmailLink",ro(n,e))}async function z8(n,e){return Jf(n,"POST","/v1/accounts:signInWithEmailLink",ro(n,e))}class xf extends L_{constructor(e,t,r,i=null){super("password",r),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new xf(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new xf(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t?.email&&t?.password){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Qg(e,t,"signInWithPassword",j8);case"emailLink":return V8(e,{email:this._email,oobCode:this._password});default:bs(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Qg(e,r,"signUpPassword",O8);case"emailLink":return z8(e,{idToken:t,email:this._email,oobCode:this._password});default:bs(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Hu(n,e){return Jf(n,"POST","/v1/accounts:signInWithIdp",ro(n,e))}const F8="http://localhost";class ml extends L_{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new ml(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):bs("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i,...s}=t;if(!r||!i)return null;const c=new ml(r,i);return c.idToken=s.idToken||void 0,c.accessToken=s.accessToken||void 0,c.secret=s.secret,c.nonce=s.nonce,c.pendingToken=s.pendingToken||null,c}_getIdTokenResponse(e){const t=this.buildRequest();return Hu(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Hu(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Hu(e,t)}buildRequest(){const e={requestUri:F8,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Qf(t)}return e}}function B8(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function $8(n){const e=Qh(Xh(n)).link,t=e?Qh(Xh(e)).deep_link_id:null,r=Qh(Xh(n)).deep_link_id;return(r?Qh(Xh(r)).link:null)||r||t||e||n}class U_{constructor(e){const t=Qh(Xh(e)),r=t.apiKey??null,i=t.oobCode??null,s=B8(t.mode??null);ct(r&&i&&s,"argument-error"),this.apiKey=r,this.operation=s,this.code=i,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=$8(e);try{return new U_(t)}catch{return null}}}class Nl{constructor(){this.providerId=Nl.PROVIDER_ID}static credential(e,t){return xf._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=U_.parseLink(t);return ct(r,"argument-error"),xf._fromEmailAndCode(e,r.code,r.tenantId)}}Nl.PROVIDER_ID="password";Nl.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Nl.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class GN{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Zf extends GN{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Yo extends Zf{constructor(){super("facebook.com")}static credential(e){return ml._fromParams({providerId:Yo.PROVIDER_ID,signInMethod:Yo.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Yo.credentialFromTaggedObject(e)}static credentialFromError(e){return Yo.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Yo.credential(e.oauthAccessToken)}catch{return null}}}Yo.FACEBOOK_SIGN_IN_METHOD="facebook.com";Yo.PROVIDER_ID="facebook.com";class Qo extends Zf{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return ml._fromParams({providerId:Qo.PROVIDER_ID,signInMethod:Qo.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Qo.credentialFromTaggedObject(e)}static credentialFromError(e){return Qo.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return Qo.credential(t,r)}catch{return null}}}Qo.GOOGLE_SIGN_IN_METHOD="google.com";Qo.PROVIDER_ID="google.com";class Xo extends Zf{constructor(){super("github.com")}static credential(e){return ml._fromParams({providerId:Xo.PROVIDER_ID,signInMethod:Xo.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Xo.credentialFromTaggedObject(e)}static credentialFromError(e){return Xo.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Xo.credential(e.oauthAccessToken)}catch{return null}}}Xo.GITHUB_SIGN_IN_METHOD="github.com";Xo.PROVIDER_ID="github.com";class Jo extends Zf{constructor(){super("twitter.com")}static credential(e,t){return ml._fromParams({providerId:Jo.PROVIDER_ID,signInMethod:Jo.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Jo.credentialFromTaggedObject(e)}static credentialFromError(e){return Jo.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return Jo.credential(t,r)}catch{return null}}}Jo.TWITTER_SIGN_IN_METHOD="twitter.com";Jo.PROVIDER_ID="twitter.com";async function q8(n,e){return Jf(n,"POST","/v1/accounts:signUp",ro(n,e))}class gl{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,i=!1){const s=await ms._fromIdTokenResponse(e,r,i),c=BE(r);return new gl({user:s,providerId:c,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const i=BE(r);return new gl({user:e,providerId:i,_tokenResponse:r,operationType:t})}}function BE(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}class Xg extends oa{constructor(e,t,r,i){super(t.code,t.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,Xg.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,i){return new Xg(e,t,r,i)}}function KN(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?Xg._fromErrorAndOperation(n,s,e,r):s})}async function H8(n,e,t=!1){const r=await sd(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return gl._forOperation(n,"link",r)}async function WN(n,e,t=!1){const{auth:r}=n;if(Ei(r.app))return Promise.reject(Ha(r));const i="reauthenticate";try{const s=await sd(n,KN(r,i,e,n),t);ct(s.idToken,r,"internal-error");const c=O_(s.idToken);ct(c,r,"internal-error");const{sub:l}=c;return ct(n.uid===l,r,"user-mismatch"),gl._forOperation(n,i,s)}catch(s){throw s?.code==="auth/user-not-found"&&bs(r,"user-mismatch"),s}}async function YN(n,e,t=!1){if(Ei(n.app))return Promise.reject(Ha(n));const r="signIn",i=await KN(n,r,e),s=await gl._fromIdTokenResponse(n,r,i);return t||await n._updateCurrentUser(s.user),s}async function G8(n,e){return YN(Tc(n),e)}async function K8(n,e){return WN(hn(n),e)}async function QN(n){const e=Tc(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function XN(n,e,t){const r=Tc(n);await Qg(r,{requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"},"getOobCode",U8)}async function W8(n,e,t){if(Ei(n.app))return Promise.reject(Ha(n));const r=Tc(n),c=await Qg(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",q8).catch(d=>{throw d.code==="auth/password-does-not-meet-requirements"&&QN(n),d}),l=await gl._fromIdTokenResponse(r,"signIn",c);return await r._updateCurrentUser(l.user),l}function Y8(n,e,t){return Ei(n.app)?Promise.reject(Ha(n)):G8(hn(n),Nl.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&QN(n),r})}async function $E(n,e){const t=hn(n),i={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()},{email:s}=await L8(t.auth,i);s!==n.email&&await n.reload()}function Q8(n,e){return X8(hn(n),null,e)}async function X8(n,e,t){const{auth:r}=n,s={idToken:await n.getIdToken(),returnSecureToken:!0};t&&(s.password=t);const c=await sd(n,D8(r,s));await n._updateTokensIfNecessary(c,!0)}function J8(n,e,t,r){return hn(n).onIdTokenChanged(e,t,r)}function Z8(n,e,t){return hn(n).beforeAuthStateChanged(e,t)}function eU(n,e,t,r){return hn(n).onAuthStateChanged(e,t,r)}function tU(n){return hn(n).signOut()}const Jg="__sak";class JN{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Jg,"1"),this.storage.removeItem(Jg),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const nU=1e3,rU=10;class ZN extends JN{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=zN(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),i=this.localCache[t];r!==i&&e(t,i,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((c,l,d)=>{this.notifyListeners(c,d)});return}const r=e.key;t?this.detachListener():this.stopPolling();const i=()=>{const c=this.storage.getItem(r);!t&&this.localCache[r]===c||this.notifyListeners(r,c)},s=this.storage.getItem(r);m8()&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,rU):i()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},nU)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}ZN.type="LOCAL";const iU=ZN;class eI extends JN{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}eI.type="SESSION";const tI=eI;function sU(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}class Kv{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(i=>i.isListeningto(e));if(t)return t;const r=new Kv(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:i,data:s}=t.data,c=this.handlersMap[i];if(!c?.size)return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:i});const l=Array.from(c).map(async h=>h(t.origin,s)),d=await sU(l);t.ports[0].postMessage({status:"done",eventId:r,eventType:i,response:d})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Kv.receivers=[];function V_(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}class aU{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,c;return new Promise((l,d)=>{const h=V_("",20);i.port1.start();const m=setTimeout(()=>{d(new Error("unsupported_event"))},r);c={messageChannel:i,onMessage(g){const b=g;if(b.data.eventId===h)switch(b.data.status){case"ack":clearTimeout(m),s=setTimeout(()=>{d(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),l(b.data.response);break;default:clearTimeout(m),clearTimeout(s),d(new Error("invalid_response"));break}}},this.handlers.add(c),i.port1.addEventListener("message",c.onMessage),this.target.postMessage({eventType:e,eventId:h,data:t},[i.port2])}).finally(()=>{c&&this.removeMessageHandler(c)})}}function Ys(){return window}function oU(n){Ys().location.href=n}function nI(){return typeof Ys().WorkerGlobalScope<"u"&&typeof Ys().importScripts=="function"}async function cU(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function lU(){return navigator?.serviceWorker?.controller||null}function uU(){return nI()?self:null}const rI="firebaseLocalStorageDb",dU=1,Zg="firebaseLocalStorage",iI="fbase_key";class ep{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Wv(n,e){return n.transaction([Zg],e?"readwrite":"readonly").objectStore(Zg)}function hU(){const n=indexedDB.deleteDatabase(rI);return new ep(n).toPromise()}function Z1(){const n=indexedDB.open(rI,dU);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(Zg,{keyPath:iI})}catch(i){t(i)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(Zg)?e(r):(r.close(),await hU(),e(await Z1()))})})}async function qE(n,e,t){const r=Wv(n,!0).put({[iI]:e,value:t});return new ep(r).toPromise()}async function fU(n,e){const t=Wv(n,!1).get(e),r=await new ep(t).toPromise();return r===void 0?null:r.value}function HE(n,e){const t=Wv(n,!0).delete(e);return new ep(t).toPromise()}const pU=800,mU=3;class sI{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Z1(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>mU)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return nI()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Kv._getInstance(uU()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await cU(),!this.activeServiceWorker)return;this.sender=new aU(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||lU()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Z1();return await qE(e,Jg,"1"),await HE(e,Jg),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>qE(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>fU(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>HE(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const s=Wv(i,!1).getAll();return new ep(s).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:i,value:s}of e)r.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(s)&&(this.notifyListeners(i,s),t.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!r.has(i)&&(this.notifyListeners(i,null),t.push(i));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),pU)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}sI.type="LOCAL";const gU=sI;new Xf(3e4,6e4);function vU(n,e){return e?$a(e):(ct(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}class z_ extends L_{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Hu(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Hu(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Hu(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function yU(n){return YN(n.auth,new z_(n),n.bypassAuthState)}function bU(n){const{auth:e,user:t}=n;return ct(t,e,"internal-error"),WN(t,new z_(n),n.bypassAuthState)}async function xU(n){const{auth:e,user:t}=n;return ct(t,e,"internal-error"),H8(t,new z_(n),n.bypassAuthState)}class aI{constructor(e,t,r,i,s=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:i,tenantId:s,error:c,type:l}=e;if(c){this.reject(c);return}const d={auth:this.auth,requestUri:t,sessionId:r,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(d))}catch(h){this.reject(h)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return yU;case"linkViaPopup":case"linkViaRedirect":return xU;case"reauthViaPopup":case"reauthViaRedirect":return bU;default:bs(this.auth,"internal-error")}}resolve(e){Qa(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Qa(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const _U=new Xf(2e3,1e4);class Uu extends aI{constructor(e,t,r,i,s){super(e,t,i,s),this.provider=r,this.authWindow=null,this.pollId=null,Uu.currentPopupAction&&Uu.currentPopupAction.cancel(),Uu.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return ct(e,this.auth,"internal-error"),e}async onExecution(){Qa(this.filter.length===1,"Popup operations only handle one event");const e=V_();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Ws(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(Ws(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Uu.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Ws(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,_U.get())};e()}}Uu.currentPopupAction=null;const SU="pendingRedirect",ug=new Map;class TU extends aI{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=ug.get(this.auth._key());if(!e){try{const r=await kU(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}ug.set(this.auth._key(),e)}return this.bypassAuthState||ug.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function kU(n,e){const t=EU(e),r=wU(n);if(!await r._isAvailable())return!1;const i=await r._get(t)==="true";return await r._remove(t),i}function CU(n,e){ug.set(n._key(),e)}function wU(n){return $a(n._redirectPersistence)}function EU(n){return lg(SU,n.config.apiKey,n.name)}async function RU(n,e,t=!1){if(Ei(n.app))return Promise.reject(Ha(n));const r=Tc(n),i=vU(r,e),c=await new TU(r,i,t).execute();return c&&!t&&(delete c.user._redirectEventId,await r._persistUserIfCurrent(c.user),await r._setRedirectUser(null,e)),c}const AU=600*1e3;class NU{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!IU(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!oI(e)){const r=e.error.code?.split("auth/")[1]||"internal-error";t.onError(Ws(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=AU&&this.cachedEventUids.clear(),this.cachedEventUids.has(GE(e))}saveEventToCache(e){this.cachedEventUids.add(GE(e)),this.lastProcessedEventTime=Date.now()}}function GE(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function oI({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function IU(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return oI(n);default:return!1}}async function PU(n,e={}){return ca(n,"GET","/v1/projects",e)}const MU=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,DU=/^https?/;async function OU(n){if(n.config.emulator)return;const{authorizedDomains:e}=await PU(n);for(const t of e)try{if(jU(t))return}catch{}bs(n,"unauthorized-domain")}function jU(n){const e=X1(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const c=new URL(n);return c.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&c.hostname===r}if(!DU.test(t))return!1;if(MU.test(n))return r===n;const i=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const LU=new Xf(3e4,6e4);function KE(){const n=Ys().___jsl;if(n?.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function UU(n){return new Promise((e,t)=>{function r(){KE(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{KE(),t(Ws(n,"network-request-failed"))},timeout:LU.get()})}if(Ys().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(Ys().gapi?.load)r();else{const i=k8("iframefcb");return Ys()[i]=()=>{gapi.load?r():t(Ws(n,"network-request-failed"))},BN(`${T8()}?onload=${i}`).catch(s=>t(s))}}).catch(e=>{throw dg=null,e})}let dg=null;function VU(n){return dg=dg||UU(n),dg}const zU=new Xf(5e3,15e3),FU="__/auth/iframe",BU="emulator/auth/iframe",$U={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},qU=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function HU(n){const e=n.config;ct(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?D_(e,BU):`https://${n.config.authDomain}/${FU}`,r={apiKey:e.apiKey,appName:n.name,v:Al},i=qU.get(n.config.apiHost);i&&(r.eid=i);const s=n._getFrameworks();return s.length&&(r.fw=s.join(",")),`${t}?${Qf(r).slice(1)}`}async function GU(n){const e=await VU(n),t=Ys().gapi;return ct(t,n,"internal-error"),e.open({where:document.body,url:HU(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:$U,dontclear:!0},r=>new Promise(async(i,s)=>{await r.restyle({setHideOnLeave:!1});const c=Ws(n,"network-request-failed"),l=Ys().setTimeout(()=>{s(c)},zU.get());function d(){Ys().clearTimeout(l),i(r)}r.ping(d).then(d,()=>{s(c)})}))}const KU={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},WU=500,YU=600,QU="_blank",XU="http://localhost";class WE{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function JU(n,e,t,r=WU,i=YU){const s=Math.max((window.screen.availHeight-i)/2,0).toString(),c=Math.max((window.screen.availWidth-r)/2,0).toString();let l="";const d={...KU,width:r.toString(),height:i.toString(),top:s,left:c},h=jr().toLowerCase();t&&(l=ON(h)?QU:t),MN(h)&&(e=e||XU,d.scrollbars="yes");const m=Object.entries(d).reduce((b,[_,R])=>`${b}${_}=${R},`,"");if(p8(h)&&l!=="_self")return ZU(e||"",l),new WE(null);const g=window.open(e||"",l,m);ct(g,n,"popup-blocked");try{g.focus()}catch{}return new WE(g)}function ZU(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}const e7="__/auth/handler",t7="emulator/auth/handler",n7=encodeURIComponent("fac");async function YE(n,e,t,r,i,s){ct(n.config.authDomain,n,"auth-domain-config-required"),ct(n.config.apiKey,n,"invalid-api-key");const c={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:Al,eventId:i};if(e instanceof GN){e.setDefaultLanguage(n.languageCode),c.providerId=e.providerId||"",D9(e.getCustomParameters())||(c.customParameters=JSON.stringify(e.getCustomParameters()));for(const[m,g]of Object.entries({}))c[m]=g}if(e instanceof Zf){const m=e.getScopes().filter(g=>g!=="");m.length>0&&(c.scopes=m.join(","))}n.tenantId&&(c.tid=n.tenantId);const l=c;for(const m of Object.keys(l))l[m]===void 0&&delete l[m];const d=await n._getAppCheckToken(),h=d?`#${n7}=${encodeURIComponent(d)}`:"";return`${r7(n)}?${Qf(l).slice(1)}${h}`}function r7({config:n}){return n.emulator?D_(n,t7):`https://${n.authDomain}/${e7}`}const Yb="webStorageSupport";class i7{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=tI,this._completeRedirectFn=RU,this._overrideRedirectResult=CU}async _openPopup(e,t,r,i){Qa(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const s=await YE(e,t,r,X1(),i);return JU(e,s,V_())}async _openRedirect(e,t,r,i){await this._originValidation(e);const s=await YE(e,t,r,X1(),i);return oU(s),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:i,promise:s}=this.eventManagers[t];return i?Promise.resolve(i):(Qa(s,"If manager is not set, promise should be"),s)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await GU(e),r=new NU(e);return t.register("authEvent",i=>(ct(i?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Yb,{type:Yb},i=>{const s=i?.[0]?.[Yb];s!==void 0&&t(!!s),bs(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=OU(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return zN()||DN()||j_()}}const s7=i7;var QE="@firebase/auth",XE="1.11.1";class a7{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){ct(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function o7(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function c7(n){pl(new fc("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:c,authDomain:l}=r.options;ct(c&&!c.includes(":"),"invalid-api-key",{appName:r.name});const d={apiKey:c,authDomain:l,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:FN(n)},h=new x8(r,i,s,d);return N8(h,t),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),pl(new fc("auth-internal",e=>{const t=Tc(e.getProvider("auth").getImmediate());return(r=>new a7(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Ks(QE,XE,o7(n)),Ks(QE,XE,"esm2020")}const l7=300,u7=yN("authIdTokenMaxAge")||l7;let JE=null;const d7=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>u7)return;const i=t?.token;JE!==i&&(JE=i,await fetch(n,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function h7(n=P_()){const e=Hv(n,"auth");if(e.isInitialized())return e.getImmediate();const t=A8(n,{popupRedirectResolver:s7,persistence:[gU,iU,tI]}),r=yN("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const s=new URL(r,location.origin);if(location.origin===s.origin){const c=d7(s.toString());Z8(t,c,()=>c(t.currentUser)),J8(t,l=>c(l))}}const i=mN("auth");return i&&I8(t,`http://${i}`),t}function f7(){return document.getElementsByTagName("head")?.[0]??document}_8({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=i=>{const s=Ws("internal-error");s.customData=i,t(s)},r.type="text/javascript",r.charset="UTF-8",f7().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});c7("Browser");var ZE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var ac,cI;(function(){var n;function e(S,k){function P(){}P.prototype=k.prototype,S.F=k.prototype,S.prototype=new P,S.prototype.constructor=S,S.D=function(L,U,z){for(var V=Array(arguments.length-2),le=2;le<arguments.length;le++)V[le-2]=arguments[le];return k.prototype[U].apply(L,V)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,t),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(S,k,P){P||(P=0);const L=Array(16);if(typeof k=="string")for(var U=0;U<16;++U)L[U]=k.charCodeAt(P++)|k.charCodeAt(P++)<<8|k.charCodeAt(P++)<<16|k.charCodeAt(P++)<<24;else for(U=0;U<16;++U)L[U]=k[P++]|k[P++]<<8|k[P++]<<16|k[P++]<<24;k=S.g[0],P=S.g[1],U=S.g[2];let z=S.g[3],V;V=k+(z^P&(U^z))+L[0]+3614090360&4294967295,k=P+(V<<7&4294967295|V>>>25),V=z+(U^k&(P^U))+L[1]+3905402710&4294967295,z=k+(V<<12&4294967295|V>>>20),V=U+(P^z&(k^P))+L[2]+606105819&4294967295,U=z+(V<<17&4294967295|V>>>15),V=P+(k^U&(z^k))+L[3]+3250441966&4294967295,P=U+(V<<22&4294967295|V>>>10),V=k+(z^P&(U^z))+L[4]+4118548399&4294967295,k=P+(V<<7&4294967295|V>>>25),V=z+(U^k&(P^U))+L[5]+1200080426&4294967295,z=k+(V<<12&4294967295|V>>>20),V=U+(P^z&(k^P))+L[6]+2821735955&4294967295,U=z+(V<<17&4294967295|V>>>15),V=P+(k^U&(z^k))+L[7]+4249261313&4294967295,P=U+(V<<22&4294967295|V>>>10),V=k+(z^P&(U^z))+L[8]+1770035416&4294967295,k=P+(V<<7&4294967295|V>>>25),V=z+(U^k&(P^U))+L[9]+2336552879&4294967295,z=k+(V<<12&4294967295|V>>>20),V=U+(P^z&(k^P))+L[10]+4294925233&4294967295,U=z+(V<<17&4294967295|V>>>15),V=P+(k^U&(z^k))+L[11]+2304563134&4294967295,P=U+(V<<22&4294967295|V>>>10),V=k+(z^P&(U^z))+L[12]+1804603682&4294967295,k=P+(V<<7&4294967295|V>>>25),V=z+(U^k&(P^U))+L[13]+4254626195&4294967295,z=k+(V<<12&4294967295|V>>>20),V=U+(P^z&(k^P))+L[14]+2792965006&4294967295,U=z+(V<<17&4294967295|V>>>15),V=P+(k^U&(z^k))+L[15]+1236535329&4294967295,P=U+(V<<22&4294967295|V>>>10),V=k+(U^z&(P^U))+L[1]+4129170786&4294967295,k=P+(V<<5&4294967295|V>>>27),V=z+(P^U&(k^P))+L[6]+3225465664&4294967295,z=k+(V<<9&4294967295|V>>>23),V=U+(k^P&(z^k))+L[11]+643717713&4294967295,U=z+(V<<14&4294967295|V>>>18),V=P+(z^k&(U^z))+L[0]+3921069994&4294967295,P=U+(V<<20&4294967295|V>>>12),V=k+(U^z&(P^U))+L[5]+3593408605&4294967295,k=P+(V<<5&4294967295|V>>>27),V=z+(P^U&(k^P))+L[10]+38016083&4294967295,z=k+(V<<9&4294967295|V>>>23),V=U+(k^P&(z^k))+L[15]+3634488961&4294967295,U=z+(V<<14&4294967295|V>>>18),V=P+(z^k&(U^z))+L[4]+3889429448&4294967295,P=U+(V<<20&4294967295|V>>>12),V=k+(U^z&(P^U))+L[9]+568446438&4294967295,k=P+(V<<5&4294967295|V>>>27),V=z+(P^U&(k^P))+L[14]+3275163606&4294967295,z=k+(V<<9&4294967295|V>>>23),V=U+(k^P&(z^k))+L[3]+4107603335&4294967295,U=z+(V<<14&4294967295|V>>>18),V=P+(z^k&(U^z))+L[8]+1163531501&4294967295,P=U+(V<<20&4294967295|V>>>12),V=k+(U^z&(P^U))+L[13]+2850285829&4294967295,k=P+(V<<5&4294967295|V>>>27),V=z+(P^U&(k^P))+L[2]+4243563512&4294967295,z=k+(V<<9&4294967295|V>>>23),V=U+(k^P&(z^k))+L[7]+1735328473&4294967295,U=z+(V<<14&4294967295|V>>>18),V=P+(z^k&(U^z))+L[12]+2368359562&4294967295,P=U+(V<<20&4294967295|V>>>12),V=k+(P^U^z)+L[5]+4294588738&4294967295,k=P+(V<<4&4294967295|V>>>28),V=z+(k^P^U)+L[8]+2272392833&4294967295,z=k+(V<<11&4294967295|V>>>21),V=U+(z^k^P)+L[11]+1839030562&4294967295,U=z+(V<<16&4294967295|V>>>16),V=P+(U^z^k)+L[14]+4259657740&4294967295,P=U+(V<<23&4294967295|V>>>9),V=k+(P^U^z)+L[1]+2763975236&4294967295,k=P+(V<<4&4294967295|V>>>28),V=z+(k^P^U)+L[4]+1272893353&4294967295,z=k+(V<<11&4294967295|V>>>21),V=U+(z^k^P)+L[7]+4139469664&4294967295,U=z+(V<<16&4294967295|V>>>16),V=P+(U^z^k)+L[10]+3200236656&4294967295,P=U+(V<<23&4294967295|V>>>9),V=k+(P^U^z)+L[13]+681279174&4294967295,k=P+(V<<4&4294967295|V>>>28),V=z+(k^P^U)+L[0]+3936430074&4294967295,z=k+(V<<11&4294967295|V>>>21),V=U+(z^k^P)+L[3]+3572445317&4294967295,U=z+(V<<16&4294967295|V>>>16),V=P+(U^z^k)+L[6]+76029189&4294967295,P=U+(V<<23&4294967295|V>>>9),V=k+(P^U^z)+L[9]+3654602809&4294967295,k=P+(V<<4&4294967295|V>>>28),V=z+(k^P^U)+L[12]+3873151461&4294967295,z=k+(V<<11&4294967295|V>>>21),V=U+(z^k^P)+L[15]+530742520&4294967295,U=z+(V<<16&4294967295|V>>>16),V=P+(U^z^k)+L[2]+3299628645&4294967295,P=U+(V<<23&4294967295|V>>>9),V=k+(U^(P|~z))+L[0]+4096336452&4294967295,k=P+(V<<6&4294967295|V>>>26),V=z+(P^(k|~U))+L[7]+1126891415&4294967295,z=k+(V<<10&4294967295|V>>>22),V=U+(k^(z|~P))+L[14]+2878612391&4294967295,U=z+(V<<15&4294967295|V>>>17),V=P+(z^(U|~k))+L[5]+4237533241&4294967295,P=U+(V<<21&4294967295|V>>>11),V=k+(U^(P|~z))+L[12]+1700485571&4294967295,k=P+(V<<6&4294967295|V>>>26),V=z+(P^(k|~U))+L[3]+2399980690&4294967295,z=k+(V<<10&4294967295|V>>>22),V=U+(k^(z|~P))+L[10]+4293915773&4294967295,U=z+(V<<15&4294967295|V>>>17),V=P+(z^(U|~k))+L[1]+2240044497&4294967295,P=U+(V<<21&4294967295|V>>>11),V=k+(U^(P|~z))+L[8]+1873313359&4294967295,k=P+(V<<6&4294967295|V>>>26),V=z+(P^(k|~U))+L[15]+4264355552&4294967295,z=k+(V<<10&4294967295|V>>>22),V=U+(k^(z|~P))+L[6]+2734768916&4294967295,U=z+(V<<15&4294967295|V>>>17),V=P+(z^(U|~k))+L[13]+1309151649&4294967295,P=U+(V<<21&4294967295|V>>>11),V=k+(U^(P|~z))+L[4]+4149444226&4294967295,k=P+(V<<6&4294967295|V>>>26),V=z+(P^(k|~U))+L[11]+3174756917&4294967295,z=k+(V<<10&4294967295|V>>>22),V=U+(k^(z|~P))+L[2]+718787259&4294967295,U=z+(V<<15&4294967295|V>>>17),V=P+(z^(U|~k))+L[9]+3951481745&4294967295,S.g[0]=S.g[0]+k&4294967295,S.g[1]=S.g[1]+(U+(V<<21&4294967295|V>>>11))&4294967295,S.g[2]=S.g[2]+U&4294967295,S.g[3]=S.g[3]+z&4294967295}r.prototype.v=function(S,k){k===void 0&&(k=S.length);const P=k-this.blockSize,L=this.C;let U=this.h,z=0;for(;z<k;){if(U==0)for(;z<=P;)i(this,S,z),z+=this.blockSize;if(typeof S=="string"){for(;z<k;)if(L[U++]=S.charCodeAt(z++),U==this.blockSize){i(this,L),U=0;break}}else for(;z<k;)if(L[U++]=S[z++],U==this.blockSize){i(this,L),U=0;break}}this.h=U,this.o+=k},r.prototype.A=function(){var S=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);S[0]=128;for(var k=1;k<S.length-8;++k)S[k]=0;k=this.o*8;for(var P=S.length-8;P<S.length;++P)S[P]=k&255,k/=256;for(this.v(S),S=Array(16),k=0,P=0;P<4;++P)for(let L=0;L<32;L+=8)S[k++]=this.g[P]>>>L&255;return S};function s(S,k){var P=l;return Object.prototype.hasOwnProperty.call(P,S)?P[S]:P[S]=k(S)}function c(S,k){this.h=k;const P=[];let L=!0;for(let U=S.length-1;U>=0;U--){const z=S[U]|0;L&&z==k||(P[U]=z,L=!1)}this.g=P}var l={};function d(S){return-128<=S&&S<128?s(S,function(k){return new c([k|0],k<0?-1:0)}):new c([S|0],S<0?-1:0)}function h(S){if(isNaN(S)||!isFinite(S))return g;if(S<0)return A(h(-S));const k=[];let P=1;for(let L=0;S>=P;L++)k[L]=S/P|0,P*=4294967296;return new c(k,0)}function m(S,k){if(S.length==0)throw Error("number format error: empty string");if(k=k||10,k<2||36<k)throw Error("radix out of range: "+k);if(S.charAt(0)=="-")return A(m(S.substring(1),k));if(S.indexOf("-")>=0)throw Error('number format error: interior "-" character');const P=h(Math.pow(k,8));let L=g;for(let z=0;z<S.length;z+=8){var U=Math.min(8,S.length-z);const V=parseInt(S.substring(z,z+U),k);U<8?(U=h(Math.pow(k,U)),L=L.j(U).add(h(V))):(L=L.j(P),L=L.add(h(V)))}return L}var g=d(0),b=d(1),_=d(16777216);n=c.prototype,n.m=function(){if(E(this))return-A(this).m();let S=0,k=1;for(let P=0;P<this.g.length;P++){const L=this.i(P);S+=(L>=0?L:4294967296+L)*k,k*=4294967296}return S},n.toString=function(S){if(S=S||10,S<2||36<S)throw Error("radix out of range: "+S);if(R(this))return"0";if(E(this))return"-"+A(this).toString(S);const k=h(Math.pow(S,6));var P=this;let L="";for(;;){const U=C(P,k).g;P=M(P,U.j(k));let z=((P.g.length>0?P.g[0]:P.h)>>>0).toString(S);if(P=U,R(P))return z+L;for(;z.length<6;)z="0"+z;L=z+L}},n.i=function(S){return S<0?0:S<this.g.length?this.g[S]:this.h};function R(S){if(S.h!=0)return!1;for(let k=0;k<S.g.length;k++)if(S.g[k]!=0)return!1;return!0}function E(S){return S.h==-1}n.l=function(S){return S=M(this,S),E(S)?-1:R(S)?0:1};function A(S){const k=S.g.length,P=[];for(let L=0;L<k;L++)P[L]=~S.g[L];return new c(P,~S.h).add(b)}n.abs=function(){return E(this)?A(this):this},n.add=function(S){const k=Math.max(this.g.length,S.g.length),P=[];let L=0;for(let U=0;U<=k;U++){let z=L+(this.i(U)&65535)+(S.i(U)&65535),V=(z>>>16)+(this.i(U)>>>16)+(S.i(U)>>>16);L=V>>>16,z&=65535,V&=65535,P[U]=V<<16|z}return new c(P,P[P.length-1]&-2147483648?-1:0)};function M(S,k){return S.add(A(k))}n.j=function(S){if(R(this)||R(S))return g;if(E(this))return E(S)?A(this).j(A(S)):A(A(this).j(S));if(E(S))return A(this.j(A(S)));if(this.l(_)<0&&S.l(_)<0)return h(this.m()*S.m());const k=this.g.length+S.g.length,P=[];for(var L=0;L<2*k;L++)P[L]=0;for(L=0;L<this.g.length;L++)for(let U=0;U<S.g.length;U++){const z=this.i(L)>>>16,V=this.i(L)&65535,le=S.i(U)>>>16,ve=S.i(U)&65535;P[2*L+2*U]+=V*ve,F(P,2*L+2*U),P[2*L+2*U+1]+=z*ve,F(P,2*L+2*U+1),P[2*L+2*U+1]+=V*le,F(P,2*L+2*U+1),P[2*L+2*U+2]+=z*le,F(P,2*L+2*U+2)}for(S=0;S<k;S++)P[S]=P[2*S+1]<<16|P[2*S];for(S=k;S<2*k;S++)P[S]=0;return new c(P,0)};function F(S,k){for(;(S[k]&65535)!=S[k];)S[k+1]+=S[k]>>>16,S[k]&=65535,k++}function j(S,k){this.g=S,this.h=k}function C(S,k){if(R(k))throw Error("division by zero");if(R(S))return new j(g,g);if(E(S))return k=C(A(S),k),new j(A(k.g),A(k.h));if(E(k))return k=C(S,A(k)),new j(A(k.g),k.h);if(S.g.length>30){if(E(S)||E(k))throw Error("slowDivide_ only works with positive integers.");for(var P=b,L=k;L.l(S)<=0;)P=N(P),L=N(L);var U=D(P,1),z=D(L,1);for(L=D(L,2),P=D(P,2);!R(L);){var V=z.add(L);V.l(S)<=0&&(U=U.add(P),z=V),L=D(L,1),P=D(P,1)}return k=M(S,U.j(k)),new j(U,k)}for(U=g;S.l(k)>=0;){for(P=Math.max(1,Math.floor(S.m()/k.m())),L=Math.ceil(Math.log(P)/Math.LN2),L=L<=48?1:Math.pow(2,L-48),z=h(P),V=z.j(k);E(V)||V.l(S)>0;)P-=L,z=h(P),V=z.j(k);R(z)&&(z=b),U=U.add(z),S=M(S,V)}return new j(U,S)}n.B=function(S){return C(this,S).h},n.and=function(S){const k=Math.max(this.g.length,S.g.length),P=[];for(let L=0;L<k;L++)P[L]=this.i(L)&S.i(L);return new c(P,this.h&S.h)},n.or=function(S){const k=Math.max(this.g.length,S.g.length),P=[];for(let L=0;L<k;L++)P[L]=this.i(L)|S.i(L);return new c(P,this.h|S.h)},n.xor=function(S){const k=Math.max(this.g.length,S.g.length),P=[];for(let L=0;L<k;L++)P[L]=this.i(L)^S.i(L);return new c(P,this.h^S.h)};function N(S){const k=S.g.length+1,P=[];for(let L=0;L<k;L++)P[L]=S.i(L)<<1|S.i(L-1)>>>31;return new c(P,S.h)}function D(S,k){const P=k>>5;k%=32;const L=S.g.length-P,U=[];for(let z=0;z<L;z++)U[z]=k>0?S.i(z+P)>>>k|S.i(z+P+1)<<32-k:S.i(z+P);return new c(U,S.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,cI=r,c.prototype.add=c.prototype.add,c.prototype.multiply=c.prototype.j,c.prototype.modulo=c.prototype.B,c.prototype.compare=c.prototype.l,c.prototype.toNumber=c.prototype.m,c.prototype.toString=c.prototype.toString,c.prototype.getBits=c.prototype.i,c.fromNumber=h,c.fromString=m,ac=c}).apply(typeof ZE<"u"?ZE:typeof self<"u"?self:typeof window<"u"?window:{});var Vm=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var lI,Jh,uI,hg,ex,dI,hI,fI;(function(){var n,e=Object.defineProperty;function t(v){v=[typeof globalThis=="object"&&globalThis,v,typeof window=="object"&&window,typeof self=="object"&&self,typeof Vm=="object"&&Vm];for(var w=0;w<v.length;++w){var O=v[w];if(O&&O.Math==Math)return O}throw Error("Cannot find global object")}var r=t(this);function i(v,w){if(w)e:{var O=r;v=v.split(".");for(var $=0;$<v.length-1;$++){var ne=v[$];if(!(ne in O))break e;O=O[ne]}v=v[v.length-1],$=O[v],w=w($),w!=$&&w!=null&&e(O,v,{configurable:!0,writable:!0,value:w})}}i("Symbol.dispose",function(v){return v||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(v){return v||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(v){return v||function(w){var O=[],$;for($ in w)Object.prototype.hasOwnProperty.call(w,$)&&O.push([$,w[$]]);return O}});var s=s||{},c=this||self;function l(v){var w=typeof v;return w=="object"&&v!=null||w=="function"}function d(v,w,O){return v.call.apply(v.bind,arguments)}function h(v,w,O){return h=d,h.apply(null,arguments)}function m(v,w){var O=Array.prototype.slice.call(arguments,1);return function(){var $=O.slice();return $.push.apply($,arguments),v.apply(this,$)}}function g(v,w){function O(){}O.prototype=w.prototype,v.Z=w.prototype,v.prototype=new O,v.prototype.constructor=v,v.Ob=function($,ne,ce){for(var Le=Array(arguments.length-2),vt=2;vt<arguments.length;vt++)Le[vt-2]=arguments[vt];return w.prototype[ne].apply($,Le)}}var b=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?v=>v&&AsyncContext.Snapshot.wrap(v):v=>v;function _(v){const w=v.length;if(w>0){const O=Array(w);for(let $=0;$<w;$++)O[$]=v[$];return O}return[]}function R(v,w){for(let $=1;$<arguments.length;$++){const ne=arguments[$];var O=typeof ne;if(O=O!="object"?O:ne?Array.isArray(ne)?"array":O:"null",O=="array"||O=="object"&&typeof ne.length=="number"){O=v.length||0;const ce=ne.length||0;v.length=O+ce;for(let Le=0;Le<ce;Le++)v[O+Le]=ne[Le]}else v.push(ne)}}class E{constructor(w,O){this.i=w,this.j=O,this.h=0,this.g=null}get(){let w;return this.h>0?(this.h--,w=this.g,this.g=w.next,w.next=null):w=this.i(),w}}function A(v){c.setTimeout(()=>{throw v},0)}function M(){var v=S;let w=null;return v.g&&(w=v.g,v.g=v.g.next,v.g||(v.h=null),w.next=null),w}class F{constructor(){this.h=this.g=null}add(w,O){const $=j.get();$.set(w,O),this.h?this.h.next=$:this.g=$,this.h=$}}var j=new E(()=>new C,v=>v.reset());class C{constructor(){this.next=this.g=this.h=null}set(w,O){this.h=w,this.g=O,this.next=null}reset(){this.next=this.g=this.h=null}}let N,D=!1,S=new F,k=()=>{const v=Promise.resolve(void 0);N=()=>{v.then(P)}};function P(){for(var v;v=M();){try{v.h.call(v.g)}catch(O){A(O)}var w=j;w.j(v),w.h<100&&(w.h++,v.next=w.g,w.g=v)}D=!1}function L(){this.u=this.u,this.C=this.C}L.prototype.u=!1,L.prototype.dispose=function(){this.u||(this.u=!0,this.N())},L.prototype[Symbol.dispose]=function(){this.dispose()},L.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function U(v,w){this.type=v,this.g=this.target=w,this.defaultPrevented=!1}U.prototype.h=function(){this.defaultPrevented=!0};var z=(function(){if(!c.addEventListener||!Object.defineProperty)return!1;var v=!1,w=Object.defineProperty({},"passive",{get:function(){v=!0}});try{const O=()=>{};c.addEventListener("test",O,w),c.removeEventListener("test",O,w)}catch{}return v})();function V(v){return/^[\s\xa0]*$/.test(v)}function le(v,w){U.call(this,v?v.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,v&&this.init(v,w)}g(le,U),le.prototype.init=function(v,w){const O=this.type=v.type,$=v.changedTouches&&v.changedTouches.length?v.changedTouches[0]:null;this.target=v.target||v.srcElement,this.g=w,w=v.relatedTarget,w||(O=="mouseover"?w=v.fromElement:O=="mouseout"&&(w=v.toElement)),this.relatedTarget=w,$?(this.clientX=$.clientX!==void 0?$.clientX:$.pageX,this.clientY=$.clientY!==void 0?$.clientY:$.pageY,this.screenX=$.screenX||0,this.screenY=$.screenY||0):(this.clientX=v.clientX!==void 0?v.clientX:v.pageX,this.clientY=v.clientY!==void 0?v.clientY:v.pageY,this.screenX=v.screenX||0,this.screenY=v.screenY||0),this.button=v.button,this.key=v.key||"",this.ctrlKey=v.ctrlKey,this.altKey=v.altKey,this.shiftKey=v.shiftKey,this.metaKey=v.metaKey,this.pointerId=v.pointerId||0,this.pointerType=v.pointerType,this.state=v.state,this.i=v,v.defaultPrevented&&le.Z.h.call(this)},le.prototype.h=function(){le.Z.h.call(this);const v=this.i;v.preventDefault?v.preventDefault():v.returnValue=!1};var ve="closure_listenable_"+(Math.random()*1e6|0),K=0;function oe(v,w,O,$,ne){this.listener=v,this.proxy=null,this.src=w,this.type=O,this.capture=!!$,this.ha=ne,this.key=++K,this.da=this.fa=!1}function ee(v){v.da=!0,v.listener=null,v.proxy=null,v.src=null,v.ha=null}function Me(v,w,O){for(const $ in v)w.call(O,v[$],$,v)}function je(v,w){for(const O in v)w.call(void 0,v[O],O,v)}function q(v){const w={};for(const O in v)w[O]=v[O];return w}const te="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function fe(v,w){let O,$;for(let ne=1;ne<arguments.length;ne++){$=arguments[ne];for(O in $)v[O]=$[O];for(let ce=0;ce<te.length;ce++)O=te[ce],Object.prototype.hasOwnProperty.call($,O)&&(v[O]=$[O])}}function Se(v){this.src=v,this.g={},this.h=0}Se.prototype.add=function(v,w,O,$,ne){const ce=v.toString();v=this.g[ce],v||(v=this.g[ce]=[],this.h++);const Le=Te(v,w,$,ne);return Le>-1?(w=v[Le],O||(w.fa=!1)):(w=new oe(w,this.src,ce,!!$,ne),w.fa=O,v.push(w)),w};function Oe(v,w){const O=w.type;if(O in v.g){var $=v.g[O],ne=Array.prototype.indexOf.call($,w,void 0),ce;(ce=ne>=0)&&Array.prototype.splice.call($,ne,1),ce&&(ee(w),v.g[O].length==0&&(delete v.g[O],v.h--))}}function Te(v,w,O,$){for(let ne=0;ne<v.length;++ne){const ce=v[ne];if(!ce.da&&ce.listener==w&&ce.capture==!!O&&ce.ha==$)return ne}return-1}var we="closure_lm_"+(Math.random()*1e6|0),Ge={};function Ke(v,w,O,$,ne){if(Array.isArray(w)){for(let ce=0;ce<w.length;ce++)Ke(v,w[ce],O,$,ne);return null}return O=Q(O),v&&v[ve]?v.J(w,O,l($)?!!$.capture:!1,ne):Ce(v,w,O,!1,$,ne)}function Ce(v,w,O,$,ne,ce){if(!w)throw Error("Invalid event type");const Le=l(ne)?!!ne.capture:!!ne;let vt=ot(v);if(vt||(v[we]=vt=new Se(v)),O=vt.add(w,O,$,Le,ce),O.proxy)return O;if($=Re(),O.proxy=$,$.src=v,$.listener=O,v.addEventListener)z||(ne=Le),ne===void 0&&(ne=!1),v.addEventListener(w.toString(),$,ne);else if(v.attachEvent)v.attachEvent(Ie(w.toString()),$);else if(v.addListener&&v.removeListener)v.addListener($);else throw Error("addEventListener and attachEvent are unavailable.");return O}function Re(){function v(O){return w.call(v.src,v.listener,O)}const w=qe;return v}function He(v,w,O,$,ne){if(Array.isArray(w))for(var ce=0;ce<w.length;ce++)He(v,w[ce],O,$,ne);else $=l($)?!!$.capture:!!$,O=Q(O),v&&v[ve]?(v=v.i,ce=String(w).toString(),ce in v.g&&(w=v.g[ce],O=Te(w,O,$,ne),O>-1&&(ee(w[O]),Array.prototype.splice.call(w,O,1),w.length==0&&(delete v.g[ce],v.h--)))):v&&(v=ot(v))&&(w=v.g[w.toString()],v=-1,w&&(v=Te(w,O,$,ne)),(O=v>-1?w[v]:null)&&de(O))}function de(v){if(typeof v!="number"&&v&&!v.da){var w=v.src;if(w&&w[ve])Oe(w.i,v);else{var O=v.type,$=v.proxy;w.removeEventListener?w.removeEventListener(O,$,v.capture):w.detachEvent?w.detachEvent(Ie(O),$):w.addListener&&w.removeListener&&w.removeListener($),(O=ot(w))?(Oe(O,v),O.h==0&&(O.src=null,w[we]=null)):ee(v)}}}function Ie(v){return v in Ge?Ge[v]:Ge[v]="on"+v}function qe(v,w){if(v.da)v=!0;else{w=new le(w,this);const O=v.listener,$=v.ha||v.src;v.fa&&de(v),v=O.call($,w)}return v}function ot(v){return v=v[we],v instanceof Se?v:null}var $e="__closure_events_fn_"+(Math.random()*1e9>>>0);function Q(v){return typeof v=="function"?v:(v[$e]||(v[$e]=function(w){return v.handleEvent(w)}),v[$e])}function Pe(){L.call(this),this.i=new Se(this),this.M=this,this.G=null}g(Pe,L),Pe.prototype[ve]=!0,Pe.prototype.removeEventListener=function(v,w,O,$){He(this,v,w,O,$)};function Fe(v,w){var O,$=v.G;if($)for(O=[];$;$=$.G)O.push($);if(v=v.M,$=w.type||w,typeof w=="string")w=new U(w,v);else if(w instanceof U)w.target=w.target||v;else{var ne=w;w=new U($,v),fe(w,ne)}ne=!0;let ce,Le;if(O)for(Le=O.length-1;Le>=0;Le--)ce=w.g=O[Le],ne=ht(ce,$,!0,w)&&ne;if(ce=w.g=v,ne=ht(ce,$,!0,w)&&ne,ne=ht(ce,$,!1,w)&&ne,O)for(Le=0;Le<O.length;Le++)ce=w.g=O[Le],ne=ht(ce,$,!1,w)&&ne}Pe.prototype.N=function(){if(Pe.Z.N.call(this),this.i){var v=this.i;for(const w in v.g){const O=v.g[w];for(let $=0;$<O.length;$++)ee(O[$]);delete v.g[w],v.h--}}this.G=null},Pe.prototype.J=function(v,w,O,$){return this.i.add(String(v),w,!1,O,$)},Pe.prototype.K=function(v,w,O,$){return this.i.add(String(v),w,!0,O,$)};function ht(v,w,O,$){if(w=v.i.g[String(w)],!w)return!0;w=w.concat();let ne=!0;for(let ce=0;ce<w.length;++ce){const Le=w[ce];if(Le&&!Le.da&&Le.capture==O){const vt=Le.listener,Mn=Le.ha||Le.src;Le.fa&&Oe(v.i,Le),ne=vt.call(Mn,$)!==!1&&ne}}return ne&&!$.defaultPrevented}function Vt(v,w){if(typeof v!="function")if(v&&typeof v.handleEvent=="function")v=h(v.handleEvent,v);else throw Error("Invalid listener argument");return Number(w)>2147483647?-1:c.setTimeout(v,w||0)}function Lt(v){v.g=Vt(()=>{v.g=null,v.i&&(v.i=!1,Lt(v))},v.l);const w=v.h;v.h=null,v.m.apply(null,w)}class Yt extends L{constructor(w,O){super(),this.m=w,this.l=O,this.h=null,this.i=!1,this.g=null}j(w){this.h=arguments,this.g?this.i=!0:Lt(this)}N(){super.N(),this.g&&(c.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function In(v){L.call(this),this.h=v,this.g={}}g(In,L);var fi=[];function Ni(v){Me(v.g,function(w,O){this.g.hasOwnProperty(O)&&de(w)},v),v.g={}}In.prototype.N=function(){In.Z.N.call(this),Ni(this)},In.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var pi=c.JSON.stringify,ao=c.JSON.parse,vn=class{stringify(v){return c.JSON.stringify(v,void 0)}parse(v){return c.JSON.parse(v,void 0)}};function fa(){}function pa(){}var sn={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Gt(){U.call(this,"d")}g(Gt,U);function Nr(){U.call(this,"c")}g(Nr,U);var ln={},Ts=null;function Ii(){return Ts=Ts||new Pe}ln.Ia="serverreachability";function oo(v){U.call(this,ln.Ia,v)}g(oo,U);function W(v){const w=Ii();Fe(w,new oo(w))}ln.STAT_EVENT="statevent";function Z(v,w){U.call(this,ln.STAT_EVENT,v),this.stat=w}g(Z,U);function X(v){const w=Ii();Fe(w,new Z(w,v))}ln.Ja="timingevent";function Ne(v,w){U.call(this,ln.Ja,v),this.size=w}g(Ne,U);function Je(v,w){if(typeof v!="function")throw Error("Fn must not be null and must be a function");return c.setTimeout(function(){v()},w)}function tt(){this.g=!0}tt.prototype.ua=function(){this.g=!1};function xt(v,w,O,$,ne,ce){v.info(function(){if(v.g)if(ce){var Le="",vt=ce.split("&");for(let $t=0;$t<vt.length;$t++){var Mn=vt[$t].split("=");if(Mn.length>1){const yn=Mn[0];Mn=Mn[1];const Li=yn.split("_");Le=Li.length>=2&&Li[1]=="type"?Le+(yn+"="+Mn+"&"):Le+(yn+"=redacted&")}}}else Le=null;else Le=ce;return"XMLHTTP REQ ("+$+") [attempt "+ne+"]: "+w+`
`+O+`
`+Le})}function _n(v,w,O,$,ne,ce,Le){v.info(function(){return"XMLHTTP RESP ("+$+") [ attempt "+ne+"]: "+w+`
`+O+`
`+ce+" "+Le})}function un(v,w,O,$){v.info(function(){return"XMLHTTP TEXT ("+w+"): "+zl(v,O)+($?" "+$:"")})}function Pi(v,w){v.info(function(){return"TIMEOUT: "+w})}tt.prototype.info=function(){};function zl(v,w){if(!v.g)return w;if(!w)return null;try{const ce=JSON.parse(w);if(ce){for(v=0;v<ce.length;v++)if(Array.isArray(ce[v])){var O=ce[v];if(!(O.length<2)){var $=O[1];if(Array.isArray($)&&!($.length<1)){var ne=$[0];if(ne!="noop"&&ne!="stop"&&ne!="close")for(let Le=1;Le<$.length;Le++)$[Le]=""}}}}return pi(ce)}catch{return w}}var Sn={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Mi={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Pn;function tr(){}g(tr,fa),tr.prototype.g=function(){return new XMLHttpRequest},Pn=new tr;function mi(v){return encodeURIComponent(String(v))}function Fl(v){var w=1;v=v.split(":");const O=[];for(;w>0&&v.length;)O.push(v.shift()),w--;return v.length&&O.push(v.join(":")),O}function Yr(v,w,O,$){this.j=v,this.i=w,this.l=O,this.S=$||1,this.V=new In(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Qr}function Qr(){this.i=null,this.g="",this.h=!1}var Fn={},or={};function ks(v,w,O){v.M=1,v.A=Nc($n(w)),v.u=O,v.R=!0,Bl(v,null)}function Bl(v,w){v.F=Date.now(),Cs(v),v.B=$n(v.A);var O=v.B,$=v.S;Array.isArray($)||($=[String($)]),Gl(O.i,"t",$),v.C=0,O=v.j.L,v.h=new Qr,v.g=Ip(v.j,O?w:null,!v.u),v.P>0&&(v.O=new Yt(h(v.Y,v,v.g),v.P)),w=v.V,O=v.g,$=v.ba;var ne="readystatechange";Array.isArray(ne)||(ne&&(fi[0]=ne.toString()),ne=fi);for(let ce=0;ce<ne.length;ce++){const Le=Ke(O,ne[ce],$||w.handleEvent,!1,w.h||w);if(!Le)break;w.g[Le.key]=Le}w=v.J?q(v.J):{},v.u?(v.v||(v.v="POST"),w["Content-Type"]="application/x-www-form-urlencoded",v.g.ea(v.B,v.v,v.u,w)):(v.v="GET",v.g.ea(v.B,v.v,null,w)),W(),xt(v.i,v.v,v.B,v.l,v.S,v.u)}Yr.prototype.ba=function(v){v=v.target;const w=this.O;w&&ns(v)==3?w.j():this.Y(v)},Yr.prototype.Y=function(v){try{if(v==this.g)e:{const vt=ns(this.g),Mn=this.g.ya(),$t=this.g.ca();if(!(vt<3)&&(vt!=3||this.g&&(this.h.h||this.g.la()||vr(this.g)))){this.K||vt!=4||Mn==7||(Mn==8||$t<=0?W(3):W(2)),ws(this);var w=this.g.ca();this.X=w;var O=$0(this);if(this.o=w==200,_n(this.i,this.v,this.B,this.l,this.S,vt,w),this.o){if(this.U&&!this.L){t:{if(this.g){var $,ne=this.g;if(($=ne.g?ne.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!V($)){var ce=$;break t}}ce=null}if(v=ce)un(this.i,this.l,v,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Es(this,v);else{this.o=!1,this.m=3,X(12),gi(this),Di(this);break e}}if(this.R){v=!0;let yn;for(;!this.K&&this.C<O.length;)if(yn=yp(this,O),yn==or){vt==4&&(this.m=4,X(14),v=!1),un(this.i,this.l,null,"[Incomplete Response]");break}else if(yn==Fn){this.m=4,X(15),un(this.i,this.l,O,"[Invalid Chunk]"),v=!1;break}else un(this.i,this.l,yn,null),Es(this,yn);if(vp(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),vt!=4||O.length!=0||this.h.h||(this.m=1,X(16),v=!1),this.o=this.o&&v,!v)un(this.i,this.l,O,"[Invalid Chunked Response]"),gi(this),Di(this);else if(O.length>0&&!this.W){this.W=!0;var Le=this.j;Le.g==this&&Le.aa&&!Le.P&&(Le.j.info("Great, no buffering proxy detected. Bytes received: "+O.length),Zd(Le),Le.P=!0,X(11))}}else un(this.i,this.l,O,null),Es(this,O);vt==4&&gi(this),this.o&&!this.K&&(vt==4?Ep(this.j,this):(this.o=!1,Cs(this)))}else ga(this.g),w==400&&O.indexOf("Unknown SID")>0?(this.m=3,X(12)):(this.m=0,X(13)),gi(this),Di(this)}}}catch{}finally{}};function $0(v){if(!vp(v))return v.g.la();const w=vr(v.g);if(w==="")return"";let O="";const $=w.length,ne=ns(v.g)==4;if(!v.h.i){if(typeof TextDecoder>"u")return gi(v),Di(v),"";v.h.i=new c.TextDecoder}for(let ce=0;ce<$;ce++)v.h.h=!0,O+=v.h.i.decode(w[ce],{stream:!(ne&&ce==$-1)});return w.length=0,v.h.g+=O,v.C=0,v.h.g}function vp(v){return v.g?v.v=="GET"&&v.M!=2&&v.j.Aa:!1}function yp(v,w){var O=v.C,$=w.indexOf(`
`,O);return $==-1?or:(O=Number(w.substring(O,$)),isNaN(O)?Fn:($+=1,$+O>w.length?or:(w=w.slice($,$+O),v.C=$+O,w)))}Yr.prototype.cancel=function(){this.K=!0,gi(this)};function Cs(v){v.T=Date.now()+v.H,$l(v,v.H)}function $l(v,w){if(v.D!=null)throw Error("WatchDog timer not null");v.D=Je(h(v.aa,v),w)}function ws(v){v.D&&(c.clearTimeout(v.D),v.D=null)}Yr.prototype.aa=function(){this.D=null;const v=Date.now();v-this.T>=0?(Pi(this.i,this.B),this.M!=2&&(W(),X(17)),gi(this),this.m=2,Di(this)):$l(this,this.T-v)};function Di(v){v.j.I==0||v.K||Ep(v.j,v)}function gi(v){ws(v);var w=v.O;w&&typeof w.dispose=="function"&&w.dispose(),v.O=null,Ni(v.V),v.g&&(w=v.g,v.g=null,w.abort(),w.dispose())}function Es(v,w){try{var O=v.j;if(O.I!=0&&(O.g==v||As(O.h,v))){if(!v.L&&As(O.h,v)&&O.I==3){try{var $=O.Ba.g.parse(w)}catch{$=null}if(Array.isArray($)&&$.length==3){var ne=$;if(ne[0]==0){e:if(!O.v){if(O.g)if(O.g.F+3e3<v.F)Xl(O),go(O);else break e;Lc(O),X(18)}}else O.xa=ne[1],0<O.xa-O.K&&ne[2]<37500&&O.F&&O.A==0&&!O.C&&(O.C=Je(h(O.Va,O),6e3));Rs(O.h)<=1&&O.ta&&(O.ta=void 0)}else Os(O,11)}else if((v.L||O.g==v)&&Xl(O),!V(w))for(ne=O.Ba.g.parse(w),w=0;w<ne.length;w++){let $t=ne[w];const yn=$t[0];if(!(yn<=O.K))if(O.K=yn,$t=$t[1],O.I==2)if($t[0]=="c"){O.M=$t[1],O.ba=$t[2];const Li=$t[3];Li!=null&&(O.ka=Li,O.j.info("VER="+O.ka));const js=$t[4];js!=null&&(O.za=js,O.j.info("SVER="+O.za));const rs=$t[5];rs!=null&&typeof rs=="number"&&rs>0&&($=1.5*rs,O.O=$,O.j.info("backChannelRequestTimeoutMs_="+$)),$=O;const is=v.g;if(is){const Uc=is.g?is.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Uc){var ce=$.h;ce.g||Uc.indexOf("spdy")==-1&&Uc.indexOf("quic")==-1&&Uc.indexOf("h2")==-1||(ce.j=ce.l,ce.g=new Set,ce.h&&(Fd(ce,ce.h),ce.h=null))}if($.G){const Jl=is.g?is.g.getResponseHeader("X-HTTP-Session-Id"):null;Jl&&($.wa=Jl,Qt($.J,$.G,Jl))}}O.I=3,O.l&&O.l.ra(),O.aa&&(O.T=Date.now()-v.F,O.j.info("Handshake RTT: "+O.T+"ms")),$=O;var Le=v;if($.na=Np($,$.L?$.ba:null,$.W),Le.L){Bd($.h,Le);var vt=Le,Mn=$.O;Mn&&(vt.H=Mn),vt.D&&(ws(vt),Cs(vt)),$.g=Le}else Cp($);O.i.length>0&&Ds(O)}else $t[0]!="stop"&&$t[0]!="close"||Os(O,7);else O.I==3&&($t[0]=="stop"||$t[0]=="close"?$t[0]=="stop"?Os(O,7):Xd(O):$t[0]!="noop"&&O.l&&O.l.qa($t),O.A=0)}}W(4)}catch{}}var Bn=class{constructor(v,w){this.g=v,this.map=w}};function Vd(v){this.l=v||10,c.PerformanceNavigationTiming?(v=c.performance.getEntriesByType("navigation"),v=v.length>0&&(v[0].nextHopProtocol=="hq"||v[0].nextHopProtocol=="h2")):v=!!(c.chrome&&c.chrome.loadTimes&&c.chrome.loadTimes()&&c.chrome.loadTimes().wasFetchedViaSpdy),this.j=v?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function zd(v){return v.h?!0:v.g?v.g.size>=v.j:!1}function Rs(v){return v.h?1:v.g?v.g.size:0}function As(v,w){return v.h?v.h==w:v.g?v.g.has(w):!1}function Fd(v,w){v.g?v.g.add(w):v.h=w}function Bd(v,w){v.h&&v.h==w?v.h=null:v.g&&v.g.has(w)&&v.g.delete(w)}Vd.prototype.cancel=function(){if(this.i=$d(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const v of this.g.values())v.cancel();this.g.clear()}};function $d(v){if(v.h!=null)return v.i.concat(v.h.G);if(v.g!=null&&v.g.size!==0){let w=v.i;for(const O of v.g.values())w=w.concat(O.G);return w}return _(v.i)}var bp=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ql(v,w){if(v){v=v.split("&");for(let O=0;O<v.length;O++){const $=v[O].indexOf("=");let ne,ce=null;$>=0?(ne=v[O].substring(0,$),ce=v[O].substring($+1)):ne=v[O],w(ne,ce?decodeURIComponent(ce.replace(/\+/g," ")):"")}}}function vi(v){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let w;v instanceof vi?(this.l=v.l,cr(this,v.j),this.o=v.o,this.g=v.g,co(this,v.u),this.h=v.h,qd(this,Tp(v.i)),this.m=v.m):v&&(w=String(v).match(bp))?(this.l=!1,cr(this,w[1]||"",!0),this.o=Ns(w[2]||""),this.g=Ns(w[3]||"",!0),co(this,w[4]),this.h=Ns(w[5]||"",!0),qd(this,w[6]||"",!0),this.m=Ns(w[7]||"")):(this.l=!1,this.i=new uo(null,this.l))}vi.prototype.toString=function(){const v=[];var w=this.j;w&&v.push(Ic(w,Hl,!0),":");var O=this.g;return(O||w=="file")&&(v.push("//"),(w=this.o)&&v.push(Ic(w,Hl,!0),"@"),v.push(mi(O).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),O=this.u,O!=null&&v.push(":",String(O))),(O=this.h)&&(this.g&&O.charAt(0)!="/"&&v.push("/"),v.push(Ic(O,O.charAt(0)=="/"?Hd:xp,!0))),(O=this.i.toString())&&v.push("?",O),(O=this.m)&&v.push("#",Ic(O,_p)),v.join("")},vi.prototype.resolve=function(v){const w=$n(this);let O=!!v.j;O?cr(w,v.j):O=!!v.o,O?w.o=v.o:O=!!v.g,O?w.g=v.g:O=v.u!=null;var $=v.h;if(O)co(w,v.u);else if(O=!!v.h){if($.charAt(0)!="/")if(this.g&&!this.h)$="/"+$;else{var ne=w.h.lastIndexOf("/");ne!=-1&&($=w.h.slice(0,ne+1)+$)}if(ne=$,ne==".."||ne==".")$="";else if(ne.indexOf("./")!=-1||ne.indexOf("/.")!=-1){$=ne.lastIndexOf("/",0)==0,ne=ne.split("/");const ce=[];for(let Le=0;Le<ne.length;){const vt=ne[Le++];vt=="."?$&&Le==ne.length&&ce.push(""):vt==".."?((ce.length>1||ce.length==1&&ce[0]!="")&&ce.pop(),$&&Le==ne.length&&ce.push("")):(ce.push(vt),$=!0)}$=ce.join("/")}else $=ne}return O?w.h=$:O=v.i.toString()!=="",O?qd(w,Tp(v.i)):O=!!v.m,O&&(w.m=v.m),w};function $n(v){return new vi(v)}function cr(v,w,O){v.j=O?Ns(w,!0):w,v.j&&(v.j=v.j.replace(/:$/,""))}function co(v,w){if(w){if(w=Number(w),isNaN(w)||w<0)throw Error("Bad port number "+w);v.u=w}else v.u=null}function qd(v,w,O){w instanceof uo?(v.i=w,Kl(v.i,v.l)):(O||(w=Ic(w,lo)),v.i=new uo(w,v.l))}function Qt(v,w,O){v.i.set(w,O)}function Nc(v){return Qt(v,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),v}function Ns(v,w){return v?w?decodeURI(v.replace(/%25/g,"%2525")):decodeURIComponent(v):""}function Ic(v,w,O){return typeof v=="string"?(v=encodeURI(v).replace(w,Xr),O&&(v=v.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),v):null}function Xr(v){return v=v.charCodeAt(0),"%"+(v>>4&15).toString(16)+(v&15).toString(16)}var Hl=/[#\/\?@]/g,xp=/[#\?:]/g,Hd=/[#\?]/g,lo=/[#\?@]/g,_p=/#/g;function uo(v,w){this.h=this.g=null,this.i=v||null,this.j=!!w}function Jr(v){v.g||(v.g=new Map,v.h=0,v.i&&ql(v.i,function(w,O){v.add(decodeURIComponent(w.replace(/\+/g," ")),O)}))}n=uo.prototype,n.add=function(v,w){Jr(this),this.i=null,v=ho(this,v);let O=this.g.get(v);return O||this.g.set(v,O=[]),O.push(w),this.h+=1,this};function Sp(v,w){Jr(v),w=ho(v,w),v.g.has(w)&&(v.i=null,v.h-=v.g.get(w).length,v.g.delete(w))}function Gd(v,w){return Jr(v),w=ho(v,w),v.g.has(w)}n.forEach=function(v,w){Jr(this),this.g.forEach(function(O,$){O.forEach(function(ne){v.call(w,ne,$,this)},this)},this)};function Kd(v,w){Jr(v);let O=[];if(typeof w=="string")Gd(v,w)&&(O=O.concat(v.g.get(ho(v,w))));else for(v=Array.from(v.g.values()),w=0;w<v.length;w++)O=O.concat(v[w]);return O}n.set=function(v,w){return Jr(this),this.i=null,v=ho(this,v),Gd(this,v)&&(this.h-=this.g.get(v).length),this.g.set(v,[w]),this.h+=1,this},n.get=function(v,w){return v?(v=Kd(this,v),v.length>0?String(v[0]):w):w};function Gl(v,w,O){Sp(v,w),O.length>0&&(v.i=null,v.g.set(ho(v,w),_(O)),v.h+=O.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const v=[],w=Array.from(this.g.keys());for(let $=0;$<w.length;$++){var O=w[$];const ne=mi(O);O=Kd(this,O);for(let ce=0;ce<O.length;ce++){let Le=ne;O[ce]!==""&&(Le+="="+mi(O[ce])),v.push(Le)}}return this.i=v.join("&")};function Tp(v){const w=new uo;return w.i=v.i,v.g&&(w.g=new Map(v.g),w.h=v.h),w}function ho(v,w){return w=String(w),v.j&&(w=w.toLowerCase()),w}function Kl(v,w){w&&!v.j&&(Jr(v),v.i=null,v.g.forEach(function(O,$){const ne=$.toLowerCase();$!=ne&&(Sp(this,$),Gl(this,ne,O))},v)),v.j=w}function es(v,w){const O=new tt;if(c.Image){const $=new Image;$.onload=m(Oi,O,"TestLoadImage: loaded",!0,w,$),$.onerror=m(Oi,O,"TestLoadImage: error",!1,w,$),$.onabort=m(Oi,O,"TestLoadImage: abort",!1,w,$),$.ontimeout=m(Oi,O,"TestLoadImage: timeout",!1,w,$),c.setTimeout(function(){$.ontimeout&&$.ontimeout()},1e4),$.src=v}else w(!1)}function Wd(v,w){const O=new tt,$=new AbortController,ne=setTimeout(()=>{$.abort(),Oi(O,"TestPingServer: timeout",!1,w)},1e4);fetch(v,{signal:$.signal}).then(ce=>{clearTimeout(ne),ce.ok?Oi(O,"TestPingServer: ok",!0,w):Oi(O,"TestPingServer: server error",!1,w)}).catch(()=>{clearTimeout(ne),Oi(O,"TestPingServer: error",!1,w)})}function Oi(v,w,O,$,ne){try{ne&&(ne.onload=null,ne.onerror=null,ne.onabort=null,ne.ontimeout=null),$(O)}catch{}}function fo(){this.g=new vn}function Is(v){this.i=v.Sb||null,this.h=v.ab||!1}g(Is,fa),Is.prototype.g=function(){return new Pc(this.i,this.h)};function Pc(v,w){Pe.call(this),this.H=v,this.o=w,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}g(Pc,Pe),n=Pc.prototype,n.open=function(v,w){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=v,this.D=w,this.readyState=1,ts(this)},n.send=function(v){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const w={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};v&&(w.body=v),(this.H||c).fetch(new Request(this.D,w)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,po(this)),this.readyState=0},n.Pa=function(v){if(this.g&&(this.l=v,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=v.headers,this.readyState=2,ts(this)),this.g&&(this.readyState=3,ts(this),this.g)))if(this.responseType==="arraybuffer")v.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof c.ReadableStream<"u"&&"body"in v){if(this.j=v.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Wl(this)}else v.text().then(this.Oa.bind(this),this.ga.bind(this))};function Wl(v){v.j.read().then(v.Ma.bind(v)).catch(v.ga.bind(v))}n.Ma=function(v){if(this.g){if(this.o&&v.value)this.response.push(v.value);else if(!this.o){var w=v.value?v.value:new Uint8Array(0);(w=this.B.decode(w,{stream:!v.done}))&&(this.response=this.responseText+=w)}v.done?po(this):ts(this),this.readyState==3&&Wl(this)}},n.Oa=function(v){this.g&&(this.response=this.responseText=v,po(this))},n.Na=function(v){this.g&&(this.response=v,po(this))},n.ga=function(){this.g&&po(this)};function po(v){v.readyState=4,v.l=null,v.j=null,v.B=null,ts(v)}n.setRequestHeader=function(v,w){this.A.append(v,w)},n.getResponseHeader=function(v){return this.h&&this.h.get(v.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const v=[],w=this.h.entries();for(var O=w.next();!O.done;)O=O.value,v.push(O[0]+": "+O[1]),O=w.next();return v.join(`\r
`)};function ts(v){v.onreadystatechange&&v.onreadystatechange.call(v)}Object.defineProperty(Pc.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(v){this.m=v?"include":"same-origin"}});function ji(v){let w="";return Me(v,function(O,$){w+=$,w+=":",w+=O,w+=`\r
`}),w}function Mc(v,w,O){e:{for($ in O){var $=!1;break e}$=!0}$||(O=ji(O),typeof v=="string"?O!=null&&mi(O):Qt(v,w,O))}function Zt(v){Pe.call(this),this.headers=new Map,this.L=v||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}g(Zt,Pe);var Ps=/^https?$/i,Yd=["POST","PUT"];n=Zt.prototype,n.Fa=function(v){this.H=v},n.ea=function(v,w,O,$){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+v);w=w?w.toUpperCase():"GET",this.D=v,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Pn.g(),this.g.onreadystatechange=b(h(this.Ca,this));try{this.B=!0,this.g.open(w,String(v),!0),this.B=!1}catch(ce){Dc(this,ce);return}if(v=O||"",O=new Map(this.headers),$)if(Object.getPrototypeOf($)===Object.prototype)for(var ne in $)O.set(ne,$[ne]);else if(typeof $.keys=="function"&&typeof $.get=="function")for(const ce of $.keys())O.set(ce,$.get(ce));else throw Error("Unknown input type for opt_headers: "+String($));$=Array.from(O.keys()).find(ce=>ce.toLowerCase()=="content-type"),ne=c.FormData&&v instanceof c.FormData,!(Array.prototype.indexOf.call(Yd,w,void 0)>=0)||$||ne||O.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[ce,Le]of O)this.g.setRequestHeader(ce,Le);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(v),this.v=!1}catch(ce){Dc(this,ce)}};function Dc(v,w){v.h=!1,v.g&&(v.j=!0,v.g.abort(),v.j=!1),v.l=w,v.o=5,Qd(v),ma(v)}function Qd(v){v.A||(v.A=!0,Fe(v,"complete"),Fe(v,"error"))}n.abort=function(v){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=v||7,Fe(this,"complete"),Fe(this,"abort"),ma(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),ma(this,!0)),Zt.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?Oc(this):this.Xa())},n.Xa=function(){Oc(this)};function Oc(v){if(v.h&&typeof s<"u"){if(v.v&&ns(v)==4)setTimeout(v.Ca.bind(v),0);else if(Fe(v,"readystatechange"),ns(v)==4){v.h=!1;try{const ce=v.ca();e:switch(ce){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var w=!0;break e;default:w=!1}var O;if(!(O=w)){var $;if($=ce===0){let Le=String(v.D).match(bp)[1]||null;!Le&&c.self&&c.self.location&&(Le=c.self.location.protocol.slice(0,-1)),$=!Ps.test(Le?Le.toLowerCase():"")}O=$}if(O)Fe(v,"complete"),Fe(v,"success");else{v.o=6;try{var ne=ns(v)>2?v.g.statusText:""}catch{ne=""}v.l=ne+" ["+v.ca()+"]",Qd(v)}}finally{ma(v)}}}}function ma(v,w){if(v.g){v.m&&(clearTimeout(v.m),v.m=null);const O=v.g;v.g=null,w||Fe(v,"ready");try{O.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function ns(v){return v.g?v.g.readyState:0}n.ca=function(){try{return ns(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(v){if(this.g){var w=this.g.responseText;return v&&w.indexOf(v)==0&&(w=w.substring(v.length)),ao(w)}};function vr(v){try{if(!v.g)return null;if("response"in v.g)return v.g.response;switch(v.F){case"":case"text":return v.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in v.g)return v.g.mozResponseArrayBuffer}return null}catch{return null}}function ga(v){const w={};v=(v.g&&ns(v)>=2&&v.g.getAllResponseHeaders()||"").split(`\r
`);for(let $=0;$<v.length;$++){if(V(v[$]))continue;var O=Fl(v[$]);const ne=O[0];if(O=O[1],typeof O!="string")continue;O=O.trim();const ce=w[ne]||[];w[ne]=ce,ce.push(O)}je(w,function($){return $.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Ms(v,w,O){return O&&O.internalChannelParams&&O.internalChannelParams[v]||w}function mo(v){this.za=0,this.i=[],this.j=new tt,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Ms("failFast",!1,v),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Ms("baseRetryDelayMs",5e3,v),this.Za=Ms("retryDelaySeedMs",1e4,v),this.Ta=Ms("forwardChannelMaxRetries",2,v),this.va=Ms("forwardChannelRequestTimeoutMs",2e4,v),this.ma=v&&v.xmlHttpFactory||void 0,this.Ua=v&&v.Rb||void 0,this.Aa=v&&v.useFetchStreams||!1,this.O=void 0,this.L=v&&v.supportsCrossDomainXhr||!1,this.M="",this.h=new Vd(v&&v.concurrentRequestLimit),this.Ba=new fo,this.S=v&&v.fastHandshake||!1,this.R=v&&v.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=v&&v.Pb||!1,v&&v.ua&&this.j.ua(),v&&v.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&v&&v.detectBufferingProxy||!1,this.ia=void 0,v&&v.longPollingTimeout&&v.longPollingTimeout>0&&(this.ia=v.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=mo.prototype,n.ka=8,n.I=1,n.connect=function(v,w,O,$){X(0),this.W=v,this.H=w||{},O&&$!==void 0&&(this.H.OSID=O,this.H.OAID=$),this.F=this.X,this.J=Np(this,null,this.W),Ds(this)};function Xd(v){if(Yl(v),v.I==3){var w=v.V++,O=$n(v.J);if(Qt(O,"SID",v.M),Qt(O,"RID",w),Qt(O,"TYPE","terminate"),jc(v,O),w=new Yr(v,v.j,w),w.M=2,w.A=Nc($n(O)),O=!1,c.navigator&&c.navigator.sendBeacon)try{O=c.navigator.sendBeacon(w.A.toString(),"")}catch{}!O&&c.Image&&(new Image().src=w.A,O=!0),O||(w.g=Ip(w.j,null),w.g.ea(w.A)),w.F=Date.now(),Cs(w)}Ap(v)}function go(v){v.g&&(Zd(v),v.g.cancel(),v.g=null)}function Yl(v){go(v),v.v&&(c.clearTimeout(v.v),v.v=null),Xl(v),v.h.cancel(),v.m&&(typeof v.m=="number"&&c.clearTimeout(v.m),v.m=null)}function Ds(v){if(!zd(v.h)&&!v.m){v.m=!0;var w=v.Ea;N||k(),D||(N(),D=!0),S.add(w,v),v.D=0}}function Ql(v,w){return Rs(v.h)>=v.h.j-(v.m?1:0)?!1:v.m?(v.i=w.G.concat(v.i),!0):v.I==1||v.I==2||v.D>=(v.Sa?0:v.Ta)?!1:(v.m=Je(h(v.Ea,v,w),Rp(v,v.D)),v.D++,!0)}n.Ea=function(v){if(this.m)if(this.m=null,this.I==1){if(!v){this.V=Math.floor(Math.random()*1e5),v=this.V++;const ne=new Yr(this,this.j,v);let ce=this.o;if(this.U&&(ce?(ce=q(ce),fe(ce,this.U)):ce=this.U),this.u!==null||this.R||(ne.J=ce,ce=null),this.S)e:{for(var w=0,O=0;O<this.i.length;O++){t:{var $=this.i[O];if("__data__"in $.map&&($=$.map.__data__,typeof $=="string")){$=$.length;break t}$=void 0}if($===void 0)break;if(w+=$,w>4096){w=O;break e}if(w===4096||O===this.i.length-1){w=O+1;break e}}w=1e3}else w=1e3;w=kp(this,ne,w),O=$n(this.J),Qt(O,"RID",v),Qt(O,"CVER",22),this.G&&Qt(O,"X-HTTP-Session-Id",this.G),jc(this,O),ce&&(this.R?w="headers="+mi(ji(ce))+"&"+w:this.u&&Mc(O,this.u,ce)),Fd(this.h,ne),this.Ra&&Qt(O,"TYPE","init"),this.S?(Qt(O,"$req",w),Qt(O,"SID","null"),ne.U=!0,ks(ne,O,null)):ks(ne,O,w),this.I=2}}else this.I==3&&(v?Jd(this,v):this.i.length==0||zd(this.h)||Jd(this))};function Jd(v,w){var O;w?O=w.l:O=v.V++;const $=$n(v.J);Qt($,"SID",v.M),Qt($,"RID",O),Qt($,"AID",v.K),jc(v,$),v.u&&v.o&&Mc($,v.u,v.o),O=new Yr(v,v.j,O,v.D+1),v.u===null&&(O.J=v.o),w&&(v.i=w.G.concat(v.i)),w=kp(v,O,1e3),O.H=Math.round(v.va*.5)+Math.round(v.va*.5*Math.random()),Fd(v.h,O),ks(O,$,w)}function jc(v,w){v.H&&Me(v.H,function(O,$){Qt(w,$,O)}),v.l&&Me({},function(O,$){Qt(w,$,O)})}function kp(v,w,O){O=Math.min(v.i.length,O);const $=v.l?h(v.l.Ka,v.l,v):null;e:{var ne=v.i;let vt=-1;for(;;){const Mn=["count="+O];vt==-1?O>0?(vt=ne[0].g,Mn.push("ofs="+vt)):vt=0:Mn.push("ofs="+vt);let $t=!0;for(let yn=0;yn<O;yn++){var ce=ne[yn].g;const Li=ne[yn].map;if(ce-=vt,ce<0)vt=Math.max(0,ne[yn].g-100),$t=!1;else try{ce="req"+ce+"_"||"";try{var Le=Li instanceof Map?Li:Object.entries(Li);for(const[js,rs]of Le){let is=rs;l(rs)&&(is=pi(rs)),Mn.push(ce+js+"="+encodeURIComponent(is))}}catch(js){throw Mn.push(ce+"type="+encodeURIComponent("_badmap")),js}}catch{$&&$(Li)}}if($t){Le=Mn.join("&");break e}}Le=void 0}return v=v.i.splice(0,O),w.G=v,Le}function Cp(v){if(!v.g&&!v.v){v.Y=1;var w=v.Da;N||k(),D||(N(),D=!0),S.add(w,v),v.A=0}}function Lc(v){return v.g||v.v||v.A>=3?!1:(v.Y++,v.v=Je(h(v.Da,v),Rp(v,v.A)),v.A++,!0)}n.Da=function(){if(this.v=null,wp(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var v=4*this.T;this.j.info("BP detection timer enabled: "+v),this.B=Je(h(this.Wa,this),v)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,X(10),go(this),wp(this))};function Zd(v){v.B!=null&&(c.clearTimeout(v.B),v.B=null)}function wp(v){v.g=new Yr(v,v.j,"rpc",v.Y),v.u===null&&(v.g.J=v.o),v.g.P=0;var w=$n(v.na);Qt(w,"RID","rpc"),Qt(w,"SID",v.M),Qt(w,"AID",v.K),Qt(w,"CI",v.F?"0":"1"),!v.F&&v.ia&&Qt(w,"TO",v.ia),Qt(w,"TYPE","xmlhttp"),jc(v,w),v.u&&v.o&&Mc(w,v.u,v.o),v.O&&(v.g.H=v.O);var O=v.g;v=v.ba,O.M=1,O.A=Nc($n(w)),O.u=null,O.R=!0,Bl(O,v)}n.Va=function(){this.C!=null&&(this.C=null,go(this),Lc(this),X(19))};function Xl(v){v.C!=null&&(c.clearTimeout(v.C),v.C=null)}function Ep(v,w){var O=null;if(v.g==w){Xl(v),Zd(v),v.g=null;var $=2}else if(As(v.h,w))O=w.G,Bd(v.h,w),$=1;else return;if(v.I!=0){if(w.o)if($==1){O=w.u?w.u.length:0,w=Date.now()-w.F;var ne=v.D;$=Ii(),Fe($,new Ne($,O)),Ds(v)}else Cp(v);else if(ne=w.m,ne==3||ne==0&&w.X>0||!($==1&&Ql(v,w)||$==2&&Lc(v)))switch(O&&O.length>0&&(w=v.h,w.i=w.i.concat(O)),ne){case 1:Os(v,5);break;case 4:Os(v,10);break;case 3:Os(v,6);break;default:Os(v,2)}}}function Rp(v,w){let O=v.Qa+Math.floor(Math.random()*v.Za);return v.isActive()||(O*=2),O*w}function Os(v,w){if(v.j.info("Error code "+w),w==2){var O=h(v.bb,v),$=v.Ua;const ne=!$;$=new vi($||"//www.google.com/images/cleardot.gif"),c.location&&c.location.protocol=="http"||cr($,"https"),Nc($),ne?es($.toString(),O):Wd($.toString(),O)}else X(2);v.I=0,v.l&&v.l.pa(w),Ap(v),Yl(v)}n.bb=function(v){v?(this.j.info("Successfully pinged google.com"),X(2)):(this.j.info("Failed to ping google.com"),X(1))};function Ap(v){if(v.I=0,v.ja=[],v.l){const w=$d(v.h);(w.length!=0||v.i.length!=0)&&(R(v.ja,w),R(v.ja,v.i),v.h.i.length=0,_(v.i),v.i.length=0),v.l.oa()}}function Np(v,w,O){var $=O instanceof vi?$n(O):new vi(O);if($.g!="")w&&($.g=w+"."+$.g),co($,$.u);else{var ne=c.location;$=ne.protocol,w=w?w+"."+ne.hostname:ne.hostname,ne=+ne.port;const ce=new vi(null);$&&cr(ce,$),w&&(ce.g=w),ne&&co(ce,ne),O&&(ce.h=O),$=ce}return O=v.G,w=v.wa,O&&w&&Qt($,O,w),Qt($,"VER",v.ka),jc(v,$),$}function Ip(v,w,O){if(w&&!v.L)throw Error("Can't create secondary domain capable XhrIo object.");return w=v.Aa&&!v.ma?new Zt(new Is({ab:O})):new Zt(v.ma),w.Fa(v.L),w}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Pp(){}n=Pp.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function vo(){}vo.prototype.g=function(v,w){return new Ur(v,w)};function Ur(v,w){Pe.call(this),this.g=new mo(w),this.l=v,this.h=w&&w.messageUrlParams||null,v=w&&w.messageHeaders||null,w&&w.clientProtocolHeaderRequired&&(v?v["X-Client-Protocol"]="webchannel":v={"X-Client-Protocol":"webchannel"}),this.g.o=v,v=w&&w.initMessageHeaders||null,w&&w.messageContentType&&(v?v["X-WebChannel-Content-Type"]=w.messageContentType:v={"X-WebChannel-Content-Type":w.messageContentType}),w&&w.sa&&(v?v["X-WebChannel-Client-Profile"]=w.sa:v={"X-WebChannel-Client-Profile":w.sa}),this.g.U=v,(v=w&&w.Qb)&&!V(v)&&(this.g.u=v),this.A=w&&w.supportsCrossDomainXhr||!1,this.v=w&&w.sendRawJson||!1,(w=w&&w.httpSessionIdParam)&&!V(w)&&(this.g.G=w,v=this.h,v!==null&&w in v&&(v=this.h,w in v&&delete v[w])),this.j=new va(this)}g(Ur,Pe),Ur.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Ur.prototype.close=function(){Xd(this.g)},Ur.prototype.o=function(v){var w=this.g;if(typeof v=="string"){var O={};O.__data__=v,v=O}else this.v&&(O={},O.__data__=pi(v),v=O);w.i.push(new Bn(w.Ya++,v)),w.I==3&&Ds(w)},Ur.prototype.N=function(){this.g.l=null,delete this.j,Xd(this.g),delete this.g,Ur.Z.N.call(this)};function Mp(v){Gt.call(this),v.__headers__&&(this.headers=v.__headers__,this.statusCode=v.__status__,delete v.__headers__,delete v.__status__);var w=v.__sm__;if(w){e:{for(const O in w){v=O;break e}v=void 0}(this.i=v)&&(v=this.i,w=w!==null&&v in w?w[v]:void 0),this.data=w}else this.data=v}g(Mp,Gt);function Dp(){Nr.call(this),this.status=1}g(Dp,Nr);function va(v){this.g=v}g(va,Pp),va.prototype.ra=function(){Fe(this.g,"a")},va.prototype.qa=function(v){Fe(this.g,new Mp(v))},va.prototype.pa=function(v){Fe(this.g,new Dp)},va.prototype.oa=function(){Fe(this.g,"b")},vo.prototype.createWebChannel=vo.prototype.g,Ur.prototype.send=Ur.prototype.o,Ur.prototype.open=Ur.prototype.m,Ur.prototype.close=Ur.prototype.close,fI=function(){return new vo},hI=function(){return Ii()},dI=ln,ex={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Sn.NO_ERROR=0,Sn.TIMEOUT=8,Sn.HTTP_ERROR=6,hg=Sn,Mi.COMPLETE="complete",uI=Mi,pa.EventType=sn,sn.OPEN="a",sn.CLOSE="b",sn.ERROR="c",sn.MESSAGE="d",Pe.prototype.listen=Pe.prototype.J,Jh=pa,Zt.prototype.listenOnce=Zt.prototype.K,Zt.prototype.getLastError=Zt.prototype.Ha,Zt.prototype.getLastErrorCode=Zt.prototype.ya,Zt.prototype.getStatus=Zt.prototype.ca,Zt.prototype.getResponseJson=Zt.prototype.La,Zt.prototype.getResponseText=Zt.prototype.la,Zt.prototype.send=Zt.prototype.ea,Zt.prototype.setWithCredentials=Zt.prototype.Fa,lI=Zt}).apply(typeof Vm<"u"?Vm:typeof self<"u"?self:typeof window<"u"?window:{});const e2="@firebase/firestore",t2="4.9.2";let Mr=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Mr.UNAUTHENTICATED=new Mr(null),Mr.GOOGLE_CREDENTIALS=new Mr("google-credentials-uid"),Mr.FIRST_PARTY=new Mr("first-party-uid"),Mr.MOCK_USER=new Mr("mock-user");let Rd="12.3.0";const vl=new N_("@firebase/firestore");function Mu(){return vl.logLevel}function We(n,...e){if(vl.logLevel<=Mt.DEBUG){const t=e.map(F_);vl.debug(`Firestore (${Rd}): ${n}`,...t)}}function Xa(n,...e){if(vl.logLevel<=Mt.ERROR){const t=e.map(F_);vl.error(`Firestore (${Rd}): ${n}`,...t)}}function ad(n,...e){if(vl.logLevel<=Mt.WARN){const t=e.map(F_);vl.warn(`Firestore (${Rd}): ${n}`,...t)}}function F_(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function lt(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,pI(n,r,t)}function pI(n,e,t){let r=`FIRESTORE (${Rd}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw Xa(r),new Error(r)}function Wt(n,e,t,r){let i="Unexpected state";typeof t=="string"?i=t:r=t,n||pI(e,i,r)}function mt(n,e){return n}const me={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Ue extends oa{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Ga{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class mI{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class p7{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Mr.UNAUTHENTICATED)))}shutdown(){}}class m7{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class g7{constructor(e){this.t=e,this.currentUser=Mr.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Wt(this.o===void 0,42304);let r=this.i;const i=d=>this.i!==r?(r=this.i,t(d)):Promise.resolve();let s=new Ga;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Ga,e.enqueueRetryable((()=>i(this.currentUser)))};const c=()=>{const d=s;e.enqueueRetryable((async()=>{await d.promise,await i(this.currentUser)}))},l=d=>{We("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=d,this.o&&(this.auth.addAuthTokenListener(this.o),c())};this.t.onInit((d=>l(d))),setTimeout((()=>{if(!this.auth){const d=this.t.getImmediate({optional:!0});d?l(d):(We("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Ga)}}),0),c()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((r=>this.i!==e?(We("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Wt(typeof r.accessToken=="string",31837,{l:r}),new mI(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Wt(e===null||typeof e=="string",2055,{h:e}),new Mr(e)}}class v7{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=Mr.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class y7{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new v7(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(Mr.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class n2{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class b7{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Ei(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){Wt(this.o===void 0,3512);const r=s=>{s.error!=null&&We("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const c=s.token!==this.m;return this.m=s.token,We("FirebaseAppCheckTokenProvider",`Received ${c?"new":"existing"} token.`),c?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable((()=>r(s)))};const i=s=>{We("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((s=>i(s))),setTimeout((()=>{if(!this.appCheck){const s=this.V.getImmediate({optional:!0});s?i(s):We("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new n2(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(Wt(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new n2(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function x7(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class B_{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const i=x7(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%62))}return r}}function Dt(n,e){return n<e?-1:n>e?1:0}function tx(n,e){const t=Math.min(n.length,e.length);for(let r=0;r<t;r++){const i=n.charAt(r),s=e.charAt(r);if(i!==s)return Qb(i)===Qb(s)?Dt(i,s):Qb(i)?1:-1}return Dt(n.length,e.length)}const _7=55296,S7=57343;function Qb(n){const e=n.charCodeAt(0);return e>=_7&&e<=S7}function od(n,e,t){return n.length===e.length&&n.every(((r,i)=>t(r,e[i])))}const r2="__name__";class qs{constructor(e,t,r){t===void 0?t=0:t>e.length&&lt(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&lt(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return qs.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof qs?e.forEach((r=>{t.push(r)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let i=0;i<r;i++){const s=qs.compareSegments(e.get(i),t.get(i));if(s!==0)return s}return Dt(e.length,t.length)}static compareSegments(e,t){const r=qs.isNumericId(e),i=qs.isNumericId(t);return r&&!i?-1:!r&&i?1:r&&i?qs.extractNumericId(e).compare(qs.extractNumericId(t)):tx(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return ac.fromString(e.substring(4,e.length-2))}}class cn extends qs{construct(e,t,r){return new cn(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new Ue(me.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter((i=>i.length>0)))}return new cn(t)}static emptyPath(){return new cn([])}}const T7=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Cr extends qs{construct(e,t,r){return new Cr(e,t,r)}static isValidIdentifier(e){return T7.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Cr.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===r2}static keyField(){return new Cr([r2])}static fromServerFormat(e){const t=[];let r="",i=0;const s=()=>{if(r.length===0)throw new Ue(me.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let c=!1;for(;i<e.length;){const l=e[i];if(l==="\\"){if(i+1===e.length)throw new Ue(me.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const d=e[i+1];if(d!=="\\"&&d!=="."&&d!=="`")throw new Ue(me.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=d,i+=2}else l==="`"?(c=!c,i++):l!=="."||c?(r+=l,i++):(s(),i++)}if(s(),c)throw new Ue(me.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Cr(t)}static emptyPath(){return new Cr([])}}class nt{constructor(e){this.path=e}static fromPath(e){return new nt(cn.fromString(e))}static fromName(e){return new nt(cn.fromString(e).popFirst(5))}static empty(){return new nt(cn.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&cn.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return cn.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new nt(new cn(e.slice()))}}function gI(n,e,t){if(!t)throw new Ue(me.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function k7(n,e,t,r){if(e===!0&&r===!0)throw new Ue(me.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function i2(n){if(!nt.isDocumentKey(n))throw new Ue(me.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function s2(n){if(nt.isDocumentKey(n))throw new Ue(me.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function vI(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Yv(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(r){return r.constructor?r.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":lt(12329,{type:typeof n})}function $r(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new Ue(me.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Yv(n);throw new Ue(me.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function C7(n,e){if(e<=0)throw new Ue(me.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}function er(n,e){const t={typeString:n};return e&&(t.value=e),t}function tp(n,e){if(!vI(n))throw new Ue(me.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const i=e[r].typeString,s="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const c=n[r];if(i&&typeof c!==i){t=`JSON field '${r}' must be a ${i}.`;break}if(s!==void 0&&c!==s.value){t=`Expected '${r}' field to equal '${s.value}'`;break}}if(t)throw new Ue(me.INVALID_ARGUMENT,t);return!0}const a2=-62135596800,o2=1e6;let pr=class rl{static now(){return rl.fromMillis(Date.now())}static fromDate(e){return rl.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*o2);return new rl(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Ue(me.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Ue(me.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<a2)throw new Ue(me.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Ue(me.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/o2}_compareTo(e){return this.seconds===e.seconds?Dt(this.nanoseconds,e.nanoseconds):Dt(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:rl._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(tp(e,rl._jsonSchema))return new rl(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-a2;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};pr._jsonSchemaVersion="firestore/timestamp/1.0",pr._jsonSchema={type:er("string",pr._jsonSchemaVersion),seconds:er("number"),nanoseconds:er("number")};class ft{static fromTimestamp(e){return new ft(e)}static min(){return new ft(new pr(0,0))}static max(){return new ft(new pr(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const _f=-1;function w7(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=ft.fromTimestamp(r===1e9?new pr(t+1,0):new pr(t,r));return new pc(i,nt.empty(),e)}function E7(n){return new pc(n.readTime,n.key,_f)}class pc{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new pc(ft.min(),nt.empty(),_f)}static max(){return new pc(ft.max(),nt.empty(),_f)}}function R7(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=nt.comparator(n.documentKey,e.documentKey),t!==0?t:Dt(n.largestBatchId,e.largestBatchId))}const A7="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class N7{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function Ad(n){if(n.code!==me.FAILED_PRECONDITION||n.message!==A7)throw n;We("LocalStore","Unexpectedly lost primary lease")}class Ee{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&lt(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Ee(((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof Ee?t:Ee.resolve(t)}catch(t){return Ee.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):Ee.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):Ee.reject(t)}static resolve(e){return new Ee(((t,r)=>{t(e)}))}static reject(e){return new Ee(((t,r)=>{r(e)}))}static waitFor(e){return new Ee(((t,r)=>{let i=0,s=0,c=!1;e.forEach((l=>{++i,l.next((()=>{++s,c&&s===i&&t()}),(d=>r(d)))})),c=!0,s===i&&t()}))}static or(e){let t=Ee.resolve(!1);for(const r of e)t=t.next((i=>i?Ee.resolve(i):r()));return t}static forEach(e,t){const r=[];return e.forEach(((i,s)=>{r.push(t.call(this,i,s))})),this.waitFor(r)}static mapArray(e,t){return new Ee(((r,i)=>{const s=e.length,c=new Array(s);let l=0;for(let d=0;d<s;d++){const h=d;t(e[h]).next((m=>{c[h]=m,++l,l===s&&r(c)}),(m=>i(m)))}}))}static doWhile(e,t){return new Ee(((r,i)=>{const s=()=>{e()===!0?t().next((()=>{s()}),i):r()};s()}))}}function I7(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Nd(n){return n.name==="IndexedDbTransactionError"}class Qv{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>t.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Qv.ce=-1;const $_=-1;function Xv(n){return n==null}function ev(n){return n===0&&1/n==-1/0}function P7(n){return typeof n=="number"&&Number.isInteger(n)&&!ev(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}const yI="";function M7(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=c2(e)),e=D7(n.get(t),e);return c2(e)}function D7(n,e){let t=e;const r=n.length;for(let i=0;i<r;i++){const s=n.charAt(i);switch(s){case"\0":t+="";break;case yI:t+="";break;default:t+=s}}return t}function c2(n){return n+yI+""}function l2(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function kc(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function bI(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class kn{constructor(e,t){this.comparator=e,this.root=t||kr.EMPTY}insert(e,t){return new kn(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,kr.BLACK,null,null))}remove(e){return new kn(this.comparator,this.root.remove(e,this.comparator).copy(null,null,kr.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,r)=>(e(t,r),!1)))}toString(){const e=[];return this.inorderTraversal(((t,r)=>(e.push(`${t}:${r}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new zm(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new zm(this.root,e,this.comparator,!1)}getReverseIterator(){return new zm(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new zm(this.root,e,this.comparator,!0)}}class zm{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class kr{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??kr.RED,this.left=i??kr.EMPTY,this.right=s??kr.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new kr(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this;const s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return kr.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return kr.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,kr.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,kr.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw lt(43730,{key:this.key,value:this.value});if(this.right.isRed())throw lt(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw lt(27949);return e+(this.isRed()?0:1)}}kr.EMPTY=null,kr.RED=!0,kr.BLACK=!1;kr.EMPTY=new class{constructor(){this.size=0}get key(){throw lt(57766)}get value(){throw lt(16141)}get color(){throw lt(16727)}get left(){throw lt(29726)}get right(){throw lt(36894)}copy(e,t,r,i,s){return this}insert(e,t,r){return new kr(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ar{constructor(e){this.comparator=e,this.data=new kn(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,r)=>(e(t),!1)))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new u2(this.data.getIterator())}getIteratorFrom(e){return new u2(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((r=>{t=t.add(r)})),t}isEqual(e){if(!(e instanceof ar)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new ar(this.comparator);return t.data=e,t}}class u2{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Ri{constructor(e){this.fields=e,e.sort(Cr.comparator)}static empty(){return new Ri([])}unionWith(e){let t=new ar(Cr.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Ri(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return od(this.fields,e.fields,((t,r)=>t.isEqual(r)))}}class xI extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Rr{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new xI("Invalid base64 string: "+s):s}})(e);return new Rr(t)}static fromUint8Array(e){const t=(function(i){let s="";for(let c=0;c<i.length;++c)s+=String.fromCharCode(i[c]);return s})(e);return new Rr(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Dt(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Rr.EMPTY_BYTE_STRING=new Rr("");const O7=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function mc(n){if(Wt(!!n,39018),typeof n=="string"){let e=0;const t=O7.exec(n);if(Wt(!!t,46558,{timestamp:n}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Un(n.seconds),nanos:Un(n.nanos)}}function Un(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function gc(n){return typeof n=="string"?Rr.fromBase64String(n):Rr.fromUint8Array(n)}const _I="server_timestamp",SI="__type__",TI="__previous_value__",kI="__local_write_time__";function Jv(n){return(n?.mapValue?.fields||{})[SI]?.stringValue===_I}function Zv(n){const e=n.mapValue.fields[TI];return Jv(e)?Zv(e):e}function Sf(n){const e=mc(n.mapValue.fields[kI].timestampValue);return new pr(e.seconds,e.nanos)}class j7{constructor(e,t,r,i,s,c,l,d,h,m){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=c,this.autoDetectLongPolling=l,this.longPollingOptions=d,this.useFetchStreams=h,this.isUsingEmulator=m}}const tv="(default)";class Tf{constructor(e,t){this.projectId=e,this.database=t||tv}static empty(){return new Tf("","")}get isDefaultDatabase(){return this.database===tv}isEqual(e){return e instanceof Tf&&e.projectId===this.projectId&&e.database===this.database}}const CI="__type__",L7="__max__",Fm={mapValue:{}},wI="__vector__",nv="value";function vc(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Jv(n)?4:V7(n)?9007199254740991:U7(n)?10:11:lt(28295,{value:n})}function na(n,e){if(n===e)return!0;const t=vc(n);if(t!==vc(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Sf(n).isEqual(Sf(e));case 3:return(function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const c=mc(i.timestampValue),l=mc(s.timestampValue);return c.seconds===l.seconds&&c.nanos===l.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(i,s){return gc(i.bytesValue).isEqual(gc(s.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(i,s){return Un(i.geoPointValue.latitude)===Un(s.geoPointValue.latitude)&&Un(i.geoPointValue.longitude)===Un(s.geoPointValue.longitude)})(n,e);case 2:return(function(i,s){if("integerValue"in i&&"integerValue"in s)return Un(i.integerValue)===Un(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const c=Un(i.doubleValue),l=Un(s.doubleValue);return c===l?ev(c)===ev(l):isNaN(c)&&isNaN(l)}return!1})(n,e);case 9:return od(n.arrayValue.values||[],e.arrayValue.values||[],na);case 10:case 11:return(function(i,s){const c=i.mapValue.fields||{},l=s.mapValue.fields||{};if(l2(c)!==l2(l))return!1;for(const d in c)if(c.hasOwnProperty(d)&&(l[d]===void 0||!na(c[d],l[d])))return!1;return!0})(n,e);default:return lt(52216,{left:n})}}function kf(n,e){return(n.values||[]).find((t=>na(t,e)))!==void 0}function cd(n,e){if(n===e)return 0;const t=vc(n),r=vc(e);if(t!==r)return Dt(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return Dt(n.booleanValue,e.booleanValue);case 2:return(function(s,c){const l=Un(s.integerValue||s.doubleValue),d=Un(c.integerValue||c.doubleValue);return l<d?-1:l>d?1:l===d?0:isNaN(l)?isNaN(d)?0:-1:1})(n,e);case 3:return d2(n.timestampValue,e.timestampValue);case 4:return d2(Sf(n),Sf(e));case 5:return tx(n.stringValue,e.stringValue);case 6:return(function(s,c){const l=gc(s),d=gc(c);return l.compareTo(d)})(n.bytesValue,e.bytesValue);case 7:return(function(s,c){const l=s.split("/"),d=c.split("/");for(let h=0;h<l.length&&h<d.length;h++){const m=Dt(l[h],d[h]);if(m!==0)return m}return Dt(l.length,d.length)})(n.referenceValue,e.referenceValue);case 8:return(function(s,c){const l=Dt(Un(s.latitude),Un(c.latitude));return l!==0?l:Dt(Un(s.longitude),Un(c.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return h2(n.arrayValue,e.arrayValue);case 10:return(function(s,c){const l=s.fields||{},d=c.fields||{},h=l[nv]?.arrayValue,m=d[nv]?.arrayValue,g=Dt(h?.values?.length||0,m?.values?.length||0);return g!==0?g:h2(h,m)})(n.mapValue,e.mapValue);case 11:return(function(s,c){if(s===Fm.mapValue&&c===Fm.mapValue)return 0;if(s===Fm.mapValue)return 1;if(c===Fm.mapValue)return-1;const l=s.fields||{},d=Object.keys(l),h=c.fields||{},m=Object.keys(h);d.sort(),m.sort();for(let g=0;g<d.length&&g<m.length;++g){const b=tx(d[g],m[g]);if(b!==0)return b;const _=cd(l[d[g]],h[m[g]]);if(_!==0)return _}return Dt(d.length,m.length)})(n.mapValue,e.mapValue);default:throw lt(23264,{he:t})}}function d2(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Dt(n,e);const t=mc(n),r=mc(e),i=Dt(t.seconds,r.seconds);return i!==0?i:Dt(t.nanos,r.nanos)}function h2(n,e){const t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){const s=cd(t[i],r[i]);if(s)return s}return Dt(t.length,r.length)}function ld(n){return nx(n)}function nx(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const r=mc(t);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return gc(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return nt.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let r="[",i=!0;for(const s of t.values||[])i?i=!1:r+=",",r+=nx(s);return r+"]"})(n.arrayValue):"mapValue"in n?(function(t){const r=Object.keys(t.fields||{}).sort();let i="{",s=!0;for(const c of r)s?s=!1:i+=",",i+=`${c}:${nx(t.fields[c])}`;return i+"}"})(n.mapValue):lt(61005,{value:n})}function fg(n){switch(vc(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Zv(n);return e?16+fg(e):16;case 5:return 2*n.stringValue.length;case 6:return gc(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((i,s)=>i+fg(s)),0)})(n.arrayValue);case 10:case 11:return(function(r){let i=0;return kc(r.fields,((s,c)=>{i+=s.length+fg(c)})),i})(n.mapValue);default:throw lt(13486,{value:n})}}function rv(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function rx(n){return!!n&&"integerValue"in n}function q_(n){return!!n&&"arrayValue"in n}function f2(n){return!!n&&"nullValue"in n}function p2(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function pg(n){return!!n&&"mapValue"in n}function U7(n){return(n?.mapValue?.fields||{})[CI]?.stringValue===wI}function uf(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return kc(n.mapValue.fields,((t,r)=>e.mapValue.fields[t]=uf(r))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=uf(n.arrayValue.values[t]);return e}return{...n}}function V7(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===L7}class li{constructor(e){this.value=e}static empty(){return new li({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!pg(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=uf(t)}setAll(e){let t=Cr.emptyPath(),r={},i=[];e.forEach(((c,l)=>{if(!t.isImmediateParentOf(l)){const d=this.getFieldsMap(t);this.applyChanges(d,r,i),r={},i=[],t=l.popLast()}c?r[l.lastSegment()]=uf(c):i.push(l.lastSegment())}));const s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){const t=this.field(e.popLast());pg(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return na(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];pg(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){kc(t,((i,s)=>e[i]=s));for(const i of r)delete e[i]}clone(){return new li(uf(this.value))}}function EI(n){const e=[];return kc(n.fields,((t,r)=>{const i=new Cr([t]);if(pg(r)){const s=EI(r.mapValue).fields;if(s.length===0)e.push(i);else for(const c of s)e.push(i.child(c))}else e.push(i)})),new Ri(e)}class Or{constructor(e,t,r,i,s,c,l){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=c,this.documentState=l}static newInvalidDocument(e){return new Or(e,0,ft.min(),ft.min(),ft.min(),li.empty(),0)}static newFoundDocument(e,t,r,i){return new Or(e,1,t,ft.min(),r,i,0)}static newNoDocument(e,t){return new Or(e,2,t,ft.min(),ft.min(),li.empty(),0)}static newUnknownDocument(e,t){return new Or(e,3,t,ft.min(),ft.min(),li.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ft.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=li.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=li.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ft.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Or&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Or(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class ud{constructor(e,t){this.position=e,this.inclusive=t}}function m2(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){const s=e[i],c=n.position[i];if(s.field.isKeyField()?r=nt.comparator(nt.fromName(c.referenceValue),t.key):r=cd(c,t.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function g2(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!na(n.position[t],e.position[t]))return!1;return!0}class Cf{constructor(e,t="asc"){this.field=e,this.dir=t}}function z7(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class RI{}class Zn extends RI{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new B7(e,t,r):t==="array-contains"?new H7(e,r):t==="in"?new G7(e,r):t==="not-in"?new K7(e,r):t==="array-contains-any"?new W7(e,r):new Zn(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new $7(e,r):new q7(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(cd(t,this.value)):t!==null&&vc(this.value)===vc(t)&&this.matchesComparison(cd(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return lt(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class xs extends RI{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new xs(e,t)}matches(e){return AI(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function AI(n){return n.op==="and"}function NI(n){return F7(n)&&AI(n)}function F7(n){for(const e of n.filters)if(e instanceof xs)return!1;return!0}function ix(n){if(n instanceof Zn)return n.field.canonicalString()+n.op.toString()+ld(n.value);if(NI(n))return n.filters.map((e=>ix(e))).join(",");{const e=n.filters.map((t=>ix(t))).join(",");return`${n.op}(${e})`}}function II(n,e){return n instanceof Zn?(function(r,i){return i instanceof Zn&&r.op===i.op&&r.field.isEqual(i.field)&&na(r.value,i.value)})(n,e):n instanceof xs?(function(r,i){return i instanceof xs&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce(((s,c,l)=>s&&II(c,i.filters[l])),!0):!1})(n,e):void lt(19439)}function PI(n){return n instanceof Zn?(function(t){return`${t.field.canonicalString()} ${t.op} ${ld(t.value)}`})(n):n instanceof xs?(function(t){return t.op.toString()+" {"+t.getFilters().map(PI).join(" ,")+"}"})(n):"Filter"}class B7 extends Zn{constructor(e,t,r){super(e,t,r),this.key=nt.fromName(r.referenceValue)}matches(e){const t=nt.comparator(e.key,this.key);return this.matchesComparison(t)}}class $7 extends Zn{constructor(e,t){super(e,"in",t),this.keys=MI("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class q7 extends Zn{constructor(e,t){super(e,"not-in",t),this.keys=MI("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function MI(n,e){return(e.arrayValue?.values||[]).map((t=>nt.fromName(t.referenceValue)))}class H7 extends Zn{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return q_(t)&&kf(t.arrayValue,this.value)}}class G7 extends Zn{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&kf(this.value.arrayValue,t)}}class K7 extends Zn{constructor(e,t){super(e,"not-in",t)}matches(e){if(kf(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!kf(this.value.arrayValue,t)}}class W7 extends Zn{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!q_(t)||!t.arrayValue.values)&&t.arrayValue.values.some((r=>kf(this.value.arrayValue,r)))}}class Y7{constructor(e,t=null,r=[],i=[],s=null,c=null,l=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=c,this.endAt=l,this.Te=null}}function v2(n,e=null,t=[],r=[],i=null,s=null,c=null){return new Y7(n,e,t,r,i,s,c)}function H_(n){const e=mt(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((r=>ix(r))).join(","),t+="|ob:",t+=e.orderBy.map((r=>(function(s){return s.field.canonicalString()+s.dir})(r))).join(","),Xv(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((r=>ld(r))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((r=>ld(r))).join(",")),e.Te=t}return e.Te}function G_(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!z7(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!II(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!g2(n.startAt,e.startAt)&&g2(n.endAt,e.endAt)}function sx(n){return nt.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}class Il{constructor(e,t=null,r=[],i=[],s=null,c="F",l=null,d=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=c,this.startAt=l,this.endAt=d,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function Q7(n,e,t,r,i,s,c,l){return new Il(n,e,t,r,i,s,c,l)}function e0(n){return new Il(n)}function y2(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function K_(n){return n.collectionGroup!==null}function Gu(n){const e=mt(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const s of e.explicitOrderBy)e.Ie.push(s),t.add(s.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(c){let l=new ar(Cr.comparator);return c.filters.forEach((d=>{d.getFlattenedFilters().forEach((h=>{h.isInequality()&&(l=l.add(h.field))}))})),l})(e).forEach((s=>{t.has(s.canonicalString())||s.isKeyField()||e.Ie.push(new Cf(s,r))})),t.has(Cr.keyField().canonicalString())||e.Ie.push(new Cf(Cr.keyField(),r))}return e.Ie}function Qs(n){const e=mt(n);return e.Ee||(e.Ee=X7(e,Gu(n))),e.Ee}function X7(n,e){if(n.limitType==="F")return v2(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((i=>{const s=i.dir==="desc"?"asc":"desc";return new Cf(i.field,s)}));const t=n.endAt?new ud(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new ud(n.startAt.position,n.startAt.inclusive):null;return v2(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function ax(n,e){const t=n.filters.concat([e]);return new Il(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function iv(n,e,t){return new Il(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function t0(n,e){return G_(Qs(n),Qs(e))&&n.limitType===e.limitType}function DI(n){return`${H_(Qs(n))}|lt:${n.limitType}`}function Du(n){return`Query(target=${(function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map((i=>PI(i))).join(", ")}]`),Xv(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map((i=>(function(c){return`${c.field.canonicalString()} (${c.dir})`})(i))).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map((i=>ld(i))).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map((i=>ld(i))).join(",")),`Target(${r})`})(Qs(n))}; limitType=${n.limitType})`}function n0(n,e){return e.isFoundDocument()&&(function(r,i){const s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):nt.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)})(n,e)&&(function(r,i){for(const s of Gu(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0})(n,e)&&(function(r,i){for(const s of r.filters)if(!s.matches(i))return!1;return!0})(n,e)&&(function(r,i){return!(r.startAt&&!(function(c,l,d){const h=m2(c,l,d);return c.inclusive?h<=0:h<0})(r.startAt,Gu(r),i)||r.endAt&&!(function(c,l,d){const h=m2(c,l,d);return c.inclusive?h>=0:h>0})(r.endAt,Gu(r),i))})(n,e)}function J7(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function OI(n){return(e,t)=>{let r=!1;for(const i of Gu(n)){const s=Z7(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function Z7(n,e,t){const r=n.field.isKeyField()?nt.comparator(e.key,t.key):(function(s,c,l){const d=c.data.field(s),h=l.data.field(s);return d!==null&&h!==null?cd(d,h):lt(42886)})(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return lt(19790,{direction:n.dir})}}class Pl{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){kc(this.inner,((t,r)=>{for(const[i,s]of r)e(i,s)}))}isEmpty(){return bI(this.inner)}size(){return this.innerSize}}const eV=new kn(nt.comparator);function Ja(){return eV}const jI=new kn(nt.comparator);function Zh(...n){let e=jI;for(const t of n)e=e.insert(t.key,t);return e}function LI(n){let e=jI;return n.forEach(((t,r)=>e=e.insert(t,r.overlayedDocument))),e}function ol(){return df()}function UI(){return df()}function df(){return new Pl((n=>n.toString()),((n,e)=>n.isEqual(e)))}const tV=new kn(nt.comparator),nV=new ar(nt.comparator);function Ot(...n){let e=nV;for(const t of n)e=e.add(t);return e}const rV=new ar(Dt);function iV(){return rV}function W_(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ev(e)?"-0":e}}function VI(n){return{integerValue:""+n}}function zI(n,e){return P7(e)?VI(e):W_(n,e)}class r0{constructor(){this._=void 0}}function sV(n,e,t){return n instanceof wf?(function(i,s){const c={fields:{[SI]:{stringValue:_I},[kI]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Jv(s)&&(s=Zv(s)),s&&(c.fields[TI]=s),{mapValue:c}})(t,e):n instanceof dd?BI(n,e):n instanceof hd?$I(n,e):(function(i,s){const c=FI(i,s),l=b2(c)+b2(i.Ae);return rx(c)&&rx(i.Ae)?VI(l):W_(i.serializer,l)})(n,e)}function aV(n,e,t){return n instanceof dd?BI(n,e):n instanceof hd?$I(n,e):t}function FI(n,e){return n instanceof Ef?(function(r){return rx(r)||(function(s){return!!s&&"doubleValue"in s})(r)})(e)?e:{integerValue:0}:null}class wf extends r0{}class dd extends r0{constructor(e){super(),this.elements=e}}function BI(n,e){const t=qI(e);for(const r of n.elements)t.some((i=>na(i,r)))||t.push(r);return{arrayValue:{values:t}}}class hd extends r0{constructor(e){super(),this.elements=e}}function $I(n,e){let t=qI(e);for(const r of n.elements)t=t.filter((i=>!na(i,r)));return{arrayValue:{values:t}}}class Ef extends r0{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function b2(n){return Un(n.integerValue||n.doubleValue)}function qI(n){return q_(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class i0{constructor(e,t){this.field=e,this.transform=t}}function oV(n,e){return n.field.isEqual(e.field)&&(function(r,i){return r instanceof dd&&i instanceof dd||r instanceof hd&&i instanceof hd?od(r.elements,i.elements,na):r instanceof Ef&&i instanceof Ef?na(r.Ae,i.Ae):r instanceof wf&&i instanceof wf})(n.transform,e.transform)}class cV{constructor(e,t){this.version=e,this.transformResults=t}}class qr{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new qr}static exists(e){return new qr(void 0,e)}static updateTime(e){return new qr(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function mg(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class s0{}function HI(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new a0(n.key,qr.none()):new np(n.key,n.data,qr.none());{const t=n.data,r=li.empty();let i=new ar(Cr.comparator);for(let s of e.fields)if(!i.has(s)){let c=t.field(s);c===null&&s.length>1&&(s=s.popLast(),c=t.field(s)),c===null?r.delete(s):r.set(s,c),i=i.add(s)}return new Cc(n.key,r,new Ri(i.toArray()),qr.none())}}function lV(n,e,t){n instanceof np?(function(i,s,c){const l=i.value.clone(),d=_2(i.fieldTransforms,s,c.transformResults);l.setAll(d),s.convertToFoundDocument(c.version,l).setHasCommittedMutations()})(n,e,t):n instanceof Cc?(function(i,s,c){if(!mg(i.precondition,s))return void s.convertToUnknownDocument(c.version);const l=_2(i.fieldTransforms,s,c.transformResults),d=s.data;d.setAll(GI(i)),d.setAll(l),s.convertToFoundDocument(c.version,d).setHasCommittedMutations()})(n,e,t):(function(i,s,c){s.convertToNoDocument(c.version).setHasCommittedMutations()})(0,e,t)}function hf(n,e,t,r){return n instanceof np?(function(s,c,l,d){if(!mg(s.precondition,c))return l;const h=s.value.clone(),m=S2(s.fieldTransforms,d,c);return h.setAll(m),c.convertToFoundDocument(c.version,h).setHasLocalMutations(),null})(n,e,t,r):n instanceof Cc?(function(s,c,l,d){if(!mg(s.precondition,c))return l;const h=S2(s.fieldTransforms,d,c),m=c.data;return m.setAll(GI(s)),m.setAll(h),c.convertToFoundDocument(c.version,m).setHasLocalMutations(),l===null?null:l.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map((g=>g.field)))})(n,e,t,r):(function(s,c,l){return mg(s.precondition,c)?(c.convertToNoDocument(c.version).setHasLocalMutations(),null):l})(n,e,t)}function uV(n,e){let t=null;for(const r of n.fieldTransforms){const i=e.data.field(r.field),s=FI(r.transform,i||null);s!=null&&(t===null&&(t=li.empty()),t.set(r.field,s))}return t||null}function x2(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&od(r,i,((s,c)=>oV(s,c)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class np extends s0{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class Cc extends s0{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function GI(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}})),e}function _2(n,e,t){const r=new Map;Wt(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let i=0;i<t.length;i++){const s=n[i],c=s.transform,l=e.data.field(s.field);r.set(s.field,aV(c,l,t[i]))}return r}function S2(n,e,t){const r=new Map;for(const i of n){const s=i.transform,c=t.data.field(i.field);r.set(i.field,sV(s,c,e))}return r}class a0 extends s0{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class dV extends s0{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class hV{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&lV(s,e,r[i])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=hf(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=hf(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=UI();return this.mutations.forEach((i=>{const s=e.get(i.key),c=s.overlayedDocument;let l=this.applyToLocalView(c,s.mutatedFields);l=t.has(i.key)?null:l;const d=HI(c,l);d!==null&&r.set(i.key,d),c.isValidDocument()||c.convertToNoDocument(ft.min())})),r}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),Ot())}isEqual(e){return this.batchId===e.batchId&&od(this.mutations,e.mutations,((t,r)=>x2(t,r)))&&od(this.baseMutations,e.baseMutations,((t,r)=>x2(t,r)))}}class Y_{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){Wt(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let i=(function(){return tV})();const s=e.mutations;for(let c=0;c<s.length;c++)i=i.insert(s[c].key,r[c].version);return new Y_(e,t,r,i)}}class fV{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class pV{constructor(e,t){this.count=e,this.unchangedNames=t}}var Wn,Ut;function mV(n){switch(n){case me.OK:return lt(64938);case me.CANCELLED:case me.UNKNOWN:case me.DEADLINE_EXCEEDED:case me.RESOURCE_EXHAUSTED:case me.INTERNAL:case me.UNAVAILABLE:case me.UNAUTHENTICATED:return!1;case me.INVALID_ARGUMENT:case me.NOT_FOUND:case me.ALREADY_EXISTS:case me.PERMISSION_DENIED:case me.FAILED_PRECONDITION:case me.ABORTED:case me.OUT_OF_RANGE:case me.UNIMPLEMENTED:case me.DATA_LOSS:return!0;default:return lt(15467,{code:n})}}function KI(n){if(n===void 0)return Xa("GRPC error has no .code"),me.UNKNOWN;switch(n){case Wn.OK:return me.OK;case Wn.CANCELLED:return me.CANCELLED;case Wn.UNKNOWN:return me.UNKNOWN;case Wn.DEADLINE_EXCEEDED:return me.DEADLINE_EXCEEDED;case Wn.RESOURCE_EXHAUSTED:return me.RESOURCE_EXHAUSTED;case Wn.INTERNAL:return me.INTERNAL;case Wn.UNAVAILABLE:return me.UNAVAILABLE;case Wn.UNAUTHENTICATED:return me.UNAUTHENTICATED;case Wn.INVALID_ARGUMENT:return me.INVALID_ARGUMENT;case Wn.NOT_FOUND:return me.NOT_FOUND;case Wn.ALREADY_EXISTS:return me.ALREADY_EXISTS;case Wn.PERMISSION_DENIED:return me.PERMISSION_DENIED;case Wn.FAILED_PRECONDITION:return me.FAILED_PRECONDITION;case Wn.ABORTED:return me.ABORTED;case Wn.OUT_OF_RANGE:return me.OUT_OF_RANGE;case Wn.UNIMPLEMENTED:return me.UNIMPLEMENTED;case Wn.DATA_LOSS:return me.DATA_LOSS;default:return lt(39323,{code:n})}}(Ut=Wn||(Wn={}))[Ut.OK=0]="OK",Ut[Ut.CANCELLED=1]="CANCELLED",Ut[Ut.UNKNOWN=2]="UNKNOWN",Ut[Ut.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ut[Ut.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ut[Ut.NOT_FOUND=5]="NOT_FOUND",Ut[Ut.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ut[Ut.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ut[Ut.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ut[Ut.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ut[Ut.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ut[Ut.ABORTED=10]="ABORTED",Ut[Ut.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ut[Ut.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ut[Ut.INTERNAL=13]="INTERNAL",Ut[Ut.UNAVAILABLE=14]="UNAVAILABLE",Ut[Ut.DATA_LOSS=15]="DATA_LOSS";function gV(){return new TextEncoder}const vV=new ac([4294967295,4294967295],0);function T2(n){const e=gV().encode(n),t=new cI;return t.update(e),new Uint8Array(t.digest())}function k2(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new ac([t,r],0),new ac([i,s],0)]}class Q_{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new ef(`Invalid padding: ${t}`);if(r<0)throw new ef(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new ef(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new ef(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=ac.fromNumber(this.ge)}ye(e,t,r){let i=e.add(t.multiply(ac.fromNumber(r)));return i.compare(vV)===1&&(i=new ac([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=T2(e),[r,i]=k2(t);for(let s=0;s<this.hashCount;s++){const c=this.ye(r,i,s);if(!this.we(c))return!1}return!0}static create(e,t,r){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),c=new Q_(s,i,t);return r.forEach((l=>c.insert(l))),c}insert(e){if(this.ge===0)return;const t=T2(e),[r,i]=k2(t);for(let s=0;s<this.hashCount;s++){const c=this.ye(r,i,s);this.Se(c)}}Se(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class ef extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class o0{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const i=new Map;return i.set(e,rp.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new o0(ft.min(),i,new kn(Dt),Ja(),Ot())}}class rp{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new rp(r,t,Ot(),Ot(),Ot())}}class gg{constructor(e,t,r,i){this.be=e,this.removedTargetIds=t,this.key=r,this.De=i}}class WI{constructor(e,t){this.targetId=e,this.Ce=t}}class YI{constructor(e,t,r=Rr.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}}class C2{constructor(){this.ve=0,this.Fe=w2(),this.Me=Rr.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Ot(),t=Ot(),r=Ot();return this.Fe.forEach(((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:lt(38017,{changeType:s})}})),new rp(this.Me,this.xe,e,t,r)}qe(){this.Oe=!1,this.Fe=w2()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,Wt(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class yV{constructor(e){this.Ge=e,this.ze=new Map,this.je=Ja(),this.Je=Bm(),this.He=Bm(),this.Ye=new kn(Dt)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:lt(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((r,i)=>{this.rt(i)&&t(i)}))}st(e){const t=e.targetId,r=e.Ce.count,i=this.ot(t);if(i){const s=i.target;if(sx(s))if(r===0){const c=new nt(s.path);this.et(t,c,Or.newNoDocument(c,ft.min()))}else Wt(r===1,20013,{expectedCount:r});else{const c=this._t(t);if(c!==r){const l=this.ut(e),d=l?this.ct(l,e,c):1;if(d!==0){this.it(t);const h=d===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,h)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t;let c,l;try{c=gc(r).toUint8Array()}catch(d){if(d instanceof xI)return ad("Decoding the base64 bloom filter in existence filter failed ("+d.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw d}try{l=new Q_(c,i,s)}catch(d){return ad(d instanceof ef?"BloomFilter error: ":"Applying bloom filter failed: ",d),null}return l.ge===0?null:l}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){const r=this.Ge.getRemoteKeysForTarget(t);let i=0;return r.forEach((s=>{const c=this.Ge.ht(),l=`projects/${c.projectId}/databases/${c.database}/documents/${s.path.canonicalString()}`;e.mightContain(l)||(this.et(t,s,null),i++)})),i}Tt(e){const t=new Map;this.ze.forEach(((s,c)=>{const l=this.ot(c);if(l){if(s.current&&sx(l.target)){const d=new nt(l.target.path);this.It(d).has(c)||this.Et(c,d)||this.et(c,d,Or.newNoDocument(d,e))}s.Be&&(t.set(c,s.ke()),s.qe())}}));let r=Ot();this.He.forEach(((s,c)=>{let l=!0;c.forEachWhile((d=>{const h=this.ot(d);return!h||h.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)})),l&&(r=r.add(s))})),this.je.forEach(((s,c)=>c.setReadTime(e)));const i=new o0(e,t,this.Ye,this.je,r);return this.je=Ja(),this.Je=Bm(),this.He=Bm(),this.Ye=new kn(Dt),i}Xe(e,t){if(!this.rt(e))return;const r=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,r),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;const i=this.nt(e);this.Et(e,t)?i.Qe(t,1):i.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new C2,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new ar(Dt),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new ar(Dt),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||We("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new C2),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function Bm(){return new kn(nt.comparator)}function w2(){return new kn(nt.comparator)}const bV={asc:"ASCENDING",desc:"DESCENDING"},xV={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},_V={and:"AND",or:"OR"};class SV{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function ox(n,e){return n.useProto3Json||Xv(e)?e:{value:e}}function sv(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function QI(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function TV(n,e){return sv(n,e.toTimestamp())}function Xs(n){return Wt(!!n,49232),ft.fromTimestamp((function(t){const r=mc(t);return new pr(r.seconds,r.nanos)})(n))}function X_(n,e){return cx(n,e).canonicalString()}function cx(n,e){const t=(function(i){return new cn(["projects",i.projectId,"databases",i.database])})(n).child("documents");return e===void 0?t:t.child(e)}function XI(n){const e=cn.fromString(n);return Wt(nP(e),10190,{key:e.toString()}),e}function lx(n,e){return X_(n.databaseId,e.path)}function Xb(n,e){const t=XI(e);if(t.get(1)!==n.databaseId.projectId)throw new Ue(me.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new Ue(me.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new nt(ZI(t))}function JI(n,e){return X_(n.databaseId,e)}function kV(n){const e=XI(n);return e.length===4?cn.emptyPath():ZI(e)}function ux(n){return new cn(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function ZI(n){return Wt(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function E2(n,e,t){return{name:lx(n,e),fields:t.value.mapValue.fields}}function CV(n,e){let t;if("targetChange"in e){e.targetChange;const r=(function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:lt(39313,{state:h})})(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=(function(h,m){return h.useProto3Json?(Wt(m===void 0||typeof m=="string",58123),Rr.fromBase64String(m||"")):(Wt(m===void 0||m instanceof Buffer||m instanceof Uint8Array,16193),Rr.fromUint8Array(m||new Uint8Array))})(n,e.targetChange.resumeToken),c=e.targetChange.cause,l=c&&(function(h){const m=h.code===void 0?me.UNKNOWN:KI(h.code);return new Ue(m,h.message||"")})(c);t=new YI(r,i,s,l||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=Xb(n,r.document.name),s=Xs(r.document.updateTime),c=r.document.createTime?Xs(r.document.createTime):ft.min(),l=new li({mapValue:{fields:r.document.fields}}),d=Or.newFoundDocument(i,s,c,l),h=r.targetIds||[],m=r.removedTargetIds||[];t=new gg(h,m,d.key,d)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=Xb(n,r.document),s=r.readTime?Xs(r.readTime):ft.min(),c=Or.newNoDocument(i,s),l=r.removedTargetIds||[];t=new gg([],l,c.key,c)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=Xb(n,r.document),s=r.removedTargetIds||[];t=new gg([],s,i,null)}else{if(!("filter"in e))return lt(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:i=0,unchangedNames:s}=r,c=new pV(i,s),l=r.targetId;t=new WI(l,c)}}return t}function wV(n,e){let t;if(e instanceof np)t={update:E2(n,e.key,e.value)};else if(e instanceof a0)t={delete:lx(n,e.key)};else if(e instanceof Cc)t={update:E2(n,e.key,e.data),updateMask:OV(e.fieldMask)};else{if(!(e instanceof dV))return lt(16599,{Vt:e.type});t={verify:lx(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((r=>(function(s,c){const l=c.transform;if(l instanceof wf)return{fieldPath:c.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof dd)return{fieldPath:c.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof hd)return{fieldPath:c.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof Ef)return{fieldPath:c.field.canonicalString(),increment:l.Ae};throw lt(20930,{transform:c.transform})})(0,r)))),e.precondition.isNone||(t.currentDocument=(function(i,s){return s.updateTime!==void 0?{updateTime:TV(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:lt(27497)})(n,e.precondition)),t}function EV(n,e){return n&&n.length>0?(Wt(e!==void 0,14353),n.map((t=>(function(i,s){let c=i.updateTime?Xs(i.updateTime):Xs(s);return c.isEqual(ft.min())&&(c=Xs(s)),new cV(c,i.transformResults||[])})(t,e)))):[]}function RV(n,e){return{documents:[JI(n,e.path)]}}function AV(n,e){const t={structuredQuery:{}},r=e.path;let i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=JI(n,i);const s=(function(h){if(h.length!==0)return tP(xs.create(h,"and"))})(e.filters);s&&(t.structuredQuery.where=s);const c=(function(h){if(h.length!==0)return h.map((m=>(function(b){return{field:Ou(b.field),direction:PV(b.dir)}})(m)))})(e.orderBy);c&&(t.structuredQuery.orderBy=c);const l=ox(n,e.limit);return l!==null&&(t.structuredQuery.limit=l),e.startAt&&(t.structuredQuery.startAt=(function(h){return{before:h.inclusive,values:h.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(h){return{before:!h.inclusive,values:h.position}})(e.endAt)),{ft:t,parent:i}}function NV(n){let e=kV(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let i=null;if(r>0){Wt(r===1,65062);const m=t.from[0];m.allDescendants?i=m.collectionId:e=e.child(m.collectionId)}let s=[];t.where&&(s=(function(g){const b=eP(g);return b instanceof xs&&NI(b)?b.getFilters():[b]})(t.where));let c=[];t.orderBy&&(c=(function(g){return g.map((b=>(function(R){return new Cf(ju(R.field),(function(A){switch(A){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(R.direction))})(b)))})(t.orderBy));let l=null;t.limit&&(l=(function(g){let b;return b=typeof g=="object"?g.value:g,Xv(b)?null:b})(t.limit));let d=null;t.startAt&&(d=(function(g){const b=!!g.before,_=g.values||[];return new ud(_,b)})(t.startAt));let h=null;return t.endAt&&(h=(function(g){const b=!g.before,_=g.values||[];return new ud(_,b)})(t.endAt)),Q7(e,i,c,s,l,"F",d,h)}function IV(n,e){const t=(function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return lt(28987,{purpose:i})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function eP(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=ju(t.unaryFilter.field);return Zn.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=ju(t.unaryFilter.field);return Zn.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=ju(t.unaryFilter.field);return Zn.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const c=ju(t.unaryFilter.field);return Zn.create(c,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return lt(61313);default:return lt(60726)}})(n):n.fieldFilter!==void 0?(function(t){return Zn.create(ju(t.fieldFilter.field),(function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return lt(58110);default:return lt(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return xs.create(t.compositeFilter.filters.map((r=>eP(r))),(function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return lt(1026)}})(t.compositeFilter.op))})(n):lt(30097,{filter:n})}function PV(n){return bV[n]}function MV(n){return xV[n]}function DV(n){return _V[n]}function Ou(n){return{fieldPath:n.canonicalString()}}function ju(n){return Cr.fromServerFormat(n.fieldPath)}function tP(n){return n instanceof Zn?(function(t){if(t.op==="=="){if(p2(t.value))return{unaryFilter:{field:Ou(t.field),op:"IS_NAN"}};if(f2(t.value))return{unaryFilter:{field:Ou(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(p2(t.value))return{unaryFilter:{field:Ou(t.field),op:"IS_NOT_NAN"}};if(f2(t.value))return{unaryFilter:{field:Ou(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ou(t.field),op:MV(t.op),value:t.value}}})(n):n instanceof xs?(function(t){const r=t.getFilters().map((i=>tP(i)));return r.length===1?r[0]:{compositeFilter:{op:DV(t.op),filters:r}}})(n):lt(54877,{filter:n})}function OV(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function nP(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}class Zo{constructor(e,t,r,i,s=ft.min(),c=ft.min(),l=Rr.EMPTY_BYTE_STRING,d=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=c,this.resumeToken=l,this.expectedCount=d}withSequenceNumber(e){return new Zo(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Zo(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Zo(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Zo(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class jV{constructor(e){this.yt=e}}function LV(n){const e=NV({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?iv(e,e.limit,"L"):e}class UV{constructor(){this.Cn=new VV}addToCollectionParentIndex(e,t){return this.Cn.add(t),Ee.resolve()}getCollectionParents(e,t){return Ee.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return Ee.resolve()}deleteFieldIndex(e,t){return Ee.resolve()}deleteAllFieldIndexes(e){return Ee.resolve()}createTargetIndexes(e,t){return Ee.resolve()}getDocumentsMatchingTarget(e,t){return Ee.resolve(null)}getIndexType(e,t){return Ee.resolve(0)}getFieldIndexes(e,t){return Ee.resolve([])}getNextCollectionGroupToUpdate(e){return Ee.resolve(null)}getMinOffset(e,t){return Ee.resolve(pc.min())}getMinOffsetFromCollectionGroup(e,t){return Ee.resolve(pc.min())}updateCollectionGroup(e,t,r){return Ee.resolve()}updateIndexEntries(e,t){return Ee.resolve()}}class VV{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new ar(cn.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new ar(cn.comparator)).toArray()}}const R2={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},rP=41943040;class ai{static withCacheSize(e){return new ai(e,ai.DEFAULT_COLLECTION_PERCENTILE,ai.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}ai.DEFAULT_COLLECTION_PERCENTILE=10,ai.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ai.DEFAULT=new ai(rP,ai.DEFAULT_COLLECTION_PERCENTILE,ai.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ai.DISABLED=new ai(-1,0,0);class fd{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new fd(0)}static cr(){return new fd(-1)}}const A2="LruGarbageCollector",zV=1048576;function N2([n,e],[t,r]){const i=Dt(n,t);return i===0?Dt(e,r):i}class FV{constructor(e){this.Ir=e,this.buffer=new ar(N2),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();N2(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class BV{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){We(A2,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Nd(t)?We(A2,"Ignoring IndexedDB error during garbage collection: ",t):await Ad(t)}await this.Vr(3e5)}))}}class $V{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((r=>Math.floor(t/100*r)))}nthSequenceNumber(e,t){if(t===0)return Ee.resolve(Qv.ce);const r=new FV(t);return this.mr.forEachTarget(e,(i=>r.Ar(i.sequenceNumber))).next((()=>this.mr.pr(e,(i=>r.Ar(i))))).next((()=>r.maxValue))}removeTargets(e,t,r){return this.mr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(We("LruGarbageCollector","Garbage collection skipped; disabled"),Ee.resolve(R2)):this.getCacheSize(e).next((r=>r<this.params.cacheSizeCollectionThreshold?(We("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),R2):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let r,i,s,c,l,d,h;const m=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((g=>(g>this.params.maximumSequenceNumbersToCollect?(We("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${g}`),i=this.params.maximumSequenceNumbersToCollect):i=g,c=Date.now(),this.nthSequenceNumber(e,i)))).next((g=>(r=g,l=Date.now(),this.removeTargets(e,r,t)))).next((g=>(s=g,d=Date.now(),this.removeOrphanedDocuments(e,r)))).next((g=>(h=Date.now(),Mu()<=Mt.DEBUG&&We("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${c-m}ms
	Determined least recently used ${i} in `+(l-c)+`ms
	Removed ${s} targets in `+(d-l)+`ms
	Removed ${g} documents in `+(h-d)+`ms
Total Duration: ${h-m}ms`),Ee.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:g}))))}}function qV(n,e){return new $V(n,e)}class HV{constructor(){this.changes=new Pl((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Or.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?Ee.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class GV{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class KV{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next((i=>(r=i,this.remoteDocumentCache.getEntry(e,t)))).next((i=>(r!==null&&hf(r.mutation,i,Ri.empty(),pr.now()),i)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.getLocalViewOfDocuments(e,r,Ot()).next((()=>r))))}getLocalViewOfDocuments(e,t,r=Ot()){const i=ol();return this.populateOverlays(e,i,t).next((()=>this.computeViews(e,t,i,r).next((s=>{let c=Zh();return s.forEach(((l,d)=>{c=c.insert(l,d.overlayedDocument)})),c}))))}getOverlayedDocuments(e,t){const r=ol();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,Ot())))}populateOverlays(e,t,r){const i=[];return r.forEach((s=>{t.has(s)||i.push(s)})),this.documentOverlayCache.getOverlays(e,i).next((s=>{s.forEach(((c,l)=>{t.set(c,l)}))}))}computeViews(e,t,r,i){let s=Ja();const c=df(),l=(function(){return df()})();return t.forEach(((d,h)=>{const m=r.get(h.key);i.has(h.key)&&(m===void 0||m.mutation instanceof Cc)?s=s.insert(h.key,h):m!==void 0?(c.set(h.key,m.mutation.getFieldMask()),hf(m.mutation,h,m.mutation.getFieldMask(),pr.now())):c.set(h.key,Ri.empty())})),this.recalculateAndSaveOverlays(e,s).next((d=>(d.forEach(((h,m)=>c.set(h,m))),t.forEach(((h,m)=>l.set(h,new GV(m,c.get(h)??null)))),l)))}recalculateAndSaveOverlays(e,t){const r=df();let i=new kn(((c,l)=>c-l)),s=Ot();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((c=>{for(const l of c)l.keys().forEach((d=>{const h=t.get(d);if(h===null)return;let m=r.get(d)||Ri.empty();m=l.applyToLocalView(h,m),r.set(d,m);const g=(i.get(l.batchId)||Ot()).add(d);i=i.insert(l.batchId,g)}))})).next((()=>{const c=[],l=i.getReverseIterator();for(;l.hasNext();){const d=l.getNext(),h=d.key,m=d.value,g=UI();m.forEach((b=>{if(!s.has(b)){const _=HI(t.get(b),r.get(b));_!==null&&g.set(b,_),s=s.add(b)}})),c.push(this.documentOverlayCache.saveOverlays(e,h,g))}return Ee.waitFor(c)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.recalculateAndSaveOverlays(e,r)))}getDocumentsMatchingQuery(e,t,r,i){return(function(c){return nt.isDocumentKey(c.path)&&c.collectionGroup===null&&c.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):K_(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next((s=>{const c=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):Ee.resolve(ol());let l=_f,d=s;return c.next((h=>Ee.forEach(h,((m,g)=>(l<g.largestBatchId&&(l=g.largestBatchId),s.get(m)?Ee.resolve():this.remoteDocumentCache.getEntry(e,m).next((b=>{d=d.insert(m,b)}))))).next((()=>this.populateOverlays(e,h,s))).next((()=>this.computeViews(e,d,h,Ot()))).next((m=>({batchId:l,changes:LI(m)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new nt(t)).next((r=>{let i=Zh();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i}))}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){const s=t.collectionGroup;let c=Zh();return this.indexManager.getCollectionParents(e,s).next((l=>Ee.forEach(l,(d=>{const h=(function(g,b){return new Il(b,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt)})(t,d.child(s));return this.getDocumentsMatchingCollectionQuery(e,h,r,i).next((m=>{m.forEach(((g,b)=>{c=c.insert(g,b)}))}))})).next((()=>c))))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next((c=>(s=c,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i)))).next((c=>{s.forEach(((d,h)=>{const m=h.getKey();c.get(m)===null&&(c=c.insert(m,Or.newInvalidDocument(m)))}));let l=Zh();return c.forEach(((d,h)=>{const m=s.get(d);m!==void 0&&hf(m.mutation,h,Ri.empty(),pr.now()),n0(t,h)&&(l=l.insert(d,h))})),l}))}}class WV{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return Ee.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(i){return{id:i.id,version:i.version,createTime:Xs(i.createTime)}})(t)),Ee.resolve()}getNamedQuery(e,t){return Ee.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(i){return{name:i.name,query:LV(i.bundledQuery),readTime:Xs(i.readTime)}})(t)),Ee.resolve()}}class YV{constructor(){this.overlays=new kn(nt.comparator),this.qr=new Map}getOverlay(e,t){return Ee.resolve(this.overlays.get(t))}getOverlays(e,t){const r=ol();return Ee.forEach(t,(i=>this.getOverlay(e,i).next((s=>{s!==null&&r.set(i,s)})))).next((()=>r))}saveOverlays(e,t,r){return r.forEach(((i,s)=>{this.St(e,t,s)})),Ee.resolve()}removeOverlaysForBatchId(e,t,r){const i=this.qr.get(r);return i!==void 0&&(i.forEach((s=>this.overlays=this.overlays.remove(s))),this.qr.delete(r)),Ee.resolve()}getOverlaysForCollection(e,t,r){const i=ol(),s=t.length+1,c=new nt(t.child("")),l=this.overlays.getIteratorFrom(c);for(;l.hasNext();){const d=l.getNext().value,h=d.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===s&&d.largestBatchId>r&&i.set(d.getKey(),d)}return Ee.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new kn(((h,m)=>h-m));const c=this.overlays.getIterator();for(;c.hasNext();){const h=c.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>r){let m=s.get(h.largestBatchId);m===null&&(m=ol(),s=s.insert(h.largestBatchId,m)),m.set(h.getKey(),h)}}const l=ol(),d=s.getIterator();for(;d.hasNext()&&(d.getNext().value.forEach(((h,m)=>l.set(h,m))),!(l.size()>=i)););return Ee.resolve(l)}St(e,t,r){const i=this.overlays.get(r.key);if(i!==null){const c=this.qr.get(i.largestBatchId).delete(r.key);this.qr.set(i.largestBatchId,c)}this.overlays=this.overlays.insert(r.key,new fV(t,r));let s=this.qr.get(t);s===void 0&&(s=Ot(),this.qr.set(t,s)),this.qr.set(t,s.add(r.key))}}class QV{constructor(){this.sessionToken=Rr.EMPTY_BYTE_STRING}getSessionToken(e){return Ee.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,Ee.resolve()}}class J_{constructor(){this.Qr=new ar(ur.$r),this.Ur=new ar(ur.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const r=new ur(e,t);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,t){e.forEach((r=>this.addReference(r,t)))}removeReference(e,t){this.Gr(new ur(e,t))}zr(e,t){e.forEach((r=>this.removeReference(r,t)))}jr(e){const t=new nt(new cn([])),r=new ur(t,e),i=new ur(t,e+1),s=[];return this.Ur.forEachInRange([r,i],(c=>{this.Gr(c),s.push(c.key)})),s}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new nt(new cn([])),r=new ur(t,e),i=new ur(t,e+1);let s=Ot();return this.Ur.forEachInRange([r,i],(c=>{s=s.add(c.key)})),s}containsKey(e){const t=new ur(e,0),r=this.Qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class ur{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return nt.comparator(e.key,t.key)||Dt(e.Yr,t.Yr)}static Kr(e,t){return Dt(e.Yr,t.Yr)||nt.comparator(e.key,t.key)}}class XV{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new ar(ur.$r)}checkEmpty(e){return Ee.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){const s=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const c=new hV(s,t,r,i);this.mutationQueue.push(c);for(const l of i)this.Zr=this.Zr.add(new ur(l.key,s)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return Ee.resolve(c)}lookupMutationBatch(e,t){return Ee.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,i=this.ei(r),s=i<0?0:i;return Ee.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return Ee.resolve(this.mutationQueue.length===0?$_:this.tr-1)}getAllMutationBatches(e){return Ee.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new ur(t,0),i=new ur(t,Number.POSITIVE_INFINITY),s=[];return this.Zr.forEachInRange([r,i],(c=>{const l=this.Xr(c.Yr);s.push(l)})),Ee.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ar(Dt);return t.forEach((i=>{const s=new ur(i,0),c=new ur(i,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([s,c],(l=>{r=r.add(l.Yr)}))})),Ee.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1;let s=r;nt.isDocumentKey(s)||(s=s.child(""));const c=new ur(new nt(s),0);let l=new ar(Dt);return this.Zr.forEachWhile((d=>{const h=d.key.path;return!!r.isPrefixOf(h)&&(h.length===i&&(l=l.add(d.Yr)),!0)}),c),Ee.resolve(this.ti(l))}ti(e){const t=[];return e.forEach((r=>{const i=this.Xr(r);i!==null&&t.push(i)})),t}removeMutationBatch(e,t){Wt(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return Ee.forEach(t.mutations,(i=>{const s=new ur(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)})).next((()=>{this.Zr=r}))}ir(e){}containsKey(e,t){const r=new ur(t,0),i=this.Zr.firstAfterOrEqual(r);return Ee.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,Ee.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class JV{constructor(e){this.ri=e,this.docs=(function(){return new kn(nt.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,i=this.docs.get(r),s=i?i.size:0,c=this.ri(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:c}),this.size+=c-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return Ee.resolve(r?r.document.mutableCopy():Or.newInvalidDocument(t))}getEntries(e,t){let r=Ja();return t.forEach((i=>{const s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Or.newInvalidDocument(i))})),Ee.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=Ja();const c=t.path,l=new nt(c.child("__id-9223372036854775808__")),d=this.docs.getIteratorFrom(l);for(;d.hasNext();){const{key:h,value:{document:m}}=d.getNext();if(!c.isPrefixOf(h.path))break;h.path.length>c.length+1||R7(E7(m),r)<=0||(i.has(m.key)||n0(t,m))&&(s=s.insert(m.key,m.mutableCopy()))}return Ee.resolve(s)}getAllFromCollectionGroup(e,t,r,i){lt(9500)}ii(e,t){return Ee.forEach(this.docs,(r=>t(r)))}newChangeBuffer(e){return new ZV(this)}getSize(e){return Ee.resolve(this.size)}}class ZV extends HV{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach(((r,i)=>{i.isValidDocument()?t.push(this.Nr.addEntry(e,i)):this.Nr.removeEntry(r)})),Ee.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class ez{constructor(e){this.persistence=e,this.si=new Pl((t=>H_(t)),G_),this.lastRemoteSnapshotVersion=ft.min(),this.highestTargetId=0,this.oi=0,this._i=new J_,this.targetCount=0,this.ai=fd.ur()}forEachTarget(e,t){return this.si.forEach(((r,i)=>t(i))),Ee.resolve()}getLastRemoteSnapshotVersion(e){return Ee.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Ee.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),Ee.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.oi&&(this.oi=t),Ee.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new fd(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,Ee.resolve()}updateTargetData(e,t){return this.Pr(t),Ee.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,Ee.resolve()}removeTargets(e,t,r){let i=0;const s=[];return this.si.forEach(((c,l)=>{l.sequenceNumber<=t&&r.get(l.targetId)===null&&(this.si.delete(c),s.push(this.removeMatchingKeysForTargetId(e,l.targetId)),i++)})),Ee.waitFor(s).next((()=>i))}getTargetCount(e){return Ee.resolve(this.targetCount)}getTargetData(e,t){const r=this.si.get(t)||null;return Ee.resolve(r)}addMatchingKeys(e,t,r){return this._i.Wr(t,r),Ee.resolve()}removeMatchingKeys(e,t,r){this._i.zr(t,r);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach((c=>{s.push(i.markPotentiallyOrphaned(e,c))})),Ee.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),Ee.resolve()}getMatchingKeysForTargetId(e,t){const r=this._i.Hr(t);return Ee.resolve(r)}containsKey(e,t){return Ee.resolve(this._i.containsKey(t))}}class iP{constructor(e,t){this.ui={},this.overlays={},this.ci=new Qv(0),this.li=!1,this.li=!0,this.hi=new QV,this.referenceDelegate=e(this),this.Pi=new ez(this),this.indexManager=new UV,this.remoteDocumentCache=(function(i){return new JV(i)})((r=>this.referenceDelegate.Ti(r))),this.serializer=new jV(t),this.Ii=new WV(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new YV,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ui[e.toKey()];return r||(r=new XV(t,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,r){We("MemoryPersistence","Starting transaction:",e);const i=new tz(this.ci.next());return this.referenceDelegate.Ei(),r(i).next((s=>this.referenceDelegate.di(i).next((()=>s)))).toPromise().then((s=>(i.raiseOnCommittedEvent(),s)))}Ai(e,t){return Ee.or(Object.values(this.ui).map((r=>()=>r.containsKey(e,t))))}}class tz extends N7{constructor(e){super(),this.currentSequenceNumber=e}}class Z_{constructor(e){this.persistence=e,this.Ri=new J_,this.Vi=null}static mi(e){return new Z_(e)}get fi(){if(this.Vi)return this.Vi;throw lt(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.fi.delete(r.toString()),Ee.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.fi.add(r.toString()),Ee.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),Ee.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((i=>this.fi.add(i.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next((i=>{i.forEach((s=>this.fi.add(s.toString())))})).next((()=>r.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Ee.forEach(this.fi,(r=>{const i=nt.fromPath(r);return this.gi(e,i).next((s=>{s||t.removeEntry(i,ft.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((r=>{r?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return Ee.or([()=>Ee.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class av{constructor(e,t){this.persistence=e,this.pi=new Pl((r=>M7(r.path)),((r,i)=>r.isEqual(i))),this.garbageCollector=qV(this,t)}static mi(e,t){return new av(e,t)}Ei(){}di(e){return Ee.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((r=>t.next((i=>r+i))))}wr(e){let t=0;return this.pr(e,(r=>{t++})).next((()=>t))}pr(e,t){return Ee.forEach(this.pi,((r,i)=>this.br(e,r,i).next((s=>s?Ee.resolve():t(i)))))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.ii(e,(c=>this.br(e,c,t).next((l=>{l||(r++,s.removeEntry(c,ft.min()))})))).next((()=>s.apply(e))).next((()=>r))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),Ee.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),Ee.resolve()}removeReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),Ee.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),Ee.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=fg(e.data.value)),t}br(e,t,r){return Ee.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const i=this.pi.get(t);return Ee.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class eS{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.Es=r,this.ds=i}static As(e,t){let r=Ot(),i=Ot();for(const s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new eS(e,t.fromCache,r,i)}}class nz{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class rz{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return R9()?8:I7(jr())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,i){const s={result:null};return this.ys(e,t).next((c=>{s.result=c})).next((()=>{if(!s.result)return this.ws(e,t,i,r).next((c=>{s.result=c}))})).next((()=>{if(s.result)return;const c=new nz;return this.Ss(e,t,c).next((l=>{if(s.result=l,this.Vs)return this.bs(e,t,c,l.size)}))})).next((()=>s.result))}bs(e,t,r,i){return r.documentReadCount<this.fs?(Mu()<=Mt.DEBUG&&We("QueryEngine","SDK will not create cache indexes for query:",Du(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),Ee.resolve()):(Mu()<=Mt.DEBUG&&We("QueryEngine","Query:",Du(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.gs*i?(Mu()<=Mt.DEBUG&&We("QueryEngine","The SDK decides to create cache indexes for query:",Du(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Qs(t))):Ee.resolve())}ys(e,t){if(y2(t))return Ee.resolve(null);let r=Qs(t);return this.indexManager.getIndexType(e,r).next((i=>i===0?null:(t.limit!==null&&i===1&&(t=iv(t,null,"F"),r=Qs(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next((s=>{const c=Ot(...s);return this.ps.getDocuments(e,c).next((l=>this.indexManager.getMinOffset(e,r).next((d=>{const h=this.Ds(t,l);return this.Cs(t,h,c,d.readTime)?this.ys(e,iv(t,null,"F")):this.vs(e,h,t,d)}))))})))))}ws(e,t,r,i){return y2(t)||i.isEqual(ft.min())?Ee.resolve(null):this.ps.getDocuments(e,r).next((s=>{const c=this.Ds(t,s);return this.Cs(t,c,r,i)?Ee.resolve(null):(Mu()<=Mt.DEBUG&&We("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Du(t)),this.vs(e,c,t,w7(i,_f)).next((l=>l)))}))}Ds(e,t){let r=new ar(OI(e));return t.forEach(((i,s)=>{n0(e,s)&&(r=r.add(s))})),r}Cs(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Ss(e,t,r){return Mu()<=Mt.DEBUG&&We("QueryEngine","Using full collection scan to execute query:",Du(t)),this.ps.getDocumentsMatchingQuery(e,t,pc.min(),r)}vs(e,t,r,i){return this.ps.getDocumentsMatchingQuery(e,r,i).next((s=>(t.forEach((c=>{s=s.insert(c.key,c)})),s)))}}const tS="LocalStore",iz=3e8;class sz{constructor(e,t,r,i){this.persistence=e,this.Fs=t,this.serializer=i,this.Ms=new kn(Dt),this.xs=new Pl((s=>H_(s)),G_),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new KV(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}}function az(n,e,t,r){return new sz(n,e,t,r)}async function sP(n,e){const t=mt(n);return await t.persistence.runTransaction("Handle user change","readonly",(r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next((s=>(i=s,t.Bs(e),t.mutationQueue.getAllMutationBatches(r)))).next((s=>{const c=[],l=[];let d=Ot();for(const h of i){c.push(h.batchId);for(const m of h.mutations)d=d.add(m.key)}for(const h of s){l.push(h.batchId);for(const m of h.mutations)d=d.add(m.key)}return t.localDocuments.getDocuments(r,d).next((h=>({Ls:h,removedBatchIds:c,addedBatchIds:l})))}))}))}function oz(n,e){const t=mt(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const i=e.batch.keys(),s=t.Ns.newChangeBuffer({trackRemovals:!0});return(function(l,d,h,m){const g=h.batch,b=g.keys();let _=Ee.resolve();return b.forEach((R=>{_=_.next((()=>m.getEntry(d,R))).next((E=>{const A=h.docVersions.get(R);Wt(A!==null,48541),E.version.compareTo(A)<0&&(g.applyToRemoteDocument(E,h),E.isValidDocument()&&(E.setReadTime(h.commitVersion),m.addEntry(E)))}))})),_.next((()=>l.mutationQueue.removeMutationBatch(d,g)))})(t,r,e,s).next((()=>s.apply(r))).next((()=>t.mutationQueue.performConsistencyCheck(r))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(l){let d=Ot();for(let h=0;h<l.mutationResults.length;++h)l.mutationResults[h].transformResults.length>0&&(d=d.add(l.batch.mutations[h].key));return d})(e)))).next((()=>t.localDocuments.getDocuments(r,i)))}))}function aP(n){const e=mt(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Pi.getLastRemoteSnapshotVersion(t)))}function cz(n,e){const t=mt(n),r=e.snapshotVersion;let i=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(s=>{const c=t.Ns.newChangeBuffer({trackRemovals:!0});i=t.Ms;const l=[];e.targetChanges.forEach(((m,g)=>{const b=i.get(g);if(!b)return;l.push(t.Pi.removeMatchingKeys(s,m.removedDocuments,g).next((()=>t.Pi.addMatchingKeys(s,m.addedDocuments,g))));let _=b.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(g)!==null?_=_.withResumeToken(Rr.EMPTY_BYTE_STRING,ft.min()).withLastLimboFreeSnapshotVersion(ft.min()):m.resumeToken.approximateByteSize()>0&&(_=_.withResumeToken(m.resumeToken,r)),i=i.insert(g,_),(function(E,A,M){return E.resumeToken.approximateByteSize()===0||A.snapshotVersion.toMicroseconds()-E.snapshotVersion.toMicroseconds()>=iz?!0:M.addedDocuments.size+M.modifiedDocuments.size+M.removedDocuments.size>0})(b,_,m)&&l.push(t.Pi.updateTargetData(s,_))}));let d=Ja(),h=Ot();if(e.documentUpdates.forEach((m=>{e.resolvedLimboDocuments.has(m)&&l.push(t.persistence.referenceDelegate.updateLimboDocument(s,m))})),l.push(lz(s,c,e.documentUpdates).next((m=>{d=m.ks,h=m.qs}))),!r.isEqual(ft.min())){const m=t.Pi.getLastRemoteSnapshotVersion(s).next((g=>t.Pi.setTargetsMetadata(s,s.currentSequenceNumber,r)));l.push(m)}return Ee.waitFor(l).next((()=>c.apply(s))).next((()=>t.localDocuments.getLocalViewOfDocuments(s,d,h))).next((()=>d))})).then((s=>(t.Ms=i,s)))}function lz(n,e,t){let r=Ot(),i=Ot();return t.forEach((s=>r=r.add(s))),e.getEntries(n,r).next((s=>{let c=Ja();return t.forEach(((l,d)=>{const h=s.get(l);d.isFoundDocument()!==h.isFoundDocument()&&(i=i.add(l)),d.isNoDocument()&&d.version.isEqual(ft.min())?(e.removeEntry(l,d.readTime),c=c.insert(l,d)):!h.isValidDocument()||d.version.compareTo(h.version)>0||d.version.compareTo(h.version)===0&&h.hasPendingWrites?(e.addEntry(d),c=c.insert(l,d)):We(tS,"Ignoring outdated watch update for ",l,". Current version:",h.version," Watch version:",d.version)})),{ks:c,qs:i}}))}function uz(n,e){const t=mt(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(r=>(e===void 0&&(e=$_),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e))))}function dz(n,e){const t=mt(n);return t.persistence.runTransaction("Allocate target","readwrite",(r=>{let i;return t.Pi.getTargetData(r,e).next((s=>s?(i=s,Ee.resolve(i)):t.Pi.allocateTargetId(r).next((c=>(i=new Zo(e,c,"TargetPurposeListen",r.currentSequenceNumber),t.Pi.addTargetData(r,i).next((()=>i)))))))})).then((r=>{const i=t.Ms.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(r.targetId,r),t.xs.set(e,r.targetId)),r}))}async function dx(n,e,t){const r=mt(n),i=r.Ms.get(e),s=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",s,(c=>r.persistence.referenceDelegate.removeTarget(c,i)))}catch(c){if(!Nd(c))throw c;We(tS,`Failed to update sequence numbers for target ${e}: ${c}`)}r.Ms=r.Ms.remove(e),r.xs.delete(i.target)}function I2(n,e,t){const r=mt(n);let i=ft.min(),s=Ot();return r.persistence.runTransaction("Execute query","readwrite",(c=>(function(d,h,m){const g=mt(d),b=g.xs.get(m);return b!==void 0?Ee.resolve(g.Ms.get(b)):g.Pi.getTargetData(h,m)})(r,c,Qs(e)).next((l=>{if(l)return i=l.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(c,l.targetId).next((d=>{s=d}))})).next((()=>r.Fs.getDocumentsMatchingQuery(c,e,t?i:ft.min(),t?s:Ot()))).next((l=>(hz(r,J7(e),l),{documents:l,Qs:s})))))}function hz(n,e,t){let r=n.Os.get(e)||ft.min();t.forEach(((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)})),n.Os.set(e,r)}class P2{constructor(){this.activeTargetIds=iV()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class fz{constructor(){this.Mo=new P2,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,r){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new P2,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class pz{Oo(e){}shutdown(){}}const M2="ConnectivityMonitor";class D2{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){We(M2,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){We(M2,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let $m=null;function hx(){return $m===null?$m=(function(){return 268435456+Math.round(2147483648*Math.random())})():$m++,"0x"+$m.toString(16)}const Jb="RestConnection",mz={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class gz{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${r}/databases/${i}`,this.Wo=this.databaseId.database===tv?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Go(e,t,r,i,s){const c=hx(),l=this.zo(e,t.toUriEncodedString());We(Jb,`Sending RPC '${e}' ${c}:`,l,r);const d={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(d,i,s);const{host:h}=new URL(l),m=Rl(h);return this.Jo(e,l,d,r,m).then((g=>(We(Jb,`Received RPC '${e}' ${c}: `,g),g)),(g=>{throw ad(Jb,`RPC '${e}' ${c} failed with error: `,g,"url: ",l,"request:",r),g}))}Ho(e,t,r,i,s,c){return this.Go(e,t,r,i,s)}jo(e,t,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Rd})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((i,s)=>e[s]=i)),r&&r.headers.forEach(((i,s)=>e[s]=i))}zo(e,t){const r=mz[e];return`${this.Uo}/v1/${t}:${r}`}terminate(){}}class vz{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const Pr="WebChannelConnection";class yz extends gz{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,i,s){const c=hx();return new Promise(((l,d)=>{const h=new lI;h.setWithCredentials(!0),h.listenOnce(uI.COMPLETE,(()=>{try{switch(h.getLastErrorCode()){case hg.NO_ERROR:const g=h.getResponseJson();We(Pr,`XHR for RPC '${e}' ${c} received:`,JSON.stringify(g)),l(g);break;case hg.TIMEOUT:We(Pr,`RPC '${e}' ${c} timed out`),d(new Ue(me.DEADLINE_EXCEEDED,"Request time out"));break;case hg.HTTP_ERROR:const b=h.getStatus();if(We(Pr,`RPC '${e}' ${c} failed with status:`,b,"response text:",h.getResponseText()),b>0){let _=h.getResponseJson();Array.isArray(_)&&(_=_[0]);const R=_?.error;if(R&&R.status&&R.message){const E=(function(M){const F=M.toLowerCase().replace(/_/g,"-");return Object.values(me).indexOf(F)>=0?F:me.UNKNOWN})(R.status);d(new Ue(E,R.message))}else d(new Ue(me.UNKNOWN,"Server responded with status "+h.getStatus()))}else d(new Ue(me.UNAVAILABLE,"Connection failed."));break;default:lt(9055,{l_:e,streamId:c,h_:h.getLastErrorCode(),P_:h.getLastError()})}}finally{We(Pr,`RPC '${e}' ${c} completed.`)}}));const m=JSON.stringify(i);We(Pr,`RPC '${e}' ${c} sending request:`,i),h.send(t,"POST",m,r,15)}))}T_(e,t,r){const i=hx(),s=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],c=fI(),l=hI(),d={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(d.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(d.useFetchStreams=!0),this.jo(d.initMessageHeaders,t,r),d.encodeInitMessageHeaders=!0;const m=s.join("");We(Pr,`Creating RPC '${e}' stream ${i}: ${m}`,d);const g=c.createWebChannel(m,d);this.I_(g);let b=!1,_=!1;const R=new vz({Yo:A=>{_?We(Pr,`Not sending because RPC '${e}' stream ${i} is closed:`,A):(b||(We(Pr,`Opening RPC '${e}' stream ${i} transport.`),g.open(),b=!0),We(Pr,`RPC '${e}' stream ${i} sending:`,A),g.send(A))},Zo:()=>g.close()}),E=(A,M,F)=>{A.listen(M,(j=>{try{F(j)}catch(C){setTimeout((()=>{throw C}),0)}}))};return E(g,Jh.EventType.OPEN,(()=>{_||(We(Pr,`RPC '${e}' stream ${i} transport opened.`),R.o_())})),E(g,Jh.EventType.CLOSE,(()=>{_||(_=!0,We(Pr,`RPC '${e}' stream ${i} transport closed`),R.a_(),this.E_(g))})),E(g,Jh.EventType.ERROR,(A=>{_||(_=!0,ad(Pr,`RPC '${e}' stream ${i} transport errored. Name:`,A.name,"Message:",A.message),R.a_(new Ue(me.UNAVAILABLE,"The operation could not be completed")))})),E(g,Jh.EventType.MESSAGE,(A=>{if(!_){const M=A.data[0];Wt(!!M,16349);const F=M,j=F?.error||F[0]?.error;if(j){We(Pr,`RPC '${e}' stream ${i} received error:`,j);const C=j.status;let N=(function(k){const P=Wn[k];if(P!==void 0)return KI(P)})(C),D=j.message;N===void 0&&(N=me.INTERNAL,D="Unknown error status: "+C+" with message "+j.message),_=!0,R.a_(new Ue(N,D)),g.close()}else We(Pr,`RPC '${e}' stream ${i} received:`,M),R.u_(M)}})),E(l,dI.STAT_EVENT,(A=>{A.stat===ex.PROXY?We(Pr,`RPC '${e}' stream ${i} detected buffering proxy`):A.stat===ex.NOPROXY&&We(Pr,`RPC '${e}' stream ${i} detected no buffering proxy`)})),setTimeout((()=>{R.__()}),0),R}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}}function Zb(){return typeof document<"u"?document:null}function c0(n){return new SV(n,!0)}class oP{constructor(e,t,r=1e3,i=1.5,s=6e4){this.Mi=e,this.timerId=t,this.d_=r,this.A_=i,this.R_=s,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),i=Math.max(0,t-r);i>0&&We("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,i,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const O2="PersistentStream";class cP{constructor(e,t,r,i,s,c,l,d){this.Mi=e,this.S_=r,this.b_=i,this.connection=s,this.authCredentialsProvider=c,this.appCheckCredentialsProvider=l,this.listener=d,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new oP(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===me.RESOURCE_EXHAUSTED?(Xa(t.toString()),Xa("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===me.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,i])=>{this.D_===t&&this.G_(r,i)}),(r=>{e((()=>{const i=new Ue(me.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(i)}))}))}G_(e,t){const r=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{r((()=>this.listener.Xo()))})),this.stream.t_((()=>{r((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((i=>{r((()=>this.z_(i)))})),this.stream.onMessage((i=>{r((()=>++this.F_==1?this.J_(i):this.onNext(i)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return We(O2,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(We(O2,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class bz extends cP{constructor(e,t,r,i,s,c){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,c),this.serializer=s}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=CV(this.serializer,e),r=(function(s){if(!("targetChange"in s))return ft.min();const c=s.targetChange;return c.targetIds&&c.targetIds.length?ft.min():c.readTime?Xs(c.readTime):ft.min()})(e);return this.listener.H_(t,r)}Y_(e){const t={};t.database=ux(this.serializer),t.addTarget=(function(s,c){let l;const d=c.target;if(l=sx(d)?{documents:RV(s,d)}:{query:AV(s,d).ft},l.targetId=c.targetId,c.resumeToken.approximateByteSize()>0){l.resumeToken=QI(s,c.resumeToken);const h=ox(s,c.expectedCount);h!==null&&(l.expectedCount=h)}else if(c.snapshotVersion.compareTo(ft.min())>0){l.readTime=sv(s,c.snapshotVersion.toTimestamp());const h=ox(s,c.expectedCount);h!==null&&(l.expectedCount=h)}return l})(this.serializer,e);const r=IV(this.serializer,e);r&&(t.labels=r),this.q_(t)}Z_(e){const t={};t.database=ux(this.serializer),t.removeTarget=e,this.q_(t)}}class xz extends cP{constructor(e,t,r,i,s,c){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,c),this.serializer=s}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return Wt(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Wt(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){Wt(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=EV(e.writeResults,e.commitTime),r=Xs(e.commitTime);return this.listener.na(r,t)}ra(){const e={};e.database=ux(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((r=>wV(this.serializer,r)))};this.q_(t)}}class _z{}class Sz extends _z{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new Ue(me.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,c])=>this.connection.Go(e,cx(t,r),i,s,c))).catch((s=>{throw s.name==="FirebaseError"?(s.code===me.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new Ue(me.UNKNOWN,s.toString())}))}Ho(e,t,r,i,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([c,l])=>this.connection.Ho(e,cx(t,r),i,c,l,s))).catch((c=>{throw c.name==="FirebaseError"?(c.code===me.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),c):new Ue(me.UNKNOWN,c.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class Tz{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Xa(t),this.aa=!1):We("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const yl="RemoteStore";class kz{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=s,this.Aa.Oo((c=>{r.enqueueAndForget((async()=>{Ml(this)&&(We(yl,"Restarting streams for network reachability change."),await(async function(d){const h=mt(d);h.Ea.add(4),await ip(h),h.Ra.set("Unknown"),h.Ea.delete(4),await l0(h)})(this))}))})),this.Ra=new Tz(r,i)}}async function l0(n){if(Ml(n))for(const e of n.da)await e(!0)}async function ip(n){for(const e of n.da)await e(!1)}function lP(n,e){const t=mt(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),sS(t)?iS(t):Id(t).O_()&&rS(t,e))}function nS(n,e){const t=mt(n),r=Id(t);t.Ia.delete(e),r.O_()&&uP(t,e),t.Ia.size===0&&(r.O_()?r.L_():Ml(t)&&t.Ra.set("Unknown"))}function rS(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ft.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Id(n).Y_(e)}function uP(n,e){n.Va.Ue(e),Id(n).Z_(e)}function iS(n){n.Va=new yV({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),Id(n).start(),n.Ra.ua()}function sS(n){return Ml(n)&&!Id(n).x_()&&n.Ia.size>0}function Ml(n){return mt(n).Ea.size===0}function dP(n){n.Va=void 0}async function Cz(n){n.Ra.set("Online")}async function wz(n){n.Ia.forEach(((e,t)=>{rS(n,e)}))}async function Ez(n,e){dP(n),sS(n)?(n.Ra.ha(e),iS(n)):n.Ra.set("Unknown")}async function Rz(n,e,t){if(n.Ra.set("Online"),e instanceof YI&&e.state===2&&e.cause)try{await(async function(i,s){const c=s.cause;for(const l of s.targetIds)i.Ia.has(l)&&(await i.remoteSyncer.rejectListen(l,c),i.Ia.delete(l),i.Va.removeTarget(l))})(n,e)}catch(r){We(yl,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await ov(n,r)}else if(e instanceof gg?n.Va.Ze(e):e instanceof WI?n.Va.st(e):n.Va.tt(e),!t.isEqual(ft.min()))try{const r=await aP(n.localStore);t.compareTo(r)>=0&&await(function(s,c){const l=s.Va.Tt(c);return l.targetChanges.forEach(((d,h)=>{if(d.resumeToken.approximateByteSize()>0){const m=s.Ia.get(h);m&&s.Ia.set(h,m.withResumeToken(d.resumeToken,c))}})),l.targetMismatches.forEach(((d,h)=>{const m=s.Ia.get(d);if(!m)return;s.Ia.set(d,m.withResumeToken(Rr.EMPTY_BYTE_STRING,m.snapshotVersion)),uP(s,d);const g=new Zo(m.target,d,h,m.sequenceNumber);rS(s,g)})),s.remoteSyncer.applyRemoteEvent(l)})(n,t)}catch(r){We(yl,"Failed to raise snapshot:",r),await ov(n,r)}}async function ov(n,e,t){if(!Nd(e))throw e;n.Ea.add(1),await ip(n),n.Ra.set("Offline"),t||(t=()=>aP(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{We(yl,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await l0(n)}))}function hP(n,e){return e().catch((t=>ov(n,t,e)))}async function u0(n){const e=mt(n),t=yc(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:$_;for(;Az(e);)try{const i=await uz(e.localStore,r);if(i===null){e.Ta.length===0&&t.L_();break}r=i.batchId,Nz(e,i)}catch(i){await ov(e,i)}fP(e)&&pP(e)}function Az(n){return Ml(n)&&n.Ta.length<10}function Nz(n,e){n.Ta.push(e);const t=yc(n);t.O_()&&t.X_&&t.ea(e.mutations)}function fP(n){return Ml(n)&&!yc(n).x_()&&n.Ta.length>0}function pP(n){yc(n).start()}async function Iz(n){yc(n).ra()}async function Pz(n){const e=yc(n);for(const t of n.Ta)e.ea(t.mutations)}async function Mz(n,e,t){const r=n.Ta.shift(),i=Y_.from(r,e,t);await hP(n,(()=>n.remoteSyncer.applySuccessfulWrite(i))),await u0(n)}async function Dz(n,e){e&&yc(n).X_&&await(async function(r,i){if((function(c){return mV(c)&&c!==me.ABORTED})(i.code)){const s=r.Ta.shift();yc(r).B_(),await hP(r,(()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i))),await u0(r)}})(n,e),fP(n)&&pP(n)}async function j2(n,e){const t=mt(n);t.asyncQueue.verifyOperationInProgress(),We(yl,"RemoteStore received new credentials");const r=Ml(t);t.Ea.add(3),await ip(t),r&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await l0(t)}async function Oz(n,e){const t=mt(n);e?(t.Ea.delete(2),await l0(t)):e||(t.Ea.add(2),await ip(t),t.Ra.set("Unknown"))}function Id(n){return n.ma||(n.ma=(function(t,r,i){const s=mt(t);return s.sa(),new bz(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)})(n.datastore,n.asyncQueue,{Xo:Cz.bind(null,n),t_:wz.bind(null,n),r_:Ez.bind(null,n),H_:Rz.bind(null,n)}),n.da.push((async e=>{e?(n.ma.B_(),sS(n)?iS(n):n.Ra.set("Unknown")):(await n.ma.stop(),dP(n))}))),n.ma}function yc(n){return n.fa||(n.fa=(function(t,r,i){const s=mt(t);return s.sa(),new xz(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)})(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:Iz.bind(null,n),r_:Dz.bind(null,n),ta:Pz.bind(null,n),na:Mz.bind(null,n)}),n.da.push((async e=>{e?(n.fa.B_(),await u0(n)):(await n.fa.stop(),n.Ta.length>0&&(We(yl,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}class aS{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new Ga,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((c=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){const c=Date.now()+r,l=new aS(e,t,c,i,s);return l.start(r),l}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Ue(me.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function oS(n,e){if(Xa("AsyncQueue",`${e}: ${n}`),Nd(n))return new Ue(me.UNAVAILABLE,`${e}: ${n}`);throw n}class Ku{static emptySet(e){return new Ku(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||nt.comparator(t.key,r.key):(t,r)=>nt.comparator(t.key,r.key),this.keyedMap=Zh(),this.sortedSet=new kn(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,r)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Ku)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new Ku;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class L2{constructor(){this.ga=new kn(nt.comparator)}track(e){const t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):lt(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,r)=>{e.push(r)})),e}}class pd{constructor(e,t,r,i,s,c,l,d,h){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=c,this.syncStateChanged=l,this.excludesMetadataChanges=d,this.hasCachedResults=h}static fromInitialDocuments(e,t,r,i,s){const c=[];return t.forEach((l=>{c.push({type:0,doc:l})})),new pd(e,t,Ku.emptySet(t),c,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&t0(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}}class jz{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class Lz{constructor(){this.queries=U2(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){const i=mt(t),s=i.queries;i.queries=U2(),s.forEach(((c,l)=>{for(const d of l.Sa)d.onError(r)}))})(this,new Ue(me.ABORTED,"Firestore shutting down"))}}function U2(){return new Pl((n=>DI(n)),t0)}async function cS(n,e){const t=mt(n);let r=3;const i=e.query;let s=t.queries.get(i);s?!s.ba()&&e.Da()&&(r=2):(s=new jz,r=e.Da()?0:1);try{switch(r){case 0:s.wa=await t.onListen(i,!0);break;case 1:s.wa=await t.onListen(i,!1);break;case 2:await t.onFirstRemoteStoreListen(i)}}catch(c){const l=oS(c,`Initialization of query '${Du(e.query)}' failed`);return void e.onError(l)}t.queries.set(i,s),s.Sa.push(e),e.va(t.onlineState),s.wa&&e.Fa(s.wa)&&uS(t)}async function lS(n,e){const t=mt(n),r=e.query;let i=3;const s=t.queries.get(r);if(s){const c=s.Sa.indexOf(e);c>=0&&(s.Sa.splice(c,1),s.Sa.length===0?i=e.Da()?0:1:!s.ba()&&e.Da()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function Uz(n,e){const t=mt(n);let r=!1;for(const i of e){const s=i.query,c=t.queries.get(s);if(c){for(const l of c.Sa)l.Fa(i)&&(r=!0);c.wa=i}}r&&uS(t)}function Vz(n,e,t){const r=mt(n),i=r.queries.get(e);if(i)for(const s of i.Sa)s.onError(t);r.queries.delete(e)}function uS(n){n.Ca.forEach((e=>{e.next()}))}var fx,V2;(V2=fx||(fx={})).Ma="default",V2.Cache="cache";class dS{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)i.type!==3&&r.push(i);e=new pd(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const r=t!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=pd.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==fx.Cache}}class mP{constructor(e){this.key=e}}class gP{constructor(e){this.key=e}}class zz{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Ot(),this.mutatedKeys=Ot(),this.eu=OI(e),this.tu=new Ku(this.eu)}get nu(){return this.Ya}ru(e,t){const r=t?t.iu:new L2,i=t?t.tu:this.tu;let s=t?t.mutatedKeys:this.mutatedKeys,c=i,l=!1;const d=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,h=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal(((m,g)=>{const b=i.get(m),_=n0(this.query,g)?g:null,R=!!b&&this.mutatedKeys.has(b.key),E=!!_&&(_.hasLocalMutations||this.mutatedKeys.has(_.key)&&_.hasCommittedMutations);let A=!1;b&&_?b.data.isEqual(_.data)?R!==E&&(r.track({type:3,doc:_}),A=!0):this.su(b,_)||(r.track({type:2,doc:_}),A=!0,(d&&this.eu(_,d)>0||h&&this.eu(_,h)<0)&&(l=!0)):!b&&_?(r.track({type:0,doc:_}),A=!0):b&&!_&&(r.track({type:1,doc:b}),A=!0,(d||h)&&(l=!0)),A&&(_?(c=c.add(_),s=E?s.add(m):s.delete(m)):(c=c.delete(m),s=s.delete(m)))})),this.query.limit!==null)for(;c.size>this.query.limit;){const m=this.query.limitType==="F"?c.last():c.first();c=c.delete(m.key),s=s.delete(m.key),r.track({type:1,doc:m})}return{tu:c,iu:r,Cs:l,mutatedKeys:s}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){const s=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const c=e.iu.ya();c.sort(((m,g)=>(function(_,R){const E=A=>{switch(A){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return lt(20277,{Rt:A})}};return E(_)-E(R)})(m.type,g.type)||this.eu(m.doc,g.doc))),this.ou(r),i=i??!1;const l=t&&!i?this._u():[],d=this.Xa.size===0&&this.current&&!i?1:0,h=d!==this.Za;return this.Za=d,c.length!==0||h?{snapshot:new pd(this.query,e.tu,s,c,e.mutatedKeys,d===0,h,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:l}:{au:l}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new L2,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Ya=this.Ya.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ya=this.Ya.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=Ot(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))}));const t=[];return e.forEach((r=>{this.Xa.has(r)||t.push(new gP(r))})),this.Xa.forEach((r=>{e.has(r)||t.push(new mP(r))})),t}cu(e){this.Ya=e.Qs,this.Xa=Ot();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return pd.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const hS="SyncEngine";class Fz{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class Bz{constructor(e){this.key=e,this.hu=!1}}class $z{constructor(e,t,r,i,s,c){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=c,this.Pu={},this.Tu=new Pl((l=>DI(l)),t0),this.Iu=new Map,this.Eu=new Set,this.du=new kn(nt.comparator),this.Au=new Map,this.Ru=new J_,this.Vu={},this.mu=new Map,this.fu=fd.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function qz(n,e,t=!0){const r=SP(n);let i;const s=r.Tu.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.lu()):i=await vP(r,e,t,!0),i}async function Hz(n,e){const t=SP(n);await vP(t,e,!0,!1)}async function vP(n,e,t,r){const i=await dz(n.localStore,Qs(e)),s=i.targetId,c=n.sharedClientState.addLocalQueryTarget(s,t);let l;return r&&(l=await Gz(n,e,s,c==="current",i.resumeToken)),n.isPrimaryClient&&t&&lP(n.remoteStore,i),l}async function Gz(n,e,t,r,i){n.pu=(g,b,_)=>(async function(E,A,M,F){let j=A.view.ru(M);j.Cs&&(j=await I2(E.localStore,A.query,!1).then((({documents:S})=>A.view.ru(S,j))));const C=F&&F.targetChanges.get(A.targetId),N=F&&F.targetMismatches.get(A.targetId)!=null,D=A.view.applyChanges(j,E.isPrimaryClient,C,N);return F2(E,A.targetId,D.au),D.snapshot})(n,g,b,_);const s=await I2(n.localStore,e,!0),c=new zz(e,s.Qs),l=c.ru(s.documents),d=rp.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),h=c.applyChanges(l,n.isPrimaryClient,d);F2(n,t,h.au);const m=new Fz(e,t,c);return n.Tu.set(e,m),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),h.snapshot}async function Kz(n,e,t){const r=mt(n),i=r.Tu.get(e),s=r.Iu.get(i.targetId);if(s.length>1)return r.Iu.set(i.targetId,s.filter((c=>!t0(c,e)))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await dx(r.localStore,i.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(i.targetId),t&&nS(r.remoteStore,i.targetId),px(r,i.targetId)})).catch(Ad)):(px(r,i.targetId),await dx(r.localStore,i.targetId,!0))}async function Wz(n,e){const t=mt(n),r=t.Tu.get(e),i=t.Iu.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),nS(t.remoteStore,r.targetId))}async function Yz(n,e,t){const r=nF(n);try{const i=await(function(c,l){const d=mt(c),h=pr.now(),m=l.reduce(((_,R)=>_.add(R.key)),Ot());let g,b;return d.persistence.runTransaction("Locally write mutations","readwrite",(_=>{let R=Ja(),E=Ot();return d.Ns.getEntries(_,m).next((A=>{R=A,R.forEach(((M,F)=>{F.isValidDocument()||(E=E.add(M))}))})).next((()=>d.localDocuments.getOverlayedDocuments(_,R))).next((A=>{g=A;const M=[];for(const F of l){const j=uV(F,g.get(F.key).overlayedDocument);j!=null&&M.push(new Cc(F.key,j,EI(j.value.mapValue),qr.exists(!0)))}return d.mutationQueue.addMutationBatch(_,h,M,l)})).next((A=>{b=A;const M=A.applyToLocalDocumentSet(g,E);return d.documentOverlayCache.saveOverlays(_,A.batchId,M)}))})).then((()=>({batchId:b.batchId,changes:LI(g)})))})(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),(function(c,l,d){let h=c.Vu[c.currentUser.toKey()];h||(h=new kn(Dt)),h=h.insert(l,d),c.Vu[c.currentUser.toKey()]=h})(r,i.batchId,t),await sp(r,i.changes),await u0(r.remoteStore)}catch(i){const s=oS(i,"Failed to persist write");t.reject(s)}}async function yP(n,e){const t=mt(n);try{const r=await cz(t.localStore,e);e.targetChanges.forEach(((i,s)=>{const c=t.Au.get(s);c&&(Wt(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?c.hu=!0:i.modifiedDocuments.size>0?Wt(c.hu,14607):i.removedDocuments.size>0&&(Wt(c.hu,42227),c.hu=!1))})),await sp(t,r,e)}catch(r){await Ad(r)}}function z2(n,e,t){const r=mt(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const i=[];r.Tu.forEach(((s,c)=>{const l=c.view.va(e);l.snapshot&&i.push(l.snapshot)})),(function(c,l){const d=mt(c);d.onlineState=l;let h=!1;d.queries.forEach(((m,g)=>{for(const b of g.Sa)b.va(l)&&(h=!0)})),h&&uS(d)})(r.eventManager,e),i.length&&r.Pu.H_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function Qz(n,e,t){const r=mt(n);r.sharedClientState.updateQueryState(e,"rejected",t);const i=r.Au.get(e),s=i&&i.key;if(s){let c=new kn(nt.comparator);c=c.insert(s,Or.newNoDocument(s,ft.min()));const l=Ot().add(s),d=new o0(ft.min(),new Map,new kn(Dt),c,l);await yP(r,d),r.du=r.du.remove(s),r.Au.delete(e),fS(r)}else await dx(r.localStore,e,!1).then((()=>px(r,e,t))).catch(Ad)}async function Xz(n,e){const t=mt(n),r=e.batch.batchId;try{const i=await oz(t.localStore,e);xP(t,r,null),bP(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await sp(t,i)}catch(i){await Ad(i)}}async function Jz(n,e,t){const r=mt(n);try{const i=await(function(c,l){const d=mt(c);return d.persistence.runTransaction("Reject batch","readwrite-primary",(h=>{let m;return d.mutationQueue.lookupMutationBatch(h,l).next((g=>(Wt(g!==null,37113),m=g.keys(),d.mutationQueue.removeMutationBatch(h,g)))).next((()=>d.mutationQueue.performConsistencyCheck(h))).next((()=>d.documentOverlayCache.removeOverlaysForBatchId(h,m,l))).next((()=>d.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,m))).next((()=>d.localDocuments.getDocuments(h,m)))}))})(r.localStore,e);xP(r,e,t),bP(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await sp(r,i)}catch(i){await Ad(i)}}function bP(n,e){(n.mu.get(e)||[]).forEach((t=>{t.resolve()})),n.mu.delete(e)}function xP(n,e,t){const r=mt(n);let i=r.Vu[r.currentUser.toKey()];if(i){const s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.Vu[r.currentUser.toKey()]=i}}function px(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach((r=>{n.Ru.containsKey(r)||_P(n,r)}))}function _P(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(nS(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),fS(n))}function F2(n,e,t){for(const r of t)r instanceof mP?(n.Ru.addReference(r.key,e),Zz(n,r)):r instanceof gP?(We(hS,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,e),n.Ru.containsKey(r.key)||_P(n,r.key)):lt(19791,{wu:r})}function Zz(n,e){const t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Eu.has(r)||(We(hS,"New document in limbo: "+t),n.Eu.add(r),fS(n))}function fS(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new nt(cn.fromString(e)),r=n.fu.next();n.Au.set(r,new Bz(t)),n.du=n.du.insert(t,r),lP(n.remoteStore,new Zo(Qs(e0(t.path)),r,"TargetPurposeLimboResolution",Qv.ce))}}async function sp(n,e,t){const r=mt(n),i=[],s=[],c=[];r.Tu.isEmpty()||(r.Tu.forEach(((l,d)=>{c.push(r.pu(d,e,t).then((h=>{if((h||t)&&r.isPrimaryClient){const m=h?!h.fromCache:t?.targetChanges.get(d.targetId)?.current;r.sharedClientState.updateQueryState(d.targetId,m?"current":"not-current")}if(h){i.push(h);const m=eS.As(d.targetId,h);s.push(m)}})))})),await Promise.all(c),r.Pu.H_(i),await(async function(d,h){const m=mt(d);try{await m.persistence.runTransaction("notifyLocalViewChanges","readwrite",(g=>Ee.forEach(h,(b=>Ee.forEach(b.Es,(_=>m.persistence.referenceDelegate.addReference(g,b.targetId,_))).next((()=>Ee.forEach(b.ds,(_=>m.persistence.referenceDelegate.removeReference(g,b.targetId,_)))))))))}catch(g){if(!Nd(g))throw g;We(tS,"Failed to update sequence numbers: "+g)}for(const g of h){const b=g.targetId;if(!g.fromCache){const _=m.Ms.get(b),R=_.snapshotVersion,E=_.withLastLimboFreeSnapshotVersion(R);m.Ms=m.Ms.insert(b,E)}}})(r.localStore,s))}async function eF(n,e){const t=mt(n);if(!t.currentUser.isEqual(e)){We(hS,"User change. New user:",e.toKey());const r=await sP(t.localStore,e);t.currentUser=e,(function(s,c){s.mu.forEach((l=>{l.forEach((d=>{d.reject(new Ue(me.CANCELLED,c))}))})),s.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await sp(t,r.Ls)}}function tF(n,e){const t=mt(n),r=t.Au.get(e);if(r&&r.hu)return Ot().add(r.key);{let i=Ot();const s=t.Iu.get(e);if(!s)return i;for(const c of s){const l=t.Tu.get(c);i=i.unionWith(l.view.nu)}return i}}function SP(n){const e=mt(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=yP.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=tF.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Qz.bind(null,e),e.Pu.H_=Uz.bind(null,e.eventManager),e.Pu.yu=Vz.bind(null,e.eventManager),e}function nF(n){const e=mt(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Xz.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Jz.bind(null,e),e}class cv{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=c0(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return az(this.persistence,new rz,e.initialUser,this.serializer)}Cu(e){return new iP(Z_.mi,this.serializer)}Du(e){return new fz}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}cv.provider={build:()=>new cv};class rF extends cv{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){Wt(this.persistence.referenceDelegate instanceof av,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new BV(r,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?ai.withCacheSize(this.cacheSizeBytes):ai.DEFAULT;return new iP((r=>av.mi(r,t)),this.serializer)}}class mx{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>z2(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=eF.bind(null,this.syncEngine),await Oz(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new Lz})()}createDatastore(e){const t=c0(e.databaseInfo.databaseId),r=(function(s){return new yz(s)})(e.databaseInfo);return(function(s,c,l,d){return new Sz(s,c,l,d)})(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return(function(r,i,s,c,l){return new kz(r,i,s,c,l)})(this.localStore,this.datastore,e.asyncQueue,(t=>z2(this.syncEngine,t,0)),(function(){return D2.v()?new D2:new pz})())}createSyncEngine(e,t){return(function(i,s,c,l,d,h,m){const g=new $z(i,s,c,l,d,h);return m&&(g.gu=!0),g})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){const r=mt(t);We(yl,"RemoteStore shutting down."),r.Ea.add(5),await ip(r),r.Aa.shutdown(),r.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}mx.provider={build:()=>new mx};class pS{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Xa("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}const bc="FirestoreClient";class iF{constructor(e,t,r,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=Mr.UNAUTHENTICATED,this.clientId=B_.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,(async c=>{We(bc,"Received user=",c.uid),await this.authCredentialListener(c),this.user=c})),this.appCheckCredentials.start(r,(c=>(We(bc,"Received new app check token=",c),this.appCheckCredentialListener(c,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Ga;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=oS(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}}async function e1(n,e){n.asyncQueue.verifyOperationInProgress(),We(bc,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener((async i=>{r.isEqual(i)||(await sP(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function B2(n,e){n.asyncQueue.verifyOperationInProgress();const t=await sF(n);We(bc,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((r=>j2(e.remoteStore,r))),n.setAppCheckTokenChangeListener(((r,i)=>j2(e.remoteStore,i))),n._onlineComponents=e}async function sF(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){We(bc,"Using user provided OfflineComponentProvider");try{await e1(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(i){return i.name==="FirebaseError"?i.code===me.FAILED_PRECONDITION||i.code===me.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11})(t))throw t;ad("Error using user provided cache. Falling back to memory cache: "+t),await e1(n,new cv)}}else We(bc,"Using default OfflineComponentProvider"),await e1(n,new rF(void 0));return n._offlineComponents}async function TP(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(We(bc,"Using user provided OnlineComponentProvider"),await B2(n,n._uninitializedComponentsProvider._online)):(We(bc,"Using default OnlineComponentProvider"),await B2(n,new mx))),n._onlineComponents}function aF(n){return TP(n).then((e=>e.syncEngine))}async function lv(n){const e=await TP(n),t=e.eventManager;return t.onListen=qz.bind(null,e.syncEngine),t.onUnlisten=Kz.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Hz.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=Wz.bind(null,e.syncEngine),t}function oF(n,e,t={}){const r=new Ga;return n.asyncQueue.enqueueAndForget((async()=>(function(s,c,l,d,h){const m=new pS({next:b=>{m.Nu(),c.enqueueAndForget((()=>lS(s,g)));const _=b.docs.has(l);!_&&b.fromCache?h.reject(new Ue(me.UNAVAILABLE,"Failed to get document because the client is offline.")):_&&b.fromCache&&d&&d.source==="server"?h.reject(new Ue(me.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(b)},error:b=>h.reject(b)}),g=new dS(e0(l.path),m,{includeMetadataChanges:!0,qa:!0});return cS(s,g)})(await lv(n),n.asyncQueue,e,t,r))),r.promise}function cF(n,e,t={}){const r=new Ga;return n.asyncQueue.enqueueAndForget((async()=>(function(s,c,l,d,h){const m=new pS({next:b=>{m.Nu(),c.enqueueAndForget((()=>lS(s,g))),b.fromCache&&d.source==="server"?h.reject(new Ue(me.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(b)},error:b=>h.reject(b)}),g=new dS(l,m,{includeMetadataChanges:!0,qa:!0});return cS(s,g)})(await lv(n),n.asyncQueue,e,t,r))),r.promise}function kP(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}const $2=new Map;const CP="firestore.googleapis.com",q2=!0;class H2{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new Ue(me.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=CP,this.ssl=q2}else this.host=e.host,this.ssl=e.ssl??q2;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=rP;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<zV)throw new Ue(me.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}k7("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=kP(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new Ue(me.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new Ue(me.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new Ue(me.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,i){return r.timeoutSeconds===i.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class d0{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new H2({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Ue(me.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Ue(me.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new H2(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new p7;switch(r.type){case"firstParty":return new y7(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new Ue(me.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const r=$2.get(t);r&&(We("ComponentProvider","Removing Datastore"),$2.delete(t),r.terminate())})(this),Promise.resolve()}}function lF(n,e,t,r={}){n=$r(n,d0);const i=Rl(e),s=n._getSettings(),c={...s,emulatorOptions:n._getEmulatorOptions()},l=`${e}:${t}`;i&&(R_(`https://${l}`),A_("Firestore",!0)),s.host!==CP&&s.host!==l&&ad("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const d={...s,host:l,ssl:i,emulatorOptions:r};if(!Wa(d,c)&&(n._setSettings(d),r.mockUserToken)){let h,m;if(typeof r.mockUserToken=="string")h=r.mockUserToken,m=Mr.MOCK_USER;else{h=bN(r.mockUserToken,n._app?.options.projectId);const g=r.mockUserToken.sub||r.mockUserToken.user_id;if(!g)throw new Ue(me.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");m=new Mr(g)}n._authCredentials=new m7(new mI(h,m))}}class la{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new la(this.firestore,e,this._query)}}class Nn{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new oc(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Nn(this.firestore,e,this._key)}toJSON(){return{type:Nn._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(tp(t,Nn._jsonSchema))return new Nn(e,r||null,new nt(cn.fromString(t.referencePath)))}}Nn._jsonSchemaVersion="firestore/documentReference/1.0",Nn._jsonSchema={type:er("string",Nn._jsonSchemaVersion),referencePath:er("string")};class oc extends la{constructor(e,t,r){super(e,t,e0(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Nn(this.firestore,null,new nt(e))}withConverter(e){return new oc(this.firestore,e,this._path)}}function St(n,e,...t){if(n=hn(n),gI("collection","path",e),n instanceof d0){const r=cn.fromString(e,...t);return s2(r),new oc(n,null,r)}{if(!(n instanceof Nn||n instanceof oc))throw new Ue(me.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(cn.fromString(e,...t));return s2(r),new oc(n.firestore,null,r)}}function Be(n,e,...t){if(n=hn(n),arguments.length===1&&(e=B_.newId()),gI("doc","path",e),n instanceof d0){const r=cn.fromString(e,...t);return i2(r),new Nn(n,null,new nt(r))}{if(!(n instanceof Nn||n instanceof oc))throw new Ue(me.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(cn.fromString(e,...t));return i2(r),new Nn(n.firestore,n instanceof oc?n.converter:null,new nt(r))}}const G2="AsyncQueue";class K2{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new oP(this,"async_queue_retry"),this._c=()=>{const r=Zb();r&&We(G2,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const t=Zb();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=Zb();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new Ga;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Nd(e))throw e;We(G2,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((r=>{throw this.nc=r,this.rc=!1,Xa("INTERNAL UNHANDLED ERROR: ",W2(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const i=aS.createAndSchedule(this,e,t,r,(s=>this.hc(s)));return this.tc.push(i),i}uc(){this.nc&&lt(47125,{Pc:W2(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,r)=>t.targetTimeMs-r.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function W2(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}function Y2(n){return(function(t,r){if(typeof t!="object"||t===null)return!1;const i=t;for(const s of r)if(s in i&&typeof i[s]=="function")return!0;return!1})(n,["next","error","complete"])}class ra extends d0{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new K2,this._persistenceKey=i?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new K2(e),this._firestoreClient=void 0,await e}}}function uF(n,e){const t=typeof n=="object"?n:P_(),r=typeof n=="string"?n:tv,i=Hv(t,"firestore").getImmediate({identifier:r});if(!i._initialized){const s=gN("firestore");s&&lF(i,...s)}return i}function ap(n){if(n._terminated)throw new Ue(me.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||dF(n),n._firestoreClient}function dF(n){const e=n._freezeSettings(),t=(function(i,s,c,l){return new j7(i,s,c,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,kP(l.experimentalLongPollingOptions),l.useFetchStreams,l.isUsingEmulator)})(n._databaseId,n._app?.options.appId||"",n._persistenceKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new iF(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(i){const s=i?._online.build();return{_offline:i?._offline.build(s),_online:s}})(n._componentsProvider))}class Wi{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Wi(Rr.fromBase64String(e))}catch(t){throw new Ue(me.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Wi(Rr.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Wi._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(tp(e,Wi._jsonSchema))return Wi.fromBase64String(e.bytes)}}Wi._jsonSchemaVersion="firestore/bytes/1.0",Wi._jsonSchema={type:er("string",Wi._jsonSchemaVersion),bytes:er("string")};class op{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new Ue(me.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Cr(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Dl{constructor(e){this._methodName=e}}class Js{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Ue(me.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Ue(me.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Dt(this._lat,e._lat)||Dt(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Js._jsonSchemaVersion}}static fromJSON(e){if(tp(e,Js._jsonSchema))return new Js(e.latitude,e.longitude)}}Js._jsonSchemaVersion="firestore/geoPoint/1.0",Js._jsonSchema={type:er("string",Js._jsonSchemaVersion),latitude:er("number"),longitude:er("number")};class Zs{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(r,i){if(r.length!==i.length)return!1;for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0})(this._values,e._values)}toJSON(){return{type:Zs._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(tp(e,Zs._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new Zs(e.vectorValues);throw new Ue(me.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Zs._jsonSchemaVersion="firestore/vectorValue/1.0",Zs._jsonSchema={type:er("string",Zs._jsonSchemaVersion),vectorValues:er("object")};const hF=/^__.*__$/;class fF{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Cc(e,this.data,this.fieldMask,t,this.fieldTransforms):new np(e,this.data,t,this.fieldTransforms)}}class wP{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Cc(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function EP(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw lt(40011,{Ac:n})}}class h0{constructor(e,t,r,i,s,c){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.Rc(),this.fieldTransforms=s||[],this.fieldMask=c||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new h0({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.gc(e),r}yc(e){const t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return uv(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(EP(this.Ac)&&hF.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class pF{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||c0(e)}Cc(e,t,r,i=!1){return new h0({Ac:e,methodName:t,Dc:r,path:Cr.emptyPath(),fc:!1,bc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Pd(n){const e=n._freezeSettings(),t=c0(n._databaseId);return new pF(n._databaseId,!!e.ignoreUndefinedProperties,t)}function mS(n,e,t,r,i,s={}){const c=n.Cc(s.merge||s.mergeFields?2:0,e,t,i);xS("Data must be an object, but it was:",c,r);const l=PP(r,c);let d,h;if(s.merge)d=new Ri(c.fieldMask),h=c.fieldTransforms;else if(s.mergeFields){const m=[];for(const g of s.mergeFields){const b=gx(e,g,t);if(!c.contains(b))throw new Ue(me.INVALID_ARGUMENT,`Field '${b}' is specified in your field mask but missing from your input data.`);DP(m,b)||m.push(b)}d=new Ri(m),h=c.fieldTransforms.filter((g=>d.covers(g.field)))}else d=null,h=c.fieldTransforms;return new fF(new li(l),d,h)}class cp extends Dl{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof cp}}function RP(n,e,t){return new h0({Ac:3,Dc:e.settings.Dc,methodName:n._methodName,fc:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class gS extends Dl{_toFieldTransform(e){return new i0(e.path,new wf)}isEqual(e){return e instanceof gS}}class vS extends Dl{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=RP(this,e,!0),r=this.vc.map((s=>Ol(s,t))),i=new dd(r);return new i0(e.path,i)}isEqual(e){return e instanceof vS&&Wa(this.vc,e.vc)}}class yS extends Dl{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=RP(this,e,!0),r=this.vc.map((s=>Ol(s,t))),i=new hd(r);return new i0(e.path,i)}isEqual(e){return e instanceof yS&&Wa(this.vc,e.vc)}}class bS extends Dl{constructor(e,t){super(e),this.Fc=t}_toFieldTransform(e){const t=new Ef(e.serializer,zI(e.serializer,this.Fc));return new i0(e.path,t)}isEqual(e){return e instanceof bS&&this.Fc===e.Fc}}function AP(n,e,t,r){const i=n.Cc(1,e,t);xS("Data must be an object, but it was:",i,r);const s=[],c=li.empty();kc(r,((d,h)=>{const m=_S(e,d,t);h=hn(h);const g=i.yc(m);if(h instanceof cp)s.push(m);else{const b=Ol(h,g);b!=null&&(s.push(m),c.set(m,b))}}));const l=new Ri(s);return new wP(c,l,i.fieldTransforms)}function NP(n,e,t,r,i,s){const c=n.Cc(1,e,t),l=[gx(e,r,t)],d=[i];if(s.length%2!=0)throw new Ue(me.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let b=0;b<s.length;b+=2)l.push(gx(e,s[b])),d.push(s[b+1]);const h=[],m=li.empty();for(let b=l.length-1;b>=0;--b)if(!DP(h,l[b])){const _=l[b];let R=d[b];R=hn(R);const E=c.yc(_);if(R instanceof cp)h.push(_);else{const A=Ol(R,E);A!=null&&(h.push(_),m.set(_,A))}}const g=new Ri(h);return new wP(m,g,c.fieldTransforms)}function IP(n,e,t,r=!1){return Ol(t,n.Cc(r?4:3,e))}function Ol(n,e){if(MP(n=hn(n)))return xS("Unsupported field value:",e,n),PP(n,e);if(n instanceof Dl)return(function(r,i){if(!EP(i.Ac))throw i.Sc(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Sc(`${r._methodName}() is not currently supported inside arrays`);const s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(r,i){const s=[];let c=0;for(const l of r){let d=Ol(l,i.wc(c));d==null&&(d={nullValue:"NULL_VALUE"}),s.push(d),c++}return{arrayValue:{values:s}}})(n,e)}return(function(r,i){if((r=hn(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return zI(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const s=pr.fromDate(r);return{timestampValue:sv(i.serializer,s)}}if(r instanceof pr){const s=new pr(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:sv(i.serializer,s)}}if(r instanceof Js)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Wi)return{bytesValue:QI(i.serializer,r._byteString)};if(r instanceof Nn){const s=i.databaseId,c=r.firestore._databaseId;if(!c.isEqual(s))throw i.Sc(`Document reference is for database ${c.projectId}/${c.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:X_(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof Zs)return(function(c,l){return{mapValue:{fields:{[CI]:{stringValue:wI},[nv]:{arrayValue:{values:c.toArray().map((h=>{if(typeof h!="number")throw l.Sc("VectorValues must only contain numeric values.");return W_(l.serializer,h)}))}}}}}})(r,i);throw i.Sc(`Unsupported field value: ${Yv(r)}`)})(n,e)}function PP(n,e){const t={};return bI(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):kc(n,((r,i)=>{const s=Ol(i,e.mc(r));s!=null&&(t[r]=s)})),{mapValue:{fields:t}}}function MP(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof pr||n instanceof Js||n instanceof Wi||n instanceof Nn||n instanceof Dl||n instanceof Zs)}function xS(n,e,t){if(!MP(t)||!vI(t)){const r=Yv(t);throw r==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+r)}}function gx(n,e,t){if((e=hn(e))instanceof op)return e._internalPath;if(typeof e=="string")return _S(n,e);throw uv("Field path arguments must be of type string or ",n,!1,void 0,t)}const mF=new RegExp("[~\\*/\\[\\]]");function _S(n,e,t){if(e.search(mF)>=0)throw uv(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new op(...e.split("."))._internalPath}catch{throw uv(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function uv(n,e,t,r,i){const s=r&&!r.isEmpty(),c=i!==void 0;let l=`Function ${e}() called with invalid data`;t&&(l+=" (via `toFirestore()`)"),l+=". ";let d="";return(s||c)&&(d+=" (found",s&&(d+=` in field ${r}`),c&&(d+=` in document ${i}`),d+=")"),new Ue(me.INVALID_ARGUMENT,l+n+d)}function DP(n,e){return n.some((t=>t.isEqual(e)))}class SS{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Nn(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new gF(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(f0("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class gF extends SS{data(){return super.data()}}function f0(n,e){return typeof e=="string"?_S(n,e):e instanceof op?e._internalPath:e._delegate._internalPath}function OP(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new Ue(me.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class TS{}class p0 extends TS{}function Yi(n,e,...t){let r=[];e instanceof TS&&r.push(e),r=r.concat(t),(function(s){const c=s.filter((d=>d instanceof kS)).length,l=s.filter((d=>d instanceof m0)).length;if(c>1||c>0&&l>0)throw new Ue(me.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(r);for(const i of r)n=i._apply(n);return n}class m0 extends p0{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new m0(e,t,r)}_apply(e){const t=this._parse(e);return jP(e._query,t),new la(e.firestore,e.converter,ax(e._query,t))}_parse(e){const t=Pd(e.firestore);return(function(s,c,l,d,h,m,g){let b;if(h.isKeyField()){if(m==="array-contains"||m==="array-contains-any")throw new Ue(me.INVALID_ARGUMENT,`Invalid Query. You can't perform '${m}' queries on documentId().`);if(m==="in"||m==="not-in"){X2(g,m);const R=[];for(const E of g)R.push(Q2(d,s,E));b={arrayValue:{values:R}}}else b=Q2(d,s,g)}else m!=="in"&&m!=="not-in"&&m!=="array-contains-any"||X2(g,m),b=IP(l,c,g,m==="in"||m==="not-in");return Zn.create(h,m,b)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function il(n,e,t){const r=e,i=f0("where",n);return m0._create(i,r,t)}class kS extends TS{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new kS(e,t)}_parse(e){const t=this._queryConstraints.map((r=>r._parse(e))).filter((r=>r.getFilters().length>0));return t.length===1?t[0]:xs.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:((function(i,s){let c=i;const l=s.getFlattenedFilters();for(const d of l)jP(c,d),c=ax(c,d)})(e._query,t),new la(e.firestore,e.converter,ax(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class CS extends p0{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new CS(e,t)}_apply(e){const t=(function(i,s,c){if(i.startAt!==null)throw new Ue(me.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new Ue(me.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Cf(s,c)})(e._query,this._field,this._direction);return new la(e.firestore,e.converter,(function(i,s){const c=i.explicitOrderBy.concat([s]);return new Il(i.path,i.collectionGroup,c,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)})(e._query,t))}}function dv(n,e="asc"){const t=e,r=f0("orderBy",n);return CS._create(r,t)}class wS extends p0{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new wS(e,t,r)}_apply(e){return new la(e.firestore,e.converter,iv(e._query,this._limit,this._limitType))}}function vx(n){return C7("limit",n),wS._create("limit",n,"F")}class ES extends p0{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new ES(e,t,r)}_apply(e){const t=yF(e,this.type,this._docOrFields,this._inclusive);return new la(e.firestore,e.converter,(function(i,s){return new Il(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)})(e._query,t))}}function vF(...n){return ES._create("startAfter",n,!1)}function yF(n,e,t,r){if(t[0]=hn(t[0]),t[0]instanceof SS)return(function(s,c,l,d,h){if(!d)throw new Ue(me.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${l}().`);const m=[];for(const g of Gu(s))if(g.field.isKeyField())m.push(rv(c,d.key));else{const b=d.data.field(g.field);if(Jv(b))throw new Ue(me.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+g.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(b===null){const _=g.field.canonicalString();throw new Ue(me.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${_}' (used as the orderBy) does not exist.`)}m.push(b)}return new ud(m,h)})(n._query,n.firestore._databaseId,e,t[0]._document,r);{const i=Pd(n.firestore);return(function(c,l,d,h,m,g){const b=c.explicitOrderBy;if(m.length>b.length)throw new Ue(me.INVALID_ARGUMENT,`Too many arguments provided to ${h}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const _=[];for(let R=0;R<m.length;R++){const E=m[R];if(b[R].field.isKeyField()){if(typeof E!="string")throw new Ue(me.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${h}(), but got a ${typeof E}`);if(!K_(c)&&E.indexOf("/")!==-1)throw new Ue(me.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${h}() must be a plain document ID, but '${E}' contains a slash.`);const A=c.path.child(cn.fromString(E));if(!nt.isDocumentKey(A))throw new Ue(me.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${h}() must result in a valid document path, but '${A}' is not because it contains an odd number of segments.`);const M=new nt(A);_.push(rv(l,M))}else{const A=IP(d,h,E);_.push(A)}}return new ud(_,g)})(n._query,n.firestore._databaseId,i,e,t,r)}}function Q2(n,e,t){if(typeof(t=hn(t))=="string"){if(t==="")throw new Ue(me.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!K_(e)&&t.indexOf("/")!==-1)throw new Ue(me.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(cn.fromString(t));if(!nt.isDocumentKey(r))throw new Ue(me.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return rv(n,new nt(r))}if(t instanceof Nn)return rv(n,t._key);throw new Ue(me.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Yv(t)}.`)}function X2(n,e){if(!Array.isArray(n)||n.length===0)throw new Ue(me.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function jP(n,e){const t=(function(i,s){for(const c of i)for(const l of c.getFlattenedFilters())if(s.indexOf(l.op)>=0)return l.op;return null})(n.filters,(function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new Ue(me.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Ue(me.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class bF{convertValue(e,t="none"){switch(vc(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Un(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(gc(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw lt(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return kc(e,((i,s)=>{r[i]=this.convertValue(s,t)})),r}convertVectorValue(e){const t=e.fields?.[nv].arrayValue?.values?.map((r=>Un(r.doubleValue)));return new Zs(t)}convertGeoPoint(e){return new Js(Un(e.latitude),Un(e.longitude))}convertArray(e,t){return(e.values||[]).map((r=>this.convertValue(r,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Zv(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Sf(e));default:return null}}convertTimestamp(e){const t=mc(e);return new pr(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=cn.fromString(e);Wt(nP(r),9688,{name:e});const i=new Tf(r.get(1),r.get(3)),s=new nt(r.popFirst(5));return i.isEqual(t)||Xa(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function RS(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class tf{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class ll extends SS{constructor(e,t,r,i,s,c){super(e,t,r,i,c),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new vg(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(f0("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new Ue(me.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=ll._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}ll._jsonSchemaVersion="firestore/documentSnapshot/1.0",ll._jsonSchema={type:er("string",ll._jsonSchemaVersion),bundleSource:er("string","DocumentSnapshot"),bundleName:er("string"),bundle:er("string")};class vg extends ll{data(e={}){return super.data(e)}}class ul{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new tf(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((r=>{e.call(t,new vg(this._firestore,this._userDataWriter,r.key,r,new tf(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Ue(me.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(i,s){if(i._snapshot.oldDocs.isEmpty()){let c=0;return i._snapshot.docChanges.map((l=>{const d=new vg(i._firestore,i._userDataWriter,l.doc.key,l.doc,new tf(i._snapshot.mutatedKeys.has(l.doc.key),i._snapshot.fromCache),i.query.converter);return l.doc,{type:"added",doc:d,oldIndex:-1,newIndex:c++}}))}{let c=i._snapshot.oldDocs;return i._snapshot.docChanges.filter((l=>s||l.type!==3)).map((l=>{const d=new vg(i._firestore,i._userDataWriter,l.doc.key,l.doc,new tf(i._snapshot.mutatedKeys.has(l.doc.key),i._snapshot.fromCache),i.query.converter);let h=-1,m=-1;return l.type!==0&&(h=c.indexOf(l.doc.key),c=c.delete(l.doc.key)),l.type!==1&&(c=c.add(l.doc),m=c.indexOf(l.doc.key)),{type:xF(l.type),doc:d,oldIndex:h,newIndex:m}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new Ue(me.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=ul._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=B_.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],i=[];return this.docs.forEach((s=>{s._document!==null&&(t.push(s._document),r.push(this._userDataWriter.convertObjectMap(s._document.data.value.mapValue.fields,"previous")),i.push(s.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function xF(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return lt(61501,{type:n})}}function g0(n){n=$r(n,Nn);const e=$r(n.firestore,ra);return oF(ap(e),n._key).then((t=>LP(e,n,t)))}ul._jsonSchemaVersion="firestore/querySnapshot/1.0",ul._jsonSchema={type:er("string",ul._jsonSchemaVersion),bundleSource:er("string","QuerySnapshot"),bundleName:er("string"),bundle:er("string")};class AS extends bF{constructor(e){super(),this.firestore=e}convertBytes(e){return new Wi(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Nn(this.firestore,null,t)}}function bl(n){n=$r(n,la);const e=$r(n.firestore,ra),t=ap(e),r=new AS(e);return OP(n._query),cF(t,n._query).then((i=>new ul(e,r,n,i)))}function md(n,e,t){n=$r(n,Nn);const r=$r(n.firestore,ra),i=RS(n.converter,e,t);return lp(r,[mS(Pd(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,qr.none())])}function at(n,e,t,...r){n=$r(n,Nn);const i=$r(n.firestore,ra),s=Pd(i);let c;return c=typeof(e=hn(e))=="string"||e instanceof op?NP(s,"updateDoc",n._key,e,t,r):AP(s,"updateDoc",n._key,e),lp(i,[c.toMutation(n._key,qr.exists(!0))])}function ec(n){return lp($r(n.firestore,ra),[new a0(n._key,qr.none())])}function Ln(n,e){const t=$r(n.firestore,ra),r=Be(n),i=RS(n.converter,e);return lp(t,[mS(Pd(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,qr.exists(!1))]).then((()=>r))}function oi(n,...e){n=hn(n);let t={includeMetadataChanges:!1,source:"default"},r=0;typeof e[r]!="object"||Y2(e[r])||(t=e[r++]);const i={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if(Y2(e[r])){const d=e[r];e[r]=d.next?.bind(d),e[r+1]=d.error?.bind(d),e[r+2]=d.complete?.bind(d)}let s,c,l;if(n instanceof Nn)c=$r(n.firestore,ra),l=e0(n._key.path),s={next:d=>{e[r]&&e[r](LP(c,n,d))},error:e[r+1],complete:e[r+2]};else{const d=$r(n,la);c=$r(d.firestore,ra),l=d._query;const h=new AS(c);s={next:m=>{e[r]&&e[r](new ul(c,h,d,m))},error:e[r+1],complete:e[r+2]},OP(n._query)}return(function(h,m,g,b){const _=new pS(b),R=new dS(m,_,g);return h.asyncQueue.enqueueAndForget((async()=>cS(await lv(h),R))),()=>{_.Nu(),h.asyncQueue.enqueueAndForget((async()=>lS(await lv(h),R)))}})(ap(c),l,i,s)}function lp(n,e){return(function(r,i){const s=new Ga;return r.asyncQueue.enqueueAndForget((async()=>Yz(await aF(r),i,s))),s.promise})(ap(n),e)}function LP(n,e,t){const r=t.docs.get(e._key),i=new AS(n);return new ll(n,i,e._key,r,new tf(t.hasPendingWrites,t.fromCache),e.converter)}class _F{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Pd(e)}set(e,t,r){this._verifyNotCommitted();const i=t1(e,this._firestore),s=RS(i.converter,t,r),c=mS(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(c.toMutation(i._key,qr.none())),this}update(e,t,r,...i){this._verifyNotCommitted();const s=t1(e,this._firestore);let c;return c=typeof(t=hn(t))=="string"||t instanceof op?NP(this._dataReader,"WriteBatch.update",s._key,t,r,i):AP(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(c.toMutation(s._key,qr.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=t1(e,this._firestore);return this._mutations=this._mutations.concat(new a0(t._key,qr.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Ue(me.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function t1(n,e){if((n=hn(n)).firestore!==e)throw new Ue(me.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}function SF(){return new cp("deleteField")}function bt(){return new gS("serverTimestamp")}function up(...n){return new vS("arrayUnion",n)}function hv(...n){return new yS("arrayRemove",n)}function fv(n){return new bS("increment",n)}function J2(n){return ap(n=$r(n,ra)),new _F(n,(e=>lp(n,e)))}(function(e,t=!0){(function(i){Rd=i})(Al),pl(new fc("firestore",((r,{instanceIdentifier:i,options:s})=>{const c=r.getProvider("app").getImmediate(),l=new ra(new g7(r.getProvider("auth-internal")),new b7(c,r.getProvider("app-check-internal")),(function(h,m){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new Ue(me.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Tf(h.options.projectId,m)})(c,i),c);return s={useFetchStreams:t,...s},l._setSettings(s),l}),"PUBLIC").setMultipleInstances(!0)),Ks(e2,t2,e),Ks(e2,t2,"esm2020")})();const UP="firebasestorage.googleapis.com",TF="storageBucket",kF=120*1e3,CF=600*1e3;class ua extends oa{constructor(e,t,r=0){super(n1(e),`Firebase Storage: ${t} (${n1(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,ua.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return n1(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var ia;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(ia||(ia={}));function n1(n){return"storage/"+n}function wF(){const n="An unknown error occurred, please check the error payload for server response.";return new ua(ia.UNKNOWN,n)}function EF(){return new ua(ia.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function RF(){return new ua(ia.CANCELED,"User canceled the upload/download.")}function AF(n){return new ua(ia.INVALID_URL,"Invalid URL '"+n+"'.")}function NF(n){return new ua(ia.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function Z2(n){return new ua(ia.INVALID_ARGUMENT,n)}function VP(){return new ua(ia.APP_DELETED,"The Firebase app was deleted.")}function IF(n){return new ua(ia.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}class gs{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let r;try{r=gs.makeFromUrl(e,t)}catch{return new gs(e,"")}if(r.path==="")return r;throw NF(e)}static makeFromUrl(e,t){let r=null;const i="([A-Za-z0-9.\\-_]+)";function s(C){C.path.charAt(C.path.length-1)==="/"&&(C.path_=C.path_.slice(0,-1))}const c="(/(.*))?$",l=new RegExp("^gs://"+i+c,"i"),d={bucket:1,path:3};function h(C){C.path_=decodeURIComponent(C.path)}const m="v[A-Za-z0-9_]+",g=t.replace(/[.]/g,"\\."),b="(/([^?#]*).*)?$",_=new RegExp(`^https?://${g}/${m}/b/${i}/o${b}`,"i"),R={bucket:1,path:3},E=t===UP?"(?:storage.googleapis.com|storage.cloud.google.com)":t,A="([^?#]*)",M=new RegExp(`^https?://${E}/${i}/${A}`,"i"),j=[{regex:l,indices:d,postModify:s},{regex:_,indices:R,postModify:h},{regex:M,indices:{bucket:1,path:2},postModify:h}];for(let C=0;C<j.length;C++){const N=j[C],D=N.regex.exec(e);if(D){const S=D[N.indices.bucket];let k=D[N.indices.path];k||(k=""),r=new gs(S,k),N.postModify(r);break}}if(r==null)throw AF(e);return r}}class PF{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function MF(n,e,t){let r=1,i=null,s=null,c=!1,l=0;function d(){return l===2}let h=!1;function m(...A){h||(h=!0,e.apply(null,A))}function g(A){i=setTimeout(()=>{i=null,n(_,d())},A)}function b(){s&&clearTimeout(s)}function _(A,...M){if(h){b();return}if(A){b(),m.call(null,A,...M);return}if(d()||c){b(),m.call(null,A,...M);return}r<64&&(r*=2);let j;l===1?(l=2,j=0):j=(r+Math.random())*1e3,g(j)}let R=!1;function E(A){R||(R=!0,b(),!h&&(i!==null?(A||(l=2),clearTimeout(i),g(0)):A||(l=1)))}return g(0),s=setTimeout(()=>{c=!0,E(!0)},t),E}function DF(n){n(!1)}function OF(n){return n!==void 0}function eR(n,e,t,r){if(r<e)throw Z2(`Invalid value for '${n}'. Expected ${e} or greater.`);if(r>t)throw Z2(`Invalid value for '${n}'. Expected ${t} or less.`)}function jF(n){const e=encodeURIComponent;let t="?";for(const r in n)if(n.hasOwnProperty(r)){const i=e(r)+"="+e(n[r]);t=t+i+"&"}return t=t.slice(0,-1),t}var pv;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(pv||(pv={}));function LF(n,e){const t=n>=500&&n<600,i=[408,429].indexOf(n)!==-1,s=e.indexOf(n)!==-1;return t||i||s}class UF{constructor(e,t,r,i,s,c,l,d,h,m,g,b=!0,_=!1){this.url_=e,this.method_=t,this.headers_=r,this.body_=i,this.successCodes_=s,this.additionalRetryCodes_=c,this.callback_=l,this.errorCallback_=d,this.timeout_=h,this.progressCallback_=m,this.connectionFactory_=g,this.retry=b,this.isUsingEmulator=_,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((R,E)=>{this.resolve_=R,this.reject_=E,this.start_()})}start_(){const e=(r,i)=>{if(i){r(!1,new qm(!1,null,!0));return}const s=this.connectionFactory_();this.pendingConnection_=s;const c=l=>{const d=l.loaded,h=l.lengthComputable?l.total:-1;this.progressCallback_!==null&&this.progressCallback_(d,h)};this.progressCallback_!==null&&s.addUploadProgressListener(c),s.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&s.removeUploadProgressListener(c),this.pendingConnection_=null;const l=s.getErrorCode()===pv.NO_ERROR,d=s.getStatus();if(!l||LF(d,this.additionalRetryCodes_)&&this.retry){const m=s.getErrorCode()===pv.ABORT;r(!1,new qm(!1,null,m));return}const h=this.successCodes_.indexOf(d)!==-1;r(!0,new qm(h,s))})},t=(r,i)=>{const s=this.resolve_,c=this.reject_,l=i.connection;if(i.wasSuccessCode)try{const d=this.callback_(l,l.getResponse());OF(d)?s(d):s()}catch(d){c(d)}else if(l!==null){const d=wF();d.serverResponse=l.getErrorText(),this.errorCallback_?c(this.errorCallback_(l,d)):c(d)}else if(i.canceled){const d=this.appDelete_?VP():RF();c(d)}else{const d=EF();c(d)}};this.canceled_?t(!1,new qm(!1,null,!0)):this.backoffId_=MF(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&DF(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class qm{constructor(e,t,r){this.wasSuccessCode=e,this.connection=t,this.canceled=!!r}}function VF(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function zF(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function FF(n,e){e&&(n["X-Firebase-GMPID"]=e)}function BF(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function $F(n,e,t,r,i,s,c=!0,l=!1){const d=jF(n.urlParams),h=n.url+d,m=Object.assign({},n.headers);return FF(m,e),VF(m,t),zF(m,s),BF(m,r),new UF(h,n.method,m,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,i,c,l)}function qF(n){if(n.length===0)return null;const e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function HF(n){const e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}class mv{constructor(e,t){this._service=e,t instanceof gs?this._location=t:this._location=gs.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new mv(e,t)}get root(){const e=new gs(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return HF(this._location.path)}get storage(){return this._service}get parent(){const e=qF(this._location.path);if(e===null)return null;const t=new gs(this._location.bucket,e);return new mv(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw IF(e)}}function tR(n,e){const t=e?.[TF];return t==null?null:gs.makeFromBucketSpec(t,n)}function GF(n,e,t,r={}){n.host=`${e}:${t}`;const i=Rl(e);i&&(R_(`https://${n.host}/b`),A_("Storage",!0)),n._isUsingEmulator=!0,n._protocol=i?"https":"http";const{mockUserToken:s}=r;s&&(n._overrideAuthToken=typeof s=="string"?s:bN(s,n.app.options.projectId))}class KF{constructor(e,t,r,i,s,c=!1){this.app=e,this._authProvider=t,this._appCheckProvider=r,this._url=i,this._firebaseVersion=s,this._isUsingEmulator=c,this._bucket=null,this._host=UP,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=kF,this._maxUploadRetryTime=CF,this._requests=new Set,i!=null?this._bucket=gs.makeFromBucketSpec(i,this._host):this._bucket=tR(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=gs.makeFromBucketSpec(this._url,e):this._bucket=tR(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){eR("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){eR("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(t!==null)return t.accessToken}return null}async _getAppCheckToken(){if(Ei(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new mv(this,e)}_makeRequest(e,t,r,i,s=!0){if(this._deleted)return new PF(VP());{const c=$F(e,this._appId,r,i,t,this._firebaseVersion,s,this._isUsingEmulator);return this._requests.add(c),c.getPromise().then(()=>this._requests.delete(c),()=>this._requests.delete(c)),c}}async makeRequestWithTokens(e,t){const[r,i]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,r,i).getPromise()}}const nR="@firebase/storage",rR="0.14.0";const zP="storage";function WF(n=P_(),e){n=hn(n);const r=Hv(n,zP).getImmediate({identifier:e}),i=gN("storage");return i&&YF(r,...i),r}function YF(n,e,t,r={}){GF(n,e,t,r)}function QF(n,{instanceIdentifier:e}){const t=n.getProvider("app").getImmediate(),r=n.getProvider("auth-internal"),i=n.getProvider("app-check-internal");return new KF(t,r,i,e,Al)}function XF(){pl(new fc(zP,QF,"PUBLIC").setMultipleInstances(!0)),Ks(nR,rR,""),Ks(nR,rR,"esm2020")}XF();const JF={apiKey:"AIzaSyAaaBO8Nw49Xsyo4QG1ropL0UYWeY2zrlU",authDomain:"meydan-academy.firebaseapp.com",projectId:"meydan-academy",storageBucket:"meydan-academy.firebasestorage.app",messagingSenderId:"267697346186",appId:"1:267697346186:web:d53b7d91fe0fabf8d37f73"},NS=SN(JF),Lu=h7(NS),_e=uF(NS);WF(NS);const FP=T.createContext({}),Ar=()=>{const n=T.useContext(FP);if(!n)throw new Error("useAuth must be used within an AuthProvider");return n},ZF=({children:n})=>{const[e,t]=T.useState(null),[r,i]=T.useState(null),[s,c]=T.useState(!0),l=async(R,E=!0)=>{if(R)try{await md(Be(_e,"users",R),{isOnline:E,lastSeen:bt()},{merge:!0})}catch(A){console.error("Presence update failed:",A)}};T.useEffect(()=>eU(Lu,async E=>{if(t(E),E){const A=oi(Be(_e,"users",E.uid),j=>{j.exists()&&i({id:j.id,...j.data()})});await l(E.uid);const M=setInterval(()=>{l(E.uid)},120*1e3),F=()=>{Be(_e,"users",E.uid),navigator.sendBeacon(`https://firestore.googleapis.com/v1/projects/meydan-academy/databases/(default)/documents/users/${E.uid}`,JSON.stringify({fields:{lastSeen:{timestampValue:new Date().toISOString()}}}))};return window.addEventListener("beforeunload",F),c(!1),()=>{A(),clearInterval(M),window.removeEventListener("beforeunload",F)}}else i(null),c(!1)}),[]);const _={currentUser:e,userProfile:r,register:async(R,E,A)=>{const M=await W8(Lu,R,E);try{await $E(M.user)}catch(F){console.error("Error sending verification email:",F)}return await md(Be(_e,"users",M.user.uid),{displayName:A,email:R,role:"member",createdAt:bt(),isOnline:!0,lastSeen:bt()}),M},login:async(R,E)=>{const A=await Y8(Lu,R,E);return await l(A.user.uid,!0),A},logout:async()=>{if(e)try{await l(e.uid,!1)}catch(R){console.log("Final presence update failed (expected):",R.code)}return tU(Lu)},resetPassword:R=>XN(Lu,R),resendVerification:()=>{if(e)return $E(e)}};return f.jsx(FP.Provider,{value:_,children:!s&&n})};let r1=null;const eB=()=>(r1||(r1=new(window.AudioContext||window.webkitAudioContext)),r1),yx=()=>{try{const n=eB(),e=n.currentTime,t=n.createOscillator(),r=n.createGain();t.connect(r),r.connect(n.destination),t.frequency.value=880,t.type="sine",r.gain.setValueAtTime(0,e),r.gain.linearRampToValueAtTime(.2,e+.01),r.gain.linearRampToValueAtTime(0,e+.1),t.start(e),t.stop(e+.1);const i=n.createOscillator(),s=n.createGain();i.connect(s),s.connect(n.destination),i.frequency.value=660,i.type="sine",s.gain.setValueAtTime(0,e+.08),s.gain.linearRampToValueAtTime(.2,e+.09),s.gain.linearRampToValueAtTime(0,e+.25),i.start(e+.08),i.stop(e+.25)}catch(n){console.error("Error playing notification sound:",n)}},tB=(n,e)=>!n||!e?!1:/@everyone\b/i.test(n)?!0:new RegExp(`@${e}\\b`,"i").test(n),BP=T.createContext(),dp=()=>{const n=T.useContext(BP);if(!n)throw new Error("useData must be used within DataProvider");return n},nB=({children:n})=>{const{currentUser:e}=Ar(),[t,r]=T.useState([]),[i,s]=T.useState([]),[c,l]=T.useState(null),[d,h]=T.useState([]),[m,g]=T.useState(null),[b,_]=T.useState({}),[R,E]=T.useState([]),A=T.useRef({}),M=T.useRef(!0);T.useEffect(()=>{if(r([]),!c)return;const N=oi(St(_e,"servers",c,"members"),async k=>{const P=[],L=[],U=new Map;if(k.docChanges().forEach(z=>{const V=z.doc.data();z.type==="added"&&(P.push(V.userId),U.set(V.userId,V.role)),z.type==="removed"&&L.push(V.userId),z.type==="modified"&&U.set(V.userId,V.role)}),t.length===0&&P.length>0){const z=new Map;k.docs.forEach(ve=>{z.set(ve.data().userId,ve.data().role||"member")});const V=Array.from(z.keys()),le=[];for(let ve=0;ve<V.length;ve+=10){const K=V.slice(ve,ve+10),oe=Yi(St(_e,"users"),il("__name__","in",K));(await bl(oe)).forEach(Me=>{le.push({id:Me.id,...Me.data(),serverRole:z.get(Me.id)})})}r(le);return}if(P.length>0&&t.length>0){const z=[];for(let V=0;V<P.length;V+=10){const le=P.slice(V,V+10),ve=Yi(St(_e,"users"),il("__name__","in",le));(await bl(ve)).forEach(oe=>{z.push({id:oe.id,...oe.data(),serverRole:U.get(oe.id)})})}r(V=>[...V,...z])}L.length>0&&r(z=>z.filter(V=>!L.includes(V.id))),k.docChanges().some(z=>z.type==="modified")&&r(z=>z.map(V=>U.has(V.id)?{...V,serverRole:U.get(V.id)}:V))}),D=Yi(St(_e,"users"),il("servers","array-contains",c),il("isOnline","==",!0)),S=oi(D,k=>{r(P=>{const L=new Map;return k.forEach(U=>{const z=U.data();L.set(U.id,{presence:z.presence,isOnline:z.isOnline,status:z.status,lastSeen:z.lastSeen,displayName:z.displayName,photoUrl:z.photoUrl||z.photoURL,bio:z.bio,role:z.role})}),P.map(U=>{const z=L.get(U.id);return z?{...U,...z}:{...U,isOnline:!1,presence:"offline",status:null}})})});return()=>{N(),S()}},[c]);const[F,j]=T.useState([]);T.useEffect(()=>{if(!e){s([]),l(null),j([]);return}return oi(Be(_e,"users",e.uid),D=>{if(!D.exists())return;const S=D.data(),k=S?.servers||[],P=S?.unreadMentions||{};Object.keys(P).forEach(L=>{const U=A.current[L]||0;(P[L]?.count||0)>U&&L!==c&&yx()}),A.current=Object.fromEntries(Object.entries(P).map(([L,U])=>[L,U.count])),_(P),j(L=>JSON.stringify(L)!==JSON.stringify(k)?k:L),l(L=>{const U=S?.currentServer;return L?L==="home"||k.includes(L)?L:k.length>0?k[0]:"home":U&&(U==="home"||k.includes(U))?U:k.length>0?k[0]:"home"})})},[e]),T.useEffect(()=>{if(s(D=>D.filter(S=>F.includes(S.id))),F.length===0){s([]);return}const N=[];for(let D=0;D<F.length;D+=10){const S=F.slice(D,D+10),k=Yi(St(_e,"servers"),il("__name__","in",S)),P=oi(k,L=>{const U=[];L.forEach(z=>{U.push({id:z.id,...z.data()})}),s(z=>[...z.filter(ve=>!S.includes(ve.id)),...U].sort((ve,K)=>F.indexOf(ve.id)-F.indexOf(K.id)))});N.push(P)}return()=>{N.forEach(D=>D())}},[F]),T.useEffect(()=>{if(!e){E([]);return}M.current=!0;const N=Yi(St(_e,"dms"),il("participants","array-contains",e.uid)),D=oi(N,S=>{const k=[];S.forEach(L=>{k.push({id:L.id,...L.data()})}),k.sort((L,U)=>{const z=L.updatedAt?.toMillis()||0;return(U.updatedAt?.toMillis()||0)-z});const P=k.filter(L=>!L.hiddenFor||!L.hiddenFor.includes(e.uid));E(P),M.current||S.docChanges().forEach(L=>{if(L.type==="modified"||L.type==="added"){const U=L.doc.data();if(U.lastMessage&&U.lastMessage.userId!==e.uid){const z=Date.now(),V=U.lastMessage.timestamp?.toMillis()||0;z-V<3e4&&yx()}}}),M.current=!1});return()=>D()},[e]),T.useEffect(()=>{if(!c){h([]),g(null);return}const N=i.find(S=>S.id===c);g(N||null);const D=oi(St(_e,"servers",c,"channels"),S=>{const k=[];S.forEach(P=>{k.push({id:P.id,...P.data()})}),h(k.sort((P,L)=>P.position-L.position))});return()=>{D()}},[c,i]);const C={users:t,servers:i,currentServer:c,setCurrentServer:l,channels:d,server:m,dms:R,unreadMentions:b};return f.jsx(BP.Provider,{value:C,children:n})};var $P={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},iR=be.createContext&&be.createContext($P),rB=["attr","size","title"];function iB(n,e){if(n==null)return{};var t=sB(n,e),r,i;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);for(i=0;i<s.length;i++)r=s[i],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(n,r)&&(t[r]=n[r])}return t}function sB(n,e){if(n==null)return{};var t={};for(var r in n)if(Object.prototype.hasOwnProperty.call(n,r)){if(e.indexOf(r)>=0)continue;t[r]=n[r]}return t}function gv(){return gv=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},gv.apply(this,arguments)}function sR(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function vv(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?sR(Object(t),!0).forEach(function(r){aB(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):sR(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function aB(n,e,t){return e=oB(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function oB(n){var e=cB(n,"string");return typeof e=="symbol"?e:e+""}function cB(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function qP(n){return n&&n.map((e,t)=>be.createElement(e.tag,vv({key:t},e.attr),qP(e.child)))}function ze(n){return e=>be.createElement(lB,gv({attr:vv({},n.attr)},e),qP(n.child))}function lB(n){var e=t=>{var{attr:r,size:i,title:s}=n,c=iB(n,rB),l=i||t.size||"1em",d;return t.className&&(d=t.className),n.className&&(d=(d?d+" ":"")+n.className),be.createElement("svg",gv({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,r,c,{className:d,style:vv(vv({color:n.color||t.color},t.style),n.style),height:l,width:l,xmlns:"http://www.w3.org/2000/svg"}),s&&be.createElement("title",null,s),n.children)};return iR!==void 0?be.createElement(iR.Consumer,null,t=>e(t)):e($P)}function HP(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M17 11c.34 0 .67.04 1 .09V6.27L10.5 3 3 6.27v4.91c0 4.54 3.2 8.79 7.5 9.82.55-.13 1.08-.32 1.6-.55-.69-.98-1.1-2.17-1.1-3.45 0-3.31 2.69-6 6-6z"},child:[]},{tag:"path",attr:{d:"M17 13c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm0 1.38c.62 0 1.12.51 1.12 1.12s-.51 1.12-1.12 1.12-1.12-.51-1.12-1.12.5-1.12 1.12-1.12zm0 5.37c-.93 0-1.74-.46-2.24-1.17.05-.72 1.51-1.08 2.24-1.08s2.19.36 2.24 1.08c-.5.71-1.31 1.17-2.24 1.17z"},child:[]}]})(n)}function GP(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"},child:[]},{tag:"path",attr:{d:"m17.6 9.48 1.84-3.18c.16-.31.04-.69-.26-.85a.637.637 0 0 0-.83.22l-1.88 3.24a11.463 11.463 0 0 0-8.94 0L5.65 5.67a.643.643 0 0 0-.87-.2c-.28.18-.37.54-.22.83L6.4 9.48A10.78 10.78 0 0 0 1 18h22a10.78 10.78 0 0 0-5.4-8.52zM7 15.25a1.25 1.25 0 1 1 0-2.5 1.25 1.25 0 0 1 0 2.5zm10 0a1.25 1.25 0 1 1 0-2.5 1.25 1.25 0 0 1 0 2.5z"},child:[]}]})(n)}function uB(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"},child:[]}]})(n)}function dB(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"},child:[]},{tag:"path",attr:{d:"M9.4 16.6 4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0 4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"},child:[]}]})(n)}function Ka(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"},child:[]}]})(n)}function hB(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M10.09 15.59 11.5 17l5-5-5-5-1.41 1.41L12.67 11H3v2h9.67l-2.58 2.59zM19 3H5a2 2 0 0 0-2 2v4h2V5h14v14H5v-4H3v4a2 2 0 0 0 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"},child:[]}]})(n)}function fB(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M13 3a9 9 0 0 0-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42A8.954 8.954 0 0 0 13 21a9 9 0 0 0 0-18zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"},child:[]}]})(n)}function IS(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"},child:[]}]})(n)}function KP(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"},child:[]}]})(n)}function pB(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"m17 7-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"},child:[]}]})(n)}function mB(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M21 11V3h-8l3.29 3.29-10 10L3 13v8h8l-3.29-3.29 10-10z"},child:[]}]})(n)}function PS(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M19 19H5V5h7V3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"},child:[]}]})(n)}function xl(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M9.19 6.35c-2.04 2.29-3.44 5.58-3.57 5.89L2 10.69l4.05-4.05c.47-.47 1.15-.68 1.81-.55l1.33.26zM11.17 17s3.74-1.55 5.89-3.7c5.4-5.4 4.5-9.62 4.21-10.57-.95-.3-5.17-1.19-10.57 4.21C8.55 9.09 7 12.83 7 12.83L11.17 17zm6.48-2.19c-2.29 2.04-5.58 3.44-5.89 3.57L13.31 22l4.05-4.05c.47-.47.68-1.15.55-1.81l-.26-1.33zM9 18c0 .83-.34 1.58-.88 2.12C6.94 21.3 2 22 2 22s.7-4.94 1.88-6.12A2.996 2.996 0 0 1 9 18zm4-9c0-1.1.9-2 2-2s2 .9 2 2-.9 2-2 2-2-.9-2-2z"},child:[]}]})(n)}function MS(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"},child:[]}]})(n)}function Rf(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"},child:[]},{tag:"path",attr:{d:"M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58a.49.49 0 0 0 .12-.61l-1.92-3.32a.488.488 0 0 0-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54a.484.484 0 0 0-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58a.49.49 0 0 0-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"},child:[]}]})(n)}function gB(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"m23 12-2.44-2.79.34-3.69-3.61-.82-1.89-3.2L12 2.96 8.6 1.5 6.71 4.69 3.1 5.5l.34 3.7L1 12l2.44 2.79-.34 3.7 3.61.82L8.6 22.5l3.4-1.47 3.4 1.46 1.89-3.19 3.61-.82-.34-3.69L23 12zm-12.91 4.72-3.8-3.81 1.48-1.48 2.32 2.33 5.85-5.87 1.48 1.48-7.33 7.35z"},child:[]}]})(n)}function vB(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"},child:[]}]})(n)}function yB(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"},child:[]}]})(n)}function Af(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0zm0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M19 11h-1.7c0 .74-.16 1.43-.43 2.05l1.23 1.23c.56-.98.9-2.09.9-3.28zm-4.02.17c0-.06.02-.11.02-.17V5c0-1.66-1.34-3-3-3S9 3.34 9 5v.18l5.98 5.99zM4.27 3 3 4.27l6.01 6.01V11c0 1.66 1.33 3 2.99 3 .22 0 .44-.03.65-.08l1.66 1.66c-.71.33-1.5.52-2.31.52-2.76 0-5.3-2.1-5.3-5.1H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c.91-.13 1.77-.45 2.54-.9L19.73 21 21 19.73 4.27 3z"},child:[]}]})(n)}function _l(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"},child:[]}]})(n)}function bB(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM9.5 16.5v-9l7 4.5-7 4.5z"},child:[]}]})(n)}function xB(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M6 6h12v12H6z"},child:[]}]})(n)}function bx(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0zm0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"m21 6.5-4 4V7c0-.55-.45-1-1-1H9.82L21 17.18V6.5zM3.27 2 2 3.27 4.73 6H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.21 0 .39-.08.54-.18L19.73 21 21 19.73 3.27 2z"},child:[]}]})(n)}function Nf(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"},child:[]}]})(n)}function _B(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M7 9v6h4l5 5V4l-5 5H7z"},child:[]}]})(n)}function aR(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M16.5 12A4.5 4.5 0 0 0 14 7.97v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51A8.796 8.796 0 0 0 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3 3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06a8.99 8.99 0 0 0 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4 9.91 6.09 12 8.18V4z"},child:[]}]})(n)}function xx(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M3 9v6h4l5 5V4L7 9H3zm13.5 3A4.5 4.5 0 0 0 14 7.97v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"},child:[]}]})(n)}function ff(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M12 9c-1.6 0-3.15.25-4.6.72v3.1c0 .39-.23.74-.56.9-.98.49-1.87 1.12-2.66 1.85-.18.18-.43.28-.7.28-.28 0-.53-.11-.71-.29L.29 13.08a.956.956 0 0 1-.29-.7c0-.28.11-.53.29-.71C3.34 8.78 7.46 7 12 7s8.66 1.78 11.71 4.67c.18.18.29.43.29.71 0 .28-.11.53-.29.71l-2.48 2.48c-.18.18-.43.29-.71.29-.27 0-.52-.11-.7-.28a11.27 11.27 0 0 0-2.67-1.85.996.996 0 0 1-.56-.9v-3.1C15.15 9.25 13.6 9 12 9z"},child:[]}]})(n)}function SB(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M20.01 15.38c-1.23 0-2.42-.2-3.53-.56a.977.977 0 0 0-1.01.24l-1.57 1.97c-2.83-1.35-5.48-3.9-6.89-6.83l1.95-1.66c.27-.28.35-.67.24-1.02-.37-1.11-.56-2.3-.56-3.53 0-.54-.45-.99-.99-.99H4.19C3.65 3 3 3.24 3 3.99 3 13.28 10.73 21 20.01 21c.71 0 .99-.63.99-1.18v-3.45c0-.54-.45-.99-.99-.99z"},child:[]}]})(n)}function TB(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"},child:[]}]})(n)}function kB(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"},child:[]}]})(n)}function If(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"},child:[]},{tag:"path",attr:{d:"M20 18c1.1 0 1.99-.9 1.99-2L22 6a2 2 0 0 0-2-2H4c-1.11 0-2 .89-2 2v10a2 2 0 0 0 2 2H0v2h24v-2h-4zm-7-3.53v-2.19c-2.78 0-4.61.85-6 2.72.56-2.67 2.11-5.33 6-5.87V7l4 3.73-4 3.74z"},child:[]}]})(n)}function WP(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"},child:[]},{tag:"path",attr:{d:"m21.22 18.02 2 2H24v-2h-2.78zm.77-2 .01-10a2 2 0 0 0-2-2H7.22l5.23 5.23c.18-.04.36-.07.55-.1V7.02l4 3.73-1.58 1.47 5.54 5.54c.61-.33 1.03-.99 1.03-1.74zM2.39 1.73 1.11 3l1.54 1.54c-.4.36-.65.89-.65 1.48v10a2 2 0 0 0 2 2H0v2h18.13l2.71 2.71 1.27-1.27L2.39 1.73zM7 15.02c.31-1.48.92-2.95 2.07-4.06l1.59 1.59c-1.54.38-2.7 1.18-3.66 2.47z"},child:[]}]})(n)}function oR(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"},child:[]}]})(n)}function Wu(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"},child:[]}]})(n)}function CB(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"},child:[]}]})(n)}function Yu(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{fillRule:"evenodd",d:"M16 9V4h1c.55 0 1-.45 1-1s-.45-1-1-1H7c-.55 0-1 .45-1 1s.45 1 1 1h1v5c0 1.66-1.34 3-3 3v2h5.97v7l1 1 1-1v-7H19v-2c-1.66 0-3-1.34-3-3z"},child:[]}]})(n)}function wB(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M10 9V5l-7 7 7 7v-4.1c5 0 8.5 1.6 11 5.1-1-5-4-10-11-11z"},child:[]}]})(n)}function i1(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"},child:[]}]})(n)}function YP(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M20 10V8h-4V4h-2v4h-4V4H8v4H4v2h4v4H4v2h4v4h2v-4h4v4h2v-4h4v-2h-4v-4h4zm-6 4h-4v-4h4v4z"},child:[]}]})(n)}function _x(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M7 18h2V6H7v12zm4 4h2V2h-2v20zm-8-8h2v-4H3v4zm12 4h2V6h-2v12zm4-8v4h2v-4h-2z"},child:[]}]})(n)}function EB(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M17 4h3v16h-3zM5 14h3v6H5zm6-5h3v11h-3z"},child:[]}]})(n)}function RB(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M20 9H4v2h16V9zM4 15h16v-2H4v2z"},child:[]}]})(n)}function AB(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{fillRule:"evenodd",d:"M4 11h16v2H4z"},child:[]}]})(n)}function NB(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M5 20h14v-2H5v2zM19 9h-4V3H9v6H5l7 7 7-7z"},child:[]}]})(n)}function Sx(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M5 20h14v-2H5v2zm0-10h4v6h6v-6h4l-7-7-7 7z"},child:[]}]})(n)}function IB(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M20 3H4c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h6v2H8v2h8v-2h-2v-2h6c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2"},child:[]}]})(n)}function PB(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"},child:[]},{tag:"path",attr:{d:"M12 4c3.87 0 7 3.13 7 7v2h-2.92L21 17.92V11a9 9 0 0 0-9-9c-1.95 0-3.76.62-5.23 1.68l1.44 1.44A6.914 6.914 0 0 1 12 4zM2.27 1.72 1 3l3.33 3.32A8.899 8.899 0 0 0 3 11v7c0 1.66 1.34 3 3 3h3v-8H5v-2c0-1.17.29-2.26.79-3.22L15 17v4h3c.3 0 .59-.06.86-.14L21 23l1.27-1.27-20-20.01z"},child:[]}]})(n)}function MB(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z",opacity:".1"},child:[]},{tag:"path",attr:{d:"M12 1a9 9 0 0 0-9 9v7c0 1.66 1.34 3 3 3h3v-8H5v-2c0-3.87 3.13-7 7-7s7 3.13 7 7v2h-4v8h3c1.66 0 3-1.34 3-3v-7a9 9 0 0 0-9-9z"},child:[]}]})(n)}function QP(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"},child:[]},{tag:"path",attr:{d:"M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"},child:[]}]})(n)}function DB(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M12 1 3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"},child:[]}]})(n)}function OB(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M19 7v2.99s-1.99.01-2 0V7h-3s.01-1.99 0-2h3V2h2v3h3v2h-3zm-3 4V8h-3V5H5c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-8h-3zM5 19l3-4 2 3 3-4 4 5H5z"},child:[]}]})(n)}function jB(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"m19 9 1.25-2.75L23 5l-2.75-1.25L19 1l-1.25 2.75L15 5l2.75 1.25L19 9zm-7.5.5L9 4 6.5 9.5 1 12l5.5 2.5L9 20l2.5-5.5L17 12l-5.5-2.5zM19 15l-1.25 2.75L15 19l2.75 1.25L19 23l1.25-2.75L23 19l-2.75-1.25L19 15z"},child:[]}]})(n)}function Qu(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04a.996.996 0 0 0 0-1.41l-2.34-2.34a.996.996 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"},child:[]}]})(n)}function yv(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"},child:[]}]})(n)}function LB(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"},child:[]}]})(n)}function UB(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M12 2C6.49 2 2 6.49 2 12s4.49 10 10 10a2.5 2.5 0 0 0 2.5-2.5c0-.61-.23-1.2-.64-1.67a.528.528 0 0 1-.13-.33c0-.28.22-.5.5-.5H16c3.31 0 6-2.69 6-6 0-4.96-4.49-9-10-9zm5.5 11c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm-3-4c-.83 0-1.5-.67-1.5-1.5S13.67 6 14.5 6s1.5.67 1.5 1.5S15.33 9 14.5 9zM5 11.5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5S7.33 13 6.5 13 5 12.33 5 11.5zm6-4c0 .83-.67 1.5-1.5 1.5S8 8.33 8 7.5 8.67 6 9.5 6s1.5.67 1.5 1.5z"},child:[]}]})(n)}function VB(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M16 11h-1V3c0-1.1-.9-2-2-2h-2c-1.1 0-2 .9-2 2v8H8c-2.76 0-5 2.24-5 5v7h18v-7c0-2.76-2.24-5-5-5zm3 10h-2v-3c0-.55-.45-1-1-1s-1 .45-1 1v3h-2v-3c0-.55-.45-1-1-1s-1 .45-1 1v3H9v-3c0-.55-.45-1-1-1s-1 .45-1 1v3H5v-5c0-1.65 1.35-3 3-3h8c1.65 0 3 1.35 3 3v5z"},child:[]}]})(n)}function zB(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M12.16 3h-.32L9.21 8.25h5.58zM16.46 8.25h5.16L19 3h-5.16zM21.38 9.75h-8.63V20.1zM11.25 20.1V9.75H2.62zM7.54 8.25 10.16 3H5L2.38 8.25z"},child:[]}]})(n)}function Sl(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"},child:[]}]})(n)}function mr(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"},child:[]}]})(n)}function FB(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"},child:[]}]})(n)}function BB(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"},child:[]}]})(n)}function cR(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"},child:[]}]})(n)}function $B(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"},child:[]}]})(n)}function qB(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M17.65 6.35A7.958 7.958 0 0 0 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08A5.99 5.99 0 0 1 12 18c-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"},child:[]}]})(n)}function HB(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M21 12.22C21 6.73 16.74 3 12 3c-4.69 0-9 3.65-9 9.28-.6.34-1 .98-1 1.72v2c0 1.1.9 2 2 2h1v-6.1c0-3.87 3.13-7 7-7s7 3.13 7 7V19h-8v2h8c1.1 0 2-.9 2-2v-1.22c.59-.31 1-.92 1-1.64v-2.3c0-.7-.41-1.31-1-1.62z"},child:[]},{tag:"circle",attr:{cx:"9",cy:"13",r:"1"},child:[]},{tag:"circle",attr:{cx:"15",cy:"13",r:"1"},child:[]},{tag:"path",attr:{d:"M18 11.03A6.04 6.04 0 0 0 12.05 6c-3.03 0-6.29 2.51-6.03 6.45a8.075 8.075 0 0 0 4.86-5.89c1.31 2.63 4 4.44 7.12 4.47z"},child:[]}]})(n)}function GB(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M17 1.01 7 1c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-1.99-2-1.99zM17 19H7V5h10v14zm-1-6h-3V8h-2v5H8l4 4 4-4z"},child:[]}]})(n)}function KB(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M11 11V3H5c-1.1 0-2 .9-2 2v6h8zm2 0h8V5c0-1.1-.9-2-2-2h-6v8zm-2 2H3v6c0 1.1.9 2 2 2h6v-8zm2 0v8h6c1.1 0 2-.9 2-2v-6h-8z"},child:[]}]})(n)}function lR(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M18 9V7h-2V2.84A9.929 9.929 0 0 0 11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12c0-1.05-.17-2.05-.47-3H18zm-2.5-1c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5-1.5-.67-1.5-1.5.67-1.5 1.5-1.5zm-7 0c.83 0 1.5.67 1.5 1.5S9.33 11 8.5 11 7 10.33 7 9.5 7.67 8 8.5 8zm3.5 9.5c-2.33 0-4.31-1.46-5.11-3.5h10.22c-.8 2.04-2.78 3.5-5.11 3.5zM22 3h2v2h-2v2h-2V5h-2V3h2V1h2v2z"},child:[]}]})(n)}function XP(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM8.5 8c.83 0 1.5.67 1.5 1.5S9.33 11 8.5 11 7 10.33 7 9.5 7.67 8 8.5 8zM12 18c-2.28 0-4.22-1.66-5-4h10c-.78 2.34-2.72 4-5 4zm3.5-7c-.83 0-1.5-.67-1.5-1.5S14.67 8 15.5 8s1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"},child:[]}]})(n)}function DS(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"},child:[]}]})(n)}function WB(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm-9-2V7H4v3H1v2h3v3h2v-3h3v-2H6zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"},child:[]}]})(n)}function YB(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"},child:[]}]})(n)}function OS(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"},child:[]}]})(n)}function QB(n){return ze({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"},child:[]}]})(n)}const JP=T.createContext(),Ss=()=>{const n=T.useContext(JP);if(!n)throw new Error("useToast must be used within ToastProvider");return n},XB=({children:n})=>{const[e,t]=T.useState([]),r=T.useCallback((h,m="info")=>{const g=Date.now();t(b=>[...b,{id:g,message:h,type:m}]),setTimeout(()=>{t(b=>b.filter(_=>_.id!==g))},4e3)},[]),i=T.useCallback(h=>{t(m=>m.filter(g=>g.id!==h))},[]),s=T.useCallback(h=>r(h,"success"),[r]),c=T.useCallback(h=>r(h,"error"),[r]),l=T.useCallback(h=>r(h,"info"),[r]),d=T.useCallback(h=>r(h,"warning"),[r]);return f.jsxs(JP.Provider,{value:{success:s,error:c,info:l,warning:d},children:[n,f.jsx(JB,{toasts:e,removeToast:i})]})},JB=({toasts:n,removeToast:e})=>f.jsx("div",{className:"fixed bottom-4 right-4 z-50 space-y-2",children:n.map(t=>f.jsx(ZB,{toast:t,onClose:()=>e(t.id)},t.id))}),ZB=({toast:n,onClose:e})=>{const t={success:f.jsx(uB,{size:20}),error:f.jsx(vB,{size:20}),warning:f.jsx(yB,{size:20}),info:f.jsx(IS,{size:20})},r={success:"bg-green-600 border-green-500",error:"bg-red-600 border-red-500",warning:"bg-yellow-600 border-yellow-500",info:"bg-blue-600 border-blue-500"};return f.jsxs("div",{className:`${r[n.type]} border-l-4 text-white px-4 py-3 rounded-lg shadow-lg 
                  flex items-center gap-3 min-w-[300px] max-w-md animate-slide-in`,children:[f.jsx("div",{className:"flex-shrink-0",children:t[n.type]}),f.jsx("div",{className:"flex-1 text-sm font-medium",children:n.message}),f.jsx("button",{onClick:e,className:"flex-shrink-0 hover:bg-white/20 rounded p-1 transition-colors",children:f.jsx(mr,{size:18})})]})};function ZP(n){var e,t,r="";if(typeof n=="string"||typeof n=="number")r+=n;else if(typeof n=="object")if(Array.isArray(n)){var i=n.length;for(e=0;e<i;e++)n[e]&&(t=ZP(n[e]))&&(r&&(r+=" "),r+=t)}else for(t in n)n[t]&&(r&&(r+=" "),r+=t);return r}function e$(){for(var n,e,t=0,r="",i=arguments.length;t<i;t++)(n=arguments[t])&&(e=ZP(n))&&(r&&(r+=" "),r+=e);return r}const t$=(n,e)=>{const t=new Array(n.length+e.length);for(let r=0;r<n.length;r++)t[r]=n[r];for(let r=0;r<e.length;r++)t[n.length+r]=e[r];return t},n$=(n,e)=>({classGroupId:n,validator:e}),e5=(n=new Map,e=null,t)=>({nextPart:n,validators:e,classGroupId:t}),bv="-",uR=[],r$="arbitrary..",i$=n=>{const e=a$(n),{conflictingClassGroups:t,conflictingClassGroupModifiers:r}=n;return{getClassGroupId:c=>{if(c.startsWith("[")&&c.endsWith("]"))return s$(c);const l=c.split(bv),d=l[0]===""&&l.length>1?1:0;return t5(l,d,e)},getConflictingClassGroupIds:(c,l)=>{if(l){const d=r[c],h=t[c];return d?h?t$(h,d):d:h||uR}return t[c]||uR}}},t5=(n,e,t)=>{if(n.length-e===0)return t.classGroupId;const i=n[e],s=t.nextPart.get(i);if(s){const h=t5(n,e+1,s);if(h)return h}const c=t.validators;if(c===null)return;const l=e===0?n.join(bv):n.slice(e).join(bv),d=c.length;for(let h=0;h<d;h++){const m=c[h];if(m.validator(l))return m.classGroupId}},s$=n=>n.slice(1,-1).indexOf(":")===-1?void 0:(()=>{const e=n.slice(1,-1),t=e.indexOf(":"),r=e.slice(0,t);return r?r$+r:void 0})(),a$=n=>{const{theme:e,classGroups:t}=n;return o$(t,e)},o$=(n,e)=>{const t=e5();for(const r in n){const i=n[r];jS(i,t,r,e)}return t},jS=(n,e,t,r)=>{const i=n.length;for(let s=0;s<i;s++){const c=n[s];c$(c,e,t,r)}},c$=(n,e,t,r)=>{if(typeof n=="string"){l$(n,e,t);return}if(typeof n=="function"){u$(n,e,t,r);return}d$(n,e,t,r)},l$=(n,e,t)=>{const r=n===""?e:n5(e,n);r.classGroupId=t},u$=(n,e,t,r)=>{if(h$(n)){jS(n(r),e,t,r);return}e.validators===null&&(e.validators=[]),e.validators.push(n$(t,n))},d$=(n,e,t,r)=>{const i=Object.entries(n),s=i.length;for(let c=0;c<s;c++){const[l,d]=i[c];jS(d,n5(e,l),t,r)}},n5=(n,e)=>{let t=n;const r=e.split(bv),i=r.length;for(let s=0;s<i;s++){const c=r[s];let l=t.nextPart.get(c);l||(l=e5(),t.nextPart.set(c,l)),t=l}return t},h$=n=>"isThemeGetter"in n&&n.isThemeGetter===!0,f$=n=>{if(n<1)return{get:()=>{},set:()=>{}};let e=0,t=Object.create(null),r=Object.create(null);const i=(s,c)=>{t[s]=c,e++,e>n&&(e=0,r=t,t=Object.create(null))};return{get(s){let c=t[s];if(c!==void 0)return c;if((c=r[s])!==void 0)return i(s,c),c},set(s,c){s in t?t[s]=c:i(s,c)}}},Tx="!",dR=":",p$=[],hR=(n,e,t,r,i)=>({modifiers:n,hasImportantModifier:e,baseClassName:t,maybePostfixModifierPosition:r,isExternal:i}),m$=n=>{const{prefix:e,experimentalParseClassName:t}=n;let r=i=>{const s=[];let c=0,l=0,d=0,h;const m=i.length;for(let E=0;E<m;E++){const A=i[E];if(c===0&&l===0){if(A===dR){s.push(i.slice(d,E)),d=E+1;continue}if(A==="/"){h=E;continue}}A==="["?c++:A==="]"?c--:A==="("?l++:A===")"&&l--}const g=s.length===0?i:i.slice(d);let b=g,_=!1;g.endsWith(Tx)?(b=g.slice(0,-1),_=!0):g.startsWith(Tx)&&(b=g.slice(1),_=!0);const R=h&&h>d?h-d:void 0;return hR(s,_,b,R)};if(e){const i=e+dR,s=r;r=c=>c.startsWith(i)?s(c.slice(i.length)):hR(p$,!1,c,void 0,!0)}if(t){const i=r;r=s=>t({className:s,parseClassName:i})}return r},g$=n=>{const e=new Map;return n.orderSensitiveModifiers.forEach((t,r)=>{e.set(t,1e6+r)}),t=>{const r=[];let i=[];for(let s=0;s<t.length;s++){const c=t[s],l=c[0]==="[",d=e.has(c);l||d?(i.length>0&&(i.sort(),r.push(...i),i=[]),r.push(c)):i.push(c)}return i.length>0&&(i.sort(),r.push(...i)),r}},v$=n=>({cache:f$(n.cacheSize),parseClassName:m$(n),sortModifiers:g$(n),...i$(n)}),y$=/\s+/,b$=(n,e)=>{const{parseClassName:t,getClassGroupId:r,getConflictingClassGroupIds:i,sortModifiers:s}=e,c=[],l=n.trim().split(y$);let d="";for(let h=l.length-1;h>=0;h-=1){const m=l[h],{isExternal:g,modifiers:b,hasImportantModifier:_,baseClassName:R,maybePostfixModifierPosition:E}=t(m);if(g){d=m+(d.length>0?" "+d:d);continue}let A=!!E,M=r(A?R.substring(0,E):R);if(!M){if(!A){d=m+(d.length>0?" "+d:d);continue}if(M=r(R),!M){d=m+(d.length>0?" "+d:d);continue}A=!1}const F=b.length===0?"":b.length===1?b[0]:s(b).join(":"),j=_?F+Tx:F,C=j+M;if(c.indexOf(C)>-1)continue;c.push(C);const N=i(M,A);for(let D=0;D<N.length;++D){const S=N[D];c.push(j+S)}d=m+(d.length>0?" "+d:d)}return d},x$=(...n)=>{let e=0,t,r,i="";for(;e<n.length;)(t=n[e++])&&(r=r5(t))&&(i&&(i+=" "),i+=r);return i},r5=n=>{if(typeof n=="string")return n;let e,t="";for(let r=0;r<n.length;r++)n[r]&&(e=r5(n[r]))&&(t&&(t+=" "),t+=e);return t},_$=(n,...e)=>{let t,r,i,s;const c=d=>{const h=e.reduce((m,g)=>g(m),n());return t=v$(h),r=t.cache.get,i=t.cache.set,s=l,l(d)},l=d=>{const h=r(d);if(h)return h;const m=b$(d,t);return i(d,m),m};return s=c,(...d)=>s(x$(...d))},S$=[],rr=n=>{const e=t=>t[n]||S$;return e.isThemeGetter=!0,e},i5=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,s5=/^\((?:(\w[\w-]*):)?(.+)\)$/i,T$=/^\d+\/\d+$/,k$=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,C$=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,w$=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,E$=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,R$=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Ru=n=>T$.test(n),kt=n=>!!n&&!Number.isNaN(Number(n)),Fo=n=>!!n&&Number.isInteger(Number(n)),s1=n=>n.endsWith("%")&&kt(n.slice(0,-1)),Ma=n=>k$.test(n),A$=()=>!0,N$=n=>C$.test(n)&&!w$.test(n),a5=()=>!1,I$=n=>E$.test(n),P$=n=>R$.test(n),M$=n=>!Qe(n)&&!Xe(n),D$=n=>Md(n,l5,a5),Qe=n=>i5.test(n),el=n=>Md(n,u5,N$),a1=n=>Md(n,V$,kt),fR=n=>Md(n,o5,a5),O$=n=>Md(n,c5,P$),Hm=n=>Md(n,d5,I$),Xe=n=>s5.test(n),Uh=n=>Dd(n,u5),j$=n=>Dd(n,z$),pR=n=>Dd(n,o5),L$=n=>Dd(n,l5),U$=n=>Dd(n,c5),Gm=n=>Dd(n,d5,!0),Md=(n,e,t)=>{const r=i5.exec(n);return r?r[1]?e(r[1]):t(r[2]):!1},Dd=(n,e,t=!1)=>{const r=s5.exec(n);return r?r[1]?e(r[1]):t:!1},o5=n=>n==="position"||n==="percentage",c5=n=>n==="image"||n==="url",l5=n=>n==="length"||n==="size"||n==="bg-size",u5=n=>n==="length",V$=n=>n==="number",z$=n=>n==="family-name",d5=n=>n==="shadow",F$=()=>{const n=rr("color"),e=rr("font"),t=rr("text"),r=rr("font-weight"),i=rr("tracking"),s=rr("leading"),c=rr("breakpoint"),l=rr("container"),d=rr("spacing"),h=rr("radius"),m=rr("shadow"),g=rr("inset-shadow"),b=rr("text-shadow"),_=rr("drop-shadow"),R=rr("blur"),E=rr("perspective"),A=rr("aspect"),M=rr("ease"),F=rr("animate"),j=()=>["auto","avoid","all","avoid-page","page","left","right","column"],C=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],N=()=>[...C(),Xe,Qe],D=()=>["auto","hidden","clip","visible","scroll"],S=()=>["auto","contain","none"],k=()=>[Xe,Qe,d],P=()=>[Ru,"full","auto",...k()],L=()=>[Fo,"none","subgrid",Xe,Qe],U=()=>["auto",{span:["full",Fo,Xe,Qe]},Fo,Xe,Qe],z=()=>[Fo,"auto",Xe,Qe],V=()=>["auto","min","max","fr",Xe,Qe],le=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],ve=()=>["start","end","center","stretch","center-safe","end-safe"],K=()=>["auto",...k()],oe=()=>[Ru,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...k()],ee=()=>[n,Xe,Qe],Me=()=>[...C(),pR,fR,{position:[Xe,Qe]}],je=()=>["no-repeat",{repeat:["","x","y","space","round"]}],q=()=>["auto","cover","contain",L$,D$,{size:[Xe,Qe]}],te=()=>[s1,Uh,el],fe=()=>["","none","full",h,Xe,Qe],Se=()=>["",kt,Uh,el],Oe=()=>["solid","dashed","dotted","double"],Te=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],we=()=>[kt,s1,pR,fR],Ge=()=>["","none",R,Xe,Qe],Ke=()=>["none",kt,Xe,Qe],Ce=()=>["none",kt,Xe,Qe],Re=()=>[kt,Xe,Qe],He=()=>[Ru,"full",...k()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[Ma],breakpoint:[Ma],color:[A$],container:[Ma],"drop-shadow":[Ma],ease:["in","out","in-out"],font:[M$],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[Ma],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[Ma],shadow:[Ma],spacing:["px",kt],text:[Ma],"text-shadow":[Ma],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",Ru,Qe,Xe,A]}],container:["container"],columns:[{columns:[kt,Qe,Xe,l]}],"break-after":[{"break-after":j()}],"break-before":[{"break-before":j()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:N()}],overflow:[{overflow:D()}],"overflow-x":[{"overflow-x":D()}],"overflow-y":[{"overflow-y":D()}],overscroll:[{overscroll:S()}],"overscroll-x":[{"overscroll-x":S()}],"overscroll-y":[{"overscroll-y":S()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:P()}],"inset-x":[{"inset-x":P()}],"inset-y":[{"inset-y":P()}],start:[{start:P()}],end:[{end:P()}],top:[{top:P()}],right:[{right:P()}],bottom:[{bottom:P()}],left:[{left:P()}],visibility:["visible","invisible","collapse"],z:[{z:[Fo,"auto",Xe,Qe]}],basis:[{basis:[Ru,"full","auto",l,...k()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[kt,Ru,"auto","initial","none",Qe]}],grow:[{grow:["",kt,Xe,Qe]}],shrink:[{shrink:["",kt,Xe,Qe]}],order:[{order:[Fo,"first","last","none",Xe,Qe]}],"grid-cols":[{"grid-cols":L()}],"col-start-end":[{col:U()}],"col-start":[{"col-start":z()}],"col-end":[{"col-end":z()}],"grid-rows":[{"grid-rows":L()}],"row-start-end":[{row:U()}],"row-start":[{"row-start":z()}],"row-end":[{"row-end":z()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":V()}],"auto-rows":[{"auto-rows":V()}],gap:[{gap:k()}],"gap-x":[{"gap-x":k()}],"gap-y":[{"gap-y":k()}],"justify-content":[{justify:[...le(),"normal"]}],"justify-items":[{"justify-items":[...ve(),"normal"]}],"justify-self":[{"justify-self":["auto",...ve()]}],"align-content":[{content:["normal",...le()]}],"align-items":[{items:[...ve(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...ve(),{baseline:["","last"]}]}],"place-content":[{"place-content":le()}],"place-items":[{"place-items":[...ve(),"baseline"]}],"place-self":[{"place-self":["auto",...ve()]}],p:[{p:k()}],px:[{px:k()}],py:[{py:k()}],ps:[{ps:k()}],pe:[{pe:k()}],pt:[{pt:k()}],pr:[{pr:k()}],pb:[{pb:k()}],pl:[{pl:k()}],m:[{m:K()}],mx:[{mx:K()}],my:[{my:K()}],ms:[{ms:K()}],me:[{me:K()}],mt:[{mt:K()}],mr:[{mr:K()}],mb:[{mb:K()}],ml:[{ml:K()}],"space-x":[{"space-x":k()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":k()}],"space-y-reverse":["space-y-reverse"],size:[{size:oe()}],w:[{w:[l,"screen",...oe()]}],"min-w":[{"min-w":[l,"screen","none",...oe()]}],"max-w":[{"max-w":[l,"screen","none","prose",{screen:[c]},...oe()]}],h:[{h:["screen","lh",...oe()]}],"min-h":[{"min-h":["screen","lh","none",...oe()]}],"max-h":[{"max-h":["screen","lh",...oe()]}],"font-size":[{text:["base",t,Uh,el]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[r,Xe,a1]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",s1,Qe]}],"font-family":[{font:[j$,Qe,e]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[i,Xe,Qe]}],"line-clamp":[{"line-clamp":[kt,"none",Xe,a1]}],leading:[{leading:[s,...k()]}],"list-image":[{"list-image":["none",Xe,Qe]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",Xe,Qe]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:ee()}],"text-color":[{text:ee()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Oe(),"wavy"]}],"text-decoration-thickness":[{decoration:[kt,"from-font","auto",Xe,el]}],"text-decoration-color":[{decoration:ee()}],"underline-offset":[{"underline-offset":[kt,"auto",Xe,Qe]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:k()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Xe,Qe]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Xe,Qe]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:Me()}],"bg-repeat":[{bg:je()}],"bg-size":[{bg:q()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},Fo,Xe,Qe],radial:["",Xe,Qe],conic:[Fo,Xe,Qe]},U$,O$]}],"bg-color":[{bg:ee()}],"gradient-from-pos":[{from:te()}],"gradient-via-pos":[{via:te()}],"gradient-to-pos":[{to:te()}],"gradient-from":[{from:ee()}],"gradient-via":[{via:ee()}],"gradient-to":[{to:ee()}],rounded:[{rounded:fe()}],"rounded-s":[{"rounded-s":fe()}],"rounded-e":[{"rounded-e":fe()}],"rounded-t":[{"rounded-t":fe()}],"rounded-r":[{"rounded-r":fe()}],"rounded-b":[{"rounded-b":fe()}],"rounded-l":[{"rounded-l":fe()}],"rounded-ss":[{"rounded-ss":fe()}],"rounded-se":[{"rounded-se":fe()}],"rounded-ee":[{"rounded-ee":fe()}],"rounded-es":[{"rounded-es":fe()}],"rounded-tl":[{"rounded-tl":fe()}],"rounded-tr":[{"rounded-tr":fe()}],"rounded-br":[{"rounded-br":fe()}],"rounded-bl":[{"rounded-bl":fe()}],"border-w":[{border:Se()}],"border-w-x":[{"border-x":Se()}],"border-w-y":[{"border-y":Se()}],"border-w-s":[{"border-s":Se()}],"border-w-e":[{"border-e":Se()}],"border-w-t":[{"border-t":Se()}],"border-w-r":[{"border-r":Se()}],"border-w-b":[{"border-b":Se()}],"border-w-l":[{"border-l":Se()}],"divide-x":[{"divide-x":Se()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":Se()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...Oe(),"hidden","none"]}],"divide-style":[{divide:[...Oe(),"hidden","none"]}],"border-color":[{border:ee()}],"border-color-x":[{"border-x":ee()}],"border-color-y":[{"border-y":ee()}],"border-color-s":[{"border-s":ee()}],"border-color-e":[{"border-e":ee()}],"border-color-t":[{"border-t":ee()}],"border-color-r":[{"border-r":ee()}],"border-color-b":[{"border-b":ee()}],"border-color-l":[{"border-l":ee()}],"divide-color":[{divide:ee()}],"outline-style":[{outline:[...Oe(),"none","hidden"]}],"outline-offset":[{"outline-offset":[kt,Xe,Qe]}],"outline-w":[{outline:["",kt,Uh,el]}],"outline-color":[{outline:ee()}],shadow:[{shadow:["","none",m,Gm,Hm]}],"shadow-color":[{shadow:ee()}],"inset-shadow":[{"inset-shadow":["none",g,Gm,Hm]}],"inset-shadow-color":[{"inset-shadow":ee()}],"ring-w":[{ring:Se()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:ee()}],"ring-offset-w":[{"ring-offset":[kt,el]}],"ring-offset-color":[{"ring-offset":ee()}],"inset-ring-w":[{"inset-ring":Se()}],"inset-ring-color":[{"inset-ring":ee()}],"text-shadow":[{"text-shadow":["none",b,Gm,Hm]}],"text-shadow-color":[{"text-shadow":ee()}],opacity:[{opacity:[kt,Xe,Qe]}],"mix-blend":[{"mix-blend":[...Te(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":Te()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[kt]}],"mask-image-linear-from-pos":[{"mask-linear-from":we()}],"mask-image-linear-to-pos":[{"mask-linear-to":we()}],"mask-image-linear-from-color":[{"mask-linear-from":ee()}],"mask-image-linear-to-color":[{"mask-linear-to":ee()}],"mask-image-t-from-pos":[{"mask-t-from":we()}],"mask-image-t-to-pos":[{"mask-t-to":we()}],"mask-image-t-from-color":[{"mask-t-from":ee()}],"mask-image-t-to-color":[{"mask-t-to":ee()}],"mask-image-r-from-pos":[{"mask-r-from":we()}],"mask-image-r-to-pos":[{"mask-r-to":we()}],"mask-image-r-from-color":[{"mask-r-from":ee()}],"mask-image-r-to-color":[{"mask-r-to":ee()}],"mask-image-b-from-pos":[{"mask-b-from":we()}],"mask-image-b-to-pos":[{"mask-b-to":we()}],"mask-image-b-from-color":[{"mask-b-from":ee()}],"mask-image-b-to-color":[{"mask-b-to":ee()}],"mask-image-l-from-pos":[{"mask-l-from":we()}],"mask-image-l-to-pos":[{"mask-l-to":we()}],"mask-image-l-from-color":[{"mask-l-from":ee()}],"mask-image-l-to-color":[{"mask-l-to":ee()}],"mask-image-x-from-pos":[{"mask-x-from":we()}],"mask-image-x-to-pos":[{"mask-x-to":we()}],"mask-image-x-from-color":[{"mask-x-from":ee()}],"mask-image-x-to-color":[{"mask-x-to":ee()}],"mask-image-y-from-pos":[{"mask-y-from":we()}],"mask-image-y-to-pos":[{"mask-y-to":we()}],"mask-image-y-from-color":[{"mask-y-from":ee()}],"mask-image-y-to-color":[{"mask-y-to":ee()}],"mask-image-radial":[{"mask-radial":[Xe,Qe]}],"mask-image-radial-from-pos":[{"mask-radial-from":we()}],"mask-image-radial-to-pos":[{"mask-radial-to":we()}],"mask-image-radial-from-color":[{"mask-radial-from":ee()}],"mask-image-radial-to-color":[{"mask-radial-to":ee()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":C()}],"mask-image-conic-pos":[{"mask-conic":[kt]}],"mask-image-conic-from-pos":[{"mask-conic-from":we()}],"mask-image-conic-to-pos":[{"mask-conic-to":we()}],"mask-image-conic-from-color":[{"mask-conic-from":ee()}],"mask-image-conic-to-color":[{"mask-conic-to":ee()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:Me()}],"mask-repeat":[{mask:je()}],"mask-size":[{mask:q()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",Xe,Qe]}],filter:[{filter:["","none",Xe,Qe]}],blur:[{blur:Ge()}],brightness:[{brightness:[kt,Xe,Qe]}],contrast:[{contrast:[kt,Xe,Qe]}],"drop-shadow":[{"drop-shadow":["","none",_,Gm,Hm]}],"drop-shadow-color":[{"drop-shadow":ee()}],grayscale:[{grayscale:["",kt,Xe,Qe]}],"hue-rotate":[{"hue-rotate":[kt,Xe,Qe]}],invert:[{invert:["",kt,Xe,Qe]}],saturate:[{saturate:[kt,Xe,Qe]}],sepia:[{sepia:["",kt,Xe,Qe]}],"backdrop-filter":[{"backdrop-filter":["","none",Xe,Qe]}],"backdrop-blur":[{"backdrop-blur":Ge()}],"backdrop-brightness":[{"backdrop-brightness":[kt,Xe,Qe]}],"backdrop-contrast":[{"backdrop-contrast":[kt,Xe,Qe]}],"backdrop-grayscale":[{"backdrop-grayscale":["",kt,Xe,Qe]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[kt,Xe,Qe]}],"backdrop-invert":[{"backdrop-invert":["",kt,Xe,Qe]}],"backdrop-opacity":[{"backdrop-opacity":[kt,Xe,Qe]}],"backdrop-saturate":[{"backdrop-saturate":[kt,Xe,Qe]}],"backdrop-sepia":[{"backdrop-sepia":["",kt,Xe,Qe]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":k()}],"border-spacing-x":[{"border-spacing-x":k()}],"border-spacing-y":[{"border-spacing-y":k()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",Xe,Qe]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[kt,"initial",Xe,Qe]}],ease:[{ease:["linear","initial",M,Xe,Qe]}],delay:[{delay:[kt,Xe,Qe]}],animate:[{animate:["none",F,Xe,Qe]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[E,Xe,Qe]}],"perspective-origin":[{"perspective-origin":N()}],rotate:[{rotate:Ke()}],"rotate-x":[{"rotate-x":Ke()}],"rotate-y":[{"rotate-y":Ke()}],"rotate-z":[{"rotate-z":Ke()}],scale:[{scale:Ce()}],"scale-x":[{"scale-x":Ce()}],"scale-y":[{"scale-y":Ce()}],"scale-z":[{"scale-z":Ce()}],"scale-3d":["scale-3d"],skew:[{skew:Re()}],"skew-x":[{"skew-x":Re()}],"skew-y":[{"skew-y":Re()}],transform:[{transform:[Xe,Qe,"","none","gpu","cpu"]}],"transform-origin":[{origin:N()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:He()}],"translate-x":[{"translate-x":He()}],"translate-y":[{"translate-y":He()}],"translate-z":[{"translate-z":He()}],"translate-none":["translate-none"],accent:[{accent:ee()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:ee()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Xe,Qe]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":k()}],"scroll-mx":[{"scroll-mx":k()}],"scroll-my":[{"scroll-my":k()}],"scroll-ms":[{"scroll-ms":k()}],"scroll-me":[{"scroll-me":k()}],"scroll-mt":[{"scroll-mt":k()}],"scroll-mr":[{"scroll-mr":k()}],"scroll-mb":[{"scroll-mb":k()}],"scroll-ml":[{"scroll-ml":k()}],"scroll-p":[{"scroll-p":k()}],"scroll-px":[{"scroll-px":k()}],"scroll-py":[{"scroll-py":k()}],"scroll-ps":[{"scroll-ps":k()}],"scroll-pe":[{"scroll-pe":k()}],"scroll-pt":[{"scroll-pt":k()}],"scroll-pr":[{"scroll-pr":k()}],"scroll-pb":[{"scroll-pb":k()}],"scroll-pl":[{"scroll-pl":k()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Xe,Qe]}],fill:[{fill:["none",...ee()]}],"stroke-w":[{stroke:[kt,Uh,el,a1]}],stroke:[{stroke:["none",...ee()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},B$=_$(F$);function Ct(...n){return B$(e$(n))}function v0(n){if(!n)return"";const e=n.toDate?n.toDate():new Date(n),r=new Date-e;return r<6e4?"Just now":r<36e5?`${Math.floor(r/6e4)}m ago`:r<864e5?`${Math.floor(r/36e5)}h ago`:r<6048e5?`${Math.floor(r/864e5)}d ago`:e.toLocaleDateString()}function h5(n){switch(n){case"admin":return"bg-admin/20 text-admin border-admin/30";case"moderator":return"bg-moderator/20 text-moderator border-moderator/30";default:return"bg-member/20 text-member border-member/30"}}const Vn=({label:n,error:e,className:t,containerClassName:r,...i})=>f.jsxs("div",{className:Ct("flex flex-col gap-1.5",r),children:[n&&f.jsx("label",{className:"text-sm font-medium text-dark-text",children:n}),f.jsx("input",{className:Ct("bg-dark-input text-dark-text px-4 py-2.5 rounded-md","border border-transparent focus:border-brand-primary","outline-none transition-colors duration-200","placeholder:text-dark-muted",e&&"border-admin",t),...i}),e&&f.jsx("span",{className:"text-sm text-admin",children:e})]}),ut=({children:n,variant:e="primary",size:t="md",className:r,disabled:i,...s})=>{const c="font-medium rounded-md transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",l={primary:"bg-brand-primary hover:bg-brand-hover text-white",secondary:"bg-dark-input hover:bg-dark-hover text-dark-text",danger:"bg-admin hover:bg-admin/80 text-white",ghost:"hover:bg-dark-hover text-dark-text"},d={sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-base",lg:"px-6 py-3 text-lg"};return f.jsx("button",{className:Ct(c,l[e],d[t],r),disabled:i,...s,children:n})},$$=({isOpen:n,onClose:e})=>{const[t,r]=T.useState(""),[i,s]=T.useState(!1),[c,l]=T.useState(!1),{success:d,error:h}=Ss(),m=async g=>{g.preventDefault(),s(!0);try{await XN(Lu,t),l(!0),d("Password reset email sent! Check your inbox."),setTimeout(()=>{e(),l(!1),r("")},3e3)}catch(b){console.error("Password reset error:",b),b.code==="auth/user-not-found"?h("No account found with this email address."):b.code==="auth/invalid-email"?h("Invalid email address."):h("Failed to send reset email. Please try again.")}finally{s(!1)}};return n?f.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:f.jsxs("div",{className:"bg-dark-sidebar rounded-lg shadow-2xl w-full max-w-md p-6 relative",children:[f.jsx("button",{onClick:e,className:"absolute top-4 right-4 text-dark-muted hover:text-dark-text transition-colors",children:f.jsx(mr,{size:24})}),f.jsxs("div",{className:"mb-6",children:[f.jsx("h2",{className:"text-2xl font-bold text-dark-text mb-2",children:"Reset Password"}),f.jsx("p",{className:"text-dark-muted text-sm",children:"Enter your email address and we'll send you a link to reset your password."})]}),c?f.jsx("div",{className:"bg-green-500/10 border border-green-500/30 text-green-400 px-4 py-3 rounded-md text-sm text-center",children:" Reset email sent successfully! Check your inbox."}):f.jsxs("form",{onSubmit:m,className:"space-y-4",children:[f.jsx(Vn,{label:"Email Address",type:"email",placeholder:"your@email.com",value:t,onChange:g=>r(g.target.value),required:!0,autoFocus:!0}),f.jsxs("div",{className:"flex gap-3",children:[f.jsx(ut,{type:"button",variant:"secondary",onClick:e,className:"flex-1",children:"Cancel"}),f.jsx(ut,{type:"submit",variant:"primary",className:"flex-1",disabled:i||!t,children:i?"Sending...":"Send Reset Link"})]})]})]})}):null},q$=({onSwitchToRegister:n,onSwitchToReset:e})=>{const{login:t}=Ar(),[r,i]=T.useState({email:"",password:""}),[s,c]=T.useState(""),[l,d]=T.useState(!1),[h,m]=T.useState(!1),g=async b=>{b.preventDefault(),c(""),d(!0);try{await t(r.email,r.password)}catch(_){c(_.message||"Failed to login")}finally{d(!1)}};return f.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-dark-bg p-4",children:[f.jsxs("div",{className:"w-full max-w-md bg-dark-sidebar rounded-lg shadow-2xl p-8",children:[f.jsxs("div",{className:"text-center mb-8",children:[f.jsx("h1",{className:"text-3xl font-bold text-dark-text mb-2",children:"Welcome Back!"}),f.jsx("p",{className:"text-dark-muted",children:"Login to Lumo"})]}),f.jsxs("form",{onSubmit:g,className:"space-y-4",children:[f.jsx(Vn,{label:"Email",type:"email",placeholder:"Enter your email",value:r.email,onChange:b=>i({...r,email:b.target.value}),required:!0}),f.jsxs("div",{children:[f.jsx(Vn,{label:"Password",type:"password",placeholder:"Enter your password",value:r.password,onChange:b=>i({...r,password:b.target.value}),required:!0}),f.jsx("div",{className:"mt-2 text-right",children:f.jsx("button",{type:"button",onClick:()=>m(!0),className:"text-sm text-brand-primary hover:underline",children:"Forgot Password?"})})]}),s&&f.jsx("div",{className:"bg-admin/10 border border-admin/30 text-admin px-4 py-3 rounded-md text-sm",children:s}),f.jsx(ut,{type:"submit",variant:"primary",className:"w-full",disabled:l,children:l?"Logging in...":"Login"})]}),f.jsx("div",{className:"mt-6 text-center",children:f.jsxs("div",{className:"text-dark-muted text-sm",children:["Don't have an account?"," ",f.jsx("button",{onClick:n,className:"text-brand-primary hover:underline",children:"Register"})]})})]}),f.jsx($$,{isOpen:h,onClose:()=>m(!1)})]})},H$=({onSwitchToLogin:n})=>{const{register:e}=Ar(),[t,r]=T.useState({displayName:"",email:"",password:"",confirmPassword:""}),[i,s]=T.useState(""),[c,l]=T.useState(""),[d,h]=T.useState(!1),[m,g]=T.useState([]);T.useEffect(()=>{(async()=>{try{const R=St(_e,"users"),E=await bl(R),A=[];E.forEach(M=>{const F=M.data().displayName;F&&A.push(F.toLowerCase())}),g(A)}catch(R){console.error("Error loading usernames:",R)}})()},[]),T.useEffect(()=>{const _=t.displayName;if(_){if(_.length<3){l("Username must be at least 3 characters");return}if(!/^[a-zA-Z0-9-_]+$/.test(_)){l("Only letters, numbers, hyphens (-) and underscores (_) allowed");return}const R=_.toLowerCase();m.includes(R)?l("This username is already taken"):l("")}else l("")},[t.displayName,m]);const b=async _=>{if(_.preventDefault(),s(""),c){s(c);return}if(t.password!==t.confirmPassword){s("Passwords do not match");return}if(t.password.length<6){s("Password must be at least 6 characters");return}h(!0);try{await e(t.email,t.password,t.displayName)}catch(R){s(R.message||"Failed to register")}finally{h(!1)}};return f.jsx("div",{className:"min-h-screen flex items-center justify-center bg-dark-bg p-4",children:f.jsxs("div",{className:"w-full max-w-md bg-dark-sidebar rounded-lg shadow-2xl p-8",children:[f.jsxs("div",{className:"text-center mb-8",children:[f.jsx("h1",{className:"text-3xl font-bold text-dark-text mb-2",children:"Create Account"}),f.jsx("p",{className:"text-dark-muted",children:"Join Lumo"})]}),f.jsxs("form",{onSubmit:b,className:"space-y-4",children:[f.jsxs("div",{children:[f.jsx(Vn,{label:"Display Name",type:"text",placeholder:"Enter your display name",value:t.displayName,onChange:_=>r({...t,displayName:_.target.value}),required:!0}),c&&f.jsx("p",{className:"text-xs text-admin mt-1",children:c}),t.displayName&&!c&&f.jsx("p",{className:"text-xs text-green-500 mt-1",children:" Username available"})]}),f.jsx(Vn,{label:"Email",type:"email",placeholder:"Enter your email",value:t.email,onChange:_=>r({...t,email:_.target.value}),required:!0}),f.jsx(Vn,{label:"Password",type:"password",placeholder:"Enter your password",value:t.password,onChange:_=>r({...t,password:_.target.value}),required:!0}),f.jsx(Vn,{label:"Confirm Password",type:"password",placeholder:"Confirm your password",value:t.confirmPassword,onChange:_=>r({...t,confirmPassword:_.target.value}),required:!0}),i&&f.jsx("div",{className:"bg-admin/10 border border-admin/30 text-admin px-4 py-3 rounded-md text-sm",children:i}),f.jsx(ut,{type:"submit",variant:"primary",className:"w-full",disabled:d||!!c,children:d?"Creating account...":"Register"})]}),f.jsx("div",{className:"mt-6 text-center",children:f.jsxs("div",{className:"text-dark-muted text-sm",children:["Already have an account?"," ",f.jsx("button",{onClick:n,className:"text-brand-primary hover:underline",children:"Login"})]})})]})})},G$=({onSwitchToLogin:n})=>{const{resetPassword:e}=Ar(),[t,r]=T.useState(""),[i,s]=T.useState(""),[c,l]=T.useState(!1),[d,h]=T.useState(!1),m=async g=>{g.preventDefault(),s(""),l(!1),h(!0);try{await e(t),l(!0)}catch(b){s(b.message||"Failed to send reset email")}finally{h(!1)}};return f.jsx("div",{className:"min-h-screen flex items-center justify-center bg-dark-bg p-4",children:f.jsxs("div",{className:"w-full max-w-md bg-dark-sidebar rounded-lg shadow-2xl p-8",children:[f.jsxs("div",{className:"text-center mb-8",children:[f.jsx("h1",{className:"text-3xl font-bold text-dark-text mb-2",children:"Reset Password"}),f.jsx("p",{className:"text-dark-muted",children:"Enter your email to receive a reset link"})]}),f.jsxs("form",{onSubmit:m,className:"space-y-4",children:[f.jsx(Vn,{label:"Email",type:"email",placeholder:"Enter your email",value:t,onChange:g=>r(g.target.value),required:!0}),i&&f.jsx("div",{className:"bg-admin/10 border border-admin/30 text-admin px-4 py-3 rounded-md text-sm",children:i}),c&&f.jsx("div",{className:"bg-green-500/10 border border-green-500/30 text-green-500 px-4 py-3 rounded-md text-sm",children:"Password reset email sent! Check your inbox."}),f.jsx(ut,{type:"submit",variant:"primary",className:"w-full",disabled:d,children:d?"Sending...":"Send Reset Link"})]}),f.jsx("div",{className:"mt-6 text-center",children:f.jsx("button",{onClick:n,className:"text-brand-primary hover:underline text-sm",children:"Back to Login"})})]})})},K$=({onSwipeLeft:n,onSwipeRight:e,minSwipeDistance:t=50})=>{const r=T.useRef(null),i=T.useRef(null);return{onTouchStart:d=>{i.current=null,r.current=d.targetTouches[0].clientX},onTouchMove:d=>{i.current=d.targetTouches[0].clientX},onTouchEnd:()=>{if(!r.current||!i.current)return;const d=r.current-i.current,h=d>t,m=d<-t;h&&n&&n(),m&&e&&e()}}};function W$(n){return ze({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M248 8C111.1 8 0 119.1 0 256s111.1 248 248 248 248-111.1 248-248S384.9 8 248 8zm100.7 364.9c-4.2 0-6.8-1.3-10.7-3.6-62.4-37.6-135-39.2-206.7-24.5-3.9 1-9 2.6-11.9 2.6-9.7 0-15.8-7.7-15.8-15.8 0-10.3 6.1-15.2 13.6-16.8 81.9-18.1 165.6-16.5 237 26.2 6.1 3.9 9.7 7.4 9.7 16.5s-7.1 15.4-15.2 15.4zm26.9-65.6c-5.2 0-8.7-2.3-12.3-4.2-62.5-37-155.7-51.9-238.6-29.4-4.8 1.3-7.4 2.6-11.9 2.6-10.7 0-19.4-8.7-19.4-19.4s5.2-17.8 15.5-20.7c27.8-7.8 56.2-13.6 97.8-13.6 64.9 0 127.6 16.1 177 45.5 8.1 4.8 11.3 11 11.3 19.7-.1 10.8-8.5 19.5-19.4 19.5zm31-76.2c-5.2 0-8.4-1.3-12.9-3.9-71.2-42.5-198.5-52.7-280.9-29.7-3.6 1-8.1 2.6-12.9 2.6-13.2 0-23.3-10.3-23.3-23.6 0-13.6 8.4-21.3 17.4-23.9 35.2-10.3 74.6-15.2 117.5-15.2 73 0 149.5 15.2 205.4 47.8 7.8 4.5 12.9 10.7 12.9 22.6 0 13.6-11 23.3-23.2 23.3z"},child:[]}]})(n)}function mR(n){return ze({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"},child:[]}]})(n)}function Y$(n){return ze({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"},child:[]}]})(n)}function y0(n){return ze({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M440.667 182.109l7.143-40c1.313-7.355-4.342-14.109-11.813-14.109h-74.81l14.623-81.891C377.123 38.754 371.468 32 363.997 32h-40.632a12 12 0 0 0-11.813 9.891L296.175 128H197.54l14.623-81.891C213.477 38.754 207.822 32 200.35 32h-40.632a12 12 0 0 0-11.813 9.891L132.528 128H53.432a12 12 0 0 0-11.813 9.891l-7.143 40C33.163 185.246 38.818 192 46.289 192h74.81L98.242 320H19.146a12 12 0 0 0-11.813 9.891l-7.143 40C-1.123 377.246 4.532 384 12.003 384h74.81L72.19 465.891C70.877 473.246 76.532 480 84.003 480h40.632a12 12 0 0 0 11.813-9.891L151.826 384h98.634l-14.623 81.891C234.523 473.246 240.178 480 247.65 480h40.632a12 12 0 0 0 11.813-9.891L315.472 384h79.096a12 12 0 0 0 11.813-9.891l7.143-40c1.313-7.355-4.342-14.109-11.813-14.109h-74.81l22.857-128h79.096a12 12 0 0 0 11.813-9.891zM261.889 320h-98.634l22.857-128h98.634l-22.857 128z"},child:[]}]})(n)}function gR(n){return ze({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M493.4 24.6l-104-24c-11.3-2.6-22.9 3.3-27.5 13.9l-48 112c-4.2 9.8-1.4 21.3 6.9 28l60.6 49.6c-36 76.7-98.9 140.5-177.2 177.2l-49.6-60.6c-6.8-8.3-18.2-11.1-28-6.9l-112 48C3.9 366.5-2 378.1.6 389.4l24 104C27.1 504.2 36.7 512 48 512c256.1 0 464-207.5 464-464 0-11.2-7.7-20.9-18.6-23.4z"},child:[]}]})(n)}const ea=({isOpen:n,onClose:e,title:t,children:r,size:i="md",showCloseButton:s=!0})=>{if(T.useEffect(()=>{const l=d=>{d.key==="Escape"&&n&&e()};return n?(document.body.style.overflow="hidden",document.addEventListener("keydown",l)):document.body.style.overflow="unset",()=>{document.body.style.overflow="unset",document.removeEventListener("keydown",l)}},[n,e]),!n)return null;const c={sm:"max-w-md",md:"max-w-2xl",lg:"max-w-4xl",xl:"max-w-6xl"};return f.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center",children:[f.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm",onClick:e}),f.jsxs("div",{className:Ct("relative bg-dark-sidebar rounded-lg shadow-2xl","w-full mx-4 max-h-[90vh] overflow-y-auto",c[i]),children:[(t||s)&&f.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-dark-hover",children:[f.jsx("h2",{className:"text-xl font-semibold text-dark-text",children:t}),s&&f.jsx("button",{onClick:e,className:"text-dark-muted hover:text-dark-text transition-colors",children:f.jsx(mr,{size:24})})]}),f.jsx("div",{className:"p-6",children:r})]})]})},Q$={premium:{id:"premium",label:"Premium Member",description:"Premium Member",icon:xl,color:"#F47FFF"},admin:{id:"admin",label:"Admin",description:"Server Administrator",icon:HP,color:"#f23f42"},verified:{id:"verified",label:"Verified",description:"Verified Member",icon:gB,color:"#3ba55c"},developer:{id:"developer",label:"Developer",description:"App Developer",icon:dB,color:"#5865F2"}};class X${constructor(){this.encoder=new TextEncoder,this._pieces=[],this._parts=[]}append_buffer(e){this.flush(),this._parts.push(e)}append(e){this._pieces.push(e)}flush(){if(this._pieces.length>0){const e=new Uint8Array(this._pieces);this._parts.push(e),this._pieces=[]}}toArrayBuffer(){const e=[];for(const t of this._parts)e.push(t);return J$(e).buffer}}function J$(n){let e=0;for(const i of n)e+=i.byteLength;const t=new Uint8Array(e);let r=0;for(const i of n){const s=new Uint8Array(i.buffer,i.byteOffset,i.byteLength);t.set(s,r),r+=i.byteLength}return t}function f5(n){return new Z$(n).unpack()}function p5(n){const e=new eq,t=e.pack(n);return t instanceof Promise?t.then(()=>e.getBuffer()):e.getBuffer()}class Z${constructor(e){this.index=0,this.dataBuffer=e,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}unpack(){const e=this.unpack_uint8();if(e<128)return e;if((e^224)<32)return(e^224)-32;let t;if((t=e^160)<=15)return this.unpack_raw(t);if((t=e^176)<=15)return this.unpack_string(t);if((t=e^144)<=15)return this.unpack_array(t);if((t=e^128)<=15)return this.unpack_map(t);switch(e){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return t=this.unpack_uint16(),this.unpack_string(t);case 217:return t=this.unpack_uint32(),this.unpack_string(t);case 218:return t=this.unpack_uint16(),this.unpack_raw(t);case 219:return t=this.unpack_uint32(),this.unpack_raw(t);case 220:return t=this.unpack_uint16(),this.unpack_array(t);case 221:return t=this.unpack_uint32(),this.unpack_array(t);case 222:return t=this.unpack_uint16(),this.unpack_map(t);case 223:return t=this.unpack_uint32(),this.unpack_map(t)}}unpack_uint8(){const e=this.dataView[this.index]&255;return this.index++,e}unpack_uint16(){const e=this.read(2),t=(e[0]&255)*256+(e[1]&255);return this.index+=2,t}unpack_uint32(){const e=this.read(4),t=((e[0]*256+e[1])*256+e[2])*256+e[3];return this.index+=4,t}unpack_uint64(){const e=this.read(8),t=((((((e[0]*256+e[1])*256+e[2])*256+e[3])*256+e[4])*256+e[5])*256+e[6])*256+e[7];return this.index+=8,t}unpack_int8(){const e=this.unpack_uint8();return e<128?e:e-256}unpack_int16(){const e=this.unpack_uint16();return e<32768?e:e-65536}unpack_int32(){const e=this.unpack_uint32();return e<2**31?e:e-2**32}unpack_int64(){const e=this.unpack_uint64();return e<2**63?e:e-2**64}unpack_raw(e){if(this.length<this.index+e)throw new Error(`BinaryPackFailure: index is out of range ${this.index} ${e} ${this.length}`);const t=this.dataBuffer.slice(this.index,this.index+e);return this.index+=e,t}unpack_string(e){const t=this.read(e);let r=0,i="",s,c;for(;r<e;)s=t[r],s<160?(c=s,r++):(s^192)<32?(c=(s&31)<<6|t[r+1]&63,r+=2):(s^224)<16?(c=(s&15)<<12|(t[r+1]&63)<<6|t[r+2]&63,r+=3):(c=(s&7)<<18|(t[r+1]&63)<<12|(t[r+2]&63)<<6|t[r+3]&63,r+=4),i+=String.fromCodePoint(c);return this.index+=e,i}unpack_array(e){const t=new Array(e);for(let r=0;r<e;r++)t[r]=this.unpack();return t}unpack_map(e){const t={};for(let r=0;r<e;r++){const i=this.unpack();t[i]=this.unpack()}return t}unpack_float(){const e=this.unpack_uint32(),t=e>>31,r=(e>>23&255)-127,i=e&8388607|8388608;return(t===0?1:-1)*i*2**(r-23)}unpack_double(){const e=this.unpack_uint32(),t=this.unpack_uint32(),r=e>>31,i=(e>>20&2047)-1023,c=(e&1048575|1048576)*2**(i-20)+t*2**(i-52);return(r===0?1:-1)*c}read(e){const t=this.index;if(t+e<=this.length)return this.dataView.subarray(t,t+e);throw new Error("BinaryPackFailure: read index out of range")}}class eq{getBuffer(){return this._bufferBuilder.toArrayBuffer()}pack(e){if(typeof e=="string")this.pack_string(e);else if(typeof e=="number")Math.floor(e)===e?this.pack_integer(e):this.pack_double(e);else if(typeof e=="boolean")e===!0?this._bufferBuilder.append(195):e===!1&&this._bufferBuilder.append(194);else if(e===void 0)this._bufferBuilder.append(192);else if(typeof e=="object")if(e===null)this._bufferBuilder.append(192);else{const t=e.constructor;if(e instanceof Array){const r=this.pack_array(e);if(r instanceof Promise)return r.then(()=>this._bufferBuilder.flush())}else if(e instanceof ArrayBuffer)this.pack_bin(new Uint8Array(e));else if("BYTES_PER_ELEMENT"in e){const r=e;this.pack_bin(new Uint8Array(r.buffer,r.byteOffset,r.byteLength))}else if(e instanceof Date)this.pack_string(e.toString());else{if(e instanceof Blob)return e.arrayBuffer().then(r=>{this.pack_bin(new Uint8Array(r)),this._bufferBuilder.flush()});if(t==Object||t.toString().startsWith("class")){const r=this.pack_object(e);if(r instanceof Promise)return r.then(()=>this._bufferBuilder.flush())}else throw new Error(`Type "${t.toString()}" not yet supported`)}}else throw new Error(`Type "${typeof e}" not yet supported`);this._bufferBuilder.flush()}pack_bin(e){const t=e.length;if(t<=15)this.pack_uint8(160+t);else if(t<=65535)this._bufferBuilder.append(218),this.pack_uint16(t);else if(t<=4294967295)this._bufferBuilder.append(219),this.pack_uint32(t);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(e)}pack_string(e){const t=this._textEncoder.encode(e),r=t.length;if(r<=15)this.pack_uint8(176+r);else if(r<=65535)this._bufferBuilder.append(216),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(217),this.pack_uint32(r);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(t)}pack_array(e){const t=e.length;if(t<=15)this.pack_uint8(144+t);else if(t<=65535)this._bufferBuilder.append(220),this.pack_uint16(t);else if(t<=4294967295)this._bufferBuilder.append(221),this.pack_uint32(t);else throw new Error("Invalid length");const r=i=>{if(i<t){const s=this.pack(e[i]);return s instanceof Promise?s.then(()=>r(i+1)):r(i+1)}};return r(0)}pack_integer(e){if(e>=-32&&e<=127)this._bufferBuilder.append(e&255);else if(e>=0&&e<=255)this._bufferBuilder.append(204),this.pack_uint8(e);else if(e>=-128&&e<=127)this._bufferBuilder.append(208),this.pack_int8(e);else if(e>=0&&e<=65535)this._bufferBuilder.append(205),this.pack_uint16(e);else if(e>=-32768&&e<=32767)this._bufferBuilder.append(209),this.pack_int16(e);else if(e>=0&&e<=4294967295)this._bufferBuilder.append(206),this.pack_uint32(e);else if(e>=-2147483648&&e<=2147483647)this._bufferBuilder.append(210),this.pack_int32(e);else if(e>=-9223372036854776e3&&e<=9223372036854776e3)this._bufferBuilder.append(211),this.pack_int64(e);else if(e>=0&&e<=18446744073709552e3)this._bufferBuilder.append(207),this.pack_uint64(e);else throw new Error("Invalid integer")}pack_double(e){let t=0;e<0&&(t=1,e=-e);const r=Math.floor(Math.log(e)/Math.LN2),i=e/2**r-1,s=Math.floor(i*2**52),c=2**32,l=t<<31|r+1023<<20|s/c&1048575,d=s%c;this._bufferBuilder.append(203),this.pack_int32(l),this.pack_int32(d)}pack_object(e){const t=Object.keys(e),r=t.length;if(r<=15)this.pack_uint8(128+r);else if(r<=65535)this._bufferBuilder.append(222),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(223),this.pack_uint32(r);else throw new Error("Invalid length");const i=s=>{if(s<t.length){const c=t[s];if(e.hasOwnProperty(c)){this.pack(c);const l=this.pack(e[c]);if(l instanceof Promise)return l.then(()=>i(s+1))}return i(s+1)}};return i(0)}pack_uint8(e){this._bufferBuilder.append(e)}pack_uint16(e){this._bufferBuilder.append(e>>8),this._bufferBuilder.append(e&255)}pack_uint32(e){const t=e&4294967295;this._bufferBuilder.append((t&4278190080)>>>24),this._bufferBuilder.append((t&16711680)>>>16),this._bufferBuilder.append((t&65280)>>>8),this._bufferBuilder.append(t&255)}pack_uint64(e){const t=e/4294967296,r=e%2**32;this._bufferBuilder.append((t&4278190080)>>>24),this._bufferBuilder.append((t&16711680)>>>16),this._bufferBuilder.append((t&65280)>>>8),this._bufferBuilder.append(t&255),this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}pack_int8(e){this._bufferBuilder.append(e&255)}pack_int16(e){this._bufferBuilder.append((e&65280)>>8),this._bufferBuilder.append(e&255)}pack_int32(e){this._bufferBuilder.append(e>>>24&255),this._bufferBuilder.append((e&16711680)>>>16),this._bufferBuilder.append((e&65280)>>>8),this._bufferBuilder.append(e&255)}pack_int64(e){const t=Math.floor(e/4294967296),r=e%2**32;this._bufferBuilder.append((t&4278190080)>>>24),this._bufferBuilder.append((t&16711680)>>>16),this._bufferBuilder.append((t&65280)>>>8),this._bufferBuilder.append(t&255),this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}constructor(){this._bufferBuilder=new X$,this._textEncoder=new TextEncoder}}let m5=!0,g5=!0;function nf(n,e,t){const r=n.match(e);return r&&r.length>=t&&parseFloat(r[t],10)}function jl(n,e,t){if(!n.RTCPeerConnection)return;const r=n.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(c,l){if(c!==e)return i.apply(this,arguments);const d=h=>{const m=t(h);m&&(l.handleEvent?l.handleEvent(m):l(m))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(l,d),i.apply(this,[c,d])};const s=r.removeEventListener;r.removeEventListener=function(c,l){if(c!==e||!this._eventMap||!this._eventMap[e])return s.apply(this,arguments);if(!this._eventMap[e].has(l))return s.apply(this,arguments);const d=this._eventMap[e].get(l);return this._eventMap[e].delete(l),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[c,d])},Object.defineProperty(r,"on"+e,{get(){return this["_on"+e]},set(c){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),c&&this.addEventListener(e,this["_on"+e]=c)},enumerable:!0,configurable:!0})}function tq(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(m5=n,n?"adapter.js logging disabled":"adapter.js logging enabled")}function nq(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(g5=!n,"adapter.js deprecation warnings "+(n?"disabled":"enabled"))}function v5(){if(typeof window=="object"){if(m5)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function LS(n,e){g5&&console.warn(n+" is deprecated, please use "+e+" instead.")}function rq(n){const e={browser:null,version:null};if(typeof n>"u"||!n.navigator||!n.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:t}=n;if(t.userAgentData&&t.userAgentData.brands){const r=t.userAgentData.brands.find(i=>i.brand==="Chromium");if(r)return{browser:"chrome",version:parseInt(r.version,10)}}if(t.mozGetUserMedia)e.browser="firefox",e.version=parseInt(nf(t.userAgent,/Firefox\/(\d+)\./,1));else if(t.webkitGetUserMedia||n.isSecureContext===!1&&n.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(nf(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(n.RTCPeerConnection&&t.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(nf(t.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=n.RTCRtpTransceiver&&"currentDirection"in n.RTCRtpTransceiver.prototype,e._safariVersion=nf(t.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function vR(n){return Object.prototype.toString.call(n)==="[object Object]"}function y5(n){return vR(n)?Object.keys(n).reduce(function(e,t){const r=vR(n[t]),i=r?y5(n[t]):n[t],s=r&&!Object.keys(i).length;return i===void 0||s?e:Object.assign(e,{[t]:i})},{}):n}function kx(n,e,t){!e||t.has(e.id)||(t.set(e.id,e),Object.keys(e).forEach(r=>{r.endsWith("Id")?kx(n,n.get(e[r]),t):r.endsWith("Ids")&&e[r].forEach(i=>{kx(n,n.get(i),t)})}))}function yR(n,e,t){const r=t?"outbound-rtp":"inbound-rtp",i=new Map;if(e===null)return i;const s=[];return n.forEach(c=>{c.type==="track"&&c.trackIdentifier===e.id&&s.push(c)}),s.forEach(c=>{n.forEach(l=>{l.type===r&&l.trackId===c.id&&kx(n,l,i)})}),i}const bR=v5;function b5(n,e){const t=n&&n.navigator;if(!t.mediaDevices)return;const r=function(l){if(typeof l!="object"||l.mandatory||l.optional)return l;const d={};return Object.keys(l).forEach(h=>{if(h==="require"||h==="advanced"||h==="mediaSource")return;const m=typeof l[h]=="object"?l[h]:{ideal:l[h]};m.exact!==void 0&&typeof m.exact=="number"&&(m.min=m.max=m.exact);const g=function(b,_){return b?b+_.charAt(0).toUpperCase()+_.slice(1):_==="deviceId"?"sourceId":_};if(m.ideal!==void 0){d.optional=d.optional||[];let b={};typeof m.ideal=="number"?(b[g("min",h)]=m.ideal,d.optional.push(b),b={},b[g("max",h)]=m.ideal,d.optional.push(b)):(b[g("",h)]=m.ideal,d.optional.push(b))}m.exact!==void 0&&typeof m.exact!="number"?(d.mandatory=d.mandatory||{},d.mandatory[g("",h)]=m.exact):["min","max"].forEach(b=>{m[b]!==void 0&&(d.mandatory=d.mandatory||{},d.mandatory[g(b,h)]=m[b])})}),l.advanced&&(d.optional=(d.optional||[]).concat(l.advanced)),d},i=function(l,d){if(e.version>=61)return d(l);if(l=JSON.parse(JSON.stringify(l)),l&&typeof l.audio=="object"){const h=function(m,g,b){g in m&&!(b in m)&&(m[b]=m[g],delete m[g])};l=JSON.parse(JSON.stringify(l)),h(l.audio,"autoGainControl","googAutoGainControl"),h(l.audio,"noiseSuppression","googNoiseSuppression"),l.audio=r(l.audio)}if(l&&typeof l.video=="object"){let h=l.video.facingMode;h=h&&(typeof h=="object"?h:{ideal:h});const m=e.version<66;if(h&&(h.exact==="user"||h.exact==="environment"||h.ideal==="user"||h.ideal==="environment")&&!(t.mediaDevices.getSupportedConstraints&&t.mediaDevices.getSupportedConstraints().facingMode&&!m)){delete l.video.facingMode;let g;if(h.exact==="environment"||h.ideal==="environment"?g=["back","rear"]:(h.exact==="user"||h.ideal==="user")&&(g=["front"]),g)return t.mediaDevices.enumerateDevices().then(b=>{b=b.filter(R=>R.kind==="videoinput");let _=b.find(R=>g.some(E=>R.label.toLowerCase().includes(E)));return!_&&b.length&&g.includes("back")&&(_=b[b.length-1]),_&&(l.video.deviceId=h.exact?{exact:_.deviceId}:{ideal:_.deviceId}),l.video=r(l.video),bR("chrome: "+JSON.stringify(l)),d(l)})}l.video=r(l.video)}return bR("chrome: "+JSON.stringify(l)),d(l)},s=function(l){return e.version>=64?l:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[l.name]||l.name,message:l.message,constraint:l.constraint||l.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},c=function(l,d,h){i(l,m=>{t.webkitGetUserMedia(m,d,g=>{h&&h(s(g))})})};if(t.getUserMedia=c.bind(t),t.mediaDevices.getUserMedia){const l=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(d){return i(d,h=>l(h).then(m=>{if(h.audio&&!m.getAudioTracks().length||h.video&&!m.getVideoTracks().length)throw m.getTracks().forEach(g=>{g.stop()}),new DOMException("","NotFoundError");return m},m=>Promise.reject(s(m))))}}}function x5(n){n.MediaStream=n.MediaStream||n.webkitMediaStream}function _5(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("ontrack"in n.RTCPeerConnection.prototype)){Object.defineProperty(n.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(t){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=t)},enumerable:!0,configurable:!0});const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",i=>{let s;n.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(l=>l.track&&l.track.id===i.track.id):s={track:i.track};const c=new Event("track");c.track=i.track,c.receiver=s,c.transceiver={receiver:s},c.streams=[r.stream],this.dispatchEvent(c)}),r.stream.getTracks().forEach(i=>{let s;n.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(l=>l.track&&l.track.id===i.id):s={track:i};const c=new Event("track");c.track=i,c.receiver=s,c.transceiver={receiver:s},c.streams=[r.stream],this.dispatchEvent(c)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else jl(n,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function S5(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("getSenders"in n.RTCPeerConnection.prototype)&&"createDTMFSender"in n.RTCPeerConnection.prototype){const e=function(i,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=i.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:i}};if(!n.RTCPeerConnection.prototype.getSenders){n.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(l,d){let h=i.apply(this,arguments);return h||(h=e(this,l),this._senders.push(h)),h};const s=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(l){s.apply(this,arguments);const d=this._senders.indexOf(l);d!==-1&&this._senders.splice(d,1)}}const t=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],t.apply(this,[s]),s.getTracks().forEach(c=>{this._senders.push(e(this,c))})};const r=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],r.apply(this,[s]),s.getTracks().forEach(c=>{const l=this._senders.find(d=>d.track===c);l&&this._senders.splice(this._senders.indexOf(l),1)})}}else if(typeof n=="object"&&n.RTCPeerConnection&&"getSenders"in n.RTCPeerConnection.prototype&&"createDTMFSender"in n.RTCPeerConnection.prototype&&n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)){const e=n.RTCPeerConnection.prototype.getSenders;n.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(i=>i._pc=this),r},Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function T5(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender&&n.RTCRtpReceiver))return;if(!("getStats"in n.RTCRtpSender.prototype)){const t=n.RTCPeerConnection.prototype.getSenders;t&&(n.RTCPeerConnection.prototype.getSenders=function(){const s=t.apply(this,[]);return s.forEach(c=>c._pc=this),s});const r=n.RTCPeerConnection.prototype.addTrack;r&&(n.RTCPeerConnection.prototype.addTrack=function(){const s=r.apply(this,arguments);return s._pc=this,s}),n.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(c=>yR(c,s.track,!0))}}if(!("getStats"in n.RTCRtpReceiver.prototype)){const t=n.RTCPeerConnection.prototype.getReceivers;t&&(n.RTCPeerConnection.prototype.getReceivers=function(){const i=t.apply(this,[]);return i.forEach(s=>s._pc=this),i}),jl(n,"track",r=>(r.receiver._pc=r.srcElement,r)),n.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(s=>yR(s,i.track,!1))}}if(!("getStats"in n.RTCRtpSender.prototype&&"getStats"in n.RTCRtpReceiver.prototype))return;const e=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof n.MediaStreamTrack){const r=arguments[0];let i,s,c;return this.getSenders().forEach(l=>{l.track===r&&(i?c=!0:i=l)}),this.getReceivers().forEach(l=>(l.track===r&&(s?c=!0:s=l),l.track===r)),c||i&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function k5(n){n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(c=>this._shimmedLocalStreams[c][0])};const e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(c,l){if(!l)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const d=e.apply(this,arguments);return this._shimmedLocalStreams[l.id]?this._shimmedLocalStreams[l.id].indexOf(d)===-1&&this._shimmedLocalStreams[l.id].push(d):this._shimmedLocalStreams[l.id]=[l,d],d};const t=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(c){this._shimmedLocalStreams=this._shimmedLocalStreams||{},c.getTracks().forEach(h=>{if(this.getSenders().find(g=>g.track===h))throw new DOMException("Track already exists.","InvalidAccessError")});const l=this.getSenders();t.apply(this,arguments);const d=this.getSenders().filter(h=>l.indexOf(h)===-1);this._shimmedLocalStreams[c.id]=[c].concat(d)};const r=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(c){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[c.id],r.apply(this,arguments)};const i=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(c){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},c&&Object.keys(this._shimmedLocalStreams).forEach(l=>{const d=this._shimmedLocalStreams[l].indexOf(c);d!==-1&&this._shimmedLocalStreams[l].splice(d,1),this._shimmedLocalStreams[l].length===1&&delete this._shimmedLocalStreams[l]}),i.apply(this,arguments)}}function C5(n,e){if(!n.RTCPeerConnection)return;if(n.RTCPeerConnection.prototype.addTrack&&e.version>=65)return k5(n);const t=n.RTCPeerConnection.prototype.getLocalStreams;n.RTCPeerConnection.prototype.getLocalStreams=function(){const m=t.apply(this);return this._reverseStreams=this._reverseStreams||{},m.map(g=>this._reverseStreams[g.id])};const r=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(m){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},m.getTracks().forEach(g=>{if(this.getSenders().find(_=>_.track===g))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[m.id]){const g=new n.MediaStream(m.getTracks());this._streams[m.id]=g,this._reverseStreams[g.id]=m,m=g}r.apply(this,[m])};const i=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(m){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[m.id]||m]),delete this._reverseStreams[this._streams[m.id]?this._streams[m.id].id:m.id],delete this._streams[m.id]},n.RTCPeerConnection.prototype.addTrack=function(m,g){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const b=[].slice.call(arguments,1);if(b.length!==1||!b[0].getTracks().find(E=>E===m))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(E=>E.track===m))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const R=this._streams[g.id];if(R)R.addTrack(m),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const E=new n.MediaStream([m]);this._streams[g.id]=E,this._reverseStreams[E.id]=g,this.addStream(E)}return this.getSenders().find(E=>E.track===m)};function s(h,m){let g=m.sdp;return Object.keys(h._reverseStreams||[]).forEach(b=>{const _=h._reverseStreams[b],R=h._streams[_.id];g=g.replace(new RegExp(R.id,"g"),_.id)}),new RTCSessionDescription({type:m.type,sdp:g})}function c(h,m){let g=m.sdp;return Object.keys(h._reverseStreams||[]).forEach(b=>{const _=h._reverseStreams[b],R=h._streams[_.id];g=g.replace(new RegExp(_.id,"g"),R.id)}),new RTCSessionDescription({type:m.type,sdp:g})}["createOffer","createAnswer"].forEach(function(h){const m=n.RTCPeerConnection.prototype[h],g={[h](){const b=arguments;return arguments.length&&typeof arguments[0]=="function"?m.apply(this,[R=>{const E=s(this,R);b[0].apply(null,[E])},R=>{b[1]&&b[1].apply(null,R)},arguments[2]]):m.apply(this,arguments).then(R=>s(this,R))}};n.RTCPeerConnection.prototype[h]=g[h]});const l=n.RTCPeerConnection.prototype.setLocalDescription;n.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?l.apply(this,arguments):(arguments[0]=c(this,arguments[0]),l.apply(this,arguments))};const d=Object.getOwnPropertyDescriptor(n.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(n.RTCPeerConnection.prototype,"localDescription",{get(){const h=d.get.apply(this);return h.type===""?h:s(this,h)}}),n.RTCPeerConnection.prototype.removeTrack=function(m){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!m._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(m._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let b;Object.keys(this._streams).forEach(_=>{this._streams[_].getTracks().find(E=>m.track===E)&&(b=this._streams[_])}),b&&(b.getTracks().length===1?this.removeStream(this._reverseStreams[b.id]):b.removeTrack(m.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Cx(n,e){!n.RTCPeerConnection&&n.webkitRTCPeerConnection&&(n.RTCPeerConnection=n.webkitRTCPeerConnection),n.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const r=n.RTCPeerConnection.prototype[t],i={[t](){return arguments[0]=new(t==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};n.RTCPeerConnection.prototype[t]=i[t]})}function w5(n,e){jl(n,"negotiationneeded",t=>{const r=t.target;if(!((e.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return t})}const xR=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:w5,shimAddTrackRemoveTrack:C5,shimAddTrackRemoveTrackWithNative:k5,shimGetSendersWithDtmf:S5,shimGetUserMedia:b5,shimMediaStream:x5,shimOnTrack:_5,shimPeerConnection:Cx,shimSenderReceiverGetStats:T5},Symbol.toStringTag,{value:"Module"}));function E5(n,e){const t=n&&n.navigator,r=n&&n.MediaStreamTrack;if(t.getUserMedia=function(i,s,c){LS("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),t.mediaDevices.getUserMedia(i).then(s,c)},!(e.version>55&&"autoGainControl"in t.mediaDevices.getSupportedConstraints())){const i=function(c,l,d){l in c&&!(d in c)&&(c[d]=c[l],delete c[l])},s=t.mediaDevices.getUserMedia.bind(t.mediaDevices);if(t.mediaDevices.getUserMedia=function(c){return typeof c=="object"&&typeof c.audio=="object"&&(c=JSON.parse(JSON.stringify(c)),i(c.audio,"autoGainControl","mozAutoGainControl"),i(c.audio,"noiseSuppression","mozNoiseSuppression")),s(c)},r&&r.prototype.getSettings){const c=r.prototype.getSettings;r.prototype.getSettings=function(){const l=c.apply(this,arguments);return i(l,"mozAutoGainControl","autoGainControl"),i(l,"mozNoiseSuppression","noiseSuppression"),l}}if(r&&r.prototype.applyConstraints){const c=r.prototype.applyConstraints;r.prototype.applyConstraints=function(l){return this.kind==="audio"&&typeof l=="object"&&(l=JSON.parse(JSON.stringify(l)),i(l,"autoGainControl","mozAutoGainControl"),i(l,"noiseSuppression","mozNoiseSuppression")),c.apply(this,[l])}}}}function iq(n,e){n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||n.navigator.mediaDevices&&(n.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return r.video===!0?r.video={mediaSource:e}:r.video.mediaSource=e,n.navigator.mediaDevices.getUserMedia(r)})}function R5(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function wx(n,e){if(typeof n!="object"||!(n.RTCPeerConnection||n.mozRTCPeerConnection))return;!n.RTCPeerConnection&&n.mozRTCPeerConnection&&(n.RTCPeerConnection=n.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const s=n.RTCPeerConnection.prototype[i],c={[i](){return arguments[0]=new(i==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};n.RTCPeerConnection.prototype[i]=c[i]});const t={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[s,c,l]=arguments;return r.apply(this,[s||null]).then(d=>{if(e.version<53&&!c)try{d.forEach(h=>{h.type=t[h.type]||h.type})}catch(h){if(h.name!=="TypeError")throw h;d.forEach((m,g)=>{d.set(g,Object.assign({},m,{type:t[m.type]||m.type}))})}return d}).then(c,l)}}function A5(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpSender.prototype)return;const e=n.RTCPeerConnection.prototype.getSenders;e&&(n.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(s=>s._pc=this),i});const t=n.RTCPeerConnection.prototype.addTrack;t&&(n.RTCPeerConnection.prototype.addTrack=function(){const i=t.apply(this,arguments);return i._pc=this,i}),n.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function N5(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpReceiver.prototype)return;const e=n.RTCPeerConnection.prototype.getReceivers;e&&(n.RTCPeerConnection.prototype.getReceivers=function(){const r=e.apply(this,[]);return r.forEach(i=>i._pc=this),r}),jl(n,"track",t=>(t.receiver._pc=t.srcElement,t)),n.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function I5(n){!n.RTCPeerConnection||"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(t){LS("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&t.getTracks().includes(r.track)&&this.removeTrack(r)})})}function P5(n){n.DataChannel&&!n.RTCDataChannel&&(n.RTCDataChannel=n.DataChannel)}function M5(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.addTransceiver;e&&(n.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const i=r.length>0;i&&r.forEach(c=>{if("rid"in c&&!/^[a-z0-9]{0,16}$/i.test(c.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in c&&!(parseFloat(c.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in c&&!(parseFloat(c.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=e.apply(this,arguments);if(i){const{sender:c}=s,l=c.getParameters();(!("encodings"in l)||l.encodings.length===1&&Object.keys(l.encodings[0]).length===0)&&(l.encodings=r,c.sendEncodings=r,this.setParametersPromises.push(c.setParameters(l).then(()=>{delete c.sendEncodings}).catch(()=>{delete c.sendEncodings})))}return s})}function D5(n){if(!(typeof n=="object"&&n.RTCRtpSender))return;const e=n.RTCRtpSender.prototype.getParameters;e&&(n.RTCRtpSender.prototype.getParameters=function(){const r=e.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function O5(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function j5(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.createAnswer;n.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}const _R=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:M5,shimCreateAnswer:j5,shimCreateOffer:O5,shimGetDisplayMedia:iq,shimGetParameters:D5,shimGetUserMedia:E5,shimOnTrack:R5,shimPeerConnection:wx,shimRTCDataChannel:P5,shimReceiverGetStats:N5,shimRemoveStream:I5,shimSenderGetStats:A5},Symbol.toStringTag,{value:"Module"}));function L5(n){if(!(typeof n!="object"||!n.RTCPeerConnection)){if("getLocalStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in n.RTCPeerConnection.prototype)){const e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(i=>e.call(this,i,r)),r.getVideoTracks().forEach(i=>e.call(this,i,r))},n.RTCPeerConnection.prototype.addTrack=function(r,...i){return i&&i.forEach(s=>{this._localStreams?this._localStreams.includes(s)||this._localStreams.push(s):this._localStreams=[s]}),e.apply(this,arguments)}}"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(t);if(r===-1)return;this._localStreams.splice(r,1);const i=t.getTracks();this.getSenders().forEach(s=>{i.includes(s.track)&&this.removeTrack(s)})})}}function U5(n){if(!(typeof n!="object"||!n.RTCPeerConnection)&&("getRemoteStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in n.RTCPeerConnection.prototype))){Object.defineProperty(n.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(t){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=t),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(i=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(i))return;this._remoteStreams.push(i);const s=new Event("addstream");s.stream=i,this.dispatchEvent(s)})})}});const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(s=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(s)>=0)return;r._remoteStreams.push(s);const c=new Event("addstream");c.stream=s,r.dispatchEvent(c)})}),e.apply(r,arguments)}}}function V5(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const e=n.RTCPeerConnection.prototype,t=e.createOffer,r=e.createAnswer,i=e.setLocalDescription,s=e.setRemoteDescription,c=e.addIceCandidate;e.createOffer=function(h,m){const g=arguments.length>=2?arguments[2]:arguments[0],b=t.apply(this,[g]);return m?(b.then(h,m),Promise.resolve()):b},e.createAnswer=function(h,m){const g=arguments.length>=2?arguments[2]:arguments[0],b=r.apply(this,[g]);return m?(b.then(h,m),Promise.resolve()):b};let l=function(d,h,m){const g=i.apply(this,[d]);return m?(g.then(h,m),Promise.resolve()):g};e.setLocalDescription=l,l=function(d,h,m){const g=s.apply(this,[d]);return m?(g.then(h,m),Promise.resolve()):g},e.setRemoteDescription=l,l=function(d,h,m){const g=c.apply(this,[d]);return m?(g.then(h,m),Promise.resolve()):g},e.addIceCandidate=l}function z5(n){const e=n&&n.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const t=e.mediaDevices,r=t.getUserMedia.bind(t);e.mediaDevices.getUserMedia=i=>r(F5(i))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(r,i,s){e.mediaDevices.getUserMedia(r).then(i,s)}).bind(e))}function F5(n){return n&&n.video!==void 0?Object.assign({},n,{video:y5(n.video)}):n}function B5(n){if(!n.RTCPeerConnection)return;const e=n.RTCPeerConnection;n.RTCPeerConnection=function(r,i){if(r&&r.iceServers){const s=[];for(let c=0;c<r.iceServers.length;c++){let l=r.iceServers[c];l.urls===void 0&&l.url?(LS("RTCIceServer.url","RTCIceServer.urls"),l=JSON.parse(JSON.stringify(l)),l.urls=l.url,delete l.url,s.push(l)):s.push(r.iceServers[c])}r.iceServers=s}return new e(r,i)},n.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function $5(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function q5(n){const e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const i=this.getTransceivers().find(c=>c.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):r.offerToReceiveAudio===!0&&!i&&this.addTransceiver("audio",{direction:"recvonly"}),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const s=this.getTransceivers().find(c=>c.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):r.offerToReceiveVideo===!0&&!s&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function H5(n){typeof n!="object"||n.AudioContext||(n.AudioContext=n.webkitAudioContext)}const SR=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:H5,shimCallbacksAPI:V5,shimConstraints:F5,shimCreateOfferLegacy:q5,shimGetUserMedia:z5,shimLocalStreamsAPI:L5,shimRTCIceServerUrls:B5,shimRemoteStreamsAPI:U5,shimTrackEventTransceiver:$5},Symbol.toStringTag,{value:"Module"}));var o1={exports:{}},TR;function sq(){return TR||(TR=1,(function(n){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(t){return t.trim().split(`
`).map(r=>r.trim())},e.splitSections=function(t){return t.split(`
m=`).map((i,s)=>(s>0?"m="+i:i).trim()+`\r
`)},e.getDescription=function(t){const r=e.splitSections(t);return r&&r[0]},e.getMediaSections=function(t){const r=e.splitSections(t);return r.shift(),r},e.matchPrefix=function(t,r){return e.splitLines(t).filter(i=>i.indexOf(r)===0)},e.parseCandidate=function(t){let r;t.indexOf("a=candidate:")===0?r=t.substring(12).split(" "):r=t.substring(10).split(" ");const i={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let s=8;s<r.length;s+=2)switch(r[s]){case"raddr":i.relatedAddress=r[s+1];break;case"rport":i.relatedPort=parseInt(r[s+1],10);break;case"tcptype":i.tcpType=r[s+1];break;case"ufrag":i.ufrag=r[s+1],i.usernameFragment=r[s+1];break;default:i[r[s]]===void 0&&(i[r[s]]=r[s+1]);break}return i},e.writeCandidate=function(t){const r=[];r.push(t.foundation);const i=t.component;i==="rtp"?r.push(1):i==="rtcp"?r.push(2):r.push(i),r.push(t.protocol.toUpperCase()),r.push(t.priority),r.push(t.address||t.ip),r.push(t.port);const s=t.type;return r.push("typ"),r.push(s),s!=="host"&&t.relatedAddress&&t.relatedPort&&(r.push("raddr"),r.push(t.relatedAddress),r.push("rport"),r.push(t.relatedPort)),t.tcpType&&t.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(t.tcpType)),(t.usernameFragment||t.ufrag)&&(r.push("ufrag"),r.push(t.usernameFragment||t.ufrag)),"candidate:"+r.join(" ")},e.parseIceOptions=function(t){return t.substring(14).split(" ")},e.parseRtpMap=function(t){let r=t.substring(9).split(" ");const i={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),i.name=r[0],i.clockRate=parseInt(r[1],10),i.channels=r.length===3?parseInt(r[2],10):1,i.numChannels=i.channels,i},e.writeRtpMap=function(t){let r=t.payloadType;t.preferredPayloadType!==void 0&&(r=t.preferredPayloadType);const i=t.channels||t.numChannels||1;return"a=rtpmap:"+r+" "+t.name+"/"+t.clockRate+(i!==1?"/"+i:"")+`\r
`},e.parseExtmap=function(t){const r=t.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},e.writeExtmap=function(t){return"a=extmap:"+(t.id||t.preferredId)+(t.direction&&t.direction!=="sendrecv"?"/"+t.direction:"")+" "+t.uri+(t.attributes?" "+t.attributes:"")+`\r
`},e.parseFmtp=function(t){const r={};let i;const s=t.substring(t.indexOf(" ")+1).split(";");for(let c=0;c<s.length;c++)i=s[c].trim().split("="),r[i[0].trim()]=i[1];return r},e.writeFmtp=function(t){let r="",i=t.payloadType;if(t.preferredPayloadType!==void 0&&(i=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){const s=[];Object.keys(t.parameters).forEach(c=>{t.parameters[c]!==void 0?s.push(c+"="+t.parameters[c]):s.push(c)}),r+="a=fmtp:"+i+" "+s.join(";")+`\r
`}return r},e.parseRtcpFb=function(t){const r=t.substring(t.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},e.writeRtcpFb=function(t){let r="",i=t.payloadType;return t.preferredPayloadType!==void 0&&(i=t.preferredPayloadType),t.rtcpFeedback&&t.rtcpFeedback.length&&t.rtcpFeedback.forEach(s=>{r+="a=rtcp-fb:"+i+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),r},e.parseSsrcMedia=function(t){const r=t.indexOf(" "),i={ssrc:parseInt(t.substring(7,r),10)},s=t.indexOf(":",r);return s>-1?(i.attribute=t.substring(r+1,s),i.value=t.substring(s+1)):i.attribute=t.substring(r+1),i},e.parseSsrcGroup=function(t){const r=t.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(i=>parseInt(i,10))}},e.getMid=function(t){const r=e.matchPrefix(t,"a=mid:")[0];if(r)return r.substring(6)},e.parseFingerprint=function(t){const r=t.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},e.getDtlsParameters=function(t,r){return{role:"auto",fingerprints:e.matchPrefix(t+r,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(t,r){let i="a=setup:"+r+`\r
`;return t.fingerprints.forEach(s=>{i+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),i},e.parseCryptoLine=function(t){const r=t.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},e.writeCryptoLine=function(t){return"a=crypto:"+t.tag+" "+t.cryptoSuite+" "+(typeof t.keyParams=="object"?e.writeCryptoKeyParams(t.keyParams):t.keyParams)+(t.sessionParams?" "+t.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(t){if(t.indexOf("inline:")!==0)return null;const r=t.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(t){return t.keyMethod+":"+t.keySalt+(t.lifeTime?"|"+t.lifeTime:"")+(t.mkiValue&&t.mkiLength?"|"+t.mkiValue+":"+t.mkiLength:"")},e.getCryptoParameters=function(t,r){return e.matchPrefix(t+r,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(t,r){const i=e.matchPrefix(t+r,"a=ice-ufrag:")[0],s=e.matchPrefix(t+r,"a=ice-pwd:")[0];return i&&s?{usernameFragment:i.substring(12),password:s.substring(10)}:null},e.writeIceParameters=function(t){let r="a=ice-ufrag:"+t.usernameFragment+`\r
a=ice-pwd:`+t.password+`\r
`;return t.iceLite&&(r+=`a=ice-lite\r
`),r},e.parseRtpParameters=function(t){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=e.splitLines(t)[0].split(" ");r.profile=s[2];for(let l=3;l<s.length;l++){const d=s[l],h=e.matchPrefix(t,"a=rtpmap:"+d+" ")[0];if(h){const m=e.parseRtpMap(h),g=e.matchPrefix(t,"a=fmtp:"+d+" ");switch(m.parameters=g.length?e.parseFmtp(g[0]):{},m.rtcpFeedback=e.matchPrefix(t,"a=rtcp-fb:"+d+" ").map(e.parseRtcpFb),r.codecs.push(m),m.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(m.name.toUpperCase());break}}}e.matchPrefix(t,"a=extmap:").forEach(l=>{r.headerExtensions.push(e.parseExtmap(l))});const c=e.matchPrefix(t,"a=rtcp-fb:* ").map(e.parseRtcpFb);return r.codecs.forEach(l=>{c.forEach(d=>{l.rtcpFeedback.find(m=>m.type===d.type&&m.parameter===d.parameter)||l.rtcpFeedback.push(d)})}),r},e.writeRtpDescription=function(t,r){let i="";i+="m="+t+" ",i+=r.codecs.length>0?"9":"0",i+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=r.codecs.map(c=>c.preferredPayloadType!==void 0?c.preferredPayloadType:c.payloadType).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(c=>{i+=e.writeRtpMap(c),i+=e.writeFmtp(c),i+=e.writeRtcpFb(c)});let s=0;return r.codecs.forEach(c=>{c.maxptime>s&&(s=c.maxptime)}),s>0&&(i+="a=maxptime:"+s+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(c=>{i+=e.writeExtmap(c)}),i},e.parseRtpEncodingParameters=function(t){const r=[],i=e.parseRtpParameters(t),s=i.fecMechanisms.indexOf("RED")!==-1,c=i.fecMechanisms.indexOf("ULPFEC")!==-1,l=e.matchPrefix(t,"a=ssrc:").map(b=>e.parseSsrcMedia(b)).filter(b=>b.attribute==="cname"),d=l.length>0&&l[0].ssrc;let h;const m=e.matchPrefix(t,"a=ssrc-group:FID").map(b=>b.substring(17).split(" ").map(R=>parseInt(R,10)));m.length>0&&m[0].length>1&&m[0][0]===d&&(h=m[0][1]),i.codecs.forEach(b=>{if(b.name.toUpperCase()==="RTX"&&b.parameters.apt){let _={ssrc:d,codecPayloadType:parseInt(b.parameters.apt,10)};d&&h&&(_.rtx={ssrc:h}),r.push(_),s&&(_=JSON.parse(JSON.stringify(_)),_.fec={ssrc:d,mechanism:c?"red+ulpfec":"red"},r.push(_))}}),r.length===0&&d&&r.push({ssrc:d});let g=e.matchPrefix(t,"b=");return g.length&&(g[0].indexOf("b=TIAS:")===0?g=parseInt(g[0].substring(7),10):g[0].indexOf("b=AS:")===0?g=parseInt(g[0].substring(5),10)*1e3*.95-2e3*8:g=void 0,r.forEach(b=>{b.maxBitrate=g})),r},e.parseRtcpParameters=function(t){const r={},i=e.matchPrefix(t,"a=ssrc:").map(l=>e.parseSsrcMedia(l)).filter(l=>l.attribute==="cname")[0];i&&(r.cname=i.value,r.ssrc=i.ssrc);const s=e.matchPrefix(t,"a=rtcp-rsize");r.reducedSize=s.length>0,r.compound=s.length===0;const c=e.matchPrefix(t,"a=rtcp-mux");return r.mux=c.length>0,r},e.writeRtcpParameters=function(t){let r="";return t.reducedSize&&(r+=`a=rtcp-rsize\r
`),t.mux&&(r+=`a=rtcp-mux\r
`),t.ssrc!==void 0&&t.cname&&(r+="a=ssrc:"+t.ssrc+" cname:"+t.cname+`\r
`),r},e.parseMsid=function(t){let r;const i=e.matchPrefix(t,"a=msid:");if(i.length===1)return r=i[0].substring(7).split(" "),{stream:r[0],track:r[1]};const s=e.matchPrefix(t,"a=ssrc:").map(c=>e.parseSsrcMedia(c)).filter(c=>c.attribute==="msid");if(s.length>0)return r=s[0].value.split(" "),{stream:r[0],track:r[1]}},e.parseSctpDescription=function(t){const r=e.parseMLine(t),i=e.matchPrefix(t,"a=max-message-size:");let s;i.length>0&&(s=parseInt(i[0].substring(19),10)),isNaN(s)&&(s=65536);const c=e.matchPrefix(t,"a=sctp-port:");if(c.length>0)return{port:parseInt(c[0].substring(12),10),protocol:r.fmt,maxMessageSize:s};const l=e.matchPrefix(t,"a=sctpmap:");if(l.length>0){const d=l[0].substring(10).split(" ");return{port:parseInt(d[0],10),protocol:d[1],maxMessageSize:s}}},e.writeSctpDescription=function(t,r){let i=[];return t.protocol!=="DTLS/SCTP"?i=["m="+t.kind+" 9 "+t.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:i=["m="+t.kind+" 9 "+t.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&i.push("a=max-message-size:"+r.maxMessageSize+`\r
`),i.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(t,r,i){let s;const c=r!==void 0?r:2;return t?s=t:s=e.generateSessionId(),`v=0\r
o=`+(i||"thisisadapterortc")+" "+s+" "+c+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(t,r){const i=e.splitLines(t);for(let s=0;s<i.length;s++)switch(i[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[s].substring(2)}return r?e.getDirection(r):"sendrecv"},e.getKind=function(t){return e.splitLines(t)[0].split(" ")[0].substring(2)},e.isRejected=function(t){return t.split(" ",2)[1]==="0"},e.parseMLine=function(t){const i=e.splitLines(t)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},e.parseOLine=function(t){const i=e.matchPrefix(t,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},e.isValidSDP=function(t){if(typeof t!="string"||t.length===0)return!1;const r=e.splitLines(t);for(let i=0;i<r.length;i++)if(r[i].length<2||r[i].charAt(1)!=="=")return!1;return!0},n.exports=e})(o1)),o1.exports}var G5=sq();const Xu=Wf(G5),aq=e9({__proto__:null,default:Xu},[G5]);function yg(n){if(!n.RTCIceCandidate||n.RTCIceCandidate&&"foundation"in n.RTCIceCandidate.prototype)return;const e=n.RTCIceCandidate;n.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substring(2)),r.candidate&&r.candidate.length){const i=new e(r),s=Xu.parseCandidate(r.candidate);for(const c in s)c in i||Object.defineProperty(i,c,{value:s[c]});return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new e(r)},n.RTCIceCandidate.prototype=e.prototype,jl(n,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new n.RTCIceCandidate(t.candidate),writable:"false"}),t))}function Ex(n){!n.RTCIceCandidate||n.RTCIceCandidate&&"relayProtocol"in n.RTCIceCandidate.prototype||jl(n,"icecandidate",e=>{if(e.candidate){const t=Xu.parseCandidate(e.candidate.candidate);t.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e})}function bg(n,e){if(!n.RTCPeerConnection)return;"sctp"in n.RTCPeerConnection.prototype||Object.defineProperty(n.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const t=function(l){if(!l||!l.sdp)return!1;const d=Xu.splitSections(l.sdp);return d.shift(),d.some(h=>{const m=Xu.parseMLine(h);return m&&m.kind==="application"&&m.protocol.indexOf("SCTP")!==-1})},r=function(l){const d=l.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(d===null||d.length<2)return-1;const h=parseInt(d[1],10);return h!==h?-1:h},i=function(l){let d=65536;return e.browser==="firefox"&&(e.version<57?l===-1?d=16384:d=2147483637:e.version<60?d=e.version===57?65535:65536:d=2147483637),d},s=function(l,d){let h=65536;e.browser==="firefox"&&e.version===57&&(h=65535);const m=Xu.matchPrefix(l.sdp,"a=max-message-size:");return m.length>0?h=parseInt(m[0].substring(19),10):e.browser==="firefox"&&d!==-1&&(h=2147483637),h},c=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:d}=this.getConfiguration();d==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(t(arguments[0])){const d=r(arguments[0]),h=i(d),m=s(arguments[0],d);let g;h===0&&m===0?g=Number.POSITIVE_INFINITY:h===0||m===0?g=Math.max(h,m):g=Math.min(h,m);const b={};Object.defineProperty(b,"maxMessageSize",{get(){return g}}),this._sctp=b}return c.apply(this,arguments)}}function xg(n){if(!(n.RTCPeerConnection&&"createDataChannel"in n.RTCPeerConnection.prototype))return;function e(r,i){const s=r.send;r.send=function(){const l=arguments[0],d=l.length||l.size||l.byteLength;if(r.readyState==="open"&&i.sctp&&d>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return s.apply(r,arguments)}}const t=n.RTCPeerConnection.prototype.createDataChannel;n.RTCPeerConnection.prototype.createDataChannel=function(){const i=t.apply(this,arguments);return e(i,this),i},jl(n,"datachannel",r=>(e(r.channel,r.target),r))}function Rx(n){if(!n.RTCPeerConnection||"connectionState"in n.RTCPeerConnection.prototype)return;const e=n.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(t){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),t&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=t)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(t=>{const r=e[t];e[t]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const s=i.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const c=new Event("connectionstatechange",i);s.dispatchEvent(c)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function Ax(n,e){if(!n.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const t=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=i.sdp.split(`
`).filter(c=>c.trim()!=="a=extmap-allow-mixed").join(`
`);n.RTCSessionDescription&&i instanceof n.RTCSessionDescription?arguments[0]=new n.RTCSessionDescription({type:i.type,sdp:s}):i.sdp=s}return t.apply(this,arguments)}}function _g(n,e){if(!(n.RTCPeerConnection&&n.RTCPeerConnection.prototype))return;const t=n.RTCPeerConnection.prototype.addIceCandidate;!t||t.length===0||(n.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Sg(n,e){if(!(n.RTCPeerConnection&&n.RTCPeerConnection.prototype))return;const t=n.RTCPeerConnection.prototype.setLocalDescription;!t||t.length===0||(n.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return t.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer";break}return i.sdp||i.type!=="offer"&&i.type!=="answer"?t.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(c=>t.apply(this,[c]))})}const oq=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:Ax,shimAddIceCandidateNullOrEmpty:_g,shimConnectionState:Rx,shimMaxMessageSize:bg,shimParameterlessSetLocalDescription:Sg,shimRTCIceCandidate:yg,shimRTCIceCandidateRelayProtocol:Ex,shimSendThrowTypeError:xg},Symbol.toStringTag,{value:"Module"}));function cq({window:n}={},e={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const t=v5,r=rq(n),i={browserDetails:r,commonShim:oq,extractVersion:nf,disableLog:tq,disableWarnings:nq,sdp:aq};switch(r.browser){case"chrome":if(!xR||!Cx||!e.shimChrome)return t("Chrome shim is not included in this adapter release."),i;if(r.version===null)return t("Chrome shim can not determine version, not shimming."),i;t("adapter.js shimming chrome."),i.browserShim=xR,_g(n,r),Sg(n),b5(n,r),x5(n),Cx(n,r),_5(n),C5(n,r),S5(n),T5(n),w5(n,r),yg(n),Ex(n),Rx(n),bg(n,r),xg(n),Ax(n,r);break;case"firefox":if(!_R||!wx||!e.shimFirefox)return t("Firefox shim is not included in this adapter release."),i;t("adapter.js shimming firefox."),i.browserShim=_R,_g(n,r),Sg(n),E5(n,r),wx(n,r),R5(n),I5(n),A5(n),N5(n),P5(n),M5(n),D5(n),O5(n),j5(n),yg(n),Rx(n),bg(n,r),xg(n);break;case"safari":if(!SR||!e.shimSafari)return t("Safari shim is not included in this adapter release."),i;t("adapter.js shimming safari."),i.browserShim=SR,_g(n,r),Sg(n),B5(n),q5(n),V5(n),L5(n),U5(n),$5(n),z5(n),H5(n),yg(n),Ex(n),bg(n,r),xg(n),Ax(n,r);break;default:t("Unsupported browser!");break}return i}const kR=cq({window:typeof window>"u"?void 0:window});function Ll(n,e,t,r){Object.defineProperty(n,e,{get:t,set:r,enumerable:!0,configurable:!0})}class K5{constructor(){this.chunkedMTU=16300,this._dataCount=1,this.chunk=e=>{const t=[],r=e.byteLength,i=Math.ceil(r/this.chunkedMTU);let s=0,c=0;for(;c<r;){const l=Math.min(r,c+this.chunkedMTU),d=e.slice(c,l),h={__peerData:this._dataCount,n:s,data:d,total:i};t.push(h),c=l,s++}return this._dataCount++,t}}}function lq(n){let e=0;for(const i of n)e+=i.byteLength;const t=new Uint8Array(e);let r=0;for(const i of n)t.set(i,r),r+=i.byteLength;return t}const c1=kR.default||kR,Vh=new class{isWebRTCSupported(){return typeof RTCPeerConnection<"u"}isBrowserSupported(){const n=this.getBrowser(),e=this.getVersion();return this.supportedBrowsers.includes(n)?n==="chrome"?e>=this.minChromeVersion:n==="firefox"?e>=this.minFirefoxVersion:n==="safari"?!this.isIOS&&e>=this.minSafariVersion:!1:!1}getBrowser(){return c1.browserDetails.browser}getVersion(){return c1.browserDetails.version||0}isUnifiedPlanSupported(){const n=this.getBrowser(),e=c1.browserDetails.version||0;if(n==="chrome"&&e<this.minChromeVersion)return!1;if(n==="firefox"&&e>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let t,r=!1;try{t=new RTCPeerConnection,t.addTransceiver("audio"),r=!0}catch{}finally{t&&t.close()}return r}toString(){return`Supports:
    browser:${this.getBrowser()}
    version:${this.getVersion()}
    isIOS:${this.isIOS}
    isWebRTCSupported:${this.isWebRTCSupported()}
    isBrowserSupported:${this.isBrowserSupported()}
    isUnifiedPlanSupported:${this.isUnifiedPlanSupported()}`}constructor(){this.isIOS=typeof navigator<"u"?["iPad","iPhone","iPod"].includes(navigator.platform):!1,this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}},uq=n=>!n||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(n),W5=()=>Math.random().toString(36).slice(2),CR={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"};class dq extends K5{noop(){}blobToArrayBuffer(e,t){const r=new FileReader;return r.onload=function(i){i.target&&t(i.target.result)},r.readAsArrayBuffer(e),r}binaryStringToArrayBuffer(e){const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r)&255;return t.buffer}isSecure(){return location.protocol==="https:"}constructor(...e){super(...e),this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.defaultConfig=CR,this.browser=Vh.getBrowser(),this.browserVersion=Vh.getVersion(),this.pack=p5,this.unpack=f5,this.supports=(function(){const t={browser:Vh.isBrowserSupported(),webRTC:Vh.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!t.webRTC)return t;let r;try{r=new RTCPeerConnection(CR),t.audioVideo=!0;let i;try{i=r.createDataChannel("_PEERJSTEST",{ordered:!0}),t.data=!0,t.reliable=!!i.ordered;try{i.binaryType="blob",t.binaryBlob=!Vh.isIOS}catch{}}catch{}finally{i&&i.close()}}catch{}finally{r&&r.close()}return t})(),this.validateId=uq,this.randomToken=W5}}const si=new dq,hq="PeerJS: ";class fq{get logLevel(){return this._logLevel}set logLevel(e){this._logLevel=e}log(...e){this._logLevel>=3&&this._print(3,...e)}warn(...e){this._logLevel>=2&&this._print(2,...e)}error(...e){this._logLevel>=1&&this._print(1,...e)}setLogFunction(e){this._print=e}_print(e,...t){const r=[hq,...t];for(const i in r)r[i]instanceof Error&&(r[i]="("+r[i].name+") "+r[i].message);e>=3?console.log(...r):e>=2?console.warn("WARNING",...r):e>=1&&console.error("ERROR",...r)}constructor(){this._logLevel=0}}var Ze=new fq,US={},pq=Object.prototype.hasOwnProperty,Kr="~";function Pf(){}Object.create&&(Pf.prototype=Object.create(null),new Pf().__proto__||(Kr=!1));function mq(n,e,t){this.fn=n,this.context=e,this.once=t||!1}function Y5(n,e,t,r,i){if(typeof t!="function")throw new TypeError("The listener must be a function");var s=new mq(t,r||n,i),c=Kr?Kr+e:e;return n._events[c]?n._events[c].fn?n._events[c]=[n._events[c],s]:n._events[c].push(s):(n._events[c]=s,n._eventsCount++),n}function Tg(n,e){--n._eventsCount===0?n._events=new Pf:delete n._events[e]}function Lr(){this._events=new Pf,this._eventsCount=0}Lr.prototype.eventNames=function(){var e=[],t,r;if(this._eventsCount===0)return e;for(r in t=this._events)pq.call(t,r)&&e.push(Kr?r.slice(1):r);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};Lr.prototype.listeners=function(e){var t=Kr?Kr+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,s=r.length,c=new Array(s);i<s;i++)c[i]=r[i].fn;return c};Lr.prototype.listenerCount=function(e){var t=Kr?Kr+e:e,r=this._events[t];return r?r.fn?1:r.length:0};Lr.prototype.emit=function(e,t,r,i,s,c){var l=Kr?Kr+e:e;if(!this._events[l])return!1;var d=this._events[l],h=arguments.length,m,g;if(d.fn){switch(d.once&&this.removeListener(e,d.fn,void 0,!0),h){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,t),!0;case 3:return d.fn.call(d.context,t,r),!0;case 4:return d.fn.call(d.context,t,r,i),!0;case 5:return d.fn.call(d.context,t,r,i,s),!0;case 6:return d.fn.call(d.context,t,r,i,s,c),!0}for(g=1,m=new Array(h-1);g<h;g++)m[g-1]=arguments[g];d.fn.apply(d.context,m)}else{var b=d.length,_;for(g=0;g<b;g++)switch(d[g].once&&this.removeListener(e,d[g].fn,void 0,!0),h){case 1:d[g].fn.call(d[g].context);break;case 2:d[g].fn.call(d[g].context,t);break;case 3:d[g].fn.call(d[g].context,t,r);break;case 4:d[g].fn.call(d[g].context,t,r,i);break;default:if(!m)for(_=1,m=new Array(h-1);_<h;_++)m[_-1]=arguments[_];d[g].fn.apply(d[g].context,m)}}return!0};Lr.prototype.on=function(e,t,r){return Y5(this,e,t,r,!1)};Lr.prototype.once=function(e,t,r){return Y5(this,e,t,r,!0)};Lr.prototype.removeListener=function(e,t,r,i){var s=Kr?Kr+e:e;if(!this._events[s])return this;if(!t)return Tg(this,s),this;var c=this._events[s];if(c.fn)c.fn===t&&(!i||c.once)&&(!r||c.context===r)&&Tg(this,s);else{for(var l=0,d=[],h=c.length;l<h;l++)(c[l].fn!==t||i&&!c[l].once||r&&c[l].context!==r)&&d.push(c[l]);d.length?this._events[s]=d.length===1?d[0]:d:Tg(this,s)}return this};Lr.prototype.removeAllListeners=function(e){var t;return e?(t=Kr?Kr+e:e,this._events[t]&&Tg(this,t)):(this._events=new Pf,this._eventsCount=0),this};Lr.prototype.off=Lr.prototype.removeListener;Lr.prototype.addListener=Lr.prototype.on;Lr.prefixed=Kr;Lr.EventEmitter=Lr;US=Lr;var Ul={};Ll(Ul,"ConnectionType",()=>cc);Ll(Ul,"PeerErrorType",()=>Yn);Ll(Ul,"BaseConnectionErrorType",()=>Nx);Ll(Ul,"DataConnectionErrorType",()=>VS);Ll(Ul,"SerializationType",()=>b0);Ll(Ul,"SocketEventType",()=>tc);Ll(Ul,"ServerMessageType",()=>Dr);var cc=(function(n){return n.Data="data",n.Media="media",n})({}),Yn=(function(n){return n.BrowserIncompatible="browser-incompatible",n.Disconnected="disconnected",n.InvalidID="invalid-id",n.InvalidKey="invalid-key",n.Network="network",n.PeerUnavailable="peer-unavailable",n.SslUnavailable="ssl-unavailable",n.ServerError="server-error",n.SocketError="socket-error",n.SocketClosed="socket-closed",n.UnavailableID="unavailable-id",n.WebRTC="webrtc",n})({}),Nx=(function(n){return n.NegotiationFailed="negotiation-failed",n.ConnectionClosed="connection-closed",n})({}),VS=(function(n){return n.NotOpenYet="not-open-yet",n.MessageToBig="message-too-big",n})({}),b0=(function(n){return n.Binary="binary",n.BinaryUTF8="binary-utf8",n.JSON="json",n.None="raw",n})({}),tc=(function(n){return n.Message="message",n.Disconnected="disconnected",n.Error="error",n.Close="close",n})({}),Dr=(function(n){return n.Heartbeat="HEARTBEAT",n.Candidate="CANDIDATE",n.Offer="OFFER",n.Answer="ANSWER",n.Open="OPEN",n.Error="ERROR",n.IdTaken="ID-TAKEN",n.InvalidKey="INVALID-KEY",n.Leave="LEAVE",n.Expire="EXPIRE",n})({});const Q5="1.5.5";class gq extends US.EventEmitter{constructor(e,t,r,i,s,c=5e3){super(),this.pingInterval=c,this._disconnected=!0,this._messagesQueue=[];const l=e?"wss://":"ws://";this._baseUrl=l+t+":"+r+i+"peerjs?key="+s}start(e,t){this._id=e;const r=`${this._baseUrl}&id=${e}&token=${t}`;this._socket||!this._disconnected||(this._socket=new WebSocket(r+"&version="+Q5),this._disconnected=!1,this._socket.onmessage=i=>{let s;try{s=JSON.parse(i.data),Ze.log("Server message received:",s)}catch{Ze.log("Invalid server message",i.data);return}this.emit(tc.Message,s)},this._socket.onclose=i=>{this._disconnected||(Ze.log("Socket closed.",i),this._cleanup(),this._disconnected=!0,this.emit(tc.Disconnected))},this._socket.onopen=()=>{this._disconnected||(this._sendQueuedMessages(),Ze.log("Socket open"),this._scheduleHeartbeat())})}_scheduleHeartbeat(){this._wsPingTimer=setTimeout(()=>{this._sendHeartbeat()},this.pingInterval)}_sendHeartbeat(){if(!this._wsOpen()){Ze.log("Cannot send heartbeat, because socket closed");return}const e=JSON.stringify({type:Dr.Heartbeat});this._socket.send(e),this._scheduleHeartbeat()}_wsOpen(){return!!this._socket&&this._socket.readyState===1}_sendQueuedMessages(){const e=[...this._messagesQueue];this._messagesQueue=[];for(const t of e)this.send(t)}send(e){if(this._disconnected)return;if(!this._id){this._messagesQueue.push(e);return}if(!e.type){this.emit(tc.Error,"Invalid message");return}if(!this._wsOpen())return;const t=JSON.stringify(e);this._socket.send(t)}close(){this._disconnected||(this._cleanup(),this._disconnected=!0)}_cleanup(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)}}class X5{constructor(e){this.connection=e}startConnection(e){const t=this._startPeerConnection();if(this.connection.peerConnection=t,this.connection.type===cc.Media&&e._stream&&this._addTracksToConnection(e._stream,t),e.originator){const r=this.connection,i={ordered:!!e.reliable},s=t.createDataChannel(r.label,i);r._initializeDataChannel(s),this._makeOffer()}else this.handleSDP("OFFER",e.sdp)}_startPeerConnection(){Ze.log("Creating RTCPeerConnection.");const e=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(e),e}_setupListeners(e){const t=this.connection.peer,r=this.connection.connectionId,i=this.connection.type,s=this.connection.provider;Ze.log("Listening for ICE candidates."),e.onicecandidate=c=>{!c.candidate||!c.candidate.candidate||(Ze.log(`Received ICE candidates for ${t}:`,c.candidate),s.socket.send({type:Dr.Candidate,payload:{candidate:c.candidate,type:i,connectionId:r},dst:t}))},e.oniceconnectionstatechange=()=>{switch(e.iceConnectionState){case"failed":Ze.log("iceConnectionState is failed, closing connections to "+t),this.connection.emitError(Nx.NegotiationFailed,"Negotiation of connection to "+t+" failed."),this.connection.close();break;case"closed":Ze.log("iceConnectionState is closed, closing connections to "+t),this.connection.emitError(Nx.ConnectionClosed,"Connection to "+t+" closed."),this.connection.close();break;case"disconnected":Ze.log("iceConnectionState changed to disconnected on the connection with "+t);break;case"completed":e.onicecandidate=()=>{};break}this.connection.emit("iceStateChanged",e.iceConnectionState)},Ze.log("Listening for data channel"),e.ondatachannel=c=>{Ze.log("Received data channel");const l=c.channel;s.getConnection(t,r)._initializeDataChannel(l)},Ze.log("Listening for remote stream"),e.ontrack=c=>{Ze.log("Received remote stream");const l=c.streams[0],d=s.getConnection(t,r);if(d.type===cc.Media){const h=d;this._addStreamToMediaConnection(l,h)}}}cleanup(){Ze.log("Cleaning up PeerConnection to "+this.connection.peer);const e=this.connection.peerConnection;if(!e)return;this.connection.peerConnection=null,e.onicecandidate=e.oniceconnectionstatechange=e.ondatachannel=e.ontrack=()=>{};const t=e.signalingState!=="closed";let r=!1;const i=this.connection.dataChannel;i&&(r=!!i.readyState&&i.readyState!=="closed"),(t||r)&&e.close()}async _makeOffer(){const e=this.connection.peerConnection,t=this.connection.provider;try{const r=await e.createOffer(this.connection.options.constraints);Ze.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),Ze.log("Set localDescription:",r,`for:${this.connection.peer}`);let i={sdp:r,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata};if(this.connection.type===cc.Data){const s=this.connection;i={...i,label:s.label,reliable:s.reliable,serialization:s.serialization}}t.socket.send({type:Dr.Offer,payload:i,dst:this.connection.peer})}catch(i){i!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(t.emitError(Yn.WebRTC,i),Ze.log("Failed to setLocalDescription, ",i))}}catch(r){t.emitError(Yn.WebRTC,r),Ze.log("Failed to createOffer, ",r)}}async _makeAnswer(){const e=this.connection.peerConnection,t=this.connection.provider;try{const r=await e.createAnswer();Ze.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),Ze.log("Set localDescription:",r,`for:${this.connection.peer}`),t.socket.send({type:Dr.Answer,payload:{sdp:r,type:this.connection.type,connectionId:this.connection.connectionId},dst:this.connection.peer})}catch(i){t.emitError(Yn.WebRTC,i),Ze.log("Failed to setLocalDescription, ",i)}}catch(r){t.emitError(Yn.WebRTC,r),Ze.log("Failed to create answer, ",r)}}async handleSDP(e,t){t=new RTCSessionDescription(t);const r=this.connection.peerConnection,i=this.connection.provider;Ze.log("Setting remote description",t);const s=this;try{await r.setRemoteDescription(t),Ze.log(`Set remoteDescription:${e} for:${this.connection.peer}`),e==="OFFER"&&await s._makeAnswer()}catch(c){i.emitError(Yn.WebRTC,c),Ze.log("Failed to setRemoteDescription, ",c)}}async handleCandidate(e){Ze.log("handleCandidate:",e);try{await this.connection.peerConnection.addIceCandidate(e),Ze.log(`Added ICE candidate for:${this.connection.peer}`)}catch(t){this.connection.provider.emitError(Yn.WebRTC,t),Ze.log("Failed to handleCandidate, ",t)}}_addTracksToConnection(e,t){if(Ze.log(`add tracks from stream ${e.id} to peer connection`),!t.addTrack)return Ze.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");e.getTracks().forEach(r=>{t.addTrack(r,e)})}_addStreamToMediaConnection(e,t){Ze.log(`add stream ${e.id} to media connection ${t.connectionId}`),t.addStream(e)}}class J5 extends US.EventEmitter{emitError(e,t){Ze.error("Error:",t),this.emit("error",new vq(`${e}`,t))}}class vq extends Error{constructor(e,t){typeof t=="string"?super(t):(super(),Object.assign(this,t)),this.type=e}}class Z5 extends J5{get open(){return this._open}constructor(e,t,r){super(),this.peer=e,this.provider=t,this.options=r,this._open=!1,this.metadata=r.metadata}}class xv extends Z5{static#e=this.ID_PREFIX="mc_";get type(){return cc.Media}get localStream(){return this._localStream}get remoteStream(){return this._remoteStream}constructor(e,t,r){super(e,t,r),this._localStream=this.options._stream,this.connectionId=this.options.connectionId||xv.ID_PREFIX+si.randomToken(),this._negotiator=new X5(this),this._localStream&&this._negotiator.startConnection({_stream:this._localStream,originator:!0})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{Ze.log(`DC#${this.connectionId} dc connection success`),this.emit("willCloseOnRemote")},this.dataChannel.onclose=()=>{Ze.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}addStream(e){Ze.log("Receiving stream",e),this._remoteStream=e,super.emit("stream",e)}handleMessage(e){const t=e.type,r=e.payload;switch(e.type){case Dr.Answer:this._negotiator.handleSDP(t,r.sdp),this._open=!0;break;case Dr.Candidate:this._negotiator.handleCandidate(r.candidate);break;default:Ze.warn(`Unrecognized message type:${t} from peer:${this.peer}`);break}}answer(e,t={}){if(this._localStream){Ze.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=e,t&&t.sdpTransform&&(this.options.sdpTransform=t.sdpTransform),this._negotiator.startConnection({...this.options._payload,_stream:e});const r=this.provider._getMessages(this.connectionId);for(const i of r)this.handleMessage(i);this._open=!0}close(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,super.emit("close"))}}class yq{constructor(e){this._options=e}_buildRequest(e){const t=this._options.secure?"https":"http",{host:r,port:i,path:s,key:c}=this._options,l=new URL(`${t}://${r}:${i}${s}${c}/${e}`);return l.searchParams.set("ts",`${Date.now()}${Math.random()}`),l.searchParams.set("version",Q5),fetch(l.href,{referrerPolicy:this._options.referrerPolicy})}async retrieveId(){try{const e=await this._buildRequest("id");if(e.status!==200)throw new Error(`Error. Status:${e.status}`);return e.text()}catch(e){Ze.error("Error retrieving ID",e);let t="";throw this._options.path==="/"&&this._options.host!==si.CLOUD_HOST&&(t=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+t)}}async listAllPeers(){try{const e=await this._buildRequest("peers");if(e.status!==200){if(e.status===401){let t="";throw this._options.host===si.CLOUD_HOST?t="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":t="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+t)}throw new Error(`Error. Status:${e.status}`)}return e.json()}catch(e){throw Ze.error("Error retrieving list peers",e),new Error("Could not get list peers from the server."+e)}}}class _v extends Z5{static#e=this.ID_PREFIX="dc_";static#t=this.MAX_BUFFERED_AMOUNT=8388608;get type(){return cc.Data}constructor(e,t,r){super(e,t,r),this.connectionId=this.options.connectionId||_v.ID_PREFIX+W5(),this.label=this.options.label||this.connectionId,this.reliable=!!this.options.reliable,this._negotiator=new X5(this),this._negotiator.startConnection(this.options._payload||{originator:!0,reliable:this.reliable})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{Ze.log(`DC#${this.connectionId} dc connection success`),this._open=!0,this.emit("open")},this.dataChannel.onmessage=t=>{Ze.log(`DC#${this.connectionId} dc onmessage:`,t.data)},this.dataChannel.onclose=()=>{Ze.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}close(e){if(e?.flush){this.send({__peerData:{type:"close"}});return}this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this.dataChannel=null),this.open&&(this._open=!1,super.emit("close"))}send(e,t=!1){if(!this.open){this.emitError(VS.NotOpenYet,"Connection is not open. You should listen for the `open` event before sending messages.");return}return this._send(e,t)}async handleMessage(e){const t=e.payload;switch(e.type){case Dr.Answer:await this._negotiator.handleSDP(e.type,t.sdp);break;case Dr.Candidate:await this._negotiator.handleCandidate(t.candidate);break;default:Ze.warn("Unrecognized message type:",e.type,"from peer:",this.peer);break}}}class zS extends _v{get bufferSize(){return this._bufferSize}_initializeDataChannel(e){super._initializeDataChannel(e),this.dataChannel.binaryType="arraybuffer",this.dataChannel.addEventListener("message",t=>this._handleDataMessage(t))}_bufferedSend(e){(this._buffering||!this._trySend(e))&&(this._buffer.push(e),this._bufferSize=this._buffer.length)}_trySend(e){if(!this.open)return!1;if(this.dataChannel.bufferedAmount>_v.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(()=>{this._buffering=!1,this._tryBuffer()},50),!1;try{this.dataChannel.send(e)}catch(t){return Ze.error(`DC#:${this.connectionId} Error when sending:`,t),this._buffering=!0,this.close(),!1}return!0}_tryBuffer(){if(!this.open||this._buffer.length===0)return;const e=this._buffer[0];this._trySend(e)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}close(e){if(e?.flush){this.send({__peerData:{type:"close"}});return}this._buffer=[],this._bufferSize=0,super.close()}constructor(...e){super(...e),this._buffer=[],this._bufferSize=0,this._buffering=!1}}class l1 extends zS{close(e){super.close(e),this._chunkedData={}}constructor(e,t,r){super(e,t,r),this.chunker=new K5,this.serialization=b0.Binary,this._chunkedData={}}_handleDataMessage({data:e}){const t=f5(e),r=t.__peerData;if(r){if(r.type==="close"){this.close();return}this._handleChunk(t);return}this.emit("data",t)}_handleChunk(e){const t=e.__peerData,r=this._chunkedData[t]||{data:[],count:0,total:e.total};if(r.data[e.n]=new Uint8Array(e.data),r.count++,this._chunkedData[t]=r,r.total===r.count){delete this._chunkedData[t];const i=lq(r.data);this._handleDataMessage({data:i})}}_send(e,t){const r=p5(e);if(r instanceof Promise)return this._send_blob(r);if(!t&&r.byteLength>this.chunker.chunkedMTU){this._sendChunks(r);return}this._bufferedSend(r)}async _send_blob(e){const t=await e;if(t.byteLength>this.chunker.chunkedMTU){this._sendChunks(t);return}this._bufferedSend(t)}_sendChunks(e){const t=this.chunker.chunk(e);Ze.log(`DC#${this.connectionId} Try to send ${t.length} chunks...`);for(const r of t)this.send(r,!0)}}class bq extends zS{_handleDataMessage({data:e}){super.emit("data",e)}_send(e,t){this._bufferedSend(e)}constructor(...e){super(...e),this.serialization=b0.None}}class xq extends zS{_handleDataMessage({data:e}){const t=this.parse(this.decoder.decode(e)),r=t.__peerData;if(r&&r.type==="close"){this.close();return}this.emit("data",t)}_send(e,t){const r=this.encoder.encode(this.stringify(e));if(r.byteLength>=si.chunkedMTU){this.emitError(VS.MessageToBig,"Message too big for JSON channel");return}this._bufferedSend(r)}constructor(...e){super(...e),this.serialization=b0.JSON,this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.stringify=JSON.stringify,this.parse=JSON.parse}}class FS extends J5{static#e=this.DEFAULT_KEY="peerjs";get id(){return this._id}get options(){return this._options}get open(){return this._open}get socket(){return this._socket}get connections(){const e=Object.create(null);for(const[t,r]of this._connections)e[t]=r;return e}get destroyed(){return this._destroyed}get disconnected(){return this._disconnected}constructor(e,t){super(),this._serializers={raw:bq,json:xq,binary:l1,"binary-utf8":l1,default:l1},this._id=null,this._lastServerId=null,this._destroyed=!1,this._disconnected=!1,this._open=!1,this._connections=new Map,this._lostMessages=new Map;let r;if(e&&e.constructor==Object?t=e:e&&(r=e.toString()),t={debug:0,host:si.CLOUD_HOST,port:si.CLOUD_PORT,path:"/",key:FS.DEFAULT_KEY,token:si.randomToken(),config:si.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin",serializers:{},...t},this._options=t,this._serializers={...this._serializers,...this.options.serializers},this._options.host==="/"&&(this._options.host=window.location.hostname),this._options.path&&(this._options.path[0]!=="/"&&(this._options.path="/"+this._options.path),this._options.path[this._options.path.length-1]!=="/"&&(this._options.path+="/")),this._options.secure===void 0&&this._options.host!==si.CLOUD_HOST?this._options.secure=si.isSecure():this._options.host==si.CLOUD_HOST&&(this._options.secure=!0),this._options.logFunction&&Ze.setLogFunction(this._options.logFunction),Ze.logLevel=this._options.debug||0,this._api=new yq(t),this._socket=this._createServerConnection(),!si.supports.audioVideo&&!si.supports.data){this._delayedAbort(Yn.BrowserIncompatible,"The current browser does not support WebRTC");return}if(r&&!si.validateId(r)){this._delayedAbort(Yn.InvalidID,`ID "${r}" is invalid`);return}r?this._initialize(r):this._api.retrieveId().then(i=>this._initialize(i)).catch(i=>this._abort(Yn.ServerError,i))}_createServerConnection(){const e=new gq(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return e.on(tc.Message,t=>{this._handleMessage(t)}),e.on(tc.Error,t=>{this._abort(Yn.SocketError,t)}),e.on(tc.Disconnected,()=>{this.disconnected||(this.emitError(Yn.Network,"Lost connection to server."),this.disconnect())}),e.on(tc.Close,()=>{this.disconnected||this._abort(Yn.SocketClosed,"Underlying socket is already closed.")}),e}_initialize(e){this._id=e,this.socket.start(e,this._options.token)}_handleMessage(e){const t=e.type,r=e.payload,i=e.src;switch(t){case Dr.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case Dr.Error:this._abort(Yn.ServerError,r.msg);break;case Dr.IdTaken:this._abort(Yn.UnavailableID,`ID "${this.id}" is taken`);break;case Dr.InvalidKey:this._abort(Yn.InvalidKey,`API KEY "${this._options.key}" is invalid`);break;case Dr.Leave:Ze.log(`Received leave message from ${i}`),this._cleanupPeer(i),this._connections.delete(i);break;case Dr.Expire:this.emitError(Yn.PeerUnavailable,`Could not connect to peer ${i}`);break;case Dr.Offer:{const s=r.connectionId;let c=this.getConnection(i,s);if(c&&(c.close(),Ze.warn(`Offer received for existing Connection ID:${s}`)),r.type===cc.Media){const d=new xv(i,this,{connectionId:s,_payload:r,metadata:r.metadata});c=d,this._addConnection(i,c),this.emit("call",d)}else if(r.type===cc.Data){const d=new this._serializers[r.serialization](i,this,{connectionId:s,_payload:r,metadata:r.metadata,label:r.label,serialization:r.serialization,reliable:r.reliable});c=d,this._addConnection(i,c),this.emit("connection",d)}else{Ze.warn(`Received malformed connection type:${r.type}`);return}const l=this._getMessages(s);for(const d of l)c.handleMessage(d);break}default:{if(!r){Ze.warn(`You received a malformed message from ${i} of type ${t}`);return}const s=r.connectionId,c=this.getConnection(i,s);c&&c.peerConnection?c.handleMessage(e):s?this._storeMessage(s,e):Ze.warn("You received an unrecognized message:",e);break}}}_storeMessage(e,t){this._lostMessages.has(e)||this._lostMessages.set(e,[]),this._lostMessages.get(e).push(t)}_getMessages(e){const t=this._lostMessages.get(e);return t?(this._lostMessages.delete(e),t):[]}connect(e,t={}){if(t={serialization:"default",...t},this.disconnected){Ze.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(Yn.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}const r=new this._serializers[t.serialization](e,this,t);return this._addConnection(e,r),r}call(e,t,r={}){if(this.disconnected){Ze.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(Yn.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!t){Ze.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}const i=new xv(e,this,{...r,_stream:t});return this._addConnection(e,i),i}_addConnection(e,t){Ze.log(`add connection ${t.type}:${t.connectionId} to peerId:${e}`),this._connections.has(e)||this._connections.set(e,[]),this._connections.get(e).push(t)}_removeConnection(e){const t=this._connections.get(e.peer);if(t){const r=t.indexOf(e);r!==-1&&t.splice(r,1)}this._lostMessages.delete(e.connectionId)}getConnection(e,t){const r=this._connections.get(e);if(!r)return null;for(const i of r)if(i.connectionId===t)return i;return null}_delayedAbort(e,t){setTimeout(()=>{this._abort(e,t)},0)}_abort(e,t){Ze.error("Aborting!"),this.emitError(e,t),this._lastServerId?this.disconnect():this.destroy()}destroy(){this.destroyed||(Ze.log(`Destroy peer with ID:${this.id}`),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))}_cleanup(){for(const e of this._connections.keys())this._cleanupPeer(e),this._connections.delete(e);this.socket.removeAllListeners()}_cleanupPeer(e){const t=this._connections.get(e);if(t)for(const r of t)r.close()}disconnect(){if(this.disconnected)return;const e=this.id;Ze.log(`Disconnect peer with ID:${e}`),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=e,this._id=null,this.emit("disconnected",e)}reconnect(){if(this.disconnected&&!this.destroyed)Ze.log(`Attempting reconnection to server with ID ${this._lastServerId}`),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)Ze.error("In a hurry? We're still trying to make the initial connection!");else throw new Error(`Peer ${this.id} cannot reconnect because it is not disconnected from the server!`)}}listAllPeers(e=t=>{}){this._api.listAllPeers().then(t=>e(t)).catch(t=>this._abort(Yn.ServerError,t))}}var _q=FS;let u1=null,Mf=[],Sv=[];const e3=()=>(u1||(u1=new(window.AudioContext||window.webkitAudioContext)),u1),Df=()=>{Mf.forEach(n=>{try{n.stop(),n.disconnect()}catch{}}),Mf=[],Sv.forEach(n=>{try{n.disconnect()}catch{}}),Sv=[]},Sq=()=>{try{const n=e3();n.state==="suspended"&&n.resume(),Df();const e=n.createOscillator(),t=n.createGain();e.type="sine",e.frequency.value=440,e.connect(t),t.connect(n.destination);const r=n.currentTime;let i=!0;const s=()=>{if(!i)return;const l=n.createOscillator(),d=n.createGain();l.connect(d),d.connect(n.destination),l.frequency.value=425,l.type="sine";const h=n.currentTime,m=n.createOscillator();m.type="sine",m.frequency.value=20;const g=n.createGain();g.gain.value=500,m.connect(g),g.connect(l.frequency),m.start(h),m.stop(h+2),d.gain.setValueAtTime(0,h),d.gain.linearRampToValueAtTime(.1,h+.1),d.gain.setValueAtTime(.1,h+1.8),d.gain.linearRampToValueAtTime(0,h+2),l.start(h),l.stop(h+2),Mf.push(l),Mf.push(m),Sv.push(d)};s();const c=setInterval(s,4e3);return()=>{i=!1,clearInterval(c),Df()}}catch(n){return console.error("Error playing outgoing ring:",n),()=>{}}},Tq=()=>{try{const n=e3();n.state==="suspended"&&n.resume(),Df();let e=!0;const t=()=>{if(!e)return;const i=n.currentTime,s=(c,l)=>{const d=n.createOscillator(),h=n.createGain();d.connect(h),h.connect(n.destination),d.frequency.value=l,d.type="square",h.gain.setValueAtTime(0,c),h.gain.linearRampToValueAtTime(.1,c+.05),h.gain.setValueAtTime(.1,c+.2),h.gain.linearRampToValueAtTime(0,c+.25),d.start(c),d.stop(c+.3),Mf.push(d),Sv.push(h)};s(i,880),s(i+.4,880),s(i+.8,880)};t();const r=setInterval(t,3e3);return()=>{e=!1,clearInterval(r),Df()}}catch(n){return console.error("Error playing incoming ring:",n),()=>{}}},wR=()=>{Df()},qa={SCREEN_SHARE:"screen_share",HIGH_QUALITY:"high_quality"},kq={admin:[qa.SCREEN_SHARE,qa.HIGH_QUALITY],moderator:[qa.SCREEN_SHARE],member:[]},Cq={premium:[qa.SCREEN_SHARE,qa.HIGH_QUALITY],developer:[qa.SCREEN_SHARE,qa.HIGH_QUALITY],verified:[]},t3=(n,e)=>{if(!n)return!1;const t=n.role||"member";if((kq[t]||[]).includes(e))return!0;const i=n.badges||[];for(const s of i)if((Cq[s]||[]).includes(e))return!0;return!1},ER=10,RR=300,n3=T.createContext(),Xi=()=>{const n=T.useContext(n3);if(!n)throw new Error("useCall must be used within CallProvider");return n},wq=({children:n})=>{const{currentUser:e,userProfile:t}=Ar(),{error:r}=Ss(),[i,s]=T.useState(null),[c,l]=T.useState(null),[d,h]=T.useState("idle"),[m,g]=T.useState(null),[b,_]=T.useState(null),[R,E]=T.useState(null),[A,M]=T.useState(null),[F,j]=T.useState(null),[C,N]=T.useState(null),[D,S]=T.useState(null),k=T.useRef(null),[P,L]=T.useState({});T.useRef({});const[U,z]=T.useState({}),V=T.useRef(null),le=T.useRef({}),ve=T.useRef(null),[K,oe]=T.useState(()=>{try{const W=localStorage.getItem("dss_user_volumes");return W?JSON.parse(W):{}}catch{return{}}}),[ee,Me]=T.useState(1);T.useRef(null),T.useEffect(()=>{localStorage.setItem("dss_user_volumes",JSON.stringify(K))},[K]);const je=(W,Z)=>{oe(X=>({...X,[W]:Z}))};T.useEffect(()=>{V.current||(V.current=new(window.AudioContext||window.webkitAudioContext));const W=()=>{if(D)return;const Z=.05,X={...U};let Ne=!1;const Je=tt=>{const xt=new Uint8Array(tt.frequencyBinCount);tt.getByteFrequencyData(xt);let _n=0;for(let un=0;un<xt.length;un++)_n+=xt[un];return _n/xt.length/255};if(le.current.me){const xt=Je(le.current.me)>Z;X.me!==xt&&(X.me=xt,Ne=!0)}Object.keys(le.current).forEach(tt=>{if(tt==="me")return;const _n=Je(le.current[tt])>Z;X[tt]!==_n&&(X[tt]=_n,Ne=!0)}),Ne&&z(X)};return ve.current=setInterval(W,100),()=>{ve.current&&clearInterval(ve.current)}},[]),T.useEffect(()=>{const W=V.current;if(W){if(A&&A.getAudioTracks().length>0&&!le.current.me){const Z=W.createMediaStreamSource(A),X=W.createAnalyser();X.fftSize=64,Z.connect(X),le.current.me=X}else!A&&le.current.me&&delete le.current.me;Object.entries(P).forEach(([Z,X])=>{if(X.stream&&X.stream.getAudioTracks().length>0&&!le.current[Z]){const Ne=W.createMediaStreamSource(X.stream),Je=W.createAnalyser();Je.fftSize=64,Ne.connect(Je),le.current[Z]=Je}}),Object.keys(le.current).forEach(Z=>{Z!=="me"&&!P[Z]&&delete le.current[Z]})}},[A,P]);const[q,te]=T.useState(()=>{try{const W=localStorage.getItem("dss_custom_sounds");return W?JSON.parse(W):[]}catch{return[]}});T.useEffect(()=>{localStorage.setItem("dss_custom_sounds",JSON.stringify(q))},[q]);const fe=async(W,Z)=>q.length>=ER?(r(`Maximum ${ER} sounds allowed.`),!1):Z.size>RR*1024?(r(`File too large. Max ${RR}KB.`),!1):new Promise(X=>{const Ne=new FileReader;Ne.onload=Je=>{const tt={id:Date.now().toString(),name:W.trim()||"Sound",src:Je.target.result};te(xt=>[...xt,tt]),X(!0)},Ne.readAsDataURL(Z)}),Se=W=>{te(Z=>Z.filter(X=>X.id!==W))},[Oe,Te]=T.useState(!1),[we,Ge]=T.useState(!1),[Ke,Ce]=T.useState(!1),[Re,He]=T.useState({audioInputs:[],videoInputs:[],audioOutputs:[]}),[de,Ie]=T.useState(""),[qe,ot]=T.useState(""),$e=W=>{const Z=q.find(Ne=>Ne.id===W);if(!Z)return;const X=new Audio(Z.src);X.volume=.5,ht.current.push(X),X.onended=()=>{ht.current=ht.current.filter(Ne=>Ne!==X)},X.play().catch(Ne=>console.error("Error playing sound:",Ne)),C&&C.open?(console.log("Sending sound effect:",Z.name),C.send({type:"SOUND_EFFECT",payload:{src:Z.src,name:Z.name}})):console.warn("Cannot send sound effect. Data connection missing or closed.")};T.useEffect(()=>{k.current=D},[D]),T.useRef(null),T.useRef(null);const Q=T.useRef(null),Pe=T.useRef(null),Fe=T.useRef(null),ht=T.useRef([]),Vt=()=>{ht.current.forEach(W=>{W.pause(),W.currentTime=0}),ht.current=[]},Lt=W=>{W.on("stream",Z=>{console.log(`Mesh: Received stream from ${W.peer}`),L(X=>({...X,[W.peer]:{call:W,stream:Z}}))}),W.on("close",()=>{console.log(`Mesh: Peer ${W.peer} disconnected`),L(Z=>{const X={...Z};return delete X[W.peer],X})}),W.on("error",Z=>console.error("Mesh call error:",Z))},Yt=()=>{if(Ge(W=>!W),e&&D){const{channelId:W,serverId:Z}=D,X=Be(_e,"servers",Z,"channels",W,"connectedUsers",e.uid);at(X,{isDeafened:!we}).catch(console.error)}},In=T.useRef(null);T.useEffect(()=>{Pe.current=A},[A]),T.useEffect(()=>{Fe.current=R},[R]),T.useEffect(()=>(In.current&&(In.current(),In.current=null),wR(),d==="incoming"?In.current=Tq():d==="outgoing"&&(In.current=Sq()),()=>{In.current&&In.current(),wR()}),[d]),T.useEffect(()=>{if(!e)return;const W=new _q;return W.on("open",Z=>{console.log("My Peer ID is:",Z),l(Z),s(W)}),W.on("call",Z=>{if(console.log("Receiving PeerJS call connection..."),Z.metadata&&Z.metadata.type==="room_call"){console.log("Detected incoming ROOM call from:",Z.peer);const Ne=Pe.current||Gt.current;Ne?Z.answer(Ne):Z.answer(),Lt(Z);return}Fe.current&&Fe.current.peer===Z.peer&&(console.log("Replacing existing call (upgrade/renegotiation detected)"),Fe.current.removeAllListeners&&Fe.current.removeAllListeners("close"),Fe.current.close());const X=Pe.current||Gt.current;X?(console.log("Answering call with local stream"),Z.answer(X)):(console.warn("No local stream found when answering! Answering audio-only or empty."),Z.answer()),Z.on("stream",Ne=>{console.log("Received remote stream"),j(Ne)}),E(Z),h("connected")}),W.on("error",Z=>{console.error("PeerJS Error:",Z),Z.type}),W.on("connection",Z=>{console.log("Data connection received from peer:",Z.peer),Z.on("open",()=>{console.log("Data connection open event fired."),N(Z)}),Z.on("data",X=>{if(X&&X.type==="SOUND_EFFECT"&&X.payload?.src){console.log("Received sound effect:",X.payload.name);const Ne=new Audio(X.payload.src);Ne.volume=.5,ht.current.push(Ne),Ne.onended=()=>{ht.current=ht.current.filter(Je=>Je!==Ne)},Ne.play().catch(Je=>console.error("Error playing remote sound:",Je))}}),Z.on("close",()=>{console.log("Data connection closed."),N(null)}),Z.on("error",X=>console.error("Data connection error:",X)),Z.open&&(console.log("Data connection already open."),N(Z))}),()=>{W.destroy()}},[e]),T.useEffect(()=>{if(!e)return;const W=Yi(St(_e,"users",e.uid,"incomingCalls"),il("status","==","pending")),Z=oi(W,X=>{X.docChanges().forEach(Ne=>{if(Ne.type==="added"){const Je=Ne.doc.data();g({id:Ne.doc.id,...Je}),h("incoming")}Ne.type==="removed"&&g(Je=>Je&&Je.id===Ne.doc.id?(h(tt=>(tt!=="connected"&&vn(!1),tt)),null):Je)})});return()=>Z()},[e]);const fi=async()=>{try{const W=await navigator.mediaDevices.enumerateDevices(),Z=W.filter(Je=>Je.kind==="audioinput"),X=W.filter(Je=>Je.kind==="videoinput"),Ne=W.filter(Je=>Je.kind==="audiooutput");return He({audioInputs:Z,videoInputs:X,audioOutputs:Ne}),!de&&Z.length>0&&Ie(Z[0].deviceId),!qe&&X.length>0&&ot(X[0].deviceId),console.log("Devices enumerated:",{audioInputs:Z.length,videoInputs:X.length}),{audioInputs:Z,videoInputs:X,audioOutputs:Ne}}catch(W){return console.error("Failed to enumerate devices:",W),{audioInputs:[],videoInputs:[],audioOutputs:[]}}};T.useEffect(()=>(fi(),navigator.mediaDevices.addEventListener("devicechange",fi),()=>navigator.mediaDevices.removeEventListener("devicechange",fi)),[]);const Ni=async(W=!0)=>{try{Re.audioInputs.length===0&&await fi();const Z={echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,channelCount:1,...de&&{deviceId:{exact:de}}},X=W?{width:1280,height:720,...qe&&{deviceId:{exact:qe}}}:!1,Ne=await navigator.mediaDevices.getUserMedia({video:X,audio:Z});return console.log("Media stream acquired with selected devices"),M(Ne),Ne}catch(Z){return console.error("Failed to get local stream",Z),r("Could not access camera/microphone"),null}},pi=async(W,Z="video")=>{if(!i||!c){r("Connection not ready. Please wait a moment.");return}if(_(W),h("outgoing"),!await Ni(Z==="video")){h("idle");return}Ce(Z==="voice");try{const Ne=e.displayName||t?.displayName||"Unknown",Je=e.photoURL||t?.photoURL||t?.photoUrl||null,tt=await Ln(St(_e,"users",W.id,"incomingCalls"),{callerId:e.uid,callerName:Ne,callerPhotoUrl:Je,peerId:c,type:Z,status:"pending",timestamp:bt()});Q.current=tt.id;const xt=oi(Be(_e,"users",W.id,"incomingCalls",tt.id),_n=>{const un=Q.current===tt.id;if(!_n.exists())un&&d==="outgoing"&&(r("Call ended or declined"),vn(!1)),xt();else{const Pi=_n.data();Pi.status==="accepted"?un&&h("connected"):Pi.status==="rejected"&&un&&(r("Call declined"),vn(!0))}},_n=>{console.warn("Call snapshot error:",_n),Q.current===tt.id&&(r("Call declined"),vn(!1))})}catch(Ne){console.error("Signaling failed:",Ne),r("Failed to direct call"),vn()}};T.useEffect(()=>{if(!R||!R.peerConnection)return;const W=()=>{const Z=R.peerConnection.connectionState,X=R.peerConnection.iceConnectionState;console.log(`Connection State: ${Z}, ICE State: ${X}`),(X==="disconnected"||X==="failed"||X==="closed")&&(console.warn("Peer connection lost/failed. Ending call..."),X==="failed"||X==="closed"?vn():X==="disconnected"&&Fe.current===R&&setTimeout(()=>{Fe.current&&Fe.current.peerConnection.iceConnectionState==="disconnected"&&(console.log("Connection still disconnected after timeout. Ending."),vn())},3e3))};return R.peerConnection.addEventListener("iceconnectionstatechange",W),R.peerConnection.addEventListener("connectionstatechange",W),()=>{R&&R.peerConnection&&(R.peerConnection.removeEventListener("iceconnectionstatechange",W),R.peerConnection.removeEventListener("connectionstatechange",W))}},[R]);const ao=async()=>{if(!m||!i)return;h("connected");const W=m.type==="video",Z=await Ni(W);if(!Z){console.error("Stream failed, rejecting call signal.");try{await at(Be(_e,"users",e.uid,"incomingCalls",m.id),{status:"rejected"})}catch{}vn(!1);return}if(W||Ce(!0),console.log("Connecting to peer:",m.peerId),(!i||i.disconnected)&&(r("Peer connection lost. Reconnecting..."),i?.reconnect(),await new Promise(X=>setTimeout(X,1e3)),!i||i.disconnected)){r("Could not establish P2P connection."),vn();return}try{const X=i.call(m.peerId,Z);if(!X){r("Call failed to initialize."),vn();return}X.on("stream",Ne=>{j(Ne)}),X.on("close",()=>{vn()}),X.on("error",Ne=>{console.error("Call error:",Ne),vn()}),E(X);try{await at(Be(_e,"users",e.uid,"incomingCalls",m.id),{status:"accepted"})}catch(Ne){console.error("Error updating signal doc",Ne)}}catch(X){console.error("Error calling peer:",X),r("Failed to connect to peer."),vn()}try{console.log("Establishing data connection to caller:",m.peerId);const X=i.connect(m.peerId);X.on("open",()=>{console.log("Data connection opened (Callee side)!"),N(X)}),X.on("data",Ne=>{if(Ne&&Ne.type==="SOUND_EFFECT"&&Ne.payload?.src){const Je=new Audio(Ne.payload.src);Je.volume=.5,ht.current.push(Je),Je.onended=()=>{ht.current=ht.current.filter(tt=>tt!==Je)},Je.play().catch(tt=>console.error(tt))}}),X.on("close",()=>N(null)),X.on("error",Ne=>console.error("Data connection error (Callee):",Ne))}catch(X){console.error("Failed to establish data connection",X)}},vn=async(W=!0)=>{sn.current&&(sn.current.getTracks().forEach(X=>X.stop()),sn.current=null),Gt.current=null;const Z=Pe.current;if(Z&&Z.getTracks().forEach(X=>{X.stop(),console.log("Stopped track:",X.kind)}),A&&A.getTracks().forEach(X=>X.stop()),M(null),Pe.current=null,R&&(R.close(),E(null)),j(null),h("idle"),g(null),_(null),Te(!1),Te(!1),Ce(!1),C&&(C.close(),N(null)),Vt(),Q.current&&W&&b)try{await ec(Be(_e,"users",b.id,"incomingCalls",Q.current))}catch{}if(m&&W)try{d==="incoming"?await at(Be(_e,"users",e.uid,"incomingCalls",m.id),{status:"rejected"}):await ec(Be(_e,"users",e.uid,"incomingCalls",m.id))}catch{}Q.current=null},fa=()=>{Te(W=>{const Z=!W;if(A){const X=A.getAudioTracks()[0];X&&(X.enabled=!Z)}return Z})},pa=()=>{if(A){const W=A.getVideoTracks()[0];W&&(W.enabled=!W.enabled,Ce(!W.enabled))}},sn=T.useRef(null),Gt=T.useRef(null),Nr=async(W=null)=>{if(sn.current){await ln();return}try{console.log("Requesting display media...",W);let Z={},X=W?.width||1280,Ne=W?.height||720,Je=W?.frameRate||30;W||t3(t,qa.HIGH_QUALITY)&&(X=1920,Ne=1080,Je=60);let tt;if(W?.sourceId&&window.require){console.log("Using Electron getUserMedia with sourceId:",W.sourceId);try{tt=await navigator.mediaDevices.getUserMedia({audio:{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:W.sourceId,maxWidth:X,maxHeight:Ne,maxFrameRate:Je}}})}catch(Sn){throw console.error("Electron getUserMedia failed:",Sn),Sn}}else{const Sn={video:{width:{ideal:X},height:{ideal:Ne},frameRate:{ideal:Je},displaySurface:W?.displaySurface},audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!1}};console.log("Using Web getDisplayMedia with constraints:",Sn),tt=await navigator.mediaDevices.getDisplayMedia(Sn)}const xt=tt.getVideoTracks()[0];Ce(!1),console.log("Display media obtained:",xt.label);const _n=tt.getAudioTracks()[0];let un=null;if(_n){console.log("System audio captured! Mixing with microphone...");let Sn=A;if(!Sn&&Re.audioInputs.length>0)try{Sn=await navigator.mediaDevices.getUserMedia({audio:!0})}catch{console.warn("Failed to get mic for mixing")}if(Sn&&Sn.getAudioTracks().length>0){const Mi=Sn.getAudioTracks()[0],Pn=new(window.AudioContext||window.webkitAudioContext),tr=Pn.createMediaStreamDestination(),mi=Pn.createMediaStreamSource(new MediaStream([Mi])),Fl=Pn.createMediaStreamSource(new MediaStream([_n])),Yr=Pn.createGain(),Qr=Pn.createGain();Yr.gain.value=1,Qr.gain.value=1,mi.connect(Yr).connect(tr),Fl.connect(Qr).connect(tr),un=tr.stream.getAudioTracks()[0],sn.currentAudioContext=Pn}else un=_n}A&&!Gt.current&&(Gt.current=A),xt.onended=()=>{console.log("Screen track ended by user/browser UI"),ln()},sn.current=tt;const Pi=un?[un]:A?A.getAudioTracks():[],zl=new MediaStream([xt,...Pi]);if(M(zl),R&&R.peerConnection){const Sn=R.peerConnection.getSenders(),Mi=Sn.find(Pn=>Pn.track&&Pn.track.kind==="video");if(Mi&&await Mi.replaceTrack(xt),un){const Pn=Sn.find(tr=>tr.track&&tr.track.kind==="audio");Pn&&(console.log("Replacing audio sender with mixed track..."),await Pn.replaceTrack(un))}if(!Mi){console.log("Audio-only -> Screen Share upgrade. Renegotiating...");const Pn=R.peer;if(i&&Pn){R.removeAllListeners("close");const tr=i.call(Pn,zl);tr.on("stream",mi=>j(mi)),tr.on("close",()=>vn()),tr.on("error",()=>vn()),E(tr)}}}}catch(Z){console.error("Error starting screen share:",Z),r("Failed to start screen share")}},ln=async()=>{if(sn.current)if(console.log("Stopping screen share..."),sn.currentAudioContext&&(sn.currentAudioContext.close(),sn.currentAudioContext=null),sn.current.getTracks().forEach(W=>W.stop()),sn.current=null,Gt.current){console.log("Reverting to previous stream state...");const W=Gt.current.getVideoTracks()[0],Z=Gt.current.getAudioTracks();if(R&&R.peerConnection){const X=R.peerConnection.getSenders(),Ne=X.find(tt=>tt.track&&tt.track.kind==="video");if(W&&Ne)try{await Ne.replaceTrack(W)}catch{}const Je=X.find(tt=>tt.track&&tt.track.kind==="audio");Je&&Z.length>0&&(console.log("Reverting audio sender to original mic..."),await Je.replaceTrack(Z[0]))}M(Gt.current),Gt.current=null}else{console.log("No stored camera stream, requesting new user media...");try{const W=await Ni(!0);if(W&&R&&R.peerConnection){const Z=W.getVideoTracks()[0],X=R.peerConnection.getSenders().find(Ne=>Ne.track&&Ne.track.kind==="video");X&&await X.replaceTrack(Z)}}catch(W){console.error("Failed to restore camera:",W)}}},Ts=async(W,Z)=>{if(!e)return;D&&await Ii(),console.log(`Joining voice channel (LiveKit): ${W}`),S({channelId:W,serverId:Z});const X=Be(_e,"servers",Z,"channels",W,"connectedUsers",e.uid);await at(X,{displayName:t?.displayName||e.email,photoUrl:t?.photoUrl||"",joinedAt:bt(),isMuted:Oe,isDeafened:!1}).catch(async Ne=>{Ne.code==="not-found"?await md(X,{displayName:t?.displayName||e.uid,photoUrl:t?.photoUrl||"",joinedAt:bt(),lastSeen:bt(),isMuted:Oe,isDeafened:!1},{merge:!0}):console.error("Error joining voice channel presence:",Ne)})};T.useEffect(()=>{if(!D||!e)return;const{channelId:W,serverId:Z}=D,X=Be(_e,"servers",Z,"channels",W,"connectedUsers",e.uid),Ne=setInterval(()=>{at(X,{lastSeen:bt()}).catch(Je=>{Je.code==="not-found"?Ts(W,Z):console.error("Heartbeat failed:",Je)})},1e4);return()=>clearInterval(Ne)},[D,e]);const Ii=async()=>{if(!D)return;const{channelId:W,serverId:Z}=D;if(e)try{await ec(Be(_e,"servers",Z,"channels",W,"connectedUsers",e.uid))}catch(X){console.error("Error removing from channel:",X)}S(null)};T.useEffect(()=>{const W=async Z=>{if(k.current&&e){const{channelId:X,serverId:Ne}=k.current;ec(Be(_e,"servers",Ne,"channels",X,"connectedUsers",e.uid))}};return window.addEventListener("beforeunload",W),()=>window.removeEventListener("beforeunload",W)},[e]);const oo={startCall:pi,answerCall:ao,endCall:vn,toggleAudio:fa,toggleVideo:pa,callStatus:d,incomingCall:m,outgoingCallUser:b,localStream:A,remoteStream:F,isMuted:Oe,isVideoOff:Ke,activeCall:R,isScreenSharing:!!sn.current,toggleScreenShare:Nr,availableDevices:Re,selectedMicId:de,selectedCameraId:qe,setSelectedMicId:Ie,setSelectedCameraId:ot,playSound:$e,customSounds:q,addSound:fe,removeSound:Se,joinVoiceChannel:Ts,leaveVoiceChannel:Ii,activeRoom:D,roomPeers:P,isDeafened:we,toggleDeafen:Yt,talkingPeers:U,peerVolumes:K,setPeerVolume:je};return f.jsxs(n3.Provider,{value:oo,children:[n,!we&&Object.entries(P).map(([W,Z])=>f.jsx("audio",{ref:X=>{X&&(X.srcObject=Z.stream,X.volume=K[W]??1)},autoPlay:!0,playsInline:!0,controls:!1},W))]})},BS=({user:n,isOpen:e,onClose:t,onMessage:r})=>{if(!n)return null;const i=c=>({admin:"#f23f42",moderator:"#faa81a",member:"#80848e"})[c]||"#80848e",{startCall:s}=Xi();return f.jsx(ea,{isOpen:e,onClose:t,title:"",size:"sm",showCloseButton:!1,children:f.jsxs("div",{className:"relative overflow-hidden rounded-lg -m-6 min-h-[400px] flex flex-col",children:[f.jsx("div",{className:"absolute inset-0 bg-cover bg-center transition-colors",style:{backgroundColor:n.themeColor||"#6366f1",backgroundImage:n.bannerUrl?`url(${n.bannerUrl})`:`linear-gradient(to bottom right, ${n.themeColor||"#6366f1"}, #000)`}}),f.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/95 via-black/50 to-transparent"}),f.jsx("button",{onClick:t,className:"absolute top-4 right-4 p-2 bg-black/40 hover:bg-black/60 rounded-full text-white/80 hover:text-white transition-colors z-20 backdrop-blur-sm",children:f.jsxs("svg",{stroke:"currentColor",fill:"currentColor",strokeWidth:"0",viewBox:"0 0 24 24",height:"24",width:"24",xmlns:"http://www.w3.org/2000/svg",children:[f.jsx("path",{fill:"none",d:"M0 0h24v24H0z"}),f.jsx("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})]})}),f.jsxs("div",{className:"relative z-10 p-6 mt-auto flex flex-col items-center text-center",children:[f.jsxs("div",{className:"relative group mb-4",children:[n.photoUrl?f.jsx("img",{src:n.photoUrl,alt:n.displayName,className:"w-32 h-32 rounded-full border-4 object-cover shadow-2xl",style:{borderColor:n.themeColor||"#1e1f22"},onError:c=>{c.target.style.display="none",c.target.nextSibling.style.display="flex"}},n.photoUrl):null,f.jsx("div",{className:"w-32 h-32 rounded-full border-4 flex items-center justify-center text-white font-bold text-5xl shadow-2xl",style:{display:n.photoUrl?"none":"flex",borderColor:n.themeColor||"#1e1f22",backgroundColor:n.themeColor||"#6366f1"},children:n.displayName?.[0]?.toUpperCase()||"U"})]}),f.jsxs("div",{className:"space-y-1 w-full",children:[f.jsxs("h2",{className:"text-3xl font-bold text-white flex items-center justify-center gap-2 drop-shadow-md",children:[n.displayName||"Unknown",(n.role==="admin"||n.role==="premium")&&f.jsx("div",{className:"text-brand-primary drop-shadow-none",title:"Premium Member",children:f.jsx(xl,{size:24,color:n.themeColor||"#6366f1"})})]}),f.jsx("div",{className:"flex justify-center mt-2",children:f.jsx("span",{className:"px-4 py-1.5 rounded-full text-sm font-semibold border backdrop-blur-md shadow-lg",style:{backgroundColor:`${i(n.role)}30`,color:"#fff",borderColor:`${i(n.role)}80`},children:n.role?.charAt(0).toUpperCase()+n.role?.slice(1)})})]}),f.jsx("div",{className:"flex justify-center gap-2 mt-4 flex-wrap",children:(()=>{const c=new Set(n.badges||[]);n.role==="admin"&&c.add("admin");const l=Array.from(c).filter(d=>d!=="premium").map(d=>Q$[d]).filter(Boolean);return l.length===0?null:f.jsx("div",{className:"p-1.5 rounded-xl bg-black/40 backdrop-blur-md border border-white/10 flex gap-2",children:l.map(d=>{const h=d.icon;return f.jsxs("div",{className:"relative group cursor-help p-1 hover:bg-white/10 rounded transition-colors",children:[f.jsx(h,{size:20,color:d.color}),f.jsxs("div",{className:"absolute bottom-full mb-2 left-1/2 -translate-x-1/2 px-2 py-1 bg-black text-white text-xs rounded shadow-lg whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-50",children:[f.jsx("div",{className:"font-bold",children:d.label}),d.description&&f.jsx("div",{className:"text-gray-300 font-normal text-[10px]",children:d.description}),f.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-black"})]})]},d.id)})})})()}),f.jsxs("div",{className:"flex items-center gap-3 mt-4 bg-black/30 px-4 py-2 rounded-full backdrop-blur-sm border border-white/5",children:[f.jsx("div",{className:Ct("w-3 h-3 rounded-full shadow-lg shadow-white/20",n.presence==="online"||!n.presence&&n.isOnline?"bg-green-500":n.presence==="idle"?"bg-yellow-500":n.presence==="dnd"?"bg-red-500":"bg-gray-500")}),n.status?f.jsxs("span",{className:"text-sm text-gray-200 flex gap-2",children:[f.jsx("span",{children:n.status.emoji}),f.jsx("span",{children:n.status.text})]}):f.jsx("span",{className:"text-sm text-gray-300",children:n.presence==="online"||!n.presence&&n.isOnline?"Online":"Offline"})]}),n.id!==Ar().currentUser?.uid&&f.jsxs("div",{className:"flex gap-4 justify-center mt-6 w-full max-w-xs",children:[f.jsxs("button",{onClick:()=>r&&r(n),className:"flex-1 py-3 bg-white text-black font-bold rounded-xl hover:bg-gray-200 transition-colors shadow-lg flex items-center justify-center gap-2",children:[f.jsx(TB,{size:20})," Message"]}),f.jsx("button",{onClick:()=>s(n,"voice"),className:"p-3 bg-black/50 text-white rounded-xl hover:bg-black/70 border border-white/10 transition-colors backdrop-blur-sm",title:"Voice Call",children:f.jsx(kB,{size:22})}),f.jsx("button",{onClick:()=>s(n,"video"),className:"p-3 bg-black/50 text-white rounded-xl hover:bg-black/70 border border-white/10 transition-colors backdrop-blur-sm",title:"Video Call",children:f.jsx(Nf,{size:22})})]}),n.bio&&f.jsxs("div",{className:"mt-6 w-full text-left bg-black/20 p-4 rounded-xl backdrop-blur-sm border border-white/5",children:[f.jsx("h3",{className:"text-xs font-bold text-gray-400 uppercase mb-2 tracking-wider",children:"About Me"}),f.jsx("p",{className:"text-gray-200 text-sm leading-relaxed whitespace-pre-wrap",children:n.bio})]}),f.jsxs("div",{className:"mt-4 text-xs text-gray-500 font-medium uppercase tracking-widest",children:["Member since ",n.createdAt?new Date(n.createdAt.seconds*1e3).toLocaleDateString("en-US",{month:"short",year:"numeric"}):"Unknown"]})]})]})})},gd=({isOpen:n,onClose:e,onConfirm:t,title:r="Confirm Action",message:i="Are you sure you want to proceed?",confirmText:s="Confirm",cancelText:c="Cancel",variant:l="danger"})=>{const d=()=>{t(),e()};return f.jsx(ea,{isOpen:n,onClose:e,title:r,size:"sm",children:f.jsxs("div",{className:"space-y-6",children:[f.jsx("p",{className:"text-dark-text",children:i}),f.jsxs("div",{className:"flex gap-3 justify-end",children:[f.jsx(ut,{variant:"secondary",onClick:e,children:c}),f.jsx(ut,{variant:l,onClick:d,children:s})]})]})})},Eq=()=>{const n="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let e="";for(let t=0;t<8;t++)e+=n.charAt(Math.floor(Math.random()*n.length));return e},Rq=({isOpen:n,onClose:e,serverId:t})=>{const[r,i]=T.useState(""),[s,c]=T.useState(!1),[l,d]=T.useState(!1),[h,m]=T.useState(!1),{success:g,error:b}=Ss(),_=async()=>{c(!0);try{const E=Eq();await md(Be(_e,"inviteCodes",E),{serverId:t,createdAt:bt(),expiresAt:new Date(Date.now()+(h?365*24*60*60*1e3:1440*60*1e3)),maxUses:h?-1:1,uses:0,isActive:!0,isUnlimited:h}),i(E),g("Invite code generated!")}catch(E){console.error("Error generating invite:",E),b("Failed to generate invite code")}finally{c(!1)}},R=()=>{navigator.clipboard.writeText(r),d(!0),g("Copied to clipboard!"),setTimeout(()=>d(!1),2e3)};return f.jsx(ea,{isOpen:n,onClose:e,title:"Invite Code",size:"sm",children:f.jsx("div",{className:"space-y-4",children:r?f.jsxs(f.Fragment,{children:[f.jsxs("div",{className:"bg-dark-bg p-4 rounded-lg text-center",children:[f.jsx("div",{className:"text-3xl font-mono font-bold text-brand-primary mb-2",children:r}),f.jsxs("div",{className:"flex gap-2",children:[f.jsx(ut,{variant:"secondary",onClick:R,className:"flex-1 flex items-center justify-center gap-2",children:l?f.jsxs(f.Fragment,{children:[f.jsx(Sl,{size:20}),"Copied!"]}):f.jsxs(f.Fragment,{children:[f.jsx(CB,{size:20}),"Copy Code"]})}),f.jsx(ut,{variant:"secondary",onClick:()=>{i(""),d(!1),m(!1)},className:"flex items-center justify-center gap-2 px-4",title:"Generate new code",children:f.jsx(qB,{size:20})})]})]}),f.jsxs("div",{className:"text-xs text-dark-muted space-y-1",children:[f.jsxs("div",{children:[" ",h?"Expires in 1 year":"Expires in 24 hours"]}),f.jsxs("div",{children:[" ",h?"Unlimited uses":"One-time use only"]}),f.jsx("div",{children:" Share with trusted users"})]}),f.jsx(ut,{variant:"secondary",onClick:e,className:"w-full",children:"Close"})]}):f.jsxs(f.Fragment,{children:[f.jsxs("div",{className:"space-y-2",children:[f.jsx("p",{className:"text-dark-text text-sm",children:"Generate an invite code for this server."}),f.jsxs("label",{className:"flex items-center gap-2 p-3 rounded bg-dark-bg cursor-pointer hover:bg-opacity-80 transition-colors",children:[f.jsx("input",{type:"checkbox",checked:h,onChange:E=>m(E.target.checked),className:"w-4 h-4 rounded border-gray-600 bg-dark-bg text-brand-primary focus:ring-brand-primary"}),f.jsxs("div",{className:"flex flex-col",children:[f.jsx("span",{className:"text-white text-sm font-medium",children:"Unlimited Uses"}),f.jsx("span",{className:"text-dark-muted text-xs",children:"Code will not expire after one use"})]})]})]}),f.jsx(ut,{variant:"primary",onClick:_,disabled:s,className:"w-full",children:s?"Generating...":"Generate Invite Code"})]})})})},Aq=[{emoji:"",text:"Gaming",type:"gaming"},{emoji:"",text:"Working",type:"working"},{emoji:"",text:"Listening to music",type:"music"},{emoji:"",text:"Watching",type:"watching"},{emoji:"",text:"Eating",type:"eating"},{emoji:"",text:"AFK",type:"afk"},{emoji:"",text:"Focusing",type:"focusing"},{emoji:"",text:"Studying",type:"studying"}],AR={online:{color:"bg-green-500",label:"Online",icon:""},idle:{color:"bg-yellow-500",label:"Idle",icon:""},dnd:{color:"bg-red-500",label:"Do Not Disturb",icon:""},invisible:{color:"bg-gray-500",label:"Invisible",icon:""},offline:{color:"bg-gray-500",label:"Offline",icon:""}},Nq=n=>AR[n]||AR.offline,r3=({status:n,size:e="md",className:t})=>{const r=Nq(n),i={sm:"w-2.5 h-2.5",md:"w-3 h-3",lg:"w-4 h-4"};return n==="invisible"?null:f.jsx("div",{className:Ct("rounded-full border-2 border-dark-bg",r.color,i[e]||i.md,t),title:r.label})},Iq=({dm:n,currentUserId:e,isSelected:t,onClick:r,onContextMenu:i})=>{const s=n.participants.find(d=>d!==e),[c,l]=T.useState(null);return T.useEffect(()=>{(async()=>{if(s)try{const h=await g0(Be(_e,"users",s));h.exists()&&l({id:h.id,...h.data()})}catch(h){console.error("Error fetching DM user:",h)}})()},[s]),c?f.jsxs("button",{onClick:r,onContextMenu:i,className:Ct("w-full flex items-center gap-3 px-2 py-2 rounded mb-1 group relative","text-dark-muted hover:bg-dark-hover hover:text-dark-text","transition-colors duration-150",t&&"bg-dark-hover text-dark-text"),children:[f.jsx("div",{className:"relative",children:c.photoUrl?f.jsx("img",{src:c.photoUrl,alt:c.displayName,className:"w-8 h-8 rounded-full object-cover"}):f.jsx("div",{className:"w-8 h-8 rounded-full bg-brand-primary flex items-center justify-center text-white text-sm font-bold",children:c.displayName?.[0]?.toUpperCase()})}),f.jsxs("div",{className:"flex-1 text-left overflow-hidden",children:[f.jsxs("div",{className:"text-sm font-medium truncate flex justify-between items-center",children:[f.jsx("span",{children:c.displayName}),n.updatedAt&&f.jsx("span",{className:"text-[10px] text-gray-500 hidden group-hover:block",children:v0(n.updatedAt)})]}),f.jsx("div",{className:"text-xs truncate opacity-70",children:n.lastMessage?.text||"Start a conversation"})]})]}):null},Pq=({dms:n,selectedDmId:e,onSelectDm:t})=>{const{currentUser:r}=Ar(),[i,s]=T.useState(null),[c,l]=T.useState([]),d=(g,b)=>{g.preventDefault(),s({x:g.pageX,y:g.pageY,dmId:b.id})},h=async g=>{if(l(b=>[...b,g]),s(null),!!r)try{const b=Be(_e,"dms",g);await at(b,{hiddenFor:up(r.uid)}),e===g&&t(null)}catch(b){console.error("Error deleting DM:",b),l(_=>_.filter(R=>R!==g))}};T.useEffect(()=>{const g=()=>s(null);return window.addEventListener("click",g),()=>window.removeEventListener("click",g)},[]);const m=n?.filter(g=>!c.includes(g.id))||[];return m.length===0?f.jsxs("div",{className:"px-4 py-8 text-center text-dark-muted text-sm",children:[f.jsx("p",{children:"No conversations yet."}),f.jsx("p",{className:"mt-2",children:"Start a DM from the friends list!"})]}):f.jsxs("div",{className:"flex-1 overflow-y-auto py-3",children:[f.jsxs("div",{className:"px-2",children:[f.jsx("div",{className:"text-xs font-semibold text-dark-muted uppercase px-2 mb-2 flex justify-between items-center",children:f.jsx("span",{children:"Direct Messages"})}),f.jsx("div",{className:"space-y-0.5",children:m.map(g=>f.jsx(Iq,{dm:g,currentUserId:r.uid,isSelected:e===g.id,onClick:()=>t(g),onContextMenu:b=>d(b,g)},g.id))})]}),i&&f.jsx("div",{className:"fixed bg-dark-sidebar border border-dark-hover shadow-xl rounded-md z-50 py-1 min-w-[160px]",style:{top:i.y,left:i.x},children:f.jsxs("button",{onClick:()=>h(i.dmId),className:"w-full text-left px-4 py-2 hover:bg-red-500/10 text-red-400 hover:text-red-500 text-sm flex items-center gap-2 transition-colors",children:[f.jsx(Ka,{size:16}),"Delete Conversation"]})})]})},Mq=({channel:n,serverId:e,currentUserId:t,onJoin:r,isConnected:i})=>{const[s,c]=T.useState([]),[l,d]=T.useState(null),{talkingPeers:h,setPeerVolume:m,peerVolumes:g,currentUserId:b}=Xi(),_=(F,j)=>{F.preventDefault(),j.id!==t&&d({x:F.pageX,y:F.pageY,user:j})};T.useEffect(()=>{if(!n?.id||!e){console.warn("VoiceChannel: Missing channel.id or serverId",{channel:n,serverId:e});return}try{const F=Yi(St(_e,"servers",e,"channels",n.id,"connectedUsers"),dv("joinedAt","asc")),j=oi(F,C=>{const N=[];C.forEach(D=>{N.push({id:D.id,...D.data()})}),c(N)},C=>{console.error("VoiceChannel Snapshot Error:",C)});return()=>j()}catch(F){console.error("VoiceChannel Query Setup Error:",F)}},[n?.id,e]),T.useEffect(()=>{const F=()=>d(null);return window.addEventListener("click",F),()=>window.removeEventListener("click",F)},[]);const R=F=>F.id===t?!!h.me||!!h[t]:!!h[F.id],[E,A]=T.useState(Date.now());T.useEffect(()=>{const F=setInterval(()=>A(Date.now()),5e3);return()=>clearInterval(F)},[]);const M=s.filter(F=>{if(!F.lastSeen)return!1;const j=F.lastSeen?.toDate?F.lastSeen.toDate():new Date(F.lastSeen);return E-j.getTime()<3e4});return f.jsxs("div",{className:"mb-1 relative",children:[f.jsxs("button",{onClick:()=>r(n),className:Ct("w-full flex items-center gap-2 px-2 py-1.5 rounded group","text-dark-muted hover:bg-dark-hover hover:text-dark-text","transition-colors duration-150",i&&"bg-dark-hover/50 text-brand-primary"),children:[f.jsx(xx,{className:"flex-shrink-0",size:18}),f.jsx("span",{className:"truncate text-sm flex-1 text-left font-medium",children:n.name}),n.locked&&f.jsx(KP,{className:"flex-shrink-0 text-yellow-500",size:14,title:"Locked channel"})]}),M.length>0&&f.jsx("div",{className:"pl-8 pr-2 pb-1 space-y-1",children:M.map(F=>f.jsx(Dq,{user:F,isSpeaking:R(F),currentUserId:t,onContextMenu:_},F.id))}),l&&f.jsxs("div",{className:"fixed z-50 bg-[#111214] border border-[#1e1f22] rounded-md shadow-xl p-3 min-w-[200px]",style:{top:l.y,left:l.x},onClick:F=>F.stopPropagation(),children:[f.jsx("div",{className:"text-xs font-bold text-gray-300 mb-2 px-1",children:l.user.displayName}),f.jsxs("div",{className:"px-1",children:[f.jsxs("div",{className:"flex justify-between text-[10px] uppercase font-bold text-gray-500 mb-1",children:[f.jsx("span",{children:"User Volume"}),f.jsxs("span",{children:[Math.round((g[l.user.id]??1)*100),"%"]})]}),f.jsx("input",{type:"range",min:"0",max:"100",defaultValue:(g[l.user.id]??1)*100,className:"w-full accent-brand-primary h-1 bg-gray-700 rounded-lg appearance-none cursor-pointer",onChange:F=>{const j=Math.min(100,parseInt(F.target.value))/100;l.user.id&&m(l.user.id,j)}})]})]})]})},Dq=T.memo(({user:n,isSpeaking:e,currentUserId:t,onContextMenu:r})=>f.jsxs("div",{onContextMenu:i=>r(i,n),className:"flex items-center gap-2 group/user rounded hover:bg-white/5 py-0.5 px-1 transition-colors cursor-pointer select-none",children:[f.jsx("img",{src:n.photoUrl||n.photoURL,alt:n.displayName,className:Ct("w-6 h-6 rounded-full object-cover border-2 transition-colors duration-75",e?"border-green-500 shadow-[0_0_8px_rgba(34,197,94,0.6)]":"border-transparent"),onError:i=>{i.target.style.display="none",i.target.nextSibling.style.display="flex"}}),f.jsx("div",{className:Ct("w-6 h-6 rounded-full bg-brand-primary flex items-center justify-center text-white text-[10px] font-bold border-2 transition-colors duration-75",e?"border-green-500 shadow-[0_0_8px_rgba(34,197,94,0.6)]":"border-transparent"),style:{display:n.photoUrl||n.photoURL?"none":"flex"},children:n.displayName?.[0]?.toUpperCase()}),f.jsx("span",{className:Ct("text-xs truncate text-dark-muted group-hover/user:text-dark-text transition-colors",n.id===t&&"font-bold text-brand-primary"),children:n.displayName})]}),(n,e)=>n.isSpeaking===e.isSpeaking&&n.user.id===e.user.id&&n.user.displayName===e.user.displayName&&n.user.photoUrl===e.user.photoUrl&&n.currentUserId===e.currentUserId),NR=({server:n,channels:e,selectedChannel:t,onSelectChannel:r,onOpenSettings:i,onOpenAdmin:s,onLogout:c,userProfile:l,serverId:d,userRole:h,userId:m,dms:g,selectedDm:b,onSelectDm:_})=>{const[R,E]=T.useState(!1),[A,M]=T.useState(!1),[F,j]=T.useState(!1),{joinVoiceChannel:C,leaveVoiceChannel:N,activeRoom:D,isMuted:S,toggleAudio:k,isDeafened:P,toggleDeafen:L}=Xi(),U=()=>{M(!1),c()},z=V=>{D?.channelId!==V.id&&C(V.id,d)};return f.jsxs("div",{className:"w-60 bg-dark-sidebar flex flex-col h-full",children:[f.jsxs("div",{className:"h-12 px-4 flex items-center justify-between border-b border-dark-hover shadow-md",children:[f.jsx("h2",{className:"font-semibold text-dark-text truncate",children:n?.name||"Lumo"}),f.jsxs("div",{className:"flex items-center gap-1",children:[d&&h==="admin"&&f.jsx("button",{onClick:()=>j(!0),className:"p-1.5 hover:bg-dark-hover rounded transition-colors",title:"Generate Invite",children:f.jsx(WB,{className:"text-green-500",size:20})}),l?.role==="admin"&&f.jsx("button",{onClick:s,className:"p-1.5 hover:bg-dark-hover rounded transition-colors",title:"Admin Panel",children:f.jsx(HP,{className:"text-admin",size:20})})]})]}),f.jsx("div",{className:"flex-1 overflow-y-auto py-3",children:d==="home"?f.jsx(Pq,{dms:g,selectedDmId:b?.id,onSelectDm:_}):f.jsxs("div",{className:"px-2 space-y-4",children:[e.some(V=>V.type==="voice")&&f.jsxs("div",{children:[f.jsx("div",{className:"text-xs font-semibold text-dark-muted uppercase px-2 mb-1 flex items-center justify-between group",children:"Voice Channels"}),e.filter(V=>V.type==="voice").map(V=>f.jsx(Mq,{channel:V,serverId:d,currentUserId:l?.id||m,onJoin:z,isConnected:D?.channelId===V.id},V.id))]}),f.jsxs("div",{children:[f.jsx("div",{className:"text-xs font-semibold text-dark-muted uppercase px-2 mb-1",children:"Text Channels"}),e.filter(V=>!V.type||V.type==="text").map(V=>f.jsxs("button",{onClick:()=>r(V),className:Ct("w-full flex items-center gap-2 px-2 py-1.5 rounded","text-dark-muted hover:bg-dark-hover hover:text-dark-text","transition-colors duration-150",t?.id===V.id&&"bg-dark-hover text-dark-text"),children:[f.jsx(y0,{className:"flex-shrink-0"}),f.jsx("span",{className:"truncate text-sm flex-1 text-left",children:V.name}),V.locked&&f.jsx(KP,{className:"flex-shrink-0 text-yellow-500",size:14,title:"Locked channel"})]},V.id))]})]})}),D&&f.jsxs("div",{className:"bg-[#1e1f22] px-2 py-2 border-t border-[#2b2d31] flex flex-col gap-1",children:[f.jsx("div",{className:"flex items-center justify-between mb-1 pl-1",children:f.jsxs("div",{className:"min-w-0 flex flex-col w-full",children:[f.jsxs("span",{className:"text-green-500 text-[11px] font-bold uppercase tracking-wider flex items-center gap-1",children:[f.jsx(EB,{size:12})," Voice Connected"]}),f.jsx("span",{className:"text-gray-200 text-xs font-semibold truncate cursor-pointer hover:underline hover:text-white transition-colors",onClick:()=>window.dispatchEvent(new CustomEvent("OPEN_VOICE_ROOM")),children:e.find(V=>V.id===D.channelId)?.name||"General"})]})}),f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx("button",{onClick:()=>window.dispatchEvent(new CustomEvent("OPEN_VOICE_ROOM")),className:"flex-1 flex items-center justify-center p-1.5 rounded-[4px] hover:bg-gray-700/50 text-green-400 hover:text-green-300 transition-all",title:"Open Voice View",children:f.jsx(mB,{size:18})}),f.jsx("button",{onClick:k,className:Ct("flex-1 flex items-center justify-center p-1.5 rounded-[4px] transition-all",S?"bg-red-500 text-white":"hover:bg-gray-700/50 text-gray-200"),title:S?"Unmute":"Mute",children:S?f.jsx(Af,{size:18}):f.jsx(_l,{size:18})}),f.jsx("button",{onClick:L,className:Ct("flex-1 flex items-center justify-center p-1.5 rounded-[4px] transition-all",P?"bg-red-500 text-white":"hover:bg-gray-700/50 text-gray-200"),title:P?"Undeafen":"Deafen",children:P?f.jsx(PB,{size:18}):f.jsx(MB,{size:18})}),f.jsx("button",{onClick:i,className:"flex-1 flex items-center justify-center p-1.5 rounded-[4px] hover:bg-gray-700/50 text-gray-200 transition-all",title:"Voice Settings",children:f.jsx(Rf,{size:18})}),f.jsx("button",{onClick:N,className:"flex-1 flex items-center justify-center p-1.5 rounded-[4px] hover:bg-red-500/20 text-gray-400 hover:text-red-500 transition-all",title:"Disconnect",children:f.jsx(ff,{size:18})})]})]}),f.jsxs("div",{className:"h-20 bg-dark-bg px-2 flex items-center justify-between gap-2 border-t border-dark-hover relative z-10 w-full",children:[f.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1 cursor-pointer hover:bg-dark-hover rounded p-2 transition-colors",onClick:()=>E(!0),children:[f.jsxs("div",{className:"relative flex-shrink-0",children:[l?.photoUrl?f.jsx("img",{src:l.photoUrl,alt:l.displayName,className:"w-12 h-12 rounded-full object-cover",onError:V=>{V.target.style.display="none",V.target.nextSibling.style.display="flex"}},l.photoUrl):null,f.jsx("div",{className:"w-12 h-12 rounded-full bg-brand-primary flex items-center justify-center text-white font-bold text-lg",style:{display:l?.photoUrl?"none":"flex"},children:l?.displayName?.[0]?.toUpperCase()||"U"},`fallback-${l?.photoUrl}`),f.jsx("div",{className:"absolute bottom-0 right-0",children:f.jsx(r3,{status:l?.presence||"online",size:"md"})})]}),f.jsxs("div",{className:"min-w-0 flex-1",children:[f.jsx("div",{className:"text-base font-semibold text-dark-text truncate",children:l?.displayName||"User"}),f.jsx("div",{className:"text-sm text-dark-muted truncate",children:l?.role||"member"})]})]}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("button",{onClick:i,className:"p-2.5 hover:bg-dark-hover rounded-lg transition-colors",title:"Settings",children:f.jsx(Rf,{className:"text-dark-muted hover:text-dark-text",size:24})}),f.jsx("button",{onClick:()=>M(!0),className:"p-2.5 hover:bg-dark-hover rounded-lg transition-colors",title:"Logout",children:f.jsx(pB,{className:"text-dark-muted hover:text-admin",size:24})})]})]}),f.jsx(BS,{user:l,isOpen:R,onClose:()=>E(!1)}),f.jsx(gd,{isOpen:A,onClose:()=>M(!1),onConfirm:U,title:"Logout",message:"Are you sure you want to logout?",confirmText:"Logout",variant:"danger"}),f.jsx(Rq,{isOpen:F,onClose:()=>j(!1),serverId:d})]})},Oq=(n,e)=>{if(e===0)return"0 KB/s";const t=n/e;return t>1024*1024?`${(t/(1024*1024)).toFixed(1)} MB/s`:`${(t/1024).toFixed(0)} KB/s`},$S=(n,e)=>new Promise((t,r)=>{const i="5c1c5b7cae2edd508a2f35f98c4eec96",s=new FormData;s.append("image",n);const c=new XMLHttpRequest;c.open("POST",`https://api.imgbb.com/1/upload?key=${i}`);const l=Date.now();c.upload.onprogress=d=>{if(d.lengthComputable){const h=d.loaded/d.total*100,m=(Date.now()-l)/1e3,g=Oq(d.loaded,m);e&&e(h,g)}},c.onload=()=>{if(c.status===200)try{const d=JSON.parse(c.responseText);d.success?t(d.data.url):r(new Error(d.error?.message||"Failed to upload image"))}catch{r(new Error("Invalid response from ImgBB"))}else r(new Error(`Upload failed with status ${c.status}`))},c.onerror=()=>r(new Error("Network error during upload")),c.send(s)}),jq=({server:n,onClose:e,onDelete:t,position:r,userRole:i,userId:s})=>{const[c,l]=T.useState(!1),[d,h]=T.useState(n.name),[m,g]=T.useState(!1),[b,_]=T.useState(!1),[R,E]=T.useState(n.icon||null),[A,M]=T.useState(null),[F,j]=T.useState({progress:0,speed:""}),[C,N]=T.useState(!1),[D,S]=T.useState(!1),k=T.useRef(null),{success:P,error:L}=Ss(),U=async()=>{if(!d.trim()){L("Server name is required");return}g(!0);try{await at(Be(_e,"servers",n.id),{name:d.trim()}),P("Server updated!"),l(!1),e()}catch(K){console.error("Error updating server:",K),L("Failed to update server")}finally{g(!1)}},z=async()=>{try{const K=St(_e,"servers",n.id,"members"),oe=await bl(K),ee=[];oe.forEach(Me=>{const je=Me.data().userId;ee.push(at(Be(_e,"users",je),{servers:hv(n.id),...Me.data().currentServer===n.id?{currentServer:null}:{}}))}),await Promise.all(ee),await ec(Be(_e,"servers",n.id)),P("Server deleted"),N(!1),t(),e()}catch(K){console.error("Error deleting server:",K),L("Failed to delete server"),N(!1)}},V=async()=>{try{await at(Be(_e,"users",s),{servers:hv(n.id),currentServer:null}),await ec(Be(_e,"servers",n.id,"members",s)),await at(Be(_e,"servers",n.id),{memberCount:fv(-1)}),P("Left server"),S(!1),e()}catch(K){console.error("Error leaving server:",K),S(!1),e()}},le=K=>{const oe=K.target.files?.[0];if(oe){if(!oe.type.startsWith("image/")){L("Please select an image file");return}if(oe.size>10*1024*1024){L("Image size must be less than 10MB");return}M(oe),E(URL.createObjectURL(oe))}},ve=async()=>{if(!A){L("Please select an image first");return}g(!0);try{const K=await $S(A,(oe,ee)=>{j({progress:oe,speed:ee})});await at(Be(_e,"servers",n.id),{icon:K}),P("Server icon updated!"),_(!1),e()}catch(K){console.error("Error updating icon:",K),L("Failed to update icon")}finally{g(!1),j({progress:0,speed:""})}};return f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"fixed inset-0 z-40",onClick:e}),f.jsx("div",{className:"fixed bg-dark-sidebar border border-dark-hover rounded-lg shadow-xl py-2 z-50 w-64",style:{top:r.y,left:r.x},children:c?f.jsxs("div",{className:"px-3 py-2 space-y-2",children:[f.jsx(Vn,{value:d,onChange:K=>h(K.target.value),placeholder:"Server name",autoFocus:!0}),f.jsxs("div",{className:"flex gap-2",children:[f.jsx(ut,{variant:"secondary",onClick:()=>l(!1),className:"flex-1 text-xs py-1",children:"Cancel"}),f.jsx(ut,{variant:"primary",onClick:U,disabled:m,className:"flex-1 text-xs py-1",children:m?"Saving...":"Save"})]})]}):b?f.jsxs("div",{className:"px-3 py-2 space-y-3",children:[f.jsx("input",{type:"file",ref:k,onChange:le,accept:"image/*",className:"hidden"}),f.jsxs("div",{className:"flex flex-col items-center",children:[f.jsx("button",{onClick:()=>k.current?.click(),className:"w-16 h-16 rounded-full bg-dark-hover border-2 border-dashed border-dark-muted hover:border-brand-primary flex items-center justify-center transition-colors overflow-hidden",children:R?f.jsx("img",{src:R,alt:"Preview",className:"w-full h-full object-cover"}):f.jsx(Sx,{size:24,className:"text-dark-muted"})}),f.jsx("span",{className:"text-xs text-dark-muted mt-2",children:"Click to select image"})]}),m&&F.progress>0&&f.jsxs("div",{className:"text-xs text-center text-dark-muted",children:[Math.round(F.progress),"% (",F.speed,")"]}),f.jsxs("div",{className:"flex gap-2",children:[f.jsx(ut,{variant:"secondary",onClick:()=>{_(!1),M(null),E(n.icon||null)},className:"flex-1 text-xs py-1",children:"Cancel"}),f.jsx(ut,{variant:"primary",onClick:ve,disabled:m||!A,className:"flex-1 text-xs py-1",children:m?"Uploading...":"Save"})]})]}):f.jsx(f.Fragment,{children:i==="admin"?f.jsxs(f.Fragment,{children:[f.jsxs("button",{onClick:()=>l(!0),className:"w-full px-4 py-2 text-left text-sm text-dark-text hover:bg-dark-hover transition-colors flex items-center gap-2",children:[f.jsx(Qu,{size:16}),"Edit Server Name"]}),f.jsxs("button",{onClick:()=>_(!0),className:"w-full px-4 py-2 text-left text-sm text-dark-text hover:bg-dark-hover transition-colors flex items-center gap-2",children:[f.jsx(Sx,{size:16}),"Change Icon"]}),f.jsxs("button",{onClick:()=>N(!0),className:"w-full px-4 py-2 text-left text-sm text-admin hover:bg-dark-hover transition-colors flex items-center gap-2",children:[f.jsx(Ka,{size:16}),"Delete Server"]})]}):f.jsxs("button",{onClick:()=>S(!0),className:"w-full px-4 py-2 text-left text-sm text-orange-500 hover:bg-dark-hover transition-colors flex items-center gap-2",children:[f.jsx(hB,{size:16}),"Leave Server"]})})}),f.jsx(gd,{isOpen:C,onClose:()=>N(!1),onConfirm:z,title:"Delete Server",message:`Are you sure you want to delete "${n.name}"? This action cannot be undone!`,confirmText:"Delete",confirmVariant:"danger"}),f.jsx(gd,{isOpen:D,onClose:()=>S(!1),onConfirm:V,title:"Leave Server",message:`Are you sure you want to leave "${n.name}"?`,confirmText:"Leave",confirmVariant:"warning"})]})},Lq=""+new URL("lumo-logo-DYOsjf-q.png",import.meta.url).href,IR=({servers:n,currentServerId:e,onServerChange:t,onCreateServer:r,onJoinServer:i,userRole:s,userId:c,unreadMentions:l={}})=>{const[d,h]=T.useState(!1),[m,g]=T.useState(null),b=(_,R)=>{_.preventDefault(),g({server:R,position:{x:_.clientX,y:_.clientY}})};return f.jsxs("div",{className:"w-20 bg-dark-bg h-full flex flex-col items-center",children:[f.jsx("div",{className:"flex flex-col items-center",children:f.jsx("button",{onClick:()=>t("home"),className:Ct("transition-all duration-200 rounded-2xl overflow-hidden",e==="home"||!e?"rounded-xl ring-2 ring-brand-primary ring-offset-2 ring-offset-dark-bg":"hover:rounded-xl"),children:f.jsx("img",{src:Lq,alt:"Home",className:"w-16 h-16 object-contain cursor-pointer bg-dark-bg p-1"})})}),f.jsx("div",{className:"w-8 h-0.5 bg-dark-hover my-2"}),f.jsxs("div",{className:"flex flex-col items-center gap-2 flex-1 overflow-y-auto",children:[n.map(_=>f.jsxs("div",{className:"relative",children:[f.jsx("button",{onClick:()=>t(_.id),onContextMenu:R=>b(R,_),className:Ct("w-12 h-12 rounded-2xl flex items-center justify-center transition-all duration-200","hover:rounded-xl",e===_.id?"bg-brand-primary text-white rounded-xl":"bg-dark-sidebar text-dark-text hover:bg-brand-primary hover:text-white"),title:_.name,children:_.icon?f.jsx("img",{src:_.icon,alt:_.name,className:"w-full h-full rounded-2xl object-cover"}):f.jsx("span",{className:"text-xl font-bold",children:_.name.charAt(0).toUpperCase()})}),l[_.id]?.count>0&&f.jsx("div",{className:"absolute -top-1 -right-1 min-w-5 h-5 bg-red-500 rounded-full flex items-center justify-center border-2 border-dark-bg pointer-events-none",children:f.jsx("span",{className:"text-white text-xs font-bold px-1",children:l[_.id].count>99?"99+":l[_.id].count})})]},_.id)),f.jsx("div",{className:"w-8 h-0.5 bg-dark-hover my-1"}),f.jsxs("div",{className:"relative pb-2",children:[f.jsx("button",{id:"add-server-btn",onClick:_=>{const R=_.currentTarget.getBoundingClientRect();document.documentElement.style.setProperty("--btn-top",`${R.top}px`),h(!d)},className:"w-12 h-12 rounded-2xl bg-dark-sidebar text-green-500 flex items-center justify-center hover:bg-green-500 hover:text-white hover:rounded-xl transition-all duration-200",title:"Add Server",children:f.jsx(Wu,{size:28})}),d&&f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"fixed inset-0 z-50",onClick:()=>h(!1)}),f.jsxs("div",{className:"fixed left-[80px] bg-dark-sidebar border border-dark-hover rounded-lg shadow-lg py-2 z-50 w-48",style:{top:"var(--btn-top)"},children:[s==="admin"&&f.jsx("button",{onClick:()=>{r(),h(!1)},className:"w-full px-4 py-2 text-left text-sm text-dark-text hover:bg-dark-hover transition-colors",children:"Create Server"}),f.jsx("button",{onClick:()=>{i(),h(!1)},className:"w-full px-4 py-2 text-left text-sm text-dark-text hover:bg-dark-hover transition-colors",children:"Join Server"})]})]})]})]}),m&&f.jsx(jq,{server:m.server,position:m.position,userRole:s,userId:c,onClose:()=>g(null),onDelete:()=>{g(null)}})]})},Uq=300*1e3,Vq=n=>{const e=T.useRef(null);T.useEffect(()=>{if(!n)return;const t=async()=>{try{await at(Be(_e,"users",n),{lastSeen:bt(),isOnline:!0})}catch(i){console.error("Error updating presence:",i)}};t(),e.current=setInterval(t,Uq);const r=()=>{navigator.sendBeacon&&t()};return window.addEventListener("beforeunload",r),()=>{e.current&&clearInterval(e.current),window.removeEventListener("beforeunload",r)}},[n])},zq=(n,e=6)=>{if(!n)return!1;const t=n.toMillis?n.toMillis():new Date(n).getTime(),r=Date.now(),i=e*60*1e3;return r-t<i},PR=({users:n,currentUserId:e,onStartDm:t})=>{const{currentServer:r}=dp(),[i,s]=T.useState(null),[c,l]=T.useState([]);T.useEffect(()=>{if(!r||r==="home"){l([]);return}const A=Yi(St(_e,"servers",r,"roles"));return oi(A,F=>{const j=[];F.forEach(C=>{j.push({id:C.id,...C.data()})}),l(j)})},[r]);const d=A=>A.presence==="invisible"?!1:zq(A.lastSeen),h=n.filter(A=>d(A)),m=n.filter(A=>!d(A)),g=h.reduce((A,M)=>{const F=M.serverRole||M.role||"member";return A[F]||(A[F]=[]),A[F].push(M),A},{}),R=[...[{name:"admin",position:-3},{name:"moderator",position:-2},{name:"member",position:-1}],...c.map(A=>({name:A.name,position:A.position??999}))].sort((A,M)=>A.position-M.position).map(A=>A.name).filter(A=>g[A]?.length>0),E=A=>{const M=d(A);return f.jsxs("div",{onClick:()=>s(A),className:Ct("flex items-center gap-2 px-2 py-1.5 rounded cursor-pointer","hover:bg-dark-hover transition-colors",A.id===e&&"bg-dark-hover/50",!M&&"opacity-50"),children:[f.jsxs("div",{className:"relative flex-shrink-0",children:[A.photoUrl?f.jsx("img",{src:A.photoUrl,alt:A.displayName,className:"w-8 h-8 rounded-full object-cover",onError:F=>{F.target.style.display="none",F.target.nextSibling.style.display="flex"}}):null,f.jsx("div",{className:"w-8 h-8 rounded-full bg-brand-primary flex items-center justify-center text-white font-semibold text-sm",style:{display:A.photoUrl?"none":"flex"},children:A.displayName?.[0]?.toUpperCase()||"U"}),f.jsx("div",{className:"absolute bottom-0 right-0",children:f.jsx(r3,{status:M?A.presence||"online":"offline",size:"sm"})})]}),f.jsxs("div",{className:"flex-1 min-w-0",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("span",{className:"text-sm text-dark-text truncate",children:A.displayName||"Unknown"}),f.jsx("span",{className:Ct("text-xs px-1.5 py-0.5 rounded border",h5(A.serverRole||A.role)),children:(A.serverRole||A.role)?.charAt(0).toUpperCase()+(A.serverRole||A.role)?.slice(1)})]}),A.status&&f.jsxs("div",{className:"flex items-center gap-1 mt-0.5",children:[f.jsx("span",{className:"text-xs",children:A.status.emoji}),f.jsx("span",{className:"text-xs text-dark-muted truncate",children:A.status.text})]})]})]},A.id)};return f.jsxs("div",{className:"w-60 bg-dark-sidebar h-full overflow-y-auto py-3",children:[f.jsxs("div",{className:"px-2",children:[R.map(A=>{const M=g[A]||[];return M.length===0?null:f.jsxs("div",{className:"mb-4",children:[f.jsxs("div",{className:"text-xs font-semibold text-dark-muted uppercase px-2 mb-2",children:[A.charAt(0).toUpperCase()+A.slice(1),"s  ",M.length]}),M.map(E)]},A)}),m.length>0&&f.jsxs("div",{className:"mt-4",children:[f.jsxs("div",{className:"text-xs font-semibold text-gray-500 uppercase px-2 mb-2",children:["Offline  ",m.length]}),m.map(E)]})]}),f.jsx(BS,{user:i,isOpen:!!i,onClose:()=>s(null),onMessage:A=>{t&&t(A),s(null)}})]})},Fq=({isOpen:n,onClose:e,onConfirm:t,url:r})=>{const[i,s]=T.useState(!1),c=()=>{i&&localStorage.setItem("dontAskExternalLinks","true"),t(),e()};return f.jsx(ea,{isOpen:n,onClose:e,title:"External Link Warning",size:"sm",children:f.jsxs("div",{className:"space-y-4",children:[f.jsx("div",{className:"bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-4",children:f.jsxs("p",{className:"text-dark-text text-sm",children:[f.jsx("span",{className:"font-semibold text-yellow-500",children:" Security Warning"}),f.jsx("br",{}),f.jsx("br",{}),"You are about to open an external link. External links may lead to harmful or malicious websites. Please ensure you trust the source before proceeding."]})}),f.jsxs("div",{className:"bg-dark-bg p-3 rounded-lg",children:[f.jsx("p",{className:"text-xs text-dark-muted mb-1",children:"Link:"}),f.jsx("p",{className:"text-dark-text text-sm break-all font-mono",children:r})]}),f.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[f.jsx("input",{type:"checkbox",checked:i,onChange:l=>s(l.target.checked),className:`w-4 h-4 rounded border-dark-hover bg-dark-input text-brand-primary 
                       focus:ring-2 focus:ring-brand-primary cursor-pointer`}),f.jsx("span",{className:"text-sm text-dark-text",children:"Don't ask me again"})]}),f.jsxs("div",{className:"flex gap-3 justify-end pt-2",children:[f.jsx(ut,{variant:"secondary",onClick:e,children:"Cancel"}),f.jsx(ut,{variant:"primary",onClick:c,children:"Open Link"})]})]})})},Bq=n=>{if(!n)return n;let e=n;return e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),e=e.replace(/```([^`]+)```/g,'<pre class="bg-dark-input text-dark-text p-2 rounded my-1 overflow-x-auto"><code>$1</code></pre>'),e=e.replace(/`([^`]+)`/g,'<code class="bg-dark-input text-dark-text px-1 py-0.5 rounded text-sm">$1</code>'),e=e.replace(/\*\*([^*]+)\*\*/g,'<strong class="font-bold">$1</strong>'),e=e.replace(/\*([^*]+)\*/g,'<em class="italic">$1</em>'),e=e.replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank" rel="noopener noreferrer" class="text-brand-primary hover:underline">$1</a>'),e=e.replace(/@(everyone|[a-zA-Z0-9_]+)\b/g,'<span class="text-brand-primary font-medium cursor-pointer hover:underline" data-mention="$1">$1</span>'),e=e.replace(/\n/g,"<br>"),e},i3=({children:n,onMentionClick:e})=>{const t=Bq(n),r=i=>{const s=i.target.getAttribute("data-mention");s&&e&&e(s)};return f.jsx("div",{dangerouslySetInnerHTML:{__html:t},className:"markdown-content",onClick:r})},$q=["","","","","","","","","",""],MR=({onSelect:n,onClose:e})=>f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"fixed inset-0 z-40",onClick:e}),f.jsx("div",{className:"absolute left-0 bottom-full mb-2 bg-dark-sidebar border border-dark-hover rounded-lg shadow-lg p-2 z-50",children:f.jsx("div",{className:"flex gap-1",children:$q.map(t=>f.jsx("button",{onClick:()=>n(t),className:"w-8 h-8 flex items-center justify-center text-lg hover:bg-dark-hover rounded transition-colors",title:t,children:t},t))})})]}),qq=({message:n,currentUserId:e,serverId:t,channelId:r,users:i})=>{const[s,c]=T.useState(!1),l=n.poll;if(!l)return null;const d=n.userId===e,h=l.ended===!0,m=l.options.reduce((E,A,M)=>E+(l.votes?.[`option_${M}`]?.length||0),0),g=l.options.map((E,A)=>l.votes?.[`option_${A}`]?.includes(e)?A:-1).filter(E=>E!==-1);g.length>0;const b=async E=>{if(!(s||h)){c(!0);try{const A=`poll.votes.option_${E}`,M=Be(_e,"servers",t,"channels",r,"messages",n.id);if(l.votes?.[`option_${E}`]?.includes(e))await at(M,{[A]:hv(e)});else{if(!l.multipleChoice&&g.length>0)for(const j of g)await at(M,{[`poll.votes.option_${j}`]:hv(e)});await at(M,{[A]:up(e)})}}catch(A){console.error("Error voting:",A)}finally{c(!1)}}},_=async()=>{if(!(!d||h))try{const E=Be(_e,"servers",t,"channels",r,"messages",n.id);await at(E,{"poll.ended":!0})}catch(E){console.error("Error ending poll:",E)}},R=E=>l.anonymous?null:(l.votes?.[`option_${E}`]||[]).map(M=>i?.find(F=>F.id===M)?.displayName||"Unknown").join(", ");return f.jsxs("div",{className:"bg-dark-bg rounded-lg p-4 mt-2 border border-dark-hover max-w-md",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[f.jsx(OS,{className:"text-brand-primary",size:20}),f.jsx("span",{className:"text-xs text-dark-muted uppercase tracking-wide font-semibold",children:"Poll"}),l.multipleChoice&&f.jsx("span",{className:"text-xs text-dark-muted bg-dark-hover px-2 py-0.5 rounded",children:"Multiple Choice"}),h&&f.jsx("span",{className:"text-xs text-red-400 bg-red-400/10 px-2 py-0.5 rounded",children:"Ended"})]}),f.jsx("h3",{className:"text-dark-text font-semibold mb-4",children:l.question}),f.jsx("div",{className:"space-y-2",children:l.options.map((E,A)=>{const M=l.votes?.[`option_${A}`]?.length||0,F=m>0?Math.round(M/m*100):0,j=g.includes(A),C=R(A);return f.jsxs("button",{onClick:()=>b(A),disabled:s||h,className:`w-full text-left p-3 rounded-lg relative overflow-hidden transition-all group ${j?"bg-brand-primary/20 border-2 border-brand-primary":"bg-dark-sidebar border border-dark-hover hover:border-dark-muted"} ${h?"cursor-not-allowed opacity-80":""}`,children:[m>0&&f.jsx("div",{className:`absolute inset-0 transition-all duration-500 ${j?"bg-brand-primary/30":"bg-dark-hover/50"}`,style:{width:`${F}%`}}),f.jsxs("div",{className:"relative flex items-center justify-between",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[j&&f.jsx("div",{className:"w-5 h-5 bg-brand-primary rounded-full flex items-center justify-center",children:f.jsx(Sl,{className:"text-white",size:14})}),f.jsx("span",{className:`text-sm ${j?"text-dark-text font-medium":"text-dark-muted"}`,children:E})]}),m>0&&f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsxs("span",{className:"text-xs text-dark-muted",children:[M," vote",M!==1?"s":""]}),f.jsxs("span",{className:"text-sm font-semibold text-dark-text",children:[F,"%"]})]})]}),C&&M>0&&f.jsx("div",{className:"text-xs text-dark-muted mt-1 truncate opacity-0 group-hover:opacity-100 transition-opacity",children:C})]},A)})}),f.jsxs("div",{className:"flex items-center justify-between mt-4 pt-3 border-t border-dark-hover",children:[f.jsxs("div",{className:"flex items-center gap-1 text-xs text-dark-muted",children:[f.jsx(DS,{size:14}),f.jsxs("span",{children:[m," total vote",m!==1?"s":""]})]}),f.jsxs("div",{className:"flex items-center gap-2",children:[l.anonymous&&f.jsx("span",{className:"text-xs text-dark-muted",children:"Anonymous"}),d&&!h&&f.jsxs("button",{onClick:_,className:"flex items-center gap-1.5 text-xs font-medium text-red-400 bg-red-400/10 hover:bg-red-400/20 px-3 py-1.5 rounded transition-all border border-red-400/20 hover:border-red-400/30",children:[f.jsx(xB,{size:14}),"End Poll"]})]})]})]})},s3=/(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/(?:watch\?v=|embed\/|shorts\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/,a3=/(?:https?:\/\/)?(?:open\.)?spotify\.com\/(track|album|playlist|artist|episode|show)\/([a-zA-Z0-9]+)/,o3=/(?:https?:\/\/)?(?:www\.)?(?:twitter\.com|x\.com)\/(\w+)\/status\/(\d+)/,Hq=/\.(jpg|jpeg|png|gif|webp|bmp|svg)(\?.*)?$/i,Gq=/\.(mp4|webm|ogg|mov)(\?.*)?$/i,Kq=/\.(mp3|wav|ogg|m4a)(\?.*)?$/i,Wq=n=>{const e=n.match(s3);return e?e[1]:null},Yq=n=>{const e=n.match(a3);return e?{type:e[1],id:e[2]}:null},Qq=n=>{const e=n.match(o3);return e?{user:e[1],id:e[2]}:null},c3=n=>s3.test(n)?"youtube":a3.test(n)?"spotify":o3.test(n)?"twitter":Hq.test(n)?"image":Gq.test(n)?"video":Kq.test(n)?"audio":n.includes("/raw/upload/")||/\.(zip|rar|7z|exe|pdf|docx|xlsx|txt|iso|yml|json|xml|csv)$/i.test(n)?"file":"generic",l3=n=>{const e=/(https?:\/\/[^\s<]+[^<.,:;"')\]\s])/g;return n.match(e)||[]},Xq=({url:n})=>{const e=Wq(n),[t,r]=T.useState(!1);if(!e)return null;const i=`https://img.youtube.com/vi/${e}/mqdefault.jpg`;return f.jsxs("div",{className:"mt-2 max-w-md rounded-lg overflow-hidden border border-dark-hover bg-dark-sidebar",children:[f.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 border-b border-dark-hover",children:[f.jsx(Y$,{className:"text-red-500",size:18}),f.jsx("span",{className:"text-xs text-dark-muted font-medium",children:"YouTube"})]}),t?f.jsx("div",{className:"relative pt-[56.25%]",children:f.jsx("iframe",{className:"absolute inset-0 w-full h-full",src:`https://www.youtube.com/embed/${e}?autoplay=1`,title:"YouTube video",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})}):f.jsxs("div",{className:"relative cursor-pointer group",onClick:()=>r(!0),children:[f.jsx("img",{src:i,alt:"YouTube thumbnail",className:"w-full h-auto",onError:s=>{s.target.src=`https://img.youtube.com/vi/${e}/default.jpg`}}),f.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/30 group-hover:bg-black/50 transition-colors",children:f.jsx(bB,{className:"text-white/90 group-hover:text-white group-hover:scale-110 transition-all",size:64})})]}),f.jsxs("div",{className:"px-3 py-2 flex items-center justify-between",children:[f.jsx("span",{className:"text-xs text-dark-muted truncate",children:n}),f.jsx("a",{href:n,target:"_blank",rel:"noopener noreferrer",className:"text-dark-muted hover:text-brand-primary transition-colors",onClick:s=>s.stopPropagation(),children:f.jsx(PS,{size:16})})]})]})},Jq=({url:n})=>{const e=Yq(n);if(!e)return null;const r={track:152,album:352,playlist:352,artist:352,episode:232,show:232}[e.type]||152;return f.jsxs("div",{className:"mt-2 max-w-md rounded-lg overflow-hidden border border-dark-hover bg-dark-sidebar",children:[f.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 border-b border-dark-hover",children:[f.jsx(W$,{className:"text-green-500",size:18}),f.jsxs("span",{className:"text-xs text-dark-muted font-medium",children:["Spotify ",e.type]})]}),f.jsx("iframe",{src:`https://open.spotify.com/embed/${e.type}/${e.id}?utm_source=generator&theme=0`,width:"100%",height:r,frameBorder:"0",allow:"autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture",loading:"lazy",className:"bg-transparent"}),f.jsxs("div",{className:"px-3 py-2 flex items-center justify-between border-t border-dark-hover",children:[f.jsx("span",{className:"text-xs text-dark-muted truncate",children:n}),f.jsx("a",{href:n,target:"_blank",rel:"noopener noreferrer",className:"text-dark-muted hover:text-green-500 transition-colors",children:f.jsx(PS,{size:16})})]})]})},Zq=({url:n})=>f.jsx("div",{className:"mt-2 max-w-md rounded-lg overflow-hidden border border-dark-hover bg-dark-sidebar",children:f.jsx("a",{href:n,target:"_blank",rel:"noopener noreferrer",className:"block cursor-pointer",children:f.jsx("img",{src:n,alt:"Attachment",className:"w-full h-auto max-h-[400px] object-contain bg-black/50",loading:"lazy",onError:e=>{e.target.style.display="none"}})})}),eH=({url:n})=>{const e=T.useRef(null),[t,r]=T.useState(!1),[i,s]=T.useState(!1);T.useEffect(()=>{if(window.twttr)c();else{const l=document.createElement("script");l.src="https://platform.twitter.com/widgets.js",l.async=!0,l.onload=()=>{window.twttr&&e.current&&c()},l.onerror=()=>s(!0),document.body.appendChild(l)}},[n]);const c=()=>{window.twttr&&e.current&&(e.current.innerHTML="",window.twttr.widgets.createTweet(Qq(n)?.id,e.current,{theme:"dark",conversation:"none"}).then(l=>{r(!!l),l||s(!0)}).catch(()=>s(!0)))};return i?f.jsx("div",{className:"mt-2 max-w-md rounded-lg overflow-hidden border border-dark-hover bg-dark-sidebar p-3",children:f.jsxs("div",{className:"flex items-center gap-2 text-dark-muted",children:[f.jsx(mR,{className:"text-sky-400",size:18}),f.jsx("span",{className:"text-sm",children:"Tweet could not be loaded"}),f.jsx("a",{href:n,target:"_blank",rel:"noopener noreferrer",className:"ml-auto text-brand-primary hover:underline text-sm",children:"View on X"})]})}):f.jsxs("div",{className:"mt-2 max-w-md",children:[!t&&f.jsx("div",{className:"rounded-lg border border-dark-hover bg-dark-sidebar p-4 animate-pulse",children:f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx(mR,{className:"text-sky-400",size:18}),f.jsx("span",{className:"text-sm text-dark-muted",children:"Loading tweet..."})]})}),f.jsx("div",{ref:e,className:t?"":"hidden"})]})},tH=({url:n})=>f.jsx("div",{className:"mt-2 max-w-md rounded-lg overflow-hidden border border-dark-hover bg-dark-sidebar",children:f.jsx("video",{src:n,controls:!0,className:"w-full max-h-[400px] bg-black"})}),nH=({url:n})=>f.jsxs("div",{className:"mt-2 max-w-md rounded-lg border border-dark-hover bg-dark-sidebar p-3 flex items-center gap-3",children:[f.jsx("div",{className:"w-10 h-10 rounded-full bg-brand-primary/20 flex items-center justify-center flex-shrink-0",children:f.jsx(LB,{className:"text-brand-primary",size:24})}),f.jsxs("div",{className:"flex-1 min-w-0",children:[f.jsx("div",{className:"text-xs text-dark-muted mb-1 truncate",children:n.split("/").pop()}),f.jsx("audio",{src:n,controls:!0,className:"w-full h-8"})]})]}),rH=({url:n})=>{const e=n.split("/").pop().split("?")[0]||"file",t=e.split(".").pop();return f.jsxs("div",{className:"mt-2 max-w-md rounded-lg border border-dark-hover bg-dark-sidebar p-3 flex items-center gap-3 hover:bg-dark-hover transition-colors",children:[f.jsx("div",{className:"w-12 h-12 rounded bg-dark-input flex items-center justify-center flex-shrink-0",children:f.jsx("span",{className:"text-xs font-bold text-dark-text uppercase",children:t.length<5?t:"FILE"})}),f.jsxs("div",{className:"flex-1 min-w-0",children:[f.jsx("div",{className:"text-sm font-medium text-dark-text truncate",children:e}),f.jsx("div",{className:"text-xs text-dark-muted",children:"Attachment"})]}),f.jsx("a",{href:n,download:!0,target:"_blank",rel:"noopener noreferrer",className:"p-2 rounded-full hover:bg-white/10 text-dark-muted hover:text-white transition-colors",title:"Download",children:f.jsx(NB,{size:20})})]})},iH=({url:n})=>{let e="";try{e=new URL(n).hostname.replace("www.","")}catch{e=n}return f.jsxs("a",{href:n,target:"_blank",rel:"noopener noreferrer",className:"mt-2 flex items-center gap-3 max-w-md rounded-lg border border-dark-hover bg-dark-sidebar p-3 hover:bg-dark-hover transition-colors group",children:[f.jsx("div",{className:"w-10 h-10 rounded-lg bg-brand-primary/20 flex items-center justify-center",children:f.jsx(PS,{className:"text-brand-primary",size:20})}),f.jsxs("div",{className:"flex-1 min-w-0",children:[f.jsx("div",{className:"text-sm font-medium text-dark-text truncate group-hover:text-brand-primary transition-colors",children:e}),f.jsx("div",{className:"text-xs text-dark-muted truncate",children:n})]})]})},sH=({url:n})=>{switch(c3(n)){case"youtube":return f.jsx(Xq,{url:n});case"spotify":return f.jsx(Jq,{url:n});case"twitter":return f.jsx(eH,{url:n});case"image":return f.jsx(Zq,{url:n});case"video":return f.jsx(tH,{url:n});case"audio":return f.jsx(nH,{url:n});case"file":return f.jsx(rH,{url:n});default:return f.jsx(iH,{url:n})}},aH=({text:n})=>{const t=l3(n).slice(0,3);return t.length===0?null:f.jsx("div",{className:"space-y-2",children:t.map((r,i)=>f.jsx(sH,{url:r},`${r}-${i}`))})},u3=({serverId:n,channelId:e,users:t,currentUserId:r,userRole:i,onReply:s,onMessagesChange:c})=>{const[l,d]=T.useState([]),[h,m]=T.useState(null),[g,b]=T.useState(null),[_,R]=T.useState(null),[E,A]=T.useState(null),[M,F]=T.useState(""),[j,C]=T.useState(null),[N,D]=T.useState("bottom"),[S,k]=T.useState(null),[P,L]=T.useState(!0),[U,z]=T.useState(!1),[V,le]=T.useState(null),ve=T.useRef(null),K=T.useRef(null),oe=T.useRef(0),ee=T.useRef(!0),Me=T.useRef(t);T.useEffect(()=>{Me.current=t},[t]);const{success:je,error:q}=Ss(),te=()=>{ve.current?.scrollIntoView({behavior:"smooth"})};T.useEffect(()=>{if(!e||!e)return;const Ie=Yi(n?St(_e,"servers",n,"channels",e,"messages"):St(_e,"dms",e,"messages"),dv("timestamp","desc"),vx(20)),qe=oi(Ie,ot=>{const $e=[];if(ot.forEach(Q=>{$e.push({id:Q.id,...Q.data()})}),$e.reverse(),!ee.current&&$e.length>oe.current&&r){const Q=Me.current?.find(Pe=>Pe.id===r);if(Q?.displayName){const Pe=$e.slice(oe.current),Fe=Pe.some(Vt=>Vt.userId!==r&&tB(Vt.text,Q.displayName)),ht=Pe.some(Vt=>{const Lt=Vt.userId!==r&&Vt.replyTo?.userId===r;return Lt&&console.log("Reply notification:",Vt),Lt});(Fe||ht)&&(console.log("Playing notification sound",{hasMention:Fe,hasReply:ht}),yx())}}oe.current=$e.length,d($e),ee.current&&(ee.current=!1),$e.length>0&&le($e[0]),L($e.length===20),c&&c($e),setTimeout(te,100)});return()=>{qe(),ee.current=!0}},[e,n,r,c]);const fe=async()=>{if(!e||!V||U||!P)return;z(!0);const de=K.current,Ie=de?.scrollHeight||0;try{const qe=Yi(n?St(_e,"servers",n,"channels",e,"messages"):St(_e,"dms",e,"messages"),dv("timestamp","desc"),vF(V.timestamp),vx(20)),ot=await bl(qe),$e=[];ot.forEach(Q=>{$e.push({id:Q.id,...Q.data()})}),$e.length>0?($e.reverse(),d(Q=>[...$e,...Q]),le($e[0]),L($e.length===20),setTimeout(()=>{de&&(de.scrollTop=de.scrollHeight-Ie)},0)):L(!1)}catch(qe){console.error("Error loading more messages:",qe),q("Failed to load more messages")}finally{z(!1)}},Se=de=>t.find(Ie=>Ie.id===de)||{displayName:"Unknown",role:"member"},Oe=de=>r===de||i==="admin",Te=de=>{if(de.userId!==r)return!1;if(!de.timestamp)return!0;const Ie=de.timestamp.toDate();return(new Date-Ie)/1e3/60<15},we=async()=>{if(h)try{const de=t.find(qe=>qe.id===h.userId),Ie=n?Be(_e,"servers",n,"channels",e,"messages",h.id):Be(_e,"dms",e,"messages",h.id);await ec(Ie),await Ln(St(_e,"adminLogs"),{type:"message_delete",channelId:e,messageId:h.id,userId:r,deletedText:h.text||"(empty)",originalUserId:h.userId,originalUserName:de?.displayName||"Unknown User",timestamp:bt()}),je("Message deleted successfully")}catch(de){console.error("Error deleting message:",de),q("Failed to delete message")}finally{m(null)}},Ge=de=>{A(de.id),F(de.text)},Ke=()=>{A(null),F("")},Ce=async()=>{if(!E)return;if(!M.trim()){q("Message cannot be empty");return}const de=E,Ie=M.trim(),ot=l.find($e=>$e.id===de)?.text||"";A(null),F("");try{const $e=n?Be(_e,"servers",n,"channels",e,"messages",de):Be(_e,"dms",e,"messages",de);await at($e,{text:Ie,edited:!0,editedAt:bt()}),await Ln(St(_e,"adminLogs"),{type:"message_edit",channelId:e,messageId:de,userId:r,originalText:ot,newText:Ie,timestamp:bt()}),je("Message updated successfully")}catch($e){console.error("Error editing message:",$e),$e.code==="resource-exhausted"?q("Quota exceeded. Please try again tomorrow."):q("Failed to edit message")}},Re=async(de,Ie)=>{try{const qe=l.find(Pe=>Pe.id===de);if(!qe)return;const ot={...qe.reactions},$e=ot[Ie]||[];if($e.includes(r)){const Pe=$e.filter(Fe=>Fe!==r);Pe.length===0?delete ot[Ie]:ot[Ie]=Pe}else ot[Ie]=[...$e,r];const Q=n?Be(_e,"servers",n,"channels",e,"messages",de):Be(_e,"dms",e,"messages",de);await at(Q,{reactions:ot})}catch(qe){console.error("Error toggling reaction:",qe),q("Failed to update reaction")}},He=async de=>{if(i!=="admin"&&i!=="moderator"){q("Only admins and moderators can pin messages");return}try{const Ie=!de.pinned,qe=n?Be(_e,"servers",n,"channels",e,"messages",de.id):Be(_e,"dms",e,"messages",de.id);await at(qe,{pinned:Ie,pinnedBy:Ie?r:null,pinnedAt:Ie?bt():null}),await Ln(St(_e,"adminLogs"),{type:Ie?"message_pin":"message_unpin",channelId:e,messageId:de.id,userId:r,messageText:de.text,timestamp:bt()}),je(Ie?"Message pinned":"Message unpinned")}catch(Ie){console.error("Error toggling pin:",Ie),q("Failed to pin message")}};return f.jsxs("div",{ref:K,className:"flex-1 overflow-y-auto px-4 py-4 space-y-4",children:[P&&l.length>0&&f.jsx("div",{className:"flex justify-center mb-4",children:f.jsx("button",{onClick:fe,disabled:U,className:"px-4 py-2 bg-brand-primary hover:bg-brand-primary/80 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:U?f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Loading..."]}):"Load More Messages"})}),l.length===0?f.jsx("div",{className:"text-center text-dark-muted py-8",children:"No messages yet. Start the conversation!"}):l.map(de=>{const Ie=Se(de.userId);return f.jsxs("div",{id:`message-${de.id}`,className:"flex gap-3 hover:bg-dark-hover/30 px-2 py-1 rounded group transition-colors",children:[f.jsxs("div",{className:"relative flex-shrink-0",children:[Ie.photoUrl?f.jsx("img",{src:Ie.photoUrl,alt:Ie.displayName,onClick:()=>R(Ie),className:"w-10 h-10 rounded-full object-cover cursor-pointer hover:opacity-80 transition-opacity",onError:qe=>{qe.target.style.display="none",qe.target.nextSibling.style.display="flex"}}):null,f.jsx("div",{onClick:()=>R(Ie),className:"w-10 h-10 rounded-full bg-brand-primary flex items-center justify-center text-white font-semibold cursor-pointer hover:opacity-80 transition-opacity",style:{display:Ie.photoUrl?"none":"flex"},children:Ie.displayName?.[0]?.toUpperCase()||"U"})]}),f.jsxs("div",{className:"flex-1 min-w-0",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[f.jsx("span",{className:"font-semibold text-dark-text hover:underline cursor-pointer",onClick:()=>R(Ie),children:Ie.displayName||"Unknown"}),f.jsx("span",{className:Ct("text-xs px-1.5 py-0.5 rounded border",h5(Ie.role)),children:Ie.role?.charAt(0).toUpperCase()+Ie.role?.slice(1)}),f.jsx("span",{className:"text-xs text-dark-muted",children:v0(de.timestamp)}),de.edited&&f.jsx("span",{className:"text-xs text-dark-muted italic",children:"(edited)"}),E!==de.id&&f.jsxs("div",{className:"ml-auto relative z-50",children:[f.jsx("button",{onClick:qe=>{const ot=qe.clientY,$e=window.innerHeight,Q=ot<$e/2;D(Q?"bottom":"top"),C(j===de.id?null:de.id)},className:"opacity-0 group-hover:opacity-100 p-1 hover:bg-dark-hover rounded transition-all",title:"More options",children:f.jsx($B,{size:18,className:"text-dark-muted"})}),j===de.id&&f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>C(null)}),f.jsxs("div",{className:`absolute right-0 ${N==="top"?"bottom-full mb-1":"top-full mt-1"} bg-dark-sidebar border border-dark-hover rounded-lg shadow-lg py-1 z-50 min-w-[120px]`,children:[f.jsxs("button",{onClick:()=>{s&&s(de),C(null)},className:"w-full px-3 py-2 text-left text-sm text-dark-text hover:bg-dark-hover flex items-center gap-2",children:[f.jsx(wB,{size:16,className:"text-green-400"}),"Reply"]}),Te(de)&&f.jsxs("button",{onClick:()=>{Ge(de),C(null)},className:"w-full px-3 py-2 text-left text-sm text-dark-text hover:bg-dark-hover flex items-center gap-2",children:[f.jsx(Qu,{size:16,className:"text-blue-400"}),"Edit"]}),(i==="admin"||i==="moderator")&&f.jsxs("button",{onClick:()=>{He(de),C(null)},className:"w-full px-3 py-2 text-left text-sm text-dark-text hover:bg-dark-hover flex items-center gap-2",children:[f.jsx(Yu,{size:16,className:"text-blue-400"}),de.pinned?"Unpin":"Pin"]}),Oe(de.userId)&&f.jsxs("button",{onClick:()=>{m({id:de.id,text:de.text,userId:de.userId}),C(null)},className:"w-full px-3 py-2 text-left text-sm text-admin hover:bg-dark-hover flex items-center gap-2",children:[f.jsx(Ka,{size:16}),"Delete"]})]})]})]})]}),E===de.id?f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("input",{type:"text",value:M,onChange:qe=>F(qe.target.value),onKeyDown:qe=>{qe.key==="Enter"&&Ce(),qe.key==="Escape"&&Ke()},className:`flex-1 bg-dark-input text-dark-text px-3 py-1.5 rounded
                                 border border-brand-primary outline-none`,autoFocus:!0}),f.jsx("button",{onClick:Ce,className:"text-green-500 hover:text-green-400 transition-colors",title:"Save (Enter)",children:f.jsx(Sl,{size:20})}),f.jsx("button",{onClick:Ke,className:"text-admin hover:text-admin/80 transition-colors",title:"Cancel (Esc)",children:f.jsx(mr,{size:20})})]}):f.jsxs(f.Fragment,{children:[de.replyTo&&f.jsxs("div",{className:"mb-2 ml-2 pl-3 border-l-2 border-green-400 text-sm bg-dark-sidebar/30 rounded py-1",children:[f.jsxs("div",{className:"text-xs text-green-400 font-semibold",children:["Replying to ",Se(de.replyTo.userId).displayName]}),f.jsx("div",{className:"text-dark-muted italic truncate",children:de.replyTo.text})]}),de.pinned&&f.jsxs("div",{className:"flex items-center gap-1 text-xs text-blue-400 mb-1",children:[f.jsx(Yu,{size:14}),f.jsx("span",{children:"Pinned"})]}),de.type==="audio"&&f.jsxs("div",{className:"mt-1 mb-1 max-w-[300px] w-full bg-dark-hover/50 rounded-lg p-2 border border-dark-hover flex items-center gap-3",children:[f.jsx("div",{className:"w-10 h-10 rounded-full bg-brand-primary/20 flex items-center justify-center text-brand-primary flex-shrink-0",children:f.jsx(_l,{size:20})}),f.jsx("div",{className:"flex-1 min-w-0",children:f.jsx("audio",{controls:!0,src:de.text,className:"w-full h-8",controlsList:"nodownload noplaybackrate"})})]}),de.type!=="sticker"&&de.type!=="audio"&&(()=>{const qe=l3(de.text);let ot=de.text;return qe.filter(Q=>{const Pe=c3(Q);return["youtube","spotify","twitter","image","video","audio","file"].includes(Pe)}).forEach(Q=>{ot=ot.replace(Q,"")}),ot=ot.trim(),ot.length>0&&f.jsx("div",{className:"text-dark-text whitespace-pre-wrap break-words select-text",children:f.jsx(i3,{onMentionClick:Q=>{const Pe=t.find(Fe=>Fe.displayName?.toLowerCase()===Q.toLowerCase());Pe&&R(Pe)},children:ot})})})(),de.type==="sticker"&&f.jsx("div",{className:"mt-1 mb-1",children:f.jsx("img",{src:de.text,alt:"Sticker",className:"w-40 h-40 object-contain drop-shadow-md hover:scale-110 transition-transform origin-bottom-left select-none cursor-pointer",onClick:()=>window.open(de.text,"_blank")})}),de.type!=="sticker"&&de.type!=="audio"&&f.jsx(aH,{text:de.text}),de.type==="poll"&&f.jsx(qq,{message:de,currentUserId:r,serverId:n,channelId:e,users:t}),de.reactions&&Object.keys(de.reactions).length>0&&f.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[Object.entries(de.reactions).map(([qe,ot])=>f.jsxs("button",{onClick:()=>Re(de.id,qe),className:Ct("px-2 py-1 rounded-full text-sm flex items-center gap-1 transition-colors",ot.includes(r)?"bg-brand-primary/20 border border-brand-primary text-brand-primary":"bg-dark-hover border border-dark-hover text-dark-text hover:border-dark-muted"),title:`${ot.map($e=>Se($e).displayName).join(", ")}`,children:[f.jsx("span",{children:qe}),f.jsx("span",{className:"text-xs",children:ot.length})]},qe)),f.jsxs("div",{className:"relative",children:[f.jsx("button",{onClick:()=>k(S===de.id?null:de.id),className:"px-2 py-1 rounded-full text-sm bg-dark-hover border border-dark-hover hover:border-dark-muted transition-colors",title:"Add reaction",children:f.jsx(lR,{size:16,className:"text-dark-muted"})}),S===de.id&&f.jsx(MR,{onSelect:qe=>{Re(de.id,qe),k(null)},onClose:()=>k(null)})]})]}),(!de.reactions||Object.keys(de.reactions).length===0)&&f.jsxs("div",{className:"relative mt-2",children:[f.jsxs("button",{onClick:()=>k(S===de.id?null:de.id),className:"opacity-0 group-hover:opacity-100 px-2 py-1 rounded text-xs bg-dark-hover hover:bg-dark-input transition-all flex items-center gap-1",title:"Add reaction",children:[f.jsx(lR,{size:14}),f.jsx("span",{className:"text-dark-muted",children:"Add reaction"})]}),S===de.id&&f.jsx(MR,{onSelect:qe=>{Re(de.id,qe),k(null)},onClose:()=>k(null)})]})]})]})]},de.id)}),f.jsx("div",{ref:ve}),f.jsx(gd,{isOpen:!!h,onClose:()=>m(null),onConfirm:we,title:"Delete Message",message:"Are you sure you want to delete this message? This action cannot be undone.",confirmText:"Delete",variant:"danger"}),f.jsx(Fq,{isOpen:!!g,onClose:()=>b(null),onConfirm:()=>window.open(g?.url,"_blank","noopener,noreferrer"),url:g?.url}),f.jsx(BS,{user:_,isOpen:!!_,onClose:()=>R(null)})]})},DR={smileys:{name:"Smileys & People",icon:"",emojis:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},animals:{name:"Animals & Nature",icon:"",emojis:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},food:{name:"Food & Drink",icon:"",emojis:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},activities:{name:"Activities",icon:"",emojis:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},travel:{name:"Travel & Places",icon:"",emojis:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},objects:{name:"Objects",icon:"",emojis:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},symbols:{name:"Symbols",icon:"",emojis:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","0","1","2","3","4","5","6","7","8","9","","","#","*","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},flags:{name:"Flags",icon:"",emojis:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]}},oH=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],cH=({onSelect:n,onClose:e})=>{const[t,r]=T.useState("smileys");return f.jsxs("div",{className:"absolute bottom-full right-0 mb-2 bg-dark-sidebar border border-dark-hover rounded-lg shadow-xl w-80 z-50",children:[f.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-dark-hover",children:[f.jsx("span",{className:"text-sm font-semibold text-dark-text",children:"Emoji Picker"}),f.jsx("button",{onClick:e,className:"text-dark-muted hover:text-dark-text transition-colors",children:f.jsx(mr,{size:18})})]}),f.jsxs("div",{className:"p-3 border-b border-dark-hover",children:[f.jsx("div",{className:"text-xs text-dark-muted mb-2 font-semibold",children:"POPULAR"}),f.jsx("div",{className:"grid grid-cols-10 gap-1",children:oH.map((i,s)=>f.jsx("button",{onClick:()=>n(i),className:"text-2xl hover:bg-dark-hover rounded p-1 transition-colors",title:i,children:i},s))})]}),f.jsx("div",{className:"flex gap-1 p-2 border-b border-dark-hover overflow-x-auto",children:Object.entries(DR).map(([i,s])=>f.jsx("button",{onClick:()=>r(i),className:`text-xl p-2 rounded transition-colors ${t===i?"bg-brand-primary/20 text-brand-primary":"hover:bg-dark-hover text-dark-muted"}`,title:s.name,children:s.icon},i))}),f.jsx("div",{className:"p-3 h-64 overflow-y-auto",children:f.jsx("div",{className:"grid grid-cols-8 gap-1",children:DR[t].emojis.map((i,s)=>f.jsx("button",{onClick:()=>n(i),className:"text-2xl hover:bg-dark-hover rounded p-1 transition-colors",title:i,children:i},s))})})]})};let Km;const lH=new Uint8Array(16);function uH(){if(!Km&&(Km=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Km))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Km(lH)}const Sr=[];for(let n=0;n<256;++n)Sr.push((n+256).toString(16).slice(1));function dH(n,e=0){return Sr[n[e+0]]+Sr[n[e+1]]+Sr[n[e+2]]+Sr[n[e+3]]+"-"+Sr[n[e+4]]+Sr[n[e+5]]+"-"+Sr[n[e+6]]+Sr[n[e+7]]+"-"+Sr[n[e+8]]+Sr[n[e+9]]+"-"+Sr[n[e+10]]+Sr[n[e+11]]+Sr[n[e+12]]+Sr[n[e+13]]+Sr[n[e+14]]+Sr[n[e+15]]}const hH=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),OR={randomUUID:hH};function fH(n,e,t){if(OR.randomUUID&&!n)return OR.randomUUID();n=n||{};const r=n.random||(n.rng||uH)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,dH(r)}var pH=Object.defineProperty,mH=Object.defineProperties,gH=Object.getOwnPropertyDescriptors,jR=Object.getOwnPropertySymbols,vH=Object.prototype.hasOwnProperty,yH=Object.prototype.propertyIsEnumerable,LR=(n,e,t)=>e in n?pH(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,qS=(n,e)=>{for(var t in e||(e={}))vH.call(e,t)&&LR(n,t,e[t]);if(jR)for(var t of jR(e))yH.call(e,t)&&LR(n,t,e[t]);return n},bH=(n,e)=>mH(n,gH(e)),Tr={ENABLED:typeof window<"u"&&typeof location<"u"&&location.search.indexOf("giphy-debug")!==-1,LEVEL:0,PREFIX:"GiphyJS",debug:(...n)=>{Tr.ENABLED&&Tr.LEVEL<=0&&console.debug(Tr.PREFIX,...n)},info:(...n)=>{Tr.ENABLED&&Tr.LEVEL<=1&&console.info(Tr.PREFIX,...n)},warn:(...n)=>{Tr.ENABLED&&Tr.LEVEL<=2&&console.warn(Tr.PREFIX,...n)},error:(...n)=>{Tr.ENABLED&&Tr.LEVEL<=3&&console.error(Tr.PREFIX,...n)}},xH=(n,e,t)=>{let r=1/0,i;return t.forEach(s=>{const c=s.width/n,l=s.height/e,d=c*l,h=Math.abs(1-d);h<r&&(r=h,i=s)}),i},_H=50;function SH(n,e,t,r=_H){let[i]=n;const s=n.filter(c=>(c.width*c.height>i.width*i.height&&(i=c),e-c.width<=r&&t-c.height<=r));return s.length===0?i:xH(e,t,s)}var d3=SH;function TH(n,e=0){return n.slice(0,e)}function kH(n,e){return n.filter(t=>e.indexOf(t)===-1)}function Ix(n,e){const t={};return e.forEach(r=>{n[r]!==void 0&&(t[r]=n[r])}),t}var CH=n=>{let e=0,t=0;const r=n.offsetWidth,i=n.offsetHeight;do e+=n.offsetLeft,t+=n.offsetTop,n=n.offsetParent;while(n);const s={left:e,top:t,width:r,height:i,right:e+r,bottom:t+i,x:e,y:t};return bH(qS({},s),{toJSON:()=>JSON.stringify(s)})},wH=CH,tl="",h3=16,f3=()=>{let n="";const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=e.length;for(let r=0;r<h3;r++)n+=e.charAt(Math.floor(Math.random()*t));return n},EH=()=>{if(!tl){try{tl=sessionStorage.getItem("giphyPingbackId")}catch{}if(!tl){const n=new Date().getTime().toString(16);try{tl=`${n}${fH().replace(/-/g,"")}`.substring(0,h3)}catch{tl=f3()}try{sessionStorage.setItem("giphyPingbackId",tl)}catch{}}}return tl},HS=EH,Wm=null;new Promise(n=>{typeof Image>"u"&&n(!1);const e=new Image;e.onload=()=>{Wm=!0,n(Wm)},e.onerror=()=>{Wm=!1,n(Wm)},e.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA"});var UR=(n,e,t)=>{let r=n?.assets;if(r){r=qS({},r),delete r.source;const i=Object.values(r).sort((s,c)=>s.width-c.width);return d3(i,e,t)}},RH=(n,e,t,r)=>{const i=Ix(n,["original","fixed_width","fixed_height","fixed_width_small","fixed_height_small"]),s=Object.entries(i).map(([c,l])=>qS({renditionName:c},l));return d3(s,e,t,r)},x0=({images:n},e)=>{const{fixed_width:t}=n;if(t){const{width:r,height:i}=t,s=r/i;return Math.round(e/s)}return 0},AH=({images:n},e)=>{const{fixed_width:t}=n;if(t){const{width:r,height:i}=t,s=r/i;return Math.round(e*s)}return 0},NH=({alt_text:n,user:e,tags:t=[],is_sticker:r=!1,title:i=""})=>{if(n)return n;if(i)return i;const s=e&&e.username||"",c=TH(kH(t,["transparent"]),s?4:5);return`${s?`${s} `:""}${c.join(" ")} ${r?"Sticker":"GIF"}`},rf=(typeof window<"u"?window:global)||{};rf._GIPHY_SDK_HEADERS_=rf._GIPHY_SDK_HEADERS_||(rf.Headers?new rf.Headers({"X-GIPHY-SDK-PLATFORM":"web"}):void 0);var GS=()=>rf._GIPHY_SDK_HEADERS_,Px=(n,e)=>{var t;return(t=GS())==null?void 0:t.set(n,e)},IH=Object.defineProperty,PH=Object.defineProperties,MH=Object.getOwnPropertyDescriptors,DH=Object.getOwnPropertyNames,VR=Object.getOwnPropertySymbols,OH=Object.prototype.hasOwnProperty,jH=Object.prototype.propertyIsEnumerable,zR=(n,e,t)=>e in n?IH(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,$s=(n,e)=>{for(var t in e||(e={}))OH.call(e,t)&&zR(n,t,e[t]);if(VR)for(var t of VR(e))jH.call(e,t)&&zR(n,t,e[t]);return n},d1=(n,e)=>PH(n,MH(e)),LH=(n=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(n,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):n)(function(n){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+n+'" is not supported')}),UH=(n,e)=>function(){return e||(0,n[DH(n)[0]])((e={exports:{}}).exports,e),e.exports},p3=(n,e,t)=>new Promise((r,i)=>{var s=d=>{try{l(t.next(d))}catch(h){i(h)}},c=d=>{try{l(t.throw(d))}catch(h){i(h)}},l=d=>d.done?r(d.value):Promise.resolve(d.value).then(s,c);l((t=t.apply(n,e)).next())}),VH=UH({"package.json"(n,e){e.exports={scripts:{lint:"run -T eslint . --ext .ts,.tsx",clean:"rm -rf ./dist",dev:"parcel public/test.html",docs:"typedoc src/index.ts",build:"run -T tsup src/index.ts --format cjs,esm --dts && run -T publint",prepublish:"npm run clean && npm run build",test:"run -T jest --config ./jestconfig.js","test:watch":"run -T jest --config ./jestconfig.js --watchAll"},name:"@giphy/js-fetch-api",version:"5.7.0",description:"Javascript API to fetch gifs and stickers from the GIPHY API.",homepage:"https://github.com/Giphy/giphy-js/tree/master/packages/fetch-api",main:"dist/index.cjs",types:"dist/index.d.ts",module:"dist/index.js",type:"module",sideEffects:!1,exports:{".":{types:"./dist/index.d.ts",import:"./dist/index.js",require:"./dist/index.cjs"},"./package.json":"./package.json"},files:["dist/","src/**/*"],license:"MIT",publishConfig:{access:"public"},dependencies:{"@giphy/js-types":"*","@giphy/js-util":"*"},devDependencies:{"jest-fetch-mock":"^3.0.3","parcel-bundler":"latest",typedoc:"^0.20.37","typedoc-thunder-theme":"^0.0.3",typescript:"^5.0.4"}}}}),zH=["is_anonymous","is_community","is_featured","is_hidden","is_indexable","is_preserve_size","is_realtime","is_removed","is_sticker","is_dynamic"],FH=["suppress_chrome","is_public","is_verified"],FR=n=>e=>n[e]=!!n[e],BH=n=>typeof n=="string"?n:n.text,m3=(n,e="")=>{const t=$s({},n);t.id=String(t.id),t.tags=(t.tags||[]).map(BH),t.bottle_data||(t.bottle_data={}),t.response_id=e,zH.forEach(FR(t)),Object.keys(t.images||{}).forEach(i=>{const s=t.images[i];s.width=parseInt(s.width),s.height=parseInt(s.height)});const{user:r}=t;if(r){const i=$s({},r);FH.forEach(FR(i)),t.user=i}return t},BR=n=>{const{response_id:e}=n.meta;return n.data=m3(n.data,e),n},Da=n=>{const{response_id:e}=n.meta;return n.data=n.data.map(t=>m3(t,e)),n},$H=(typeof window<"u"?window:global)||{},qH=$H.GIPHY_API_URL||"https://api.giphy.com/v1/",g3=class extends Error{constructor(e,t,r=0,i=""){super(e),this.url=t,this.status=r,this.statusText=i}},HH=class extends g3{},$R=g3,GH="@giphy/js-fetch-api: ",KH="Error fetching",WH=n=>n,ls={},YH=6e4,QH=6e3,XH=()=>{const n=Date.now();Object.keys(ls).forEach(e=>{const t=ls[e].isError?QH:YH;n-ls[e].ts>=t&&delete ls[e]})};function JH(n,e={}){const{apiVersion:t=1,noCache:r=!1,normalizer:i=WH}=e,s=qH.replace(/\/v\d+\/$/,`/v${t}/`);if(XH(),!ls[n]||r){const c=`${s}${n}`,l=()=>p3(this,null,function*(){var d,h;let m;try{const g=yield fetch(c,{method:"get"});if(g.ok){const b=yield g.json();if((d=b.meta)!=null&&d.response_id)return i(b);throw{message:"synthetic response"}}else{let b=KH;try{const R=yield g.json();R.message&&(b=R.message),(h=R.meta)!=null&&h.msg&&(b=R.meta.msg)}catch{}ls[n]&&(ls[n].isError=!0);let _=$R;b==="This content is not available in your location"&&(_=HH),m=new _(`${GH}${b}`,c,g.status,g.statusText)}}catch(g){m=new $R(g.message,c),ls[n]&&(ls[n].isError=!0)}throw m});ls[n]={request:l(),ts:Date.now()}}return ls[n].request}var ii=JH,h1=n=>n&&n.type?n.type:"gifs",ZH=class{constructor(n,e={}){this.getQS=(t={})=>new URLSearchParams($s(d1($s({},t),{api_key:this.apiKey,pingback_id:HS()}),this.qsParams)).toString(),this.apiKey=n,this.qsParams=e}categories(n){return ii(`gifs/categories?${this.getQS(n)}`)}gif(n,e){const t=e?.internal?"internal/":"";return ii(`${t}gifs/${n}?${this.getQS()}`,{normalizer:BR})}gifs(n,e){return Array.isArray(n)?ii(`gifs?${this.getQS({ids:n.join(",")})}`,{normalizer:Da}):ii(`gifs/categories/${n}/${e}?${this.getQS()}`,{normalizer:Da})}emoji(n){return ii(`emoji?${this.getQS(n)}`,{normalizer:Da})}emojiDefaultVariations(n){return ii(`emoji?${this.getQS(n)}`,{apiVersion:2,normalizer:Da})}emojiVariations(n){return ii(`emoji/${n}/variations?${this.getQS()}`,{apiVersion:2,normalizer:Da})}animate(n,e={}){const t=this.getQS(d1($s({},e),{m:n}));return ii(`text/animate?${t}`,{normalizer:Da})}search(n,e={}){const t=e.channel?`@${e.channel} ${n}`:n;let r;e.type==="text"&&(r=!0);const i=this.getQS(d1($s({rating:"pg-13"},e),{q:t,excludeDynamicResults:r}));return ii(`${h1(e)}/search?${i}`,{normalizer:Da})}subcategories(n,e){return ii(`gifs/categories/${n}?${this.getQS(e)}`)}trending(n={}){return ii(`${h1(n)}/trending?${this.getQS($s({rating:"pg-13"},n))}`,{normalizer:Da})}random(n){return ii(`${h1(n)}/random?${this.getQS($s({rating:"pg-13"},n))}`,{noCache:!0,normalizer:BR})}related(n,e={}){const{type:t="gifs"}=e;return ii(`${t}/related?${this.getQS($s({gif_id:n,rating:"pg-13"},e))}`,{normalizer:Da})}channels(n,e={}){return ii(`channels/search?${this.getQS($s({q:n,rating:"pg-13"},e))}`)}},v3=ZH,eG=Symbol("has inivisible gifs"),y3=(n,e=[])=>{let t=[...e],r=e.map(c=>c.id),i=e.length,s=!1;return c=>p3(void 0,null,function*(){if(c&&(t=c,r=c.map(g=>g.id)),s)return t;const l=yield n(i),{pagination:d,data:h}=l;i=d.count+d.offset,s=i===d.total_count,h.forEach(g=>{const{id:b}=g;r.includes(b)||(t.push(g),r.push(b))});const m=[...t];return d.hasMoreGifs&&(m.skipCountCheck=eG),m})},qR;if(typeof LH<"u"){const{version:n}=VH();(qR=GS())!=null&&qR.get("X-GIPHY-SDK-NAME")||(Px("X-GIPHY-SDK-NAME","FetchAPI"),Px("X-GIPHY-SDK-VERSION",n))}var ui=function(){return ui=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},ui.apply(this,arguments)};function Of(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return n.concat(s||Array.prototype.slice.call(e))}var mn="-ms-",pf="-moz-",Kt="-webkit-",b3="comm",_0="rule",KS="decl",tG="@import",x3="@keyframes",nG="@layer",_3=Math.abs,WS=String.fromCharCode,Mx=Object.assign;function rG(n,e){return dr(n,0)^45?(((e<<2^dr(n,0))<<2^dr(n,1))<<2^dr(n,2))<<2^dr(n,3):0}function S3(n){return n.trim()}function ja(n,e){return(n=e.exec(n))?n[0]:n}function Tt(n,e,t){return n.replace(e,t)}function kg(n,e,t){return n.indexOf(e,t)}function dr(n,e){return n.charCodeAt(e)|0}function vd(n,e,t){return n.slice(e,t)}function Gs(n){return n.length}function T3(n){return n.length}function sf(n,e){return e.push(n),n}function iG(n,e){return n.map(e).join("")}function HR(n,e){return n.filter(function(t){return!ja(t,e)})}var S0=1,yd=1,k3=0,Ji=0,Jn=0,Od="";function T0(n,e,t,r,i,s,c,l){return{value:n,root:e,parent:t,type:r,props:i,children:s,line:S0,column:yd,length:c,return:"",siblings:l}}function Ko(n,e){return Mx(T0("",null,null,"",null,null,0,n.siblings),n,{length:-n.length},e)}function Au(n){for(;n.root;)n=Ko(n.root,{children:[n]});sf(n,n.siblings)}function sG(){return Jn}function aG(){return Jn=Ji>0?dr(Od,--Ji):0,yd--,Jn===10&&(yd=1,S0--),Jn}function ys(){return Jn=Ji<k3?dr(Od,Ji++):0,yd++,Jn===10&&(yd=1,S0++),Jn}function dl(){return dr(Od,Ji)}function Cg(){return Ji}function k0(n,e){return vd(Od,n,e)}function Dx(n){switch(n){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function oG(n){return S0=yd=1,k3=Gs(Od=n),Ji=0,[]}function cG(n){return Od="",n}function f1(n){return S3(k0(Ji-1,Ox(n===91?n+2:n===40?n+1:n)))}function lG(n){for(;(Jn=dl())&&Jn<33;)ys();return Dx(n)>2||Dx(Jn)>3?"":" "}function uG(n,e){for(;--e&&ys()&&!(Jn<48||Jn>102||Jn>57&&Jn<65||Jn>70&&Jn<97););return k0(n,Cg()+(e<6&&dl()==32&&ys()==32))}function Ox(n){for(;ys();)switch(Jn){case n:return Ji;case 34:case 39:n!==34&&n!==39&&Ox(Jn);break;case 40:n===41&&Ox(n);break;case 92:ys();break}return Ji}function dG(n,e){for(;ys()&&n+Jn!==57;)if(n+Jn===84&&dl()===47)break;return"/*"+k0(e,Ji-1)+"*"+WS(n===47?n:ys())}function hG(n){for(;!Dx(dl());)ys();return k0(n,Ji)}function fG(n){return cG(wg("",null,null,null,[""],n=oG(n),0,[0],n))}function wg(n,e,t,r,i,s,c,l,d){for(var h=0,m=0,g=c,b=0,_=0,R=0,E=1,A=1,M=1,F=0,j="",C=i,N=s,D=r,S=j;A;)switch(R=F,F=ys()){case 40:if(R!=108&&dr(S,g-1)==58){kg(S+=Tt(f1(F),"&","&\f"),"&\f",_3(h?l[h-1]:0))!=-1&&(M=-1);break}case 34:case 39:case 91:S+=f1(F);break;case 9:case 10:case 13:case 32:S+=lG(R);break;case 92:S+=uG(Cg()-1,7);continue;case 47:switch(dl()){case 42:case 47:sf(pG(dG(ys(),Cg()),e,t,d),d);break;default:S+="/"}break;case 123*E:l[h++]=Gs(S)*M;case 125*E:case 59:case 0:switch(F){case 0:case 125:A=0;case 59+m:M==-1&&(S=Tt(S,/\f/g,"")),_>0&&Gs(S)-g&&sf(_>32?KR(S+";",r,t,g-1,d):KR(Tt(S," ","")+";",r,t,g-2,d),d);break;case 59:S+=";";default:if(sf(D=GR(S,e,t,h,m,i,l,j,C=[],N=[],g,s),s),F===123)if(m===0)wg(S,e,D,D,C,s,g,l,N);else switch(b===99&&dr(S,3)===110?100:b){case 100:case 108:case 109:case 115:wg(n,D,D,r&&sf(GR(n,D,D,0,0,i,l,j,i,C=[],g,N),N),i,N,g,l,r?C:N);break;default:wg(S,D,D,D,[""],N,0,l,N)}}h=m=_=0,E=M=1,j=S="",g=c;break;case 58:g=1+Gs(S),_=R;default:if(E<1){if(F==123)--E;else if(F==125&&E++==0&&aG()==125)continue}switch(S+=WS(F),F*E){case 38:M=m>0?1:(S+="\f",-1);break;case 44:l[h++]=(Gs(S)-1)*M,M=1;break;case 64:dl()===45&&(S+=f1(ys())),b=dl(),m=g=Gs(j=S+=hG(Cg())),F++;break;case 45:R===45&&Gs(S)==2&&(E=0)}}return s}function GR(n,e,t,r,i,s,c,l,d,h,m,g){for(var b=i-1,_=i===0?s:[""],R=T3(_),E=0,A=0,M=0;E<r;++E)for(var F=0,j=vd(n,b+1,b=_3(A=c[E])),C=n;F<R;++F)(C=S3(A>0?_[F]+" "+j:Tt(j,/&\f/g,_[F])))&&(d[M++]=C);return T0(n,e,t,i===0?_0:l,d,h,m,g)}function pG(n,e,t,r){return T0(n,e,t,b3,WS(sG()),vd(n,2,-2),0,r)}function KR(n,e,t,r,i){return T0(n,e,t,KS,vd(n,0,r),vd(n,r+1,-1),r,i)}function C3(n,e,t){switch(rG(n,e)){case 5103:return Kt+"print-"+n+n;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return Kt+n+n;case 4789:return pf+n+n;case 5349:case 4246:case 4810:case 6968:case 2756:return Kt+n+pf+n+mn+n+n;case 5936:switch(dr(n,e+11)){case 114:return Kt+n+mn+Tt(n,/[svh]\w+-[tblr]{2}/,"tb")+n;case 108:return Kt+n+mn+Tt(n,/[svh]\w+-[tblr]{2}/,"tb-rl")+n;case 45:return Kt+n+mn+Tt(n,/[svh]\w+-[tblr]{2}/,"lr")+n}case 6828:case 4268:case 2903:return Kt+n+mn+n+n;case 6165:return Kt+n+mn+"flex-"+n+n;case 5187:return Kt+n+Tt(n,/(\w+).+(:[^]+)/,Kt+"box-$1$2"+mn+"flex-$1$2")+n;case 5443:return Kt+n+mn+"flex-item-"+Tt(n,/flex-|-self/g,"")+(ja(n,/flex-|baseline/)?"":mn+"grid-row-"+Tt(n,/flex-|-self/g,""))+n;case 4675:return Kt+n+mn+"flex-line-pack"+Tt(n,/align-content|flex-|-self/g,"")+n;case 5548:return Kt+n+mn+Tt(n,"shrink","negative")+n;case 5292:return Kt+n+mn+Tt(n,"basis","preferred-size")+n;case 6060:return Kt+"box-"+Tt(n,"-grow","")+Kt+n+mn+Tt(n,"grow","positive")+n;case 4554:return Kt+Tt(n,/([^-])(transform)/g,"$1"+Kt+"$2")+n;case 6187:return Tt(Tt(Tt(n,/(zoom-|grab)/,Kt+"$1"),/(image-set)/,Kt+"$1"),n,"")+n;case 5495:case 3959:return Tt(n,/(image-set\([^]*)/,Kt+"$1$`$1");case 4968:return Tt(Tt(n,/(.+:)(flex-)?(.*)/,Kt+"box-pack:$3"+mn+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+Kt+n+n;case 4200:if(!ja(n,/flex-|baseline/))return mn+"grid-column-align"+vd(n,e)+n;break;case 2592:case 3360:return mn+Tt(n,"template-","")+n;case 4384:case 3616:return t&&t.some(function(r,i){return e=i,ja(r.props,/grid-\w+-end/)})?~kg(n+(t=t[e].value),"span",0)?n:mn+Tt(n,"-start","")+n+mn+"grid-row-span:"+(~kg(t,"span",0)?ja(t,/\d+/):+ja(t,/\d+/)-+ja(n,/\d+/))+";":mn+Tt(n,"-start","")+n;case 4896:case 4128:return t&&t.some(function(r){return ja(r.props,/grid-\w+-start/)})?n:mn+Tt(Tt(n,"-end","-span"),"span ","")+n;case 4095:case 3583:case 4068:case 2532:return Tt(n,/(.+)-inline(.+)/,Kt+"$1$2")+n;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Gs(n)-1-e>6)switch(dr(n,e+1)){case 109:if(dr(n,e+4)!==45)break;case 102:return Tt(n,/(.+:)(.+)-([^]+)/,"$1"+Kt+"$2-$3$1"+pf+(dr(n,e+3)==108?"$3":"$2-$3"))+n;case 115:return~kg(n,"stretch",0)?C3(Tt(n,"stretch","fill-available"),e,t)+n:n}break;case 5152:case 5920:return Tt(n,/(.+?):(\d+)(\s*\/\s*(span)?\s*(\d+))?(.*)/,function(r,i,s,c,l,d,h){return mn+i+":"+s+h+(c?mn+i+"-span:"+(l?d:+d-+s)+h:"")+n});case 4949:if(dr(n,e+6)===121)return Tt(n,":",":"+Kt)+n;break;case 6444:switch(dr(n,dr(n,14)===45?18:11)){case 120:return Tt(n,/(.+:)([^;\s!]+)(;|(\s+)?!.+)?/,"$1"+Kt+(dr(n,14)===45?"inline-":"")+"box$3$1"+Kt+"$2$3$1"+mn+"$2box$3")+n;case 100:return Tt(n,":",":"+mn)+n}break;case 5719:case 2647:case 2135:case 3927:case 2391:return Tt(n,"scroll-","scroll-snap-")+n}return n}function Tv(n,e){for(var t="",r=0;r<n.length;r++)t+=e(n[r],r,n,e)||"";return t}function mG(n,e,t,r){switch(n.type){case nG:if(n.children.length)break;case tG:case KS:return n.return=n.return||n.value;case b3:return"";case x3:return n.return=n.value+"{"+Tv(n.children,r)+"}";case _0:if(!Gs(n.value=n.props.join(",")))return""}return Gs(t=Tv(n.children,r))?n.return=n.value+"{"+t+"}":""}function gG(n){var e=T3(n);return function(t,r,i,s){for(var c="",l=0;l<e;l++)c+=n[l](t,r,i,s)||"";return c}}function vG(n){return function(e){e.root||(e=e.return)&&n(e)}}function yG(n,e,t,r){if(n.length>-1&&!n.return)switch(n.type){case KS:n.return=C3(n.value,n.length,t);return;case x3:return Tv([Ko(n,{value:Tt(n.value,"@","@"+Kt)})],r);case _0:if(n.length)return iG(t=n.props,function(i){switch(ja(i,r=/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":Au(Ko(n,{props:[Tt(i,/:(read-\w+)/,":"+pf+"$1")]})),Au(Ko(n,{props:[i]})),Mx(n,{props:HR(t,r)});break;case"::placeholder":Au(Ko(n,{props:[Tt(i,/:(plac\w+)/,":"+Kt+"input-$1")]})),Au(Ko(n,{props:[Tt(i,/:(plac\w+)/,":"+pf+"$1")]})),Au(Ko(n,{props:[Tt(i,/:(plac\w+)/,mn+"input-$1")]})),Au(Ko(n,{props:[i]})),Mx(n,{props:HR(t,r)});break}return""})}}var bG={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},wi={},bd=typeof process<"u"&&wi!==void 0&&(wi.REACT_APP_SC_ATTR||wi.SC_ATTR)||"data-styled",w3="active",E3="data-styled-version",C0="6.1.19",YS=`/*!sc*/
`,kv=typeof window<"u"&&typeof document<"u",xG=!!(typeof SC_DISABLE_SPEEDY=="boolean"?SC_DISABLE_SPEEDY:typeof process<"u"&&wi!==void 0&&wi.REACT_APP_SC_DISABLE_SPEEDY!==void 0&&wi.REACT_APP_SC_DISABLE_SPEEDY!==""?wi.REACT_APP_SC_DISABLE_SPEEDY!=="false"&&wi.REACT_APP_SC_DISABLE_SPEEDY:typeof process<"u"&&wi!==void 0&&wi.SC_DISABLE_SPEEDY!==void 0&&wi.SC_DISABLE_SPEEDY!==""&&wi.SC_DISABLE_SPEEDY!=="false"&&wi.SC_DISABLE_SPEEDY),w0=Object.freeze([]),xd=Object.freeze({});function _G(n,e,t){return t===void 0&&(t=xd),n.theme!==t.theme&&n.theme||e||t.theme}var R3=new Set(["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","tr","track","u","ul","use","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","marker","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"]),SG=/[!"#$%&'()*+,./:;<=>?@[\\\]^`{|}~-]+/g,TG=/(^-|-$)/g;function WR(n){return n.replace(SG,"-").replace(TG,"")}var kG=/(a)(d)/gi,Ym=52,YR=function(n){return String.fromCharCode(n+(n>25?39:97))};function jx(n){var e,t="";for(e=Math.abs(n);e>Ym;e=e/Ym|0)t=YR(e%Ym)+t;return(YR(e%Ym)+t).replace(kG,"$1-$2")}var p1,A3=5381,Vu=function(n,e){for(var t=e.length;t;)n=33*n^e.charCodeAt(--t);return n},N3=function(n){return Vu(A3,n)};function I3(n){return jx(N3(n)>>>0)}function CG(n){return n.displayName||n.name||"Component"}function m1(n){return typeof n=="string"&&!0}var P3=typeof Symbol=="function"&&Symbol.for,M3=P3?Symbol.for("react.memo"):60115,wG=P3?Symbol.for("react.forward_ref"):60112,EG={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},RG={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},D3={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},AG=((p1={})[wG]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},p1[M3]=D3,p1);function QR(n){return("type"in(e=n)&&e.type.$$typeof)===M3?D3:"$$typeof"in n?AG[n.$$typeof]:EG;var e}var NG=Object.defineProperty,IG=Object.getOwnPropertyNames,XR=Object.getOwnPropertySymbols,PG=Object.getOwnPropertyDescriptor,MG=Object.getPrototypeOf,JR=Object.prototype;function O3(n,e,t){if(typeof e!="string"){if(JR){var r=MG(e);r&&r!==JR&&O3(n,r,t)}var i=IG(e);XR&&(i=i.concat(XR(e)));for(var s=QR(n),c=QR(e),l=0;l<i.length;++l){var d=i[l];if(!(d in RG||t&&t[d]||c&&d in c||s&&d in s)){var h=PG(e,d);try{NG(n,d,h)}catch{}}}}return n}function _d(n){return typeof n=="function"}function QS(n){return typeof n=="object"&&"styledComponentId"in n}function cl(n,e){return n&&e?"".concat(n," ").concat(e):n||e||""}function Lx(n,e){if(n.length===0)return"";for(var t=n[0],r=1;r<n.length;r++)t+=n[r];return t}function jf(n){return n!==null&&typeof n=="object"&&n.constructor.name===Object.name&&!("props"in n&&n.$$typeof)}function Ux(n,e,t){if(t===void 0&&(t=!1),!t&&!jf(n)&&!Array.isArray(n))return e;if(Array.isArray(e))for(var r=0;r<e.length;r++)n[r]=Ux(n[r],e[r]);else if(jf(e))for(var r in e)n[r]=Ux(n[r],e[r]);return n}function XS(n,e){Object.defineProperty(n,"toString",{value:e})}function hp(n){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];return new Error("An error occurred. See https://github.com/styled-components/styled-components/blob/main/packages/styled-components/src/utils/errors.md#".concat(n," for more information.").concat(e.length>0?" Args: ".concat(e.join(", ")):""))}var DG=(function(){function n(e){this.groupSizes=new Uint32Array(512),this.length=512,this.tag=e}return n.prototype.indexOfGroup=function(e){for(var t=0,r=0;r<e;r++)t+=this.groupSizes[r];return t},n.prototype.insertRules=function(e,t){if(e>=this.groupSizes.length){for(var r=this.groupSizes,i=r.length,s=i;e>=s;)if((s<<=1)<0)throw hp(16,"".concat(e));this.groupSizes=new Uint32Array(s),this.groupSizes.set(r),this.length=s;for(var c=i;c<s;c++)this.groupSizes[c]=0}for(var l=this.indexOfGroup(e+1),d=(c=0,t.length);c<d;c++)this.tag.insertRule(l,t[c])&&(this.groupSizes[e]++,l++)},n.prototype.clearGroup=function(e){if(e<this.length){var t=this.groupSizes[e],r=this.indexOfGroup(e),i=r+t;this.groupSizes[e]=0;for(var s=r;s<i;s++)this.tag.deleteRule(r)}},n.prototype.getGroup=function(e){var t="";if(e>=this.length||this.groupSizes[e]===0)return t;for(var r=this.groupSizes[e],i=this.indexOfGroup(e),s=i+r,c=i;c<s;c++)t+="".concat(this.tag.getRule(c)).concat(YS);return t},n})(),Eg=new Map,Cv=new Map,Rg=1,Qm=function(n){if(Eg.has(n))return Eg.get(n);for(;Cv.has(Rg);)Rg++;var e=Rg++;return Eg.set(n,e),Cv.set(e,n),e},OG=function(n,e){Rg=e+1,Eg.set(n,e),Cv.set(e,n)},jG="style[".concat(bd,"][").concat(E3,'="').concat(C0,'"]'),LG=new RegExp("^".concat(bd,'\\.g(\\d+)\\[id="([\\w\\d-]+)"\\].*?"([^"]*)')),UG=function(n,e,t){for(var r,i=t.split(","),s=0,c=i.length;s<c;s++)(r=i[s])&&n.registerName(e,r)},VG=function(n,e){for(var t,r=((t=e.textContent)!==null&&t!==void 0?t:"").split(YS),i=[],s=0,c=r.length;s<c;s++){var l=r[s].trim();if(l){var d=l.match(LG);if(d){var h=0|parseInt(d[1],10),m=d[2];h!==0&&(OG(m,h),UG(n,m,d[3]),n.getTag().insertRules(h,i)),i.length=0}else i.push(l)}}},ZR=function(n){for(var e=document.querySelectorAll(jG),t=0,r=e.length;t<r;t++){var i=e[t];i&&i.getAttribute(bd)!==w3&&(VG(n,i),i.parentNode&&i.parentNode.removeChild(i))}};function zG(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:null}var j3=function(n){var e=document.head,t=n||e,r=document.createElement("style"),i=(function(l){var d=Array.from(l.querySelectorAll("style[".concat(bd,"]")));return d[d.length-1]})(t),s=i!==void 0?i.nextSibling:null;r.setAttribute(bd,w3),r.setAttribute(E3,C0);var c=zG();return c&&r.setAttribute("nonce",c),t.insertBefore(r,s),r},FG=(function(){function n(e){this.element=j3(e),this.element.appendChild(document.createTextNode("")),this.sheet=(function(t){if(t.sheet)return t.sheet;for(var r=document.styleSheets,i=0,s=r.length;i<s;i++){var c=r[i];if(c.ownerNode===t)return c}throw hp(17)})(this.element),this.length=0}return n.prototype.insertRule=function(e,t){try{return this.sheet.insertRule(t,e),this.length++,!0}catch{return!1}},n.prototype.deleteRule=function(e){this.sheet.deleteRule(e),this.length--},n.prototype.getRule=function(e){var t=this.sheet.cssRules[e];return t&&t.cssText?t.cssText:""},n})(),BG=(function(){function n(e){this.element=j3(e),this.nodes=this.element.childNodes,this.length=0}return n.prototype.insertRule=function(e,t){if(e<=this.length&&e>=0){var r=document.createTextNode(t);return this.element.insertBefore(r,this.nodes[e]||null),this.length++,!0}return!1},n.prototype.deleteRule=function(e){this.element.removeChild(this.nodes[e]),this.length--},n.prototype.getRule=function(e){return e<this.length?this.nodes[e].textContent:""},n})(),$G=(function(){function n(e){this.rules=[],this.length=0}return n.prototype.insertRule=function(e,t){return e<=this.length&&(this.rules.splice(e,0,t),this.length++,!0)},n.prototype.deleteRule=function(e){this.rules.splice(e,1),this.length--},n.prototype.getRule=function(e){return e<this.length?this.rules[e]:""},n})(),e4=kv,qG={isServer:!kv,useCSSOMInjection:!xG},L3=(function(){function n(e,t,r){e===void 0&&(e=xd),t===void 0&&(t={});var i=this;this.options=ui(ui({},qG),e),this.gs=t,this.names=new Map(r),this.server=!!e.isServer,!this.server&&kv&&e4&&(e4=!1,ZR(this)),XS(this,function(){return(function(s){for(var c=s.getTag(),l=c.length,d="",h=function(g){var b=(function(M){return Cv.get(M)})(g);if(b===void 0)return"continue";var _=s.names.get(b),R=c.getGroup(g);if(_===void 0||!_.size||R.length===0)return"continue";var E="".concat(bd,".g").concat(g,'[id="').concat(b,'"]'),A="";_!==void 0&&_.forEach(function(M){M.length>0&&(A+="".concat(M,","))}),d+="".concat(R).concat(E,'{content:"').concat(A,'"}').concat(YS)},m=0;m<l;m++)h(m);return d})(i)})}return n.registerId=function(e){return Qm(e)},n.prototype.rehydrate=function(){!this.server&&kv&&ZR(this)},n.prototype.reconstructWithOptions=function(e,t){return t===void 0&&(t=!0),new n(ui(ui({},this.options),e),this.gs,t&&this.names||void 0)},n.prototype.allocateGSInstance=function(e){return this.gs[e]=(this.gs[e]||0)+1},n.prototype.getTag=function(){return this.tag||(this.tag=(e=(function(t){var r=t.useCSSOMInjection,i=t.target;return t.isServer?new $G(i):r?new FG(i):new BG(i)})(this.options),new DG(e)));var e},n.prototype.hasNameForId=function(e,t){return this.names.has(e)&&this.names.get(e).has(t)},n.prototype.registerName=function(e,t){if(Qm(e),this.names.has(e))this.names.get(e).add(t);else{var r=new Set;r.add(t),this.names.set(e,r)}},n.prototype.insertRules=function(e,t,r){this.registerName(e,t),this.getTag().insertRules(Qm(e),r)},n.prototype.clearNames=function(e){this.names.has(e)&&this.names.get(e).clear()},n.prototype.clearRules=function(e){this.getTag().clearGroup(Qm(e)),this.clearNames(e)},n.prototype.clearTag=function(){this.tag=void 0},n})(),HG=/&/g,GG=/^\s*\/\/.*$/gm;function U3(n,e){return n.map(function(t){return t.type==="rule"&&(t.value="".concat(e," ").concat(t.value),t.value=t.value.replaceAll(",",",".concat(e," ")),t.props=t.props.map(function(r){return"".concat(e," ").concat(r)})),Array.isArray(t.children)&&t.type!=="@keyframes"&&(t.children=U3(t.children,e)),t})}function KG(n){var e,t,r,i=xd,s=i.options,c=s===void 0?xd:s,l=i.plugins,d=l===void 0?w0:l,h=function(b,_,R){return R.startsWith(t)&&R.endsWith(t)&&R.replaceAll(t,"").length>0?".".concat(e):b},m=d.slice();m.push(function(b){b.type===_0&&b.value.includes("&")&&(b.props[0]=b.props[0].replace(HG,t).replace(r,h))}),c.prefix&&m.push(yG),m.push(mG);var g=function(b,_,R,E){_===void 0&&(_=""),R===void 0&&(R=""),E===void 0&&(E="&"),e=E,t=_,r=new RegExp("\\".concat(t,"\\b"),"g");var A=b.replace(GG,""),M=fG(R||_?"".concat(R," ").concat(_," { ").concat(A," }"):A);c.namespace&&(M=U3(M,c.namespace));var F=[];return Tv(M,gG(m.concat(vG(function(j){return F.push(j)})))),F};return g.hash=d.length?d.reduce(function(b,_){return _.name||hp(15),Vu(b,_.name)},A3).toString():"",g}var WG=new L3,Vx=KG(),V3=be.createContext({shouldForwardProp:void 0,styleSheet:WG,stylis:Vx});V3.Consumer;be.createContext(void 0);function t4(){return T.useContext(V3)}var z3=(function(){function n(e,t){var r=this;this.inject=function(i,s){s===void 0&&(s=Vx);var c=r.name+s.hash;i.hasNameForId(r.id,c)||i.insertRules(r.id,c,s(r.rules,c,"@keyframes"))},this.name=e,this.id="sc-keyframes-".concat(e),this.rules=t,XS(this,function(){throw hp(12,String(r.name))})}return n.prototype.getName=function(e){return e===void 0&&(e=Vx),this.name+e.hash},n})(),YG=function(n){return n>="A"&&n<="Z"};function n4(n){for(var e="",t=0;t<n.length;t++){var r=n[t];if(t===1&&r==="-"&&n[0]==="-")return n;YG(r)?e+="-"+r.toLowerCase():e+=r}return e.startsWith("ms-")?"-"+e:e}var F3=function(n){return n==null||n===!1||n===""},B3=function(n){var e,t,r=[];for(var i in n){var s=n[i];n.hasOwnProperty(i)&&!F3(s)&&(Array.isArray(s)&&s.isCss||_d(s)?r.push("".concat(n4(i),":"),s,";"):jf(s)?r.push.apply(r,Of(Of(["".concat(i," {")],B3(s),!1),["}"],!1)):r.push("".concat(n4(i),": ").concat((e=i,(t=s)==null||typeof t=="boolean"||t===""?"":typeof t!="number"||t===0||e in bG||e.startsWith("--")?String(t).trim():"".concat(t,"px")),";")))}return r};function hl(n,e,t,r){if(F3(n))return[];if(QS(n))return[".".concat(n.styledComponentId)];if(_d(n)){if(!_d(s=n)||s.prototype&&s.prototype.isReactComponent||!e)return[n];var i=n(e);return hl(i,e,t,r)}var s;return n instanceof z3?t?(n.inject(t,r),[n.getName(r)]):[n]:jf(n)?B3(n):Array.isArray(n)?Array.prototype.concat.apply(w0,n.map(function(c){return hl(c,e,t,r)})):[n.toString()]}function QG(n){for(var e=0;e<n.length;e+=1){var t=n[e];if(_d(t)&&!QS(t))return!1}return!0}var XG=N3(C0),JG=(function(){function n(e,t,r){this.rules=e,this.staticRulesId="",this.isStatic=(r===void 0||r.isStatic)&&QG(e),this.componentId=t,this.baseHash=Vu(XG,t),this.baseStyle=r,L3.registerId(t)}return n.prototype.generateAndInjectStyles=function(e,t,r){var i=this.baseStyle?this.baseStyle.generateAndInjectStyles(e,t,r):"";if(this.isStatic&&!r.hash)if(this.staticRulesId&&t.hasNameForId(this.componentId,this.staticRulesId))i=cl(i,this.staticRulesId);else{var s=Lx(hl(this.rules,e,t,r)),c=jx(Vu(this.baseHash,s)>>>0);if(!t.hasNameForId(this.componentId,c)){var l=r(s,".".concat(c),void 0,this.componentId);t.insertRules(this.componentId,c,l)}i=cl(i,c),this.staticRulesId=c}else{for(var d=Vu(this.baseHash,r.hash),h="",m=0;m<this.rules.length;m++){var g=this.rules[m];if(typeof g=="string")h+=g;else if(g){var b=Lx(hl(g,e,t,r));d=Vu(d,b+m),h+=b}}if(h){var _=jx(d>>>0);t.hasNameForId(this.componentId,_)||t.insertRules(this.componentId,_,r(h,".".concat(_),void 0,this.componentId)),i=cl(i,_)}}return i},n})(),$3=be.createContext(void 0);$3.Consumer;var g1={};function ZG(n,e,t){var r=QS(n),i=n,s=!m1(n),c=e.attrs,l=c===void 0?w0:c,d=e.componentId,h=d===void 0?(function(C,N){var D=typeof C!="string"?"sc":WR(C);g1[D]=(g1[D]||0)+1;var S="".concat(D,"-").concat(I3(C0+D+g1[D]));return N?"".concat(N,"-").concat(S):S})(e.displayName,e.parentComponentId):d,m=e.displayName,g=m===void 0?(function(C){return m1(C)?"styled.".concat(C):"Styled(".concat(CG(C),")")})(n):m,b=e.displayName&&e.componentId?"".concat(WR(e.displayName),"-").concat(e.componentId):e.componentId||h,_=r&&i.attrs?i.attrs.concat(l).filter(Boolean):l,R=e.shouldForwardProp;if(r&&i.shouldForwardProp){var E=i.shouldForwardProp;if(e.shouldForwardProp){var A=e.shouldForwardProp;R=function(C,N){return E(C,N)&&A(C,N)}}else R=E}var M=new JG(t,b,r?i.componentStyle:void 0);function F(C,N){return(function(D,S,k){var P=D.attrs,L=D.componentStyle,U=D.defaultProps,z=D.foldedComponentIds,V=D.styledComponentId,le=D.target,ve=be.useContext($3),K=t4(),oe=D.shouldForwardProp||K.shouldForwardProp,ee=_G(S,ve,U)||xd,Me=(function(Oe,Te,we){for(var Ge,Ke=ui(ui({},Te),{className:void 0,theme:we}),Ce=0;Ce<Oe.length;Ce+=1){var Re=_d(Ge=Oe[Ce])?Ge(Ke):Ge;for(var He in Re)Ke[He]=He==="className"?cl(Ke[He],Re[He]):He==="style"?ui(ui({},Ke[He]),Re[He]):Re[He]}return Te.className&&(Ke.className=cl(Ke.className,Te.className)),Ke})(P,S,ee),je=Me.as||le,q={};for(var te in Me)Me[te]===void 0||te[0]==="$"||te==="as"||te==="theme"&&Me.theme===ee||(te==="forwardedAs"?q.as=Me.forwardedAs:oe&&!oe(te,je)||(q[te]=Me[te]));var fe=(function(Oe,Te){var we=t4(),Ge=Oe.generateAndInjectStyles(Te,we.styleSheet,we.stylis);return Ge})(L,Me),Se=cl(z,V);return fe&&(Se+=" "+fe),Me.className&&(Se+=" "+Me.className),q[m1(je)&&!R3.has(je)?"class":"className"]=Se,k&&(q.ref=k),T.createElement(je,q)})(j,C,N)}F.displayName=g;var j=be.forwardRef(F);return j.attrs=_,j.componentStyle=M,j.displayName=g,j.shouldForwardProp=R,j.foldedComponentIds=r?cl(i.foldedComponentIds,i.styledComponentId):"",j.styledComponentId=b,j.target=r?i.target:n,Object.defineProperty(j,"defaultProps",{get:function(){return this._foldedDefaultProps},set:function(C){this._foldedDefaultProps=r?(function(N){for(var D=[],S=1;S<arguments.length;S++)D[S-1]=arguments[S];for(var k=0,P=D;k<P.length;k++)Ux(N,P[k],!0);return N})({},i.defaultProps,C):C}}),XS(j,function(){return".".concat(j.styledComponentId)}),s&&O3(j,n,{attrs:!0,componentStyle:!0,displayName:!0,foldedComponentIds:!0,shouldForwardProp:!0,styledComponentId:!0,target:!0}),j}function r4(n,e){for(var t=[n[0]],r=0,i=e.length;r<i;r+=1)t.push(e[r],n[r+1]);return t}var i4=function(n){return Object.assign(n,{isCss:!0})};function E0(n){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];if(_d(n)||jf(n))return i4(hl(r4(w0,Of([n],e,!0))));var r=n;return e.length===0&&r.length===1&&typeof r[0]=="string"?hl(r):i4(hl(r4(r,e)))}function zx(n,e,t){if(t===void 0&&(t=xd),!e)throw hp(1,e);var r=function(i){for(var s=[],c=1;c<arguments.length;c++)s[c-1]=arguments[c];return n(e,t,E0.apply(void 0,Of([i],s,!1)))};return r.attrs=function(i){return zx(n,e,ui(ui({},t),{attrs:Array.prototype.concat(t.attrs,i).filter(Boolean)}))},r.withConfig=function(i){return zx(n,e,ui(ui({},t),i))},r}var q3=function(n){return zx(ZG,n)},it=q3;R3.forEach(function(n){it[n]=q3(n)});function fp(n){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];var r=Lx(E0.apply(void 0,Of([n],e,!1))),i=I3(r);return new z3(i,r)}var Fx="#121212",H3="#212121",eK="#3e3e3e",tK="#4a4a4a",G3="#a6a6a6",nK="#ececec",Ag="#ffffff",JS="#00ccff",K3="#00ff99",W3="#9933ff",Y3="#ff6666",Q3="#fff35c",rK="#6157ff";function s4(n,e,t,r){var i,s=!1,c=0;function l(){i&&clearTimeout(i)}function d(){l(),s=!0}typeof e!="boolean"&&(r=t,t=e,e=void 0);function h(){for(var m=arguments.length,g=new Array(m),b=0;b<m;b++)g[b]=arguments[b];var _=this,R=Date.now()-c;if(s)return;function E(){c=Date.now(),t.apply(_,g)}function A(){i=void 0}r&&!i&&E(),l(),r===void 0&&R>n?E():e!==!0&&(i=setTimeout(r?A:E,r===void 0?n-R:n))}return h.cancel=d,h}function ZS(n,e,t){return t===void 0?s4(n,e,!1):s4(n,t,e!==!1)}var a4={},o4;function iK(){return o4||(o4=1,(function(){if(typeof window!="object")return;if("IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype){"isIntersecting"in window.IntersectionObserverEntry.prototype||Object.defineProperty(window.IntersectionObserverEntry.prototype,"isIntersecting",{get:function(){return this.intersectionRatio>0}});return}function n(j){try{return j.defaultView&&j.defaultView.frameElement||null}catch{return null}}var e=(function(j){for(var C=j,N=n(C);N;)C=N.ownerDocument,N=n(C);return C})(window.document),t=[],r=null,i=null;function s(j){this.time=j.time,this.target=j.target,this.rootBounds=R(j.rootBounds),this.boundingClientRect=R(j.boundingClientRect),this.intersectionRect=R(j.intersectionRect||_()),this.isIntersecting=!!j.intersectionRect;var C=this.boundingClientRect,N=C.width*C.height,D=this.intersectionRect,S=D.width*D.height;N?this.intersectionRatio=Number((S/N).toFixed(4)):this.intersectionRatio=this.isIntersecting?1:0}function c(j,C){var N=C||{};if(typeof j!="function")throw new Error("callback must be a function");if(N.root&&N.root.nodeType!=1&&N.root.nodeType!=9)throw new Error("root must be a Document or Element");this._checkForIntersections=d(this._checkForIntersections.bind(this),this.THROTTLE_TIMEOUT),this._callback=j,this._observationTargets=[],this._queuedEntries=[],this._rootMarginValues=this._parseRootMargin(N.rootMargin),this.thresholds=this._initThresholds(N.threshold),this.root=N.root||null,this.rootMargin=this._rootMarginValues.map(function(D){return D.value+D.unit}).join(" "),this._monitoringDocuments=[],this._monitoringUnsubscribes=[]}c.prototype.THROTTLE_TIMEOUT=100,c.prototype.POLL_INTERVAL=null,c.prototype.USE_MUTATION_OBSERVER=!0,c._setupCrossOriginUpdater=function(){return r||(r=function(j,C){!j||!C?i=_():i=E(j,C),t.forEach(function(N){N._checkForIntersections()})}),r},c._resetCrossOriginUpdater=function(){r=null,i=null},c.prototype.observe=function(j){var C=this._observationTargets.some(function(N){return N.element==j});if(!C){if(!(j&&j.nodeType==1))throw new Error("target must be an Element");this._registerInstance(),this._observationTargets.push({element:j,entry:null}),this._monitorIntersections(j.ownerDocument),this._checkForIntersections()}},c.prototype.unobserve=function(j){this._observationTargets=this._observationTargets.filter(function(C){return C.element!=j}),this._unmonitorIntersections(j.ownerDocument),this._observationTargets.length==0&&this._unregisterInstance()},c.prototype.disconnect=function(){this._observationTargets=[],this._unmonitorAllIntersections(),this._unregisterInstance()},c.prototype.takeRecords=function(){var j=this._queuedEntries.slice();return this._queuedEntries=[],j},c.prototype._initThresholds=function(j){var C=j||[0];return Array.isArray(C)||(C=[C]),C.sort().filter(function(N,D,S){if(typeof N!="number"||isNaN(N)||N<0||N>1)throw new Error("threshold must be a number between 0 and 1 inclusively");return N!==S[D-1]})},c.prototype._parseRootMargin=function(j){var C=j||"0px",N=C.split(/\s+/).map(function(D){var S=/^(-?\d*\.?\d+)(px|%)$/.exec(D);if(!S)throw new Error("rootMargin must be specified in pixels or percent");return{value:parseFloat(S[1]),unit:S[2]}});return N[1]=N[1]||N[0],N[2]=N[2]||N[0],N[3]=N[3]||N[1],N},c.prototype._monitorIntersections=function(j){var C=j.defaultView;if(C&&this._monitoringDocuments.indexOf(j)==-1){var N=this._checkForIntersections,D=null,S=null;this.POLL_INTERVAL?D=C.setInterval(N,this.POLL_INTERVAL):(h(C,"resize",N,!0),h(j,"scroll",N,!0),this.USE_MUTATION_OBSERVER&&"MutationObserver"in C&&(S=new C.MutationObserver(N),S.observe(j,{attributes:!0,childList:!0,characterData:!0,subtree:!0}))),this._monitoringDocuments.push(j),this._monitoringUnsubscribes.push(function(){var L=j.defaultView;L&&(D&&L.clearInterval(D),m(L,"resize",N,!0)),m(j,"scroll",N,!0),S&&S.disconnect()});var k=this.root&&(this.root.ownerDocument||this.root)||e;if(j!=k){var P=n(j);P&&this._monitorIntersections(P.ownerDocument)}}},c.prototype._unmonitorIntersections=function(j){var C=this._monitoringDocuments.indexOf(j);if(C!=-1){var N=this.root&&(this.root.ownerDocument||this.root)||e,D=this._observationTargets.some(function(P){var L=P.element.ownerDocument;if(L==j)return!0;for(;L&&L!=N;){var U=n(L);if(L=U&&U.ownerDocument,L==j)return!0}return!1});if(!D){var S=this._monitoringUnsubscribes[C];if(this._monitoringDocuments.splice(C,1),this._monitoringUnsubscribes.splice(C,1),S(),j!=N){var k=n(j);k&&this._unmonitorIntersections(k.ownerDocument)}}}},c.prototype._unmonitorAllIntersections=function(){var j=this._monitoringUnsubscribes.slice(0);this._monitoringDocuments.length=0,this._monitoringUnsubscribes.length=0;for(var C=0;C<j.length;C++)j[C]()},c.prototype._checkForIntersections=function(){if(!(!this.root&&r&&!i)){var j=this._rootIsInDom(),C=j?this._getRootRect():_();this._observationTargets.forEach(function(N){var D=N.element,S=b(D),k=this._rootContainsTarget(D),P=N.entry,L=j&&k&&this._computeTargetAndRootIntersection(D,S,C),U=null;this._rootContainsTarget(D)?(!r||this.root)&&(U=C):U=_();var z=N.entry=new s({time:l(),target:D,boundingClientRect:S,rootBounds:U,intersectionRect:L});P?j&&k?this._hasCrossedThreshold(P,z)&&this._queuedEntries.push(z):P&&P.isIntersecting&&this._queuedEntries.push(z):this._queuedEntries.push(z)},this),this._queuedEntries.length&&this._callback(this.takeRecords(),this)}},c.prototype._computeTargetAndRootIntersection=function(j,C,N){if(window.getComputedStyle(j).display!="none"){for(var D=C,S=M(j),k=!1;!k&&S;){var P=null,L=S.nodeType==1?window.getComputedStyle(S):{};if(L.display=="none")return null;if(S==this.root||S.nodeType==9)if(k=!0,S==this.root||S==e)r&&!this.root?!i||i.width==0&&i.height==0?(S=null,P=null,D=null):P=i:P=N;else{var U=M(S),z=U&&b(U),V=U&&this._computeTargetAndRootIntersection(U,z,N);z&&V?(S=U,P=E(z,V)):(S=null,D=null)}else{var le=S.ownerDocument;S!=le.body&&S!=le.documentElement&&L.overflow!="visible"&&(P=b(S))}if(P&&(D=g(P,D)),!D)break;S=S&&M(S)}return D}},c.prototype._getRootRect=function(){var j;if(this.root&&!F(this.root))j=b(this.root);else{var C=F(this.root)?this.root:e,N=C.documentElement,D=C.body;j={top:0,left:0,right:N.clientWidth||D.clientWidth,width:N.clientWidth||D.clientWidth,bottom:N.clientHeight||D.clientHeight,height:N.clientHeight||D.clientHeight}}return this._expandRectByRootMargin(j)},c.prototype._expandRectByRootMargin=function(j){var C=this._rootMarginValues.map(function(D,S){return D.unit=="px"?D.value:D.value*(S%2?j.width:j.height)/100}),N={top:j.top-C[0],right:j.right+C[1],bottom:j.bottom+C[2],left:j.left-C[3]};return N.width=N.right-N.left,N.height=N.bottom-N.top,N},c.prototype._hasCrossedThreshold=function(j,C){var N=j&&j.isIntersecting?j.intersectionRatio||0:-1,D=C.isIntersecting?C.intersectionRatio||0:-1;if(N!==D)for(var S=0;S<this.thresholds.length;S++){var k=this.thresholds[S];if(k==N||k==D||k<N!=k<D)return!0}},c.prototype._rootIsInDom=function(){return!this.root||A(e,this.root)},c.prototype._rootContainsTarget=function(j){var C=this.root&&(this.root.ownerDocument||this.root)||e;return A(C,j)&&(!this.root||C==j.ownerDocument)},c.prototype._registerInstance=function(){t.indexOf(this)<0&&t.push(this)},c.prototype._unregisterInstance=function(){var j=t.indexOf(this);j!=-1&&t.splice(j,1)};function l(){return window.performance&&performance.now&&performance.now()}function d(j,C){var N=null;return function(){N||(N=setTimeout(function(){j(),N=null},C))}}function h(j,C,N,D){typeof j.addEventListener=="function"?j.addEventListener(C,N,D):typeof j.attachEvent=="function"&&j.attachEvent("on"+C,N)}function m(j,C,N,D){typeof j.removeEventListener=="function"?j.removeEventListener(C,N,D):typeof j.detachEvent=="function"&&j.detachEvent("on"+C,N)}function g(j,C){var N=Math.max(j.top,C.top),D=Math.min(j.bottom,C.bottom),S=Math.max(j.left,C.left),k=Math.min(j.right,C.right),P=k-S,L=D-N;return P>=0&&L>=0&&{top:N,bottom:D,left:S,right:k,width:P,height:L}||null}function b(j){var C;try{C=j.getBoundingClientRect()}catch{}return C?(C.width&&C.height||(C={top:C.top,right:C.right,bottom:C.bottom,left:C.left,width:C.right-C.left,height:C.bottom-C.top}),C):_()}function _(){return{top:0,bottom:0,left:0,right:0,width:0,height:0}}function R(j){return!j||"x"in j?j:{top:j.top,y:j.top,bottom:j.bottom,left:j.left,x:j.left,right:j.right,width:j.width,height:j.height}}function E(j,C){var N=C.top-j.top,D=C.left-j.left;return{top:N,left:D,height:C.height,width:C.width,bottom:N+C.height,right:D+C.width}}function A(j,C){for(var N=C;N;){if(N==j)return!0;N=M(N)}return!1}function M(j){var C=j.parentNode;return j.nodeType==9&&j!=e?n(j):(C&&C.assignedSlot&&(C=C.assignedSlot.parentNode),C&&C.nodeType==11&&C.host?C.host:C)}function F(j){return j&&j.nodeType===9}window.IntersectionObserver=c,window.IntersectionObserverEntry=s})()),a4}iK();var sK=Object.defineProperty,c4=Object.getOwnPropertySymbols,aK=Object.prototype.hasOwnProperty,oK=Object.prototype.propertyIsEnumerable,l4=(n,e,t)=>e in n?sK(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,zh=(n,e)=>{for(var t in e||(e={}))aK.call(e,t)&&l4(n,t,e[t]);if(c4)for(var t of c4(e))oK.call(e,t)&&l4(n,t,e[t]);return n},cK=(n,e,t)=>{const r=Ix(n,[t]),i=Ix(e,[t]);return r[t]&&i[t]?zh(zh(zh({},n),e),{[t]:r[t]+", "+i[t]}):zh(zh({},n),e)},lK=cK,eT=(typeof window<"u"?window:global)||{},u4,uK=((u4=eT)==null?void 0:u4.GIPHY_PINGBACK_URL)||"https://pingback.giphy.com",dK=`${uK}/v2/pingback?apikey=l0HlIwPWyBBUDAUgM`,hK=n=>{const e=GS();return e?.set("Content-Type","application/json"),Tr.debug("Pingback session",n),n.length?fetch(dK,{method:"POST",body:JSON.stringify({events:n}),headers:e}).catch(t=>{Tr.warn(`pingbacks failing to post ${t}`)}):new Promise(t=>t())},Bx=[];eT.giphyRandomId=HS();var Xm="";function tT(){const n=[...Bx];Bx=[],hK(n)}var fK=ZS(1e3,tT),d4,h4;(h4=(d4=eT).addEventListener)==null||h4.call(d4,"beforeunload",tT);var pK=({userId:n,eventType:e,actionType:t,attributes:r,queueEvents:i=!0,analyticsResponsePayload:s})=>{Xm=n?String(n):Xm;const c={ts:Date.now(),attributes:r,action_type:t,user_id:HS(),analytics_response_payload:s};Xm&&(c.logged_in_user_id=Xm),c.analytics_response_payload&&(c.analytics_response_payload=`${c.analytics_response_payload}${Tr.ENABLED?"&mode=verification":""}`),e&&(c.event_type=e),Bx.push(c),i?fK():tT()},nT=pK,$x=function(n,e){return $x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])},$x(n,e)};function X3(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");$x(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var wv=function(){return wv=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},wv.apply(this,arguments)};function J3(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t}function Z3(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var l=n.length-1;l>=0;l--)(c=n[l])&&(s=(i<3?c(s):i>3?c(e,t,s):c(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s}function eM(n,e){return function(t,r){e(t,r,n)}}function tM(n,e,t,r,i,s){function c(M){if(M!==void 0&&typeof M!="function")throw new TypeError("Function expected");return M}for(var l=r.kind,d=l==="getter"?"get":l==="setter"?"set":"value",h=!e&&n?r.static?n:n.prototype:null,m=e||(h?Object.getOwnPropertyDescriptor(h,r.name):{}),g,b=!1,_=t.length-1;_>=0;_--){var R={};for(var E in r)R[E]=E==="access"?{}:r[E];for(var E in r.access)R.access[E]=r.access[E];R.addInitializer=function(M){if(b)throw new TypeError("Cannot add initializers after decoration has completed");s.push(c(M||null))};var A=(0,t[_])(l==="accessor"?{get:m.get,set:m.set}:m[d],R);if(l==="accessor"){if(A===void 0)continue;if(A===null||typeof A!="object")throw new TypeError("Object expected");(g=c(A.get))&&(m.get=g),(g=c(A.set))&&(m.set=g),(g=c(A.init))&&i.unshift(g)}else(g=c(A))&&(l==="field"?i.unshift(g):m[d]=g)}h&&Object.defineProperty(h,r.name,m),b=!0}function nM(n,e,t){for(var r=arguments.length>2,i=0;i<e.length;i++)t=r?e[i].call(n,t):e[i].call(n);return r?t:void 0}function rM(n){return typeof n=="symbol"?n:"".concat(n)}function iM(n,e,t){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(n,"name",{configurable:!0,value:t?"".concat(t," ",e):e})}function sM(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)}function aM(n,e,t,r){function i(s){return s instanceof t?s:new t(function(c){c(s)})}return new(t||(t=Promise))(function(s,c){function l(m){try{h(r.next(m))}catch(g){c(g)}}function d(m){try{h(r.throw(m))}catch(g){c(g)}}function h(m){m.done?s(m.value):i(m.value).then(l,d)}h((r=r.apply(n,e||[])).next())})}function oM(n,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,c=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return c.next=l(0),c.throw=l(1),c.return=l(2),typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function l(h){return function(m){return d([h,m])}}function d(h){if(r)throw new TypeError("Generator is already executing.");for(;c&&(c=0,h[0]&&(t=0)),t;)try{if(r=1,i&&(s=h[0]&2?i.return:h[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,h[1])).done)return s;switch(i=0,s&&(h=[h[0]&2,s.value]),h[0]){case 0:case 1:s=h;break;case 4:return t.label++,{value:h[1],done:!1};case 5:t.label++,i=h[1],h=[0];continue;case 7:h=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(h[0]===6||h[0]===2)){t=0;continue}if(h[0]===3&&(!s||h[1]>s[0]&&h[1]<s[3])){t.label=h[1];break}if(h[0]===6&&t.label<s[1]){t.label=s[1],s=h;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(h);break}s[2]&&t.ops.pop(),t.trys.pop();continue}h=e.call(n,t)}catch(m){h=[6,m],i=0}finally{r=s=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}}var R0=Object.create?(function(n,e,t,r){r===void 0&&(r=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,i)}):(function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]});function cM(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&R0(e,n,t)}function Ev(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function rT(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],c;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(l){c={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(c)throw c.error}}return s}function lM(){for(var n=[],e=0;e<arguments.length;e++)n=n.concat(rT(arguments[e]));return n}function uM(){for(var n=0,e=0,t=arguments.length;e<t;e++)n+=arguments[e].length;for(var r=Array(n),i=0,e=0;e<t;e++)for(var s=arguments[e],c=0,l=s.length;c<l;c++,i++)r[i]=s[c];return r}function dM(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return n.concat(s||Array.prototype.slice.call(e))}function Sd(n){return this instanceof Sd?(this.v=n,this):new Sd(n)}function hM(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),i,s=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),l("next"),l("throw"),l("return",c),i[Symbol.asyncIterator]=function(){return this},i;function c(_){return function(R){return Promise.resolve(R).then(_,g)}}function l(_,R){r[_]&&(i[_]=function(E){return new Promise(function(A,M){s.push([_,E,A,M])>1||d(_,E)})},R&&(i[_]=R(i[_])))}function d(_,R){try{h(r[_](R))}catch(E){b(s[0][3],E)}}function h(_){_.value instanceof Sd?Promise.resolve(_.value.v).then(m,g):b(s[0][2],_)}function m(_){d("next",_)}function g(_){d("throw",_)}function b(_,R){_(R),s.shift(),s.length&&d(s[0][0],s[0][1])}}function fM(n){var e,t;return e={},r("next"),r("throw",function(i){throw i}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(i,s){e[i]=n[i]?function(c){return(t=!t)?{value:Sd(n[i](c)),done:!1}:s?s(c):c}:s}}function pM(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof Ev=="function"?Ev(n):n[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(s){t[s]=n[s]&&function(c){return new Promise(function(l,d){c=n[s](c),i(l,d,c.done,c.value)})}}function i(s,c,l,d){Promise.resolve(d).then(function(h){s({value:h,done:l})},c)}}function mM(n,e){return Object.defineProperty?Object.defineProperty(n,"raw",{value:e}):n.raw=e,n}var mK=Object.create?(function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}):function(n,e){n.default=e},qx=function(n){return qx=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},qx(n)};function gM(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t=qx(n),r=0;r<t.length;r++)t[r]!=="default"&&R0(e,n,t[r]);return mK(e,n),e}function vM(n){return n&&n.__esModule?n:{default:n}}function yM(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)}function bM(n,e,t,r,i){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!i:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?i.call(n,t):i?i.value=t:e.set(n,t),t}function xM(n,e){if(e===null||typeof e!="object"&&typeof e!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof n=="function"?e===n:n.has(e)}function _M(n,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,i;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(i=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");i&&(r=function(){try{i.call(this)}catch(s){return Promise.reject(s)}}),n.stack.push({value:e,dispose:r,async:t})}else t&&n.stack.push({async:!0});return e}var gK=typeof SuppressedError=="function"?SuppressedError:function(n,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=n,r.suppressed=e,r};function SM(n){function e(s){n.error=n.hasError?new gK(s,n.error,"An error was suppressed during disposal."):s,n.hasError=!0}var t,r=0;function i(){for(;t=n.stack.pop();)try{if(!t.async&&r===1)return r=0,n.stack.push(t),Promise.resolve().then(i);if(t.dispose){var s=t.dispose.call(t.value);if(t.async)return r|=2,Promise.resolve(s).then(i,function(c){return e(c),i()})}else r|=1}catch(c){e(c)}if(r===1)return n.hasError?Promise.reject(n.error):Promise.resolve();if(n.hasError)throw n.error}return i()}function TM(n,e){return typeof n=="string"&&/^\.\.?\//.test(n)?n.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(t,r,i,s,c){return r?e?".jsx":".js":i&&(!s||!c)?t:i+s+"."+c.toLowerCase()+"js"}):n}const vK={__extends:X3,__assign:wv,__rest:J3,__decorate:Z3,__param:eM,__esDecorate:tM,__runInitializers:nM,__propKey:rM,__setFunctionName:iM,__metadata:sM,__awaiter:aM,__generator:oM,__createBinding:R0,__exportStar:cM,__values:Ev,__read:rT,__spread:lM,__spreadArrays:uM,__spreadArray:dM,__await:Sd,__asyncGenerator:hM,__asyncDelegator:fM,__asyncValues:pM,__makeTemplateObject:mM,__importStar:gM,__importDefault:vM,__classPrivateFieldGet:yM,__classPrivateFieldSet:bM,__classPrivateFieldIn:xM,__addDisposableResource:_M,__disposeResources:SM,__rewriteRelativeImportExtension:TM},yK=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:_M,get __assign(){return wv},__asyncDelegator:fM,__asyncGenerator:hM,__asyncValues:pM,__await:Sd,__awaiter:aM,__classPrivateFieldGet:yM,__classPrivateFieldIn:xM,__classPrivateFieldSet:bM,__createBinding:R0,__decorate:Z3,__disposeResources:SM,__esDecorate:tM,__exportStar:cM,__extends:X3,__generator:oM,__importDefault:vM,__importStar:gM,__makeTemplateObject:mM,__metadata:sM,__param:eM,__propKey:rM,__read:rT,__rest:J3,__rewriteRelativeImportExtension:TM,__runInitializers:nM,__setFunctionName:iM,__spread:lM,__spreadArray:dM,__spreadArrays:uM,__values:Ev,default:vK},Symbol.toStringTag,{value:"Module"})),bK=t9(yK);var Jm={},f4;function xK(){if(f4)return Jm;f4=1,Object.defineProperty(Jm,"__esModule",{value:!0});var n=Sc();function e(t,r){r===void 0&&(r=0);var i=n.useRef(!1),s=n.useRef(),c=n.useRef(t),l=n.useCallback(function(){return i.current},[]),d=n.useCallback(function(){i.current=!1,s.current&&clearTimeout(s.current),s.current=setTimeout(function(){i.current=!0,c.current()},r)},[r]),h=n.useCallback(function(){i.current=null,s.current&&clearTimeout(s.current)},[]);return n.useEffect(function(){c.current=t},[t]),n.useEffect(function(){return d(),h},[r]),[l,h,d]}return Jm.default=e,Jm}var _K=xK();const SK=Wf(_K);var Zm={},eg={},Ci={},p4;function TK(){if(p4)return Ci;p4=1,Object.defineProperty(Ci,"__esModule",{value:!0}),Ci.isNavigator=Ci.isBrowser=Ci.off=Ci.on=Ci.noop=void 0;var n=function(){};Ci.noop=n;function e(r){for(var i=[],s=1;s<arguments.length;s++)i[s-1]=arguments[s];r&&r.addEventListener&&r.addEventListener.apply(r,i)}Ci.on=e;function t(r){for(var i=[],s=1;s<arguments.length;s++)i[s-1]=arguments[s];r&&r.removeEventListener&&r.removeEventListener.apply(r,i)}return Ci.off=t,Ci.isBrowser=typeof window<"u",Ci.isNavigator=typeof navigator<"u",Ci}var m4;function kK(){if(m4)return eg;m4=1,Object.defineProperty(eg,"__esModule",{value:!0});var n=Sc(),e=TK(),t=e.isBrowser?n.useLayoutEffect:n.useEffect;return eg.default=t,eg}var g4;function CK(){if(g4)return Zm;g4=1,Object.defineProperty(Zm,"__esModule",{value:!0});var n=bK,e=Sc(),t=n.__importDefault(kK()),r=function(i,s){i===void 0&&(i=1e12),s===void 0&&(s=0);var c=e.useState(0),l=c[0],d=c[1];return t.default(function(){var h,m,g,b=function(){var A=Math.min(1,(Date.now()-g)/i);d(A),_()},_=function(){h=requestAnimationFrame(b)},R=function(){m=setTimeout(function(){cancelAnimationFrame(h),d(1)},i),g=Date.now(),_()},E=setTimeout(R,s);return function(){clearTimeout(m),clearTimeout(E),cancelAnimationFrame(h)}},[i,s]),l};return Zm.default=r,Zm}var wK=CK();const EK=Wf(wK);var RK=Object.defineProperty,AK=Object.defineProperties,NK=Object.getOwnPropertyDescriptors,v4=Object.getOwnPropertySymbols,IK=Object.prototype.hasOwnProperty,PK=Object.prototype.propertyIsEnumerable,y4=(n,e,t)=>e in n?RK(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Za=(n,e)=>{for(var t in e||(e={}))IK.call(e,t)&&y4(n,t,e[t]);if(v4)for(var t of v4(e))PK.call(e,t)&&y4(n,t,e[t]);return n},iT=(n,e)=>AK(n,NK(e)),sT=(n,e,t)=>new Promise((r,i)=>{var s=d=>{try{l(t.next(d))}catch(h){i(h)}},c=d=>{try{l(t.throw(d))}catch(h){i(h)}},l=d=>d.done?r(d.value):Promise.resolve(d.value).then(s,c);l((t=t.apply(n,e)).next())}),MK=n=>{var e,t;if(!n)return"";const r=(t=(e=n?.split("."))==null?void 0:e.pop())==null?void 0:t.toLowerCase();return n.replace(`.${r}`,`/80h.${r}`)},DK=it.img`
    object-fit: cover;
    width: 32px;
    height: 32px;
    margin-right: 8px;
`,OK=({user:n,className:e=""})=>{const t=T.useRef(Math.floor(Math.random()*5)+1),r=n.avatar_url?MK(n.avatar_url):`https://media.giphy.com/avatars/default${t.current}.gif`;return be.createElement(DK,{src:r,className:e})},A0=OK,Lf=({className:n="",size:e=17,fill:t="#15CDFF"})=>be.createElement("svg",{className:[Lf.className,n].join(" "),height:e,width:"19px",viewBox:"0 0 19 17"},be.createElement("path",{className:Lf.checkMarkClassName,d:"M9.32727273,9.44126709 L9.32727273,3.03016561 L6.55027155,3.03016561 L6.55027155,10.8150746 L6.55027155,12.188882 L12.1042739,12.188882 L12.1042739,9.44126709 L9.32727273,9.44126709 Z",fill:Fx,transform:"translate(9.327273, 7.609524) scale(-1, 1) rotate(-45.000000) translate(-9.327273, -7.609524) "}),be.createElement("g",{transform:"translate(-532.000000, -466.000000)",fill:t},be.createElement("g",{transform:"translate(141.000000, 235.000000)"},be.createElement("g",{transform:"translate(264.000000, 0.000000)"},be.createElement("g",{transform:"translate(10.000000, 224.000000)"},be.createElement("g",{transform:"translate(114.000000, 2.500000)"},be.createElement("path",{d:"M15.112432,4.80769231 L16.8814194,6.87556817 L19.4157673,7.90116318 L19.6184416,10.6028916 L21.0594951,12.9065042 L19.6184416,15.2101168 L19.4157673,17.9118452 L16.8814194,18.9374402 L15.112432,21.0053161 L12.4528245,20.3611511 L9.79321699,21.0053161 L8.02422954,18.9374402 L5.48988167,17.9118452 L5.28720734,15.2101168 L3.84615385,12.9065042 L5.28720734,10.6028916 L5.48988167,7.90116318 L8.02422954,6.87556817 L9.79321699,4.80769231 L12.4528245,5.4518573 L15.112432,4.80769231 Z M17.8163503,10.8991009 L15.9282384,9.01098901 L11.5681538,13.3696923 L9.68115218,11.4818515 L7.81302031,13.3499833 L9.7011322,15.2380952 L11.5892441,17.1262071 L17.8163503,10.8991009 Z"})))))));Lf.className="giphy-verified-badge";Lf.checkMarkClassName="giphy-verified-checkmark";var Hx=Lf,jK=it.div`
    color: white;
    font-size: 16px;
    font-weight: 700;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    -webkit-font-smoothing: antialiased;
`,LK=it(Hx)`
    margin-left: 4px;
    flex-shrink: 0;
`,UK=it.div`
    display: flex;
    align-items: center;
    min-width: 0;
`,VK=({user:n})=>{const{display_name:e,username:t}=n;return be.createElement(UK,null,be.createElement(jK,null,e||`@${t}`),n.is_verified?be.createElement(LK,{size:14}):null)},kM=VK,zK=it.div`
    display: flex;
    align-items: center;
    font-family: interface, helvetica, arial;
`,FK=it(A0)`
    flex-shrink: 0;
`,aT=({gif:n,className:e,onClick:t})=>{const{user:r}=n;return!r?.username&&!r?.display_name?null:be.createElement(zK,{className:[aT.className,e].join(" "),onClick:i=>{if(i.preventDefault(),i.stopPropagation(),t)t(n);else{const s=r.profile_url;s&&window.open(s,"_blank")}}},be.createElement(FK,{user:r}),be.createElement(kM,{user:n.user}))};aT.className="giphy-attribution";var BK=aT,$K=it.div`
    background: linear-gradient(rgba(0, 0, 0, 0), rgba(18, 18, 18, 0.6));
    cursor: default;
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 75px;
    pointer-events: none;
`,qK=it(BK)`
    position: absolute;
    bottom: 10px;
    left: 10px;
    right: 10px;
`,HK=it.div`
    transition: opacity 150ms ease-in;
`,GK=({gif:n,isHovered:e,onClick:t})=>{const r=T.useRef(e);return e&&(r.current=!0),n.user&&r.current?be.createElement(HK,{style:{opacity:e?1:0}},be.createElement($K,null),be.createElement(qK,{gif:n,onClick:t})):null},KK=GK,WK=({children:n,className:e,onVisibleChange:t,config:r})=>{const i=T.useRef(null);return T.useEffect(()=>{let s;return i.current&&(s=new IntersectionObserver(([c])=>{t&&t(c.isIntersecting)},r),s.observe(i.current)),()=>s?.disconnect()},[t,i,r]),be.createElement("div",{ref:i,className:e},n)},CM=WK,wM=n=>(e,t,r,i={})=>{e.analytics_response_payload&&nT({analyticsResponsePayload:e.analytics_response_payload,userId:t,actionType:n,attributes:Za({position:JSON.stringify(wH(r))},i)})},YK=(n,e,t,r={})=>{n.analytics_response_payload&&nT({analyticsResponsePayload:n.analytics_response_payload,userId:e,actionType:"SEEN",attributes:Za({position:JSON.stringify(t)},r)})},QK=wM("CLICK"),XK=wM("HOVER");function JK(n){return n=n.replace("%%CACHEBUSTER%%",f3()),n=n.replace("%%TIMESTAMP%%",`${Date.now()}`),n=n.replace("%%APPBUNDLE%%","web"),typeof window<"u"&&(n=n.replace("%%APP_WINDOW_SIZE%%",`${window.innerWidth},${window.innerHeight}`),n=n.replace("%%DEVICE_LANGUAGE%%",`${navigator.language}`)),n}function ZK({src:n}){const e=T.useRef(JK(n)),[t,r]=T.useState(!1);return T.useEffect(()=>{r(!0)},[]),t?be.createElement("img",{src:e.current,width:0,height:0}):null}var eW=ZK,Gx=T.createContext({}),tW=({attributes:n,children:e})=>{const{attributes:t={}}=T.useContext(Gx);return be.createElement(Gx.Provider,{value:{attributes:lK(t,n,"layout_type")}},e)},EM=tW,nW=it.div`
    position: relative;
    display: block;
    picture {
        display: block;
        width: 100%;
        height: 100%;
    }
    img {
        display: block;
    }
    .${Hx.className} {
        g {
            fill: white;
        }
    }
    .${Hx.checkMarkClassName} {
        opacity: 0;
    }
`,b4=[JS,K3,W3,Y3,Q3],rW=()=>b4[Math.round(Math.random()*(b4.length-1))],iW=200,x4="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",sW=!!(typeof window<"u"&&window.document&&window.document.createElement),Nu=()=>{},aW=({children:n})=>{const[e,t]=T.useState(!1);return T.useEffect(()=>{t(!0)},[]),e?be.createElement(be.Fragment,null,n):null},nc=({gif:n,gif:{bottle_data:e={}},width:t,percentWidth:r,percentHeight:i,height:s,onGifRightClick:c=Nu,className:l="",onGifClick:d=Nu,onGifKeyPress:h=Nu,onGifSeen:m=Nu,onGifVisible:g=Nu,user:b={},backgroundColor:_,overlay:R,hideAttribution:E=!1,noLink:A=!1,borderRadius:M=4,style:F,tabIndex:j,lazyLoad:C=!0})=>{var N;const[D,S]=T.useState(!1),[k,P]=T.useState(!1),[L,U]=T.useState(!sW||!C),[z,V]=T.useState(""),le=T.useRef(rW()),ve=T.useRef(null),K=T.useRef(null),oe=T.useRef(),ee=T.useRef(),Me=T.useRef(),je=T.useRef(Nu),q=Object.keys(e).length>0,{attributes:te}=T.useContext(Gx);let fe=R;!fe&&!E&&(fe=KK);const Se=$e=>{clearTimeout(Me.current),$e.persist(),P(!0),Me.current=window.setTimeout(()=>{XK(n,b?.id,$e.target,te)},iW)},Oe=()=>{clearTimeout(Me.current),P(!1)},Te=$e=>{QK(n,b?.id,$e.target,te),d(n,$e)},we=$e=>{h(n,$e)};je.current=$e=>{S(!0),Tr.debug(`GIF ${n.id} seen. ${n.title}`),YK(n,b?.id,$e.boundingClientRect,te),m?.(n,$e.boundingClientRect),ee.current&&ee.current.disconnect()};const Ge=()=>{ee.current||(ee.current=new IntersectionObserver(([$e])=>{$e.isIntersecting&&je.current($e)},{threshold:[.99]})),!D&&ve.current&&ee.current&&ee.current.observe(ve.current)},Ke=$e=>{Ge(),g(n,$e),V(nc.imgLoadedClassName)};T.useEffect(()=>{var $e,Q;($e=K.current)!=null&&$e.complete&&(Ge(),g(n)),(Q=ee.current)==null||Q.disconnect(),S(!1)},[n.id]),T.useEffect(()=>(oe.current=new IntersectionObserver(([$e])=>{const{isIntersecting:Q}=$e;U(Q),!Q&&ee.current&&ee.current.disconnect()}),oe.current.observe(ve.current),()=>{oe.current&&oe.current.disconnect(),ee.current&&ee.current.disconnect(),Me.current&&clearTimeout(Me.current)}),[]);const Ce=x0(n,t);let Re=s;!F?.aspectRatio&&!s&&(Re=Ce);const He=RH(n.images,t,s||Ce);if(!He)return n.images?console.error(`no rendition for ${n.id}, rendition names: ${Object.keys(n.images).join(", ")}`):console.error(`no rendition for ${n.id} - no images`),null;const de=n.images[He.renditionName],qe=z===nc.imgLoadedClassName&&!n.is_sticker?"unset":_||(n.is_sticker?"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADgAAAA4AQMAAACSSKldAAAABlBMVEUhIiIWFhYoSqvJAAAAGElEQVQY02MAAv7///8PWxqIPwDZw5UGABtgwz2xhFKxAAAAAElFTkSuQmCC') 0 0":le.current),ot=M?"hidden":"unset";return be.createElement(nW,{as:A?"div":"a",href:A?void 0:n.url,"data-giphy-id":n.id,"data-giphy-is-sticker":n.is_sticker,style:Za({width:r||t,height:i||Re,overflow:ot,borderRadius:M},F),className:[nc.className,l].join(" "),onMouseOver:Se,onMouseLeave:Oe,onClick:Te,onContextMenu:$e=>c(n,$e),onKeyPress:we,tabIndex:j,ref:ve},be.createElement("picture",null,be.createElement("source",{type:"image/webp",srcSet:L?de.webp:x4,suppressHydrationWarning:!0}),be.createElement("img",{ref:K,suppressHydrationWarning:!0,className:[nc.imgClassName,z].join(" "),src:L?de.url:x4,style:{background:qe},width:"100%",height:"100%",alt:NH(n),onLoad:L?Ke:()=>{}})),q&&((N=e?.tags)==null?void 0:N.map(($e,Q)=>be.createElement(eW,{src:$e,key:Q}))),fe&&be.createElement(aW,null,L&&be.createElement(fe,{gif:n,isHovered:k,width:t,height:Re})))};nc.className="giphy-gif";nc.imgClassName="giphy-gif-img";nc.imgLoadedClassName="giphy-img-loaded";var Uf=nc,oW=it.div`
    -webkit-overflow-scrolling: touch;
    overflow-x: auto;
    overflow-y: hidden;
    white-space: nowrap;
    position: relative;
`,cW=it(Uf)`
    position: relative;
    display: inline-block;
    list-style: none;
    margin-left: ${n=>n.$ml}px;
    /* make sure gifs are fully visible with a scrollbar */
    margin-bottom: 1px;

    &:first-of-type {
        margin-left: 0;
    }
    .${Uf.imgClassName} {
        position: absolute;
        top: 0;
        left: 0;
    }
`,lW=it(CM)`
    display: inline-block;
`,uW=it.div`
    width: 30px;
    display: inline-block;
    opacity: ${n=>n.$isFirstLoad?0:1};
    height: ${n=>n.$height}px;
`,dW=Object.freeze({gutter:6,user:{},initialGifs:[]}),hW=Object.freeze({isFetching:!1,gifs:[],isLoaderVisible:!1,isDoneFetching:!1}),RM=class AM extends T.PureComponent{constructor(){super(...arguments),this.state=iT(Za({},hW),{gifs:this.props.initialGifs||[]}),this.unmounted=!1,this.paginator=y3(this.props.fetchGifs,this.state.gifs),this.onLoaderVisible=e=>{this.unmounted||this.setState({isLoaderVisible:e},this.onFetch)},this.onFetch=ZS(100,()=>sT(this,null,function*(){if(this.unmounted)return;const{isFetching:e,isLoaderVisible:t,gifs:r}=this.state;if(!e&&t){this.setState({isFetching:!0});let i;try{i=yield this.paginator()}catch{this.setState({isFetching:!1})}if(i)if(!!!i?.skipCountCheck&&r.length===i.length)this.setState({isDoneFetching:!0});else{this.setState({gifs:i,isFetching:!1});const{onGifsFetched:c}=this.props;c&&c(i),this.onFetch()}}}))}componentDidMount(){this.unmounted=!1,this.onFetch()}componentWillUnmount(){this.unmounted=!0}render(){const{onGifVisible:e,onGifRightClick:t,gifHeight:r,gifWidth:i,gutter:s,className:c=AM.className,onGifSeen:l,onGifClick:d,onGifKeyPress:h,user:m,overlay:g,hideAttribution:b,noLink:_,noResultsMessage:R,backgroundColor:E,borderRadius:A,tabIndex:M=0,loaderConfig:F}=this.props,{gifs:j,isDoneFetching:C}=this.state,N=!C,D=j.length===0;return be.createElement(EM,{attributes:{layout_type:"CAROUSEL"}},be.createElement(oW,{className:c},j.map(S=>be.createElement(cW,{gif:S,key:S.id,tabIndex:M,width:i||AH(S,r),height:r,onGifClick:d,onGifKeyPress:h,onGifSeen:l,onGifVisible:e,onGifRightClick:t,user:m,$ml:s,overlay:g,hideAttribution:b,noLink:_,borderRadius:A,backgroundColor:E})),!N&&j.length===0&&R,N&&be.createElement(lW,{onVisibleChange:this.onLoaderVisible,config:F},be.createElement(uW,{$isFirstLoad:D,$height:r}))))}};RM.className="giphy-carousel";RM.defaultProps=dW;var fW=it.div`
    color: ${G3};
    display: flex;
    justify-content: center;
    margin: 30px 0;
    font-family: interface, Helvetica Neue, helvetica, sans-serif;
    font-size: 16px;
    font-weight: 600;
    a {
        color: ${JS};
        cursor: pointer;
        &:hover {
            color: white;
        }
    }
`,pW=({onClick:n})=>be.createElement(fW,null,"Error loading GIFs.",be.createElement("a",{onClick:n},"Try again?")),mW=pW,gW=.75;it.div`
    align-items: center;
    background-color: ${({$backgroundColor:n})=>n};
    border-radius: 16px;
    display: flex;
    max-width: fit-content;
    overflow: hidden;
    padding: 4px 5px 5px 6px;
`;it.div`
    overflow-x: auto;
    overflow-y: hidden;
    position: relative;
    -webkit-overflow-scrolling: touch;
`;it.div`
    display: inline-flex;
    justify-content: space-between;
    overflow: hidden;
    white-space: nowrap;
    width: ${({$width:n})=>`${n}px`};
`;it.div`
    background-color: ${({$color:n})=>n};
    box-sizing: border-box;
    height: ${({$gifHeight:n})=>`${Math.round(n*gW)}px`};
    margin: ${({$gutter:n})=>`0 ${n}px`};
    width: 2px;
`;it(Uf)`
    display: inline-block;
    flex-shrink: 0;
    list-style: none;
    /* make sure gifs are fully visible with a scrollbar */
    margin-bottom: 1px;
    position: relative;

    .${Uf.imgClassName} {
        position: absolute;
        top: 0;
        left: 0;
    }
`;var vW=fp`
     to {
    transform: scale(1.75) translateY(-20px);
  }
`,NM=52,yW=it.div`
    display: flex;
    align-items: center;
    height: ${NM}px;
    margin: 0 auto;
    text-align: center;
    justify-content: center;
    animation: pulse 0.8s ease-in-out 0s infinite alternate backwards;
`,Fh=it.div`
    display: inline-block;
    height: 10px;
    width: 10px;
    margin: ${NM}px 10px 10px 10px;
    position: relative;
    box-shadow: 0px 0px 20px rgba(0, 0, 0, 0.3);
    animation: ${vW} cubic-bezier(0.455, 0.03, 0.515, 0.955) 0.75s infinite alternate;
    background: ${n=>n.$color};
    animation-delay: ${n=>n.$delay};
`,bW=({className:n=""})=>be.createElement(yW,{className:n},be.createElement(Fh,{$color:K3,$delay:"0"}),be.createElement(Fh,{$color:JS,$delay:".1s"}),be.createElement(Fh,{$color:W3,$delay:".2s"}),be.createElement(Fh,{$color:Y3,$delay:".3s"}),be.createElement(Fh,{$color:Q3,$delay:".4s"})),xW=bW,_W=it.div`
    opacity: ${n=>n.$isFirstLoad?0:1};
`;function _4(n,e,t=[]){return Array.apply(null,Array(n)).map((r,i)=>t[i]||e)}function SW(n,e,t,r){const i=_4(n,[]),s=_4(n,0,e);return t.forEach(c=>{const l=s.indexOf(Math.min(...s));i[l]=[...i[l],c],s[l]+=x0(c,r)}),i}var TW=Object.freeze({gutter:6,user:{},initialGifs:[]}),kW=Object.freeze({isFetching:!1,isError:!1,gifs:[],isLoaderVisible:!1,isDoneFetching:!1}),jd=class Ng extends T.PureComponent{constructor(){super(...arguments),this.state=iT(Za({},kW),{gifs:this.props.initialGifs||[]}),this.unmounted=!1,this.paginator=y3(this.props.fetchGifs,this.state.gifs),this.onLoaderVisible=e=>{this.unmounted||this.setState({isLoaderVisible:e},this.onFetch)},this.onFetch=ZS(Ng.fetchDebounce,()=>sT(this,null,function*(){if(this.unmounted)return;const{isFetching:e,isLoaderVisible:t}=this.state,{externalGifs:r}=this.props,i=(r||this.state.gifs).length;if(!e&&t){this.setState({isFetching:!0,isError:!1});let s;try{if(s=yield this.paginator(r),this.unmounted)return}catch(c){if(this.unmounted)return;this.setState({isFetching:!1,isError:!0});const{onGifsFetchError:l}=this.props;l&&l(c)}if(s)if(!!!s?.skipCountCheck&&i===s.length)this.setState({isDoneFetching:!0});else{this.setState({gifs:s,isFetching:!1});const{onGifsFetched:l}=this.props;l&&l(s),this.onFetch()}}}))}componentDidMount(){this.unmounted=!1,this.onFetch()}componentWillUnmount(){this.unmounted=!0}render(){const{onGifVisible:e,onGifRightClick:t,className:r=Ng.className,onGifSeen:i,onGifClick:s,onGifKeyPress:c,user:l,overlay:d,hideAttribution:h,noLink:m,borderRadius:g,noResultsMessage:b,columns:_,width:R,gutter:E,percentWidth:A,columnOffsets:M,backgroundColor:F,loaderConfig:j,tabIndex:C=0,layoutType:N="GRID",loader:D=xW,eagerIds:S}=this.props,{gifs:k,isError:P,isDoneFetching:L}=this.state,U=!L,z=k.length===0,V=E*(_-1),le=(R-V)/_,ve=SW(_,M,k,le);return be.createElement(EM,{attributes:{layout_type:N}},be.createElement("div",{className:r},be.createElement("div",{style:{width:A||R,display:"flex",gap:E}},ve.map((K=[],oe)=>be.createElement("div",{key:oe,style:{display:"flex",flexDirection:"column",gap:E,width:A?"100%":le,marginTop:M?.[oe]}},K.map(ee=>be.createElement(Uf,{style:{aspectRatio:ee.images.original.width/ee.images.original.height},gif:ee,tabIndex:C,key:ee.id,width:le,percentWidth:A?"100%":void 0,onGifClick:s,onGifKeyPress:c,onGifSeen:i,onGifVisible:e,onGifRightClick:t,user:l,overlay:d,backgroundColor:F,hideAttribution:h,noLink:m,borderRadius:g,lazyLoad:!S?.includes(ee.id)}))))),!U&&k.length===0&&b,P?be.createElement(mW,{onClick:this.onFetch}):U&&be.createElement(CM,{onVisibleChange:this.onLoaderVisible,config:j},be.createElement(_W,{$isFirstLoad:z},be.createElement(D,{className:Ng.loaderClassName})))))}};jd.className="giphy-grid";jd.loaderClassName="loader";jd.fetchDebounce=250;jd.defaultProps=TW;jd.getDerivedStateFromProps=({externalGifs:n},e)=>n&&n!==e.gifs?{gifs:n}:null;var CW=jd,IM=CW,Qn={searchbarHeight:"--searchbar-height",bgColor:"--searchbar-bg-color",bgColor2:"--searchbar-bg-color-2",fgColor:"--searchbar-fg-color",cancelButtonDisplay:"--searchbar-cancel-button-display"};it.div`
    ${Qn.searchbarHeight}: ${n=>n.$searchbarHeight||42}px;
    @media (${n=>n.$mobileMediaQuery}) {
        ${Qn.searchbarHeight}: ${n=>n.$mobileSearchbarHeight||35}px;
    }
    ${Qn.bgColor}: ${Ag};
    ${Qn.bgColor2}: ${Ag};
    ${Qn.fgColor}: ${Fx};
    ${n=>n.$darkMode&&E0`
            ${Qn.fgColor}: ${Ag};
            ${Qn.bgColor}: ${Fx};
            ${Qn.bgColor2}: ${tK};
        `}
    ${Qn.cancelButtonDisplay}: ${n=>n.$hideCancelButton?"none":"block"};
`;T.createContext({});T.createContext({});it.svg`
    position: relative;
    right: 10px;
    margin-left: 5px;
    cursor: pointer;
    display: var(${Qn.cancelButtonDisplay});
`;var PM=6,oT=`calc(var(${Qn.searchbarHeight}) - ${PM*2}px)`,wW=fp`
to {
    width: ${oT};
}
`;it(A0)`
    height: ${oT};
    margin: 0;
    width: 0;
    animation: ${wW} 100ms ease-in-out forwards;
`;it.div`
    background: var(${Qn.bgColor2});
    display: flex;
    align-items: center;
    padding-left: ${PM}px;
`;it.div`
    background: ${nK};
    display: flex;
    padding: 0 4px;
    color: ${eK};
    font-family: interface, Helvetica Neue, helvetica, sans-serif;
    font-weight: 600;
    font-size: 12px;
    align-items: center;
    height: ${oT};
    @media (max-width: 480px) {
        display: none;
    }
`;var EW=({className:n=""})=>be.createElement("svg",{viewBox:"0 0 30 30",version:"1.1",className:n},be.createElement("defs",null,be.createElement("path",{d:"M11.5482521,20.4090671 L4.24727698,28.2009189 C3.68084207,28.8054377 2.73159653,28.8363108 2.12707771,28.2698759 C1.5225589,27.703441 1.4916858,26.7541954 2.0581207,26.1496766 L9.40599838,18.3077689 C7.95982241,16.4371424 7.0978836,14.0789715 7.0978836,11.5181818 C7.0978836,5.44914339 11.9392549,0.518181818 17.9252787,0.518181818 C23.9113026,0.518181818 28.7526738,5.44914339 28.7526738,11.5181818 C28.7526738,17.5872202 23.9113026,22.5181818 17.9252787,22.5181818 C15.539851,22.5181818 13.3361963,21.7351359 11.5482521,20.4090671 Z M17.9252787,19.5181818 C22.242011,19.5181818 25.7526738,15.9425536 25.7526738,11.5181818 C25.7526738,7.09381 22.242011,3.51818182 17.9252787,3.51818182 C13.6085464,3.51818182 10.0978836,7.09381 10.0978836,11.5181818 C10.0978836,15.9425536 13.6085464,19.5181818 17.9252787,19.5181818 Z",id:"giphy-search-icon-path-1"})),be.createElement("g",{id:"search",stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},be.createElement("g",{id:"icons/search"},be.createElement("mask",{id:"giphy-search-icon-mask-2",fill:"white"},be.createElement("use",{xlinkHref:"#giphy-search-icon-path-1"})),be.createElement("use",{id:"Mask",fill:"#FFFFFF",fillRule:"nonzero",xlinkHref:"#giphy-search-icon-path-1"}),be.createElement("g",{mask:"url(#giphy-search-icon-mask-2)"},be.createElement("g",{transform:"translate(0.250000, 0.250000)"},be.createElement("g",null)))))),RW=EW,AW="2s",v1="#E646B6",S4="#FF6666",MM="cubic-bezier(0.920, 0.240, 0.185, 0.730)",NW=fp`
    0% {
      transform: rotate(34deg) translate(-10px, 80px);
    };
    
    100% {
      transform: rotate(34deg) translate(-10px, -20px);
    }
`,IW=fp`
    0% { 
      transform: translate(0px, 0px);
      opacity: 0;
    }
    50% {
      opacity: 1;
    }
    100% {
      transform: translate(10px, -17px);
      opacity: 0;
    }
`,PW=fp`
    0% {
      opacity: 0;
      transform: translateX(-400%);
    }
    50% {
      opacity: 1;
    }
    100% {
      opacity: 0;
      transform: translateX(0);
    }
`;it.div`
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
    cursor: pointer;
    @media screen and (-ms-high-contrast: active), screen and (-ms-high-contrast: none) {
        display: none;
    }
    height: var(${Qn.searchbarHeight});
    width: var(${Qn.searchbarHeight});
`;it.div`
    position: absolute;
    height: 100%;
    width: 100%;
    background: linear-gradient(45deg, ${v1} 0%, ${S4} 100%);
    border-radius: 0 4px 4px 0;
    overflow: hidden;
    &:before {
        animation: ${PW} ${AW} linear 0s infinite;
        background-image: linear-gradient(45deg, ${v1} 0%, ${S4} 50%, ${v1} 100%);
        background-size: 400%;
        background-position: 0% 100%;
        content: '';
        position: absolute;
        left: 0;
        top: 0;
        right: 0;
        bottom: 0;
        width: 400%;
    }
`;it.div`
    width: 100%;
    height: 100%;
    position: absolute;
    overflow: hidden;
    &::after {
        content: '+';
        color: white;
        font-family: 'SS Standard';
        font-size: 8px;
        position: absolute;
        top: 65%;
        left: 66%;
        animation: ${IW} 1s ${MM} 0s 1 forwards;
    }
`;it.div`
    position: absolute;
    width: 200%;
    height: 20px;
    background: rgba(255, 255, 255, 0.5);
    transform: rotate(34deg) translate(-10px, -20px);
    animation: ${NW} 1s ${MM} 0s 1;
    filter: blur(1px);
`;it(RW)`
    z-index: 1;
    display: flex;
    width: 50%;
    height: 50%;
`;it.div`
    display: flex;
    background: white;
    align-items: center;
    border-radius: 4px;
    height: var(${Qn.searchbarHeight});
    background: var(${Qn.bgColor2});
`;it.input`
    background: inherit;
    box-sizing: border-box;
    border: 0;
    appearance: none;
    font-weight: normal;
    font-family: interface, Helvetica Neue, helvetica, sans-serif;
    outline: 0;
    font-size: 15px;
    padding: 0 10px;
    border-radius: 0;
    text-overflow: ellipsis;
    color: var(${Qn.fgColor});
    &::placeholder {
        color: ${G3};
    }
    min-width: 150px;
    flex: 1;
    ${n=>n.$isUsernameSearch&&E0`
            color: ${rK};
        `}
`;var MW=({size:n=18,className:e})=>be.createElement("svg",{width:n,height:n,viewBox:"0 0 18 16",version:"1.1",xmlns:"http://www.w3.org/2000/svg",className:e},be.createElement("g",{id:"trending",stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},be.createElement("g",null,be.createElement("rect",{id:"Rectangle",stroke:"#979797",fill:"#D8D8D8",opacity:"0",x:"0.5",y:"0.5",width:"17",height:"17"}),be.createElement("path",{d:"M12.6093329,3.12057664 L15.156896,3.12057664 L9.64199318,9.04253019 L6.88133868,6.8175119 C6.7544587,6.67603813 6.56616874,6.60087259 6.38404017,6.61897279 C6.2490402,6.63288422 6.11891631,6.69661171 6.02063992,6.79697337 C2.21226835,10.5943119 0.308082561,12.4929812 0.308082561,12.4929812 C0.308082561,12.4929812 0.527106106,12.8074292 0.710953088,13.0215425 C0.833517743,13.1642848 0.975497751,13.3098497 1.13689311,13.4582373 L6.47329888,8.13191205 L9.16381134,10.2953038 C9.40800276,10.5710787 9.68933701,10.7021044 10.019278,10.4570223 L16.0239805,4.04474473 C16.0239805,5.87956383 16.0239805,6.79697337 16.0239805,6.79697337 C16.0239805,6.79697337 16.4320205,6.79697337 17.2481004,6.79697337 L17.2481004,1.80604505 C14.1555887,1.80604505 12.6093329,1.80604505 12.6093329,1.80604505 C12.6093329,1.80604505 12.6093329,2.24422225 12.6093329,3.12057664 Z",id:"Shape",stroke:"#00CCFF",strokeWidth:"0.4",fill:"#00CCFF",fillRule:"nonzero",transform:"translate(8.778091, 7.632141) rotate(-2.000000) translate(-8.778091, -7.632141) "})))),DW=MW,DM=9;it.div`
    background: ${H3};
    display: flex;
    padding-right: 4px;
    align-items: center;
    margin-right: ${DM}px;
    cursor: pointer;
`;it.div`
    background: ${H3};
    display: flex;
    padding: 14px;
    align-items: center;
    margin-right: ${DM}px;
    white-space: nowrap;
    cursor: pointer;
    font-style: italic;
    border-radius: 20px;
`;it(A0)`
    height: var(${Qn.searchbarHeight});
    width: var(${Qn.searchbarHeight});
`;it(DW)`
    margin-right: 2px;
`;it.div`
    display: flex;
    color: white;
    flex-direction: row;
    font-family: 'interface';
    font-weight: 600;
    font-size: 14px;
    -webkit-overflow-scrolling: touch;
    overflow-x: auto;
    overflow-y: hidden;
    padding-bottom: 10px;
    height: var(${Qn.searchbarHeight});
`;var OW=({onClick:n})=>be.createElement("svg",{width:"66px",height:"13px",viewBox:"0 0 66 13",onClick:n},be.createElement("g",{stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},be.createElement("g",{transform:"translate(-1060.000000, -462.000000)",fill:"#FFFFFF",fillRule:"nonzero"},be.createElement("g",{transform:"translate(931.000000, 286.375671)"},be.createElement("g",{transform:"translate(86.000000, 136.124329)"},be.createElement("path",{d:"M47.968,49.1962322 C49.588,49.1962322 51.052,48.6202322 51.58,47.5522322 L51.58,43.8202322 L47.476,43.8202322 L47.476,45.6802322 L49.6,45.6802322 L49.6,46.7602322 C49.12,47.1082322 48.424,47.1922322 47.98,47.1922322 C46.288,47.1922322 45.724,45.8602322 45.724,44.7802322 C45.724,43.1362322 46.612,42.3202322 47.98,42.3202322 C48.544,42.3202322 49.288,42.4762322 49.9,43.0522322 L51.28,41.6842322 C50.176,40.5682322 49.144,40.3282322 47.98,40.3282322 C44.824,40.3282322 43.384,42.5842322 43.384,44.7802322 C43.384,46.9762322 44.644,49.1962322 47.968,49.1962322 Z M54.928,48.9682322 L54.928,40.5682322 L52.564,40.5682322 L52.564,48.9682322 L54.928,48.9682322 Z M58.648,48.9682322 L58.648,46.7002322 L60.352,46.7002322 C62.596,46.6762322 63.724,45.3442322 63.724,43.6282322 C63.724,41.9842322 62.608,40.5682322 60.352,40.5682322 L56.272,40.5682322 L56.272,48.9682322 L58.648,48.9682322 Z M60.352,44.6962322 L58.648,44.6962322 L58.648,42.6082322 L60.352,42.6082322 C61,42.6082322 61.348,43.1122322 61.348,43.6642322 C61.348,44.2162322 61.012,44.6962322 60.352,44.6962322 Z M66.796,48.9802322 L66.796,45.8002322 L69.82,45.8002322 L69.82,48.9802322 L72.172,48.9802322 L72.172,40.5802322 L69.82,40.5802322 L69.82,43.7722322 L66.796,43.7722322 L66.796,40.5802322 L64.42,40.5802322 L64.42,48.9802322 L66.796,48.9802322 Z M78.16,48.9682322 L78.16,45.6202322 L81.496,40.6762322 L81.496,40.5682322 L78.82,40.5682322 L77.008,43.4482322 L75.268,40.5682322 L72.592,40.5682322 L72.592,40.6642322 L75.784,45.6202322 L75.784,48.9682322 L78.16,48.9682322 Z M87.796,49.1362322 C88.972,49.1362322 90.088,48.7402322 90.952,47.8882322 L90.028,46.9642322 C89.44,47.5522322 88.576,47.8762322 87.796,47.8762322 C85.624,47.8762322 84.712,46.3522322 84.7,44.8162322 C84.688,43.2682322 85.66,41.6962322 87.796,41.6962322 C88.576,41.6962322 89.368,41.9722322 89.968,42.5602322 L90.868,41.6962322 C90.016,40.8442322 88.924,40.4242322 87.796,40.4242322 C84.796,40.4242322 83.356,42.6202322 83.3679256,44.8282322 C83.38,47.0362322 84.748,49.1362322 87.796,49.1362322 Z M93.028,48.9682322 L93.028,40.5802322 L91.792,40.5802322 L91.792,48.9682322 L93.028,48.9682322 Z M94.252,41.3122322 C94.252,42.3322322 95.788,42.3322322 95.788,41.3122322 C95.788,40.3042322 94.252,40.3042322 94.252,41.3122322 Z M95.632,48.9682322 L95.632,43.0282322 L94.396,43.0282322 L94.396,48.9682322 L95.632,48.9682322 Z M98.188,51.7162322 L98.188,48.1042322 C98.632,48.8362322 99.556,49.1002322 100.276,49.1002322 C102.112,49.1002322 103.264,47.8042322 103.264,46.0162322 C103.264,44.2282322 102.04,42.9442322 100.276,42.9322322 C99.484,42.9322322 98.644,43.2922322 98.188,44.0122322 L98.116,43.0522322 L96.952,43.0522322 L96.952,51.7162322 L98.188,51.7162322 Z M100.156,47.9002322 C99.076,47.9002322 98.296,47.0722322 98.296,46.0162322 C98.296,44.9602322 99.016,44.1322322 100.156,44.1322322 C101.284,44.1322322 102.028,44.9002322 102.028,46.0162322 C102.028,47.1202322 101.236,47.9002322 100.156,47.9002322 Z M106.456,49.1482322 C107.992,49.1482322 108.964,48.3802322 108.976,47.2762322 C108.988,45.7522322 107.56,45.5122322 106.468,45.4162322 C105.712,45.3442322 105.196,45.1522322 105.184,44.6602322 C105.184,44.1922322 105.688,43.9402322 106.444,43.9522322 C107.032,43.9522322 107.536,44.0722322 108.004,44.5042322 L108.7,43.6882322 C108.04,43.1002322 107.332,42.8962322 106.42,42.8962322 C105.316,42.8962322 103.96,43.3882322 103.96,44.6962322 C103.972,46.0042322 105.256,46.3642322 106.372,46.4722322 C107.248,46.5562322 107.752,46.7602322 107.74,47.2882322 C107.728,47.8402322 107.068,48.0562322 106.48,48.0562322 C105.784,48.0442322 104.956,47.7922322 104.404,47.1802322 L103.756,48.0562322 C104.536,48.9322322 105.496,49.1482322 106.456,49.1482322 Z",id:"GIPHYClips"})))))),jW=OW,LW=it.div`
    display: flex;
    align-items: center;
    font-family: interface, helvetica, arial;
    cursor: pointer;
`,UW=it(A0)`
    flex-shrink: 0;
`,VW=it.div`
    display: flex;
    flex-direction: column;
`,cT=({gif:n,className:e,onClick:t})=>{const{user:r}=n;return!r?.username&&!r?.display_name?null:be.createElement(LW,{className:[cT.className,e].join(" "),onClick:i=>{if(i.preventDefault(),i.stopPropagation(),t)t(n);else{const s=r.profile_url;s&&window.open(s,"_blank")}}},be.createElement(UW,{user:r}),be.createElement(VW,null,be.createElement(jW,{onClick:i=>{i.preventDefault(),i.stopPropagation(),t?t(n):n.url&&window.open(n.url,"_blank")}}),be.createElement(kM,{user:r})))};cT.className="giphy-attribution";var zW=cT,OM=25,FW=({size:n=OM,onClick:e=()=>{}})=>be.createElement("svg",{width:n,height:n,viewBox:"0 0 26 23",onClick:e},be.createElement("g",{stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},be.createElement("g",{transform:"translate(1.000000, 0.000000)",fill:"#FFF",fillRule:"nonzero"},be.createElement("path",{d:"M11.9625091,0.572584405 L11.9625091,22.2272644 C11.9625091,22.4856644 11.8466091,22.6635044 11.6151891,22.7611644 C11.3480491,22.8413444 11.1390491,22.7968844 10.9878091,22.6277844 L4.8732291,15.9143244 L0.573909096,15.9143244 C0.413549096,15.9143244 0.277509096,15.8588444 0.166549096,15.7475044 C0.0573082348,15.6406091 -0.00292164572,15.4933347 -1.77635684e-15,15.3405244 L-1.77635684e-15,7.45058441 C-1.77635684e-15,7.29022441 0.0555890961,7.15456441 0.167309096,7.04322441 C0.278269096,6.93226441 0.414309096,6.87640441 0.573909096,6.87640441 L4.8732291,6.87640441 L10.9874291,0.172064405 C11.1390491,0.00296440549 11.3484291,-0.0414955945 11.6151891,0.0386844055 C11.8466091,0.136344405 11.9621291,0.314564405 11.9621291,0.572584405 L11.9625091,0.572584405 Z"}),be.createElement("path",{d:"M15.7579491,16.0914044 L14.6798891,13.6594044 C15.5739159,13.2635547 16.1503537,12.3776671 16.1501091,11.3999244 C16.150386,10.4242626 15.5763999,9.53983269 14.6852091,9.14272441 L15.7697291,6.71376441 C17.6193585,7.53872062 18.810518,9.37466359 18.8101092,11.3999244 C18.8105521,13.4298903 17.6139475,15.2691931 15.7579491,16.0914044 L15.7579491,16.0914044 Z"}),be.createElement("path",{d:"M18.3647491,20.2619044 L17.2863091,17.8299044 C19.8302925,16.7031661 21.4705725,14.1822599 21.4701091,11.3999244 C21.4701091,8.59818441 19.8167291,6.09892441 17.3022691,4.97678441 L18.3864091,2.54782441 C21.8804724,4.10607079 24.1307363,7.57414217 24.1301093,11.3999244 C24.1308375,15.2343934 21.8705556,18.7086904 18.3647491,20.2619044 Z"})))),BW=({size:n=OM,onClick:e=()=>{}})=>be.createElement("svg",{onClick:e,height:n,width:n,viewBox:"0 0 26 23",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},be.createElement("g",{id:"Page-1",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},be.createElement("g",{id:"Group",transform:"translate(1.000000, 0.000000)",fill:"#FFFFFF",fillRule:"nonzero"},be.createElement("path",{d:"M11.9625091,0.572584405 L11.9625091,22.2272644 C11.9625091,22.4856644 11.8466091,22.6635044 11.6151891,22.7611644 C11.3480491,22.8413444 11.1390491,22.7968844 10.9878091,22.6277844 L4.8732291,15.9143244 L0.573909096,15.9143244 C0.413549096,15.9143244 0.277509096,15.8588444 0.166549096,15.7475044 C0.0573082348,15.6406091 -0.00292164572,15.4933347 0,15.3405244 L0,7.45058441 C0,7.29022441 0.0555890961,7.15456441 0.167309096,7.04322441 C0.278269096,6.93226441 0.414309096,6.87640441 0.573909096,6.87640441 L4.8732291,6.87640441 L10.9874291,0.172064405 C11.1390491,0.00296440549 11.3484291,-0.0414955945 11.6151891,0.0386844055 C11.8466091,0.136344405 11.9621291,0.314564405 11.9621291,0.572584405 L11.9625091,0.572584405 Z",id:"Path"})),be.createElement("g",{id:"Group",transform:"translate(14.887009, 6.947630)",fill:"#FFFFFF",fillRule:"nonzero"},be.createElement("path",{d:"M7.88199149,6.27905236 C7.94693088,6.35707599 7.94693088,6.47033309 7.88199149,6.54835671 L6.54835671,7.88199149 C6.47033309,7.94693088 6.35707599,7.94693088 6.27905236,7.88199149 L3.96534802,5.56828715 L1.65164367,7.88199149 C1.57362004,7.94693088 1.46036294,7.94693088 1.38233932,7.88199149 L0.0487045381,6.54835671 C-0.016234846,6.47033309 -0.016234846,6.35707599 0.0487045381,6.27905236 L2.36240889,3.96534802 L0.0487045381,1.65164367 C-0.016234846,1.57362004 -0.016234846,1.46036294 0.0487045381,1.38233932 L1.38233932,0.0487045381 C1.46036294,-0.016234846 1.57362004,-0.016234846 1.65164367,0.0487045381 L3.96534802,2.36240889 L6.27905236,0.0487045381 C6.35707599,-0.016234846 6.47033309,-0.016234846 6.54835671,0.0487045381 L7.88199149,1.38233932 C7.94693088,1.46036294 7.94693088,1.57362004 7.88199149,1.65164367 L5.56828715,3.96534802 L7.88199149,6.27905236 Z",id:"Shape"})))),$W=it.div`
    background: ${Ag};
    height: ${n=>n.$barHeight}px;
    position: absolute;
    width: 5px;
    bottom: 0;
    left: 0;
    opacity: 0.95;
`,qW=({videoEl:n})=>{EK(2147483647,100);const e=n?.currentTime||0,t=n?.duration||0,r=e/t;let i=Math.round(r*100),s=5;return n?.height<200?s=3:n?.height<300&&(s=4),i=t<10&&i>98?100:i,be.createElement($W,{style:{width:`${i}%`},$barHeight:s,className:"hide-in-percy"})},HW=qW,GW=(n,e="")=>{switch(n){case 1:return"Aborted. The fetching process for the media resource was aborted by the user agent at the user's request.";case 2:return"Network Error. A network error of some description caused the user agent to stop fetching the media resource, after the resource was established to be usable.";case 3:return"Decode Error. An error of some description occurred while decoding the media resource, after the resource was established to be usable.";case 4:return`Can not play a video of type "${e.split(".").pop()}" on this platform.`;default:return""}},KW=(n,e,t,r,i)=>{const s=i+n;return!r.has(s)&&t>0&&e>t*n?(r.add(s),!0):!1},WW=[.25,.5,.75],jM="giphy-video",YW={IDLE:1},LM=({muted:n,ccEnabled:e=!1,ccLanguage:t="en",loop:r=!0,onStateChange:i,onTimeUpdate:s,onCanPlay:c,onFirstPlay:l,onWaiting:d,onMuted:h,onError:m,onEnded:g,onLoop:b,onQuartile:_,onEndFullscreen:R,setVideoEl:E,gif:A,width:M,percentWidth:F,height:j,volume:C=.7,className:N=jM,isInPlayer:D})=>{var S,k,P;const L=j||x0(A,M);let U;F&&(U=`${Math.round(L/M*100)}%`);const[z,V]=T.useState(UR(A.video,M,L)),le=T.useRef(0);z||console.warn(`GiphyJS No video content for id: ${A.id}`);const ve=T.useRef(Date.now()),K=T.useRef(!1),oe=T.useRef(0),ee=T.useRef(0),Me=T.useRef(new Set);T.useEffect(()=>{ve.current=Date.now(),K.current=!1,oe.current=1,ee.current=0,Me.current=new Set},[A.id]);const je=T.useRef(null);T.useEffect(()=>{const Re=UR(A.video,M,L);je.current&&z?.url&&Re.url!==z.url&&(z.url.indexOf(String(A.id))!==-1&&(le.current=je.current.currentTime),V(Re))},[M,j,A.video,L,z?.url,A.id]),T.useEffect(()=>{je.current&&z?.url&&le.current&&(je.current.currentTime=le.current,le.current=0)},[z?.url,le]);const q=T.useCallback(()=>{var Re;const He=je.current,de=(Re=He?.error)==null?void 0:Re.code;if(de&&He?.src){const Ie=GW(de,He?.src);console.error(Ie),m?.(de)}},[m]),te=T.useCallback(()=>{i?.("playing"),K.current||(K.current=!0,A.analytics_response_payload&&nT({actionType:"START",analyticsResponsePayload:A.analytics_response_payload}),l?.(Date.now()-ve.current))},[l,i,A]),fe=T.useCallback(()=>i?.("paused"),[i]),Se=T.useCallback(()=>{const Re=je.current;if(Re){const He=Re.currentTime;WW.some(de=>KW(de,He,Re.duration,Me.current,oe.current)?(_?.(de),!0):!1),s?.(He||0)}},[_,s]),Oe=T.useCallback(()=>c?.(),[c]),Te=T.useCallback(()=>{const Re=je.current;Re?.currentTime!==0&&Re?.networkState!==YW.IDLE&&d?.(++ee.current)},[d]),we=T.useCallback(()=>{r&&je.current&&je.current.play(),b?.(oe.current),oe.current=oe.current+1,K.current&&g?.()},[g,r,b]),Ge=T.useCallback(()=>R?.(),[R]),Ke=T.useCallback(Re=>sT(void 0,null,function*(){if(Re){const He=Re.play();if(He!==void 0)try{yield He,h?.(!1)}catch{Re.muted=!0,h?.(!0),Re.play()}}}),[h]);T.useEffect(()=>{const Re=je.current;Re&&(Ke(Re),E?.(Re),isNaN(C)||(Re.volume=C))},[]),T.useEffect(()=>{const Re=je.current;return Re&&(Re.addEventListener("play",te),Re.addEventListener("pause",fe),Re.addEventListener("error",q),Re.addEventListener("timeupdate",Se),Re.addEventListener("canplay",Oe),Re.addEventListener("ended",we),Re.addEventListener("waiting",Te),Re.addEventListener("webkitendfullscreen",Ge)),()=>{Re&&(Re.removeEventListener("play",te),Re.removeEventListener("pause",fe),Re.removeEventListener("error",q),Re.removeEventListener("timeupdate",Se),Re.removeEventListener("canplay",Oe),Re.removeEventListener("ended",we),Re.removeEventListener("waiting",Te),Re.removeEventListener("webkitendfullscreen",Ge))}},[te,fe,q,Se,Oe,we,Te,Ge]);const Ce=(P=(k=(S=A.video)==null?void 0:S.captions)==null?void 0:k[t])==null?void 0:P.vtt;return z?.url?be.createElement("video",{crossOrigin:"anonymous",draggable:!0,className:N,width:D?"100%":F||M,height:D?"100%":U||L,muted:n,autoPlay:!0,playsInline:!0,ref:je,src:z?.url,"data-giphy-id":A.id},e&&Ce&&be.createElement("track",{label:"English",kind:"subtitles",srcLang:t,src:Ce,default:!0})):null};LM.className=jM;var UM=LM,QW=it.div`
    position: relative;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: black;
    font-family: interface, helvetica, arial;
    -webkit-font-smoothing: antialiased;
`,XW=it.div`
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
    cursor: pointer;
`,JW=it.div`
    position: absolute;
    top: 10px;
    right: 10px;
    left: 10px;
    bottom: 0;
    display: flex;
    justify-content: space-between;
    opacity: ${n=>n.$isHovered?1:0};
    transition: opacity ease-out 250ms;
    align-items: flex-start;
`,ZW=it.div`
    font-size: 22px;
    color: white;
    margin-bottom: 5px;
    font-weight: bold;
    text-overflow: ellipsis;
    overflow: hidden;
    white-space: nowrap;
    user-select: none;
    cursor: pointer;
`,eY=it.div`
    position: relative;
    min-width: 0;
`,tY=it.div`
    &:before {
        background: linear-gradient(rgba(18, 18, 18, 0.6), rgba(0, 0, 0, 0));
        content: '';
        height: ${n=>n.$isLargePlayer?125:75}px;
        left: 0;
        pointer-events: none;
        position: absolute;
        top: 0;
        width: 100%;
    }
    &:after {
        background: linear-gradient(rgba(0, 0, 0, 0), rgba(18, 18, 18, 0.6));
        content: '';
        height: ${n=>n.$isLargePlayer?125:75}px;
        left: 0;
        pointer-events: none;
        position: absolute;
        bottom: 0;
        width: 100%;
    }
`,nY=300,rY=4e3,iY=n=>{const{style:e,width:t,percentWidth:r,hideMute:i,hideAttribution:s,hideProgressBar:c,hideTitle:l,className:d,persistentControls:h,gif:m,overlay:g}=n,[b,_]=T.useState(!1),[R,E]=T.useState(null),[A,M]=T.useState(n.muted),[F,j]=T.useState(!1),{setVideoEl:C,onMuted:N,onUserMuted:D}=n,S=n.height||x0(m,t);let k;r&&(k=`${Math.round(S/t*100)}%`);const[,P,L]=SK(()=>{_(!1)},rY),U=T.useCallback(K=>{N?.(K),j(K)},[j,N]),z=T.useCallback(K=>{C?.(K),E(K)},[C,E]),V=()=>{F?(j(!1),M(!1)):M(!A)};T.useEffect(()=>{M(n.muted)},[n.muted]);const le=h||b,ve=S>=nY;return T.useEffect(()=>(le?L():P(),()=>P()),[le,P,L]),be.createElement(QW,{className:d,style:Za({width:r||t,height:k||S},e),onMouseOver:()=>_(!0),onMouseLeave:()=>_(!1),onMouseMove:()=>{_(!0),L()},onClick:K=>{D?.(!(A||F)),R?.play(),K.preventDefault(),V()}},be.createElement(UM,iT(Za({},n),{isInPlayer:!0,onMuted:U,setVideoEl:z,muted:A})),le&&be.createElement(tY,{$isLargePlayer:ve}),be.createElement(JW,{$isHovered:le},be.createElement(eY,null,!l&&ve&&be.createElement(ZW,{onClick:K=>{K.preventDefault(),K.stopPropagation(),window.open(m.url,"_blank")}},m.title),R&&!s?be.createElement(zW,{gif:m}):null),!i&&be.createElement(XW,null,A||F?be.createElement(BW,null):be.createElement(FW,null))),le&&!c&&R?be.createElement(HW,{videoEl:R}):null,g&&be.createElement(g,{gif:m,isHovered:b,width:t,height:S}))},sY=n=>(n.overlay&&!n.controls&&console.warn(`${Tr.PREFIX}: Overlays only work when controls are enabled`),n.controls?be.createElement(iY,Za({},n)):be.createElement(UM,Za({},n))),aY=sY;it.div`
    position: absolute;
    top: 0;
    left: 0;
    bottom: 0;
    right: 0;
    height: 100%;
    width: 100%;
`;it(aY)`
    height: 100%;
    display: inline-block;
    object-fit: fill;
    pointer-events: none;
    background: rgb(0, 0, 0, 0);
`;it.div`
    position: absolute;
    top: 6px;
    right: 6px;
    cursor: pointer;
    opacity: ${n=>n.$isHovered?1:.8};
    transition: opacity ease-out 800ms;
`;Px("X-GIPHY-SDK-NAME","ReactSDK");const oY="9S3bPWJJTZZdynuLXHFSBstNA5B6tes9",T4=new v3(oY),cY=({onSelect:n})=>{const[e,t]=T.useState(""),[r,i]=T.useState(400),s=T.useRef(null);T.useEffect(()=>{s.current&&i(s.current.offsetWidth)},[]);const c=l=>e?T4.search(e,{offset:l,limit:10}):T4.trending({offset:l,limit:10});return f.jsxs("div",{className:"w-full h-full flex flex-col bg-dark-sidebar rounded-lg overflow-hidden border border-dark-hover",children:[f.jsx("div",{className:"p-3 border-b border-dark-hover",children:f.jsxs("div",{className:"relative",children:[f.jsx("input",{type:"text",placeholder:"Search GIFs...",value:e,onChange:l=>t(l.target.value),className:"w-full bg-dark-input text-dark-text px-4 py-2 pl-10 rounded outline-none border border-transparent focus:border-brand-primary transition-all",autoFocus:!0}),f.jsx(MS,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-dark-muted",size:20})]})}),f.jsx("div",{ref:s,className:"flex-1 overflow-y-auto overflow-x-hidden p-2 custom-scrollbar",children:r>0&&f.jsx(IM,{width:r-20,columns:3,fetchGifs:c,onGifClick:(l,d)=>{d.preventDefault(),n(l.images.original.url)},noLink:!0,hideAttribution:!0,gutter:6},e)})]})},lY="9S3bPWJJTZZdynuLXHFSBstNA5B6tes9",k4=new v3(lY),uY=({onSelect:n})=>{const[e,t]=T.useState(""),[r,i]=T.useState(400),s=T.useRef(null);T.useEffect(()=>{s.current&&i(s.current.offsetWidth)},[]);const c=l=>e?k4.search(e,{offset:l,limit:10,type:"stickers"}):k4.trending({offset:l,limit:10,type:"stickers"});return f.jsxs("div",{className:"w-full h-full flex flex-col bg-dark-sidebar rounded-lg overflow-hidden border border-dark-hover",children:[f.jsx("div",{className:"p-3 border-b border-dark-hover bg-brand-primary/10",children:f.jsxs("div",{className:"relative",children:[f.jsx("input",{type:"text",placeholder:"Search Premium Stickers...",value:e,onChange:l=>t(l.target.value),className:"w-full bg-dark-input text-dark-text px-4 py-2 pl-10 rounded outline-none border border-transparent focus:border-brand-primary transition-all placeholder:text-dark-muted",autoFocus:!0}),f.jsx(MS,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-dark-muted",size:20})]})}),f.jsx("div",{className:"px-3 py-1 bg-brand-primary/5 text-[10px] text-brand-primary text-center font-bold tracking-wider uppercase",children:"Premium Stickers"}),f.jsx("div",{ref:s,className:"flex-1 overflow-y-auto overflow-x-hidden p-2 custom-scrollbar",children:r>0&&f.jsx(IM,{width:r-20,columns:3,fetchGifs:c,onGifClick:(l,d)=>{d.preventDefault(),n(l.images.original.url)},noLink:!0,hideAttribution:!0,gutter:6},e)})]})},dY=({onSubmit:n,onClose:e})=>{const[t,r]=T.useState(""),[i,s]=T.useState(["",""]),[c,l]=T.useState(!1),[d,h]=T.useState(!1),m=()=>{i.length<10&&s([...i,""])},g=E=>{i.length>2&&s(i.filter((A,M)=>M!==E))},b=(E,A)=>{const M=[...i];M[E]=A,s(M)},_=()=>{const E=i.filter(A=>A.trim()!=="");t.trim()&&E.length>=2&&(n({question:t.trim(),options:E,multipleChoice:c,anonymous:d}),e())},R=t.trim()&&i.filter(E=>E.trim()).length>=2;return f.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50",children:f.jsxs("div",{className:"bg-dark-sidebar rounded-lg w-full max-w-md mx-4 shadow-2xl animate-fadeIn",children:[f.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-dark-hover",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx(OS,{className:"text-brand-primary",size:24}),f.jsx("h2",{className:"text-lg font-semibold text-dark-text",children:"Create Poll"})]}),f.jsx("button",{onClick:e,className:"p-1 hover:bg-dark-hover rounded transition-colors",children:f.jsx(mr,{className:"text-dark-muted",size:20})})]}),f.jsxs("div",{className:"p-4 space-y-4 max-h-[60vh] overflow-y-auto custom-scrollbar",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-dark-muted mb-2",children:"Question"}),f.jsx("input",{type:"text",value:t,onChange:E=>r(E.target.value),placeholder:"Ask a question...",maxLength:300,className:`w-full bg-dark-input text-dark-text px-4 py-3 rounded-lg
                         border border-transparent focus:border-brand-primary
                         outline-none transition-colors`,autoFocus:!0}),f.jsxs("div",{className:"text-xs text-dark-muted mt-1 text-right",children:[t.length,"/300"]})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-dark-muted mb-2",children:"Options"}),f.jsx("div",{className:"space-y-2",children:i.map((E,A)=>f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsxs("span",{className:"text-dark-muted text-sm w-6",children:[A+1,"."]}),f.jsx("input",{type:"text",value:E,onChange:M=>b(A,M.target.value),placeholder:`Option ${A+1}`,maxLength:100,className:`flex-1 bg-dark-input text-dark-text px-3 py-2 rounded
                               border border-transparent focus:border-brand-primary
                               outline-none transition-colors text-sm`}),i.length>2&&f.jsx("button",{onClick:()=>g(A),className:"p-1 hover:bg-red-500/20 text-red-400 rounded transition-colors",children:f.jsx(mr,{size:18})})]},A))}),i.length<10&&f.jsxs("button",{onClick:m,className:"mt-2 flex items-center gap-1 text-sm text-brand-primary hover:text-brand-primary/80 transition-colors",children:[f.jsx(Wu,{size:18}),"Add Option"]})]}),f.jsxs("div",{className:"space-y-3 pt-2 border-t border-dark-hover",children:[f.jsxs("label",{className:"flex items-center gap-3 cursor-pointer group",children:[f.jsx("div",{className:`w-5 h-5 rounded border-2 flex items-center justify-center transition-colors ${c?"bg-brand-primary border-brand-primary":"border-dark-muted group-hover:border-dark-text"}`,children:c&&f.jsx(Sl,{size:14,className:"text-white"})}),f.jsx("span",{className:"text-dark-text text-sm",children:"Allow multiple selections"}),f.jsx("input",{type:"checkbox",checked:c,onChange:E=>l(E.target.checked),className:"sr-only"})]}),f.jsxs("label",{className:"flex items-center gap-3 cursor-pointer group",children:[f.jsx("div",{className:`w-5 h-5 rounded border-2 flex items-center justify-center transition-colors ${d?"bg-brand-primary border-brand-primary":"border-dark-muted group-hover:border-dark-text"}`,children:d&&f.jsx(Sl,{size:14,className:"text-white"})}),f.jsx("span",{className:"text-dark-text text-sm",children:"Anonymous voting"}),f.jsx("input",{type:"checkbox",checked:d,onChange:E=>h(E.target.checked),className:"sr-only"})]})]})]}),f.jsxs("div",{className:"flex justify-end gap-2 p-4 border-t border-dark-hover",children:[f.jsx(ut,{variant:"secondary",onClick:e,children:"Cancel"}),f.jsx(ut,{variant:"primary",onClick:_,disabled:!R,children:"Create Poll"})]})]})})},hY=(n,e)=>{if(e===0)return"0 KB/s";const t=n/e;return t>1024*1024?`${(t/(1024*1024)).toFixed(1)} MB/s`:`${(t/1024).toFixed(0)} KB/s`},fY=n=>n.type.startsWith("image/")?"image":n.type.startsWith("video/")||n.type.startsWith("audio/")?"video":"auto",Rv=(n,e)=>new Promise((t,r)=>{const i="dcqipv1hn",s="lumo_upload",c=fY(n),l=`https://api.cloudinary.com/v1_1/${i}/${c}/upload`,d=new FormData;d.append("file",n),d.append("upload_preset",s);const h=n.name.replace(/\.[^/.]+$/,"").replace(/[^a-zA-Z0-9_-]/g,"_");d.append("public_id",h);const m=new XMLHttpRequest;m.open("POST",l);const g=Date.now();m.upload.onprogress=b=>{if(b.lengthComputable){const _=b.loaded/b.total*100,R=(Date.now()-g)/1e3,E=hY(b.loaded,R);e&&e(_,E)}},m.onload=()=>{if(m.status===200)try{const b=JSON.parse(m.responseText);t({url:b.secure_url,name:b.original_filename||n.name,type:b.resource_type,format:b.format,bytes:b.bytes})}catch{r(new Error("Invalid response from Cloudinary"))}else try{const b=JSON.parse(m.responseText);r(new Error(b.error?.message||`Upload failed with status ${m.status}`))}catch{r(new Error(`Upload failed with status ${m.status}`))}},m.onerror=()=>r(new Error("Network error during upload")),m.send(d)}),VM=({serverId:n,channelId:e,channel:t,userId:r,userProfile:i,userRole:s,users:c,replyingTo:l,onCancelReply:d})=>{const[h,m]=T.useState(""),[g,b]=T.useState(!1),[_,R]=T.useState(!1),[E,A]=T.useState(""),[M,F]=T.useState(0),[j,C]=T.useState(!1),[N,D]=T.useState(!1),[S,k]=T.useState(!1),[P,L]=T.useState(!1),[U,z]=T.useState(!1),[V,le]=T.useState({uploading:!1,progress:0,speed:""}),[ve,K]=T.useState(null),[oe,ee]=T.useState(null),[Me,je]=T.useState(""),[q,te]=T.useState(!1),[fe,Se]=T.useState(!1),[Oe,Te]=T.useState(0),we=T.useRef(null),Ge=T.useRef([]),Ke=T.useRef(null),Ce=T.useRef(!1),Re=T.useRef(0),He=T.useRef(null),de=T.useRef(null),{warning:Ie,error:qe,info:ot}=Ss(),$e=["owner","admin","moderator"].includes(s),Q=!t?.locked||$e,Pe="This channel is locked. Only staff can send messages.",Fe=W=>{const Z=de.current?.selectionStart||h.length,X=h.slice(0,Z)+W+h.slice(Z);m(X),C(!1),de.current?.focus()},ht=async W=>{if(D(!1),!(!h.trim()&&!Q))try{b(!0);const Z={text:W,userId:r,timestamp:bt(),mentions:[],replyTo:null};n?await Ln(St(_e,"servers",n,"channels",e,"messages"),Z):(await Ln(St(_e,"dms",e,"messages"),Z),await at(Be(_e,"dms",e),{lastMessage:{text:"GIF",userId:r,timestamp:bt()},updatedAt:bt(),hiddenFor:[]}))}catch(Z){console.error("Error sending GIF:",Z),qe("Failed to send GIF")}finally{b(!1)}},Vt=async W=>{if(k(!1),!(s==="admin"||s==="premium")){qe("Stickers are for Premium members only!");return}try{b(!0);const X={type:"sticker",text:W,userId:r,timestamp:bt(),mentions:[],replyTo:null};n?await Ln(St(_e,"servers",n,"channels",e,"messages"),X):(await Ln(St(_e,"dms",e,"messages"),X),await at(Be(_e,"dms",e),{lastMessage:{text:" Sticker",userId:r,timestamp:bt()},updatedAt:bt(),hiddenFor:[]}))}catch(X){console.error("Error sending Sticker:",X),qe("Failed to send Sticker")}finally{b(!1)}},Lt=async W=>{if(Q)try{b(!0);const Z={type:"poll",text:W.question,poll:{question:W.question,options:W.options,votes:{},multipleChoice:W.multipleChoice,anonymous:W.anonymous},userId:r,timestamp:bt(),mentions:[]};n?await Ln(St(_e,"servers",n,"channels",e,"messages"),Z):(await Ln(St(_e,"dms",e,"messages"),Z),await at(Be(_e,"dms",e),{lastMessage:{text:` Poll: ${W.question}`,userId:r,timestamp:bt()},updatedAt:bt(),hiddenFor:[]}))}catch(Z){console.error("Error creating poll:",Z),qe("Failed to create poll")}finally{b(!1)}},Yt=W=>{if(!W)return;const Z=s==="admin"||s==="premium"||i?.plan==="premium",X=Z?200*1024*1024:10*1024*1024;if(W.size>X){qe(`File too large! The limit is ${Z?"200MB":"10MB"}. ${Z?"":"Upgrade to Premium for larger uploads."}`);return}let Ne=null;(W.type.startsWith("image/")||W.type.startsWith("video/"))&&(Ne=URL.createObjectURL(W)),K(W),ee(Ne),je(""),L(!1),He.current&&(He.current.value="")},In=W=>{Yt(W.target.files?.[0])},fi=()=>document.querySelector('[role="dialog"]')!==null||document.querySelector(".modal-overlay")!==null||document.body.style.overflow==="hidden",Ni=W=>{if(W.preventDefault(),W.stopPropagation(),fi())return;Re.current++,W.dataTransfer.types&&Array.from(W.dataTransfer.types).includes("Files")&&te(!0)},pi=W=>{W.preventDefault(),W.stopPropagation(),Re.current--,Re.current===0&&te(!1)},ao=W=>{W.preventDefault(),W.stopPropagation()},vn=W=>{if(W.preventDefault(),W.stopPropagation(),te(!1),Re.current=0,fi())return;const Z=W.dataTransfer.files;Z&&Z.length>0&&Yt(Z[0])};T.useEffect(()=>(window.addEventListener("dragenter",Ni),window.addEventListener("dragleave",pi),window.addEventListener("dragover",ao),window.addEventListener("drop",vn),()=>{window.removeEventListener("dragenter",Ni),window.removeEventListener("dragleave",pi),window.removeEventListener("dragover",ao),window.removeEventListener("drop",vn)}),[]);const fa=()=>{oe&&URL.revokeObjectURL(oe),K(null),ee(null),je("")},pa=async()=>{if(ve)try{le({uploading:!0,progress:0,speed:"0 KB/s"});let W,Z;if(ve.type.startsWith("image/"))W=await $S(ve,(tt,xt)=>{le({uploading:!0,progress:tt,speed:xt})});else{const Je=await Rv(ve,(tt,xt)=>{le({uploading:!0,progress:tt,speed:xt})});W=Je.url,Z=Je}const Ne={text:Me.trim()?`${W}
${Me}`:W,userId:r,timestamp:bt(),mentions:[],replyTo:null};n?await Ln(St(_e,"servers",n,"channels",e,"messages"),Ne):(await Ln(St(_e,"dms",e,"messages"),Ne),await at(Be(_e,"dms",e),{lastMessage:{text:ve.type.startsWith("image/")?" Image":" Attachment",userId:r,timestamp:bt()},updatedAt:bt(),hiddenFor:[]})),fa()}catch(W){console.error("Error uploading file:",W),qe("Failed to upload file")}finally{le({uploading:!1,progress:0,speed:"",statusText:""})}},sn=async()=>{if(Q)try{const W=await navigator.mediaDevices.getUserMedia({audio:!0}),Z=new MediaRecorder(W);we.current=Z,Ge.current=[],Ce.current=!1,Z.ondataavailable=X=>{X.data.size>0&&Ge.current.push(X.data)},Z.onstop=()=>{if(W.getTracks().forEach(X=>X.stop()),Ce.current){const X=new Blob(Ge.current,{type:"audio/webm"});ln(X)}Ge.current=[]},Z.start(),Se(!0),Te(0),Ke.current=setInterval(()=>{Te(X=>X+1)},1e3)}catch(W){console.error("Error accessing microphone:",W),W.name==="NotAllowedError"?qe("Microphone permission denied. Please enable it in browser settings."):qe("Could not access microphone.")}},Gt=()=>{we.current&&fe&&(Ce.current=!0,we.current.stop(),clearInterval(Ke.current),Se(!1))},Nr=()=>{we.current&&fe&&(Ce.current=!1,we.current.stop(),clearInterval(Ke.current),Se(!1))},ln=async W=>{if(!W||W.size===0)return;const Z=`voice_message_${Date.now()}.webm`,X=new File([W],Z,{type:"audio/webm"});try{le({uploading:!0,progress:0,speed:"0 KB/s",statusText:"Sending Voice Message..."});const Ne=await Rv(X,(tt,xt)=>{le({uploading:!0,progress:tt,speed:xt,statusText:"Sending Voice Message..."})}),Je={type:"audio",text:Ne.url,metadata:{duration:Oe,format:Ne.format,bytes:Ne.bytes},userId:r,timestamp:bt(),mentions:[],replyTo:null};n?await Ln(St(_e,"servers",n,"channels",e,"messages"),Je):(await Ln(St(_e,"dms",e,"messages"),Je),await at(Be(_e,"dms",e),{lastMessage:{text:" Voice Message",userId:r,timestamp:bt()},updatedAt:bt(),hiddenFor:[]}))}catch(Ne){console.error("Error sending voice message:",Ne),qe("Failed to send voice message")}finally{le({uploading:!1,progress:0,speed:"",statusText:""})}};T.useEffect(()=>{const W=h.length,Z=h.slice(0,W),X=Z.lastIndexOf("@");if(X!==-1){const Ne=Z.slice(X+1);if(!Ne.includes(" ")){A(Ne.toLowerCase()),F(X),R(!0);return}}R(!1)},[h]);const Ts=()=>{const W=[];return n&&("everyone".startsWith(E.toLowerCase())&&W.push({id:"everyone",displayName:"everyone",type:"special"}),["admin","moderator","member"].forEach(X=>{X.startsWith(E.toLowerCase())&&W.push({id:`role-${X}`,displayName:X,type:"role"})})),c&&c.filter(X=>X.id!==r&&X.displayName.toLowerCase().startsWith(E.toLowerCase())).forEach(X=>{W.push({...X,type:"user"})}),W.slice(0,8)},Ii=W=>{const Z=h.slice(0,M),X=h.slice(M+E.length+1),Ne=`${Z}@${W.displayName} ${X}`;m(Ne),R(!1)};T.useEffect(()=>{const W=Z=>{document.activeElement!==de.current&&(document.activeElement?.tagName==="INPUT"||document.activeElement?.tagName==="TEXTAREA"||Z.ctrlKey||Z.metaKey||Z.altKey||["Escape","Tab","Enter","Backspace","Delete"].includes(Z.key)||document.querySelector('[role="dialog"]')||Z.key.length===1&&de.current?.focus())};return window.addEventListener("keydown",W),()=>window.removeEventListener("keydown",W)},[]);const oo=async W=>{if(W.preventDefault(),!!h.trim()&&!(!e||!r)){i?.isMuted&&Ie("You are muted and cannot send messages"),b(!0);try{const Z=/@(\w+)/g,X=[];let Ne;for(;(Ne=Z.exec(h))!==null;){const tt=Ne[1].toLowerCase();if(tt==="everyone")c.forEach(xt=>{xt.id!==r&&X.push(xt.id)});else if(["admin","moderator","member"].includes(tt))c.forEach(xt=>{xt.role===tt&&xt.id!==r&&X.push(xt.id)});else{const xt=c.find(_n=>_n.displayName.toLowerCase()===tt);xt&&xt.id!==r&&X.push(xt.id)}}const Je={text:h.trim(),userId:r,timestamp:bt(),mentions:[...new Set(X)],replyTo:l?{messageId:l.id,userId:l.userId,text:l.text.substring(0,100)}:null};if(n){if(await Ln(St(_e,"servers",n,"channels",e,"messages"),Je),X.length>0){const tt=X.map(xt=>at(Be(_e,"users",xt),{[`unreadMentions.${n}.count`]:fv(1),[`unreadMentions.${n}.lastMentionAt`]:bt(),[`unreadMentions.${n}.lastMentionText`]:h.trim().substring(0,50)}).catch(_n=>{console.error("Error updating mention for user:",xt,_n)}));await Promise.all(tt)}}else await Ln(St(_e,"dms",e,"messages"),Je),await at(Be(_e,"dms",e),{lastMessage:{text:h.trim().substring(0,100),userId:r,timestamp:bt()},updatedAt:bt(),hiddenFor:[]});m(""),d&&d()}catch(Z){console.error("Error sending message:",Z),qe("Failed to send message")}finally{b(!1)}}};return f.jsxs("div",{className:"px-4 pb-6 relative",children:[l&&f.jsxs("div",{className:"mb-2 bg-dark-sidebar border-l-4 border-green-400 p-3 rounded flex items-start justify-between",children:[f.jsxs("div",{className:"flex-1 min-w-0",children:[f.jsxs("div",{className:"text-xs text-green-400 font-semibold mb-1",children:["Replying to ",c.find(W=>W.id===l.userId)?.displayName||"Unknown"]}),f.jsx("div",{className:"text-sm text-dark-muted truncate",children:l.text})]}),f.jsx("button",{onClick:d,className:"ml-2 text-dark-muted hover:text-dark-text transition-colors",title:"Cancel reply",children:f.jsx(mr,{size:18})})]}),_&&f.jsx("div",{className:"absolute bottom-full left-4 right-4 mb-2 bg-dark-sidebar rounded-lg shadow-lg border border-dark-hover max-h-48 overflow-y-auto",children:Ts().map(W=>f.jsx("button",{onClick:()=>Ii(W),className:"w-full px-4 py-2 text-left hover:bg-dark-hover transition-colors flex items-center gap-2",children:W.type==="special"||W.type==="role"?f.jsxs("span",{className:"text-dark-text font-medium",children:["@",W.displayName,W.type==="role"&&f.jsx("span",{className:"ml-2 text-xs text-dark-muted",children:"(role)"})]}):f.jsxs(f.Fragment,{children:[W.photoUrl?f.jsx("img",{src:W.photoUrl,alt:W.displayName,className:"w-8 h-8 rounded-full object-cover",onError:Z=>{Z.target.style.display="none",Z.target.nextSibling.style.display="flex"}}):null,f.jsx("div",{className:"w-8 h-8 rounded-full bg-brand-primary flex items-center justify-center text-white font-semibold text-sm",style:{display:W.photoUrl?"none":"flex"},children:W.displayName[0].toUpperCase()}),f.jsxs("span",{className:"text-dark-text",children:["@",W.displayName]})]})},W.id))}),f.jsxs("form",{onSubmit:oo,className:"relative",children:[j&&f.jsx(cH,{onSelect:Fe,onClose:()=>C(!1)}),fe?f.jsxs("div",{className:"absolute inset-x-0 top-0 bottom-0 bg-dark-input rounded-lg flex items-center justify-between px-4 z-20 border border-red-500/50 animate-pulse-border",children:[f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500 animate-pulse"}),f.jsxs("span",{className:"text-dark-text font-mono font-medium",children:[Math.floor(Oe/60),":",(Oe%60).toString().padStart(2,"0")]})]}),f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx("button",{type:"button",onClick:Nr,className:"p-2 text-dark-muted hover:text-red-400 transition-colors",title:"Cancel",children:f.jsx(Ka,{size:22})}),f.jsx("button",{type:"button",onClick:Gt,className:"p-2 text-red-500 hover:text-red-400 transition-colors bg-red-500/10 rounded-full",title:"Send",children:f.jsx(i1,{size:22})})]})]}):null,V.uploading&&f.jsxs("div",{className:"absolute -top-12 left-0 right-0 bg-dark-sidebar border border-dark-hover rounded-lg p-2 shadow-lg animate-fade-in-up z-50",children:[f.jsxs("div",{className:"flex items-center justify-between text-xs text-dark-text mb-1",children:[f.jsx("span",{className:"font-semibold",children:V.statusText||"Uploading..."}),f.jsxs("span",{className:"text-dark-muted",children:[Math.round(V.progress),"%  ",V.speed]})]}),f.jsx("div",{className:"h-1.5 bg-dark-hover rounded-full overflow-hidden",children:f.jsx("div",{className:"h-full bg-brand-primary transition-all duration-200 ease-out",style:{width:`${V.progress}%`}})})]}),ve&&f.jsx("div",{className:"fixed inset-0 z-[100] bg-black/80 flex items-center justify-center p-4",children:f.jsxs("div",{className:"bg-dark-bg border border-dark-hover rounded-lg shadow-2xl max-w-lg w-full overflow-hidden flex flex-col p-4",children:[f.jsxs("h3",{className:"text-dark-text font-semibold mb-4 flex items-center gap-2",children:[f.jsx(yv,{className:"text-brand-primary"}),"Upload Attachment"]}),f.jsx("div",{className:"flex-1 w-full bg-black/50 rounded-lg overflow-hidden flex items-center justify-center mb-4 border border-dark-hover min-h-[200px] max-h-[400px]",children:oe?f.jsx("img",{src:oe,alt:"Preview",className:"max-w-full max-h-full object-contain"}):f.jsxs("div",{className:"flex flex-col items-center gap-2 text-dark-muted",children:[f.jsx("div",{className:"text-6xl",children:""}),f.jsx("div",{className:"text-sm font-medium text-dark-text max-w-xs truncate px-4",children:ve.name}),f.jsxs("div",{className:"text-xs",children:[(ve.size/1024/1024).toFixed(2)," MB"]})]})}),f.jsx("input",{type:"text",value:Me,onChange:W=>je(W.target.value),placeholder:"Add a caption... (optional)",className:"w-full bg-dark-input text-dark-text px-4 py-2 rounded-lg border border-dark-hover focus:border-brand-primary outline-none mb-4",onKeyDown:W=>{W.key==="Enter"&&!V.uploading&&pa()}}),f.jsxs("div",{className:"flex justify-between items-center",children:[f.jsx("button",{onClick:fa,className:"px-4 py-2 text-dark-text hover:text-dark-muted transition-colors font-medium",disabled:V.uploading,children:"Cancel"}),f.jsx("button",{onClick:pa,className:"px-6 py-2 bg-brand-primary hover:bg-brand-secondary text-white rounded-md transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",disabled:V.uploading,children:V.uploading?f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Uploading..."]}):f.jsxs(f.Fragment,{children:[f.jsx(i1,{size:18}),"Send"]})})]}),V.uploading&&f.jsxs("div",{className:"mt-4",children:[f.jsxs("div",{className:"flex justify-between text-xs text-dark-muted mb-1",children:[f.jsx("span",{children:V.speed}),f.jsxs("span",{children:[Math.round(V.progress),"%"]})]}),f.jsx("div",{className:"h-1 bg-dark-hover rounded-full overflow-hidden",children:f.jsx("div",{className:"h-full bg-brand-primary transition-all duration-200",style:{width:`${V.progress}%`}})})]})]})}),S&&f.jsxs("div",{className:"absolute bottom-full right-0 mb-4 w-[85vw] max-w-[400px] h-[450px] shadow-2xl rounded-lg z-50 animate-fade-in-up",children:[f.jsx("div",{className:"fixed inset-0 z-[-1]",onClick:()=>k(!1)}),f.jsx(uY,{onSelect:Vt})]}),N&&f.jsxs("div",{className:"absolute bottom-full right-0 mb-4 w-[85vw] max-w-[400px] h-[450px] shadow-2xl rounded-lg z-50",children:[f.jsx("div",{className:"fixed inset-0 z-[-1]",onClick:()=>D(!1)}),f.jsx(cY,{onSelect:ht})]}),f.jsx("input",{ref:de,type:"text",value:h,onChange:W=>m(W.target.value),onKeyDown:W=>{if(W.key==="Tab"&&_){W.preventDefault();const Z=Ts();Z.length>0&&Ii(Z[0])}},onPaste:async W=>{const Z=W.clipboardData.items;for(let X=0;X<Z.length;X++)for(let Ne=0;Ne<Z.length;Ne++)if(Z[Ne].kind==="file"){W.preventDefault(),Yt(Z[Ne].getAsFile());break}},placeholder:Q?i?.isMuted?"You are muted":"Type a message...":Pe,disabled:g||i?.isMuted||!Q||ve!==null,className:`w-full bg-dark-input text-dark-text px-12 py-3 pr-48 rounded-lg
                     border border-transparent focus:border-brand-primary
                     outline-none transition-colors duration-200
                     placeholder:text-dark-muted
                     disabled:opacity-50 disabled:cursor-not-allowed select-text`}),q&&f.jsxs("div",{className:"fixed inset-0 z-[200] bg-brand-primary/90 flex flex-col items-center justify-center animate-fade-in pointer-events-none",children:[f.jsx("div",{className:"bg-white/10 p-8 rounded-full mb-6",children:f.jsx(oR,{size:64,className:"text-white animate-bounce"})}),f.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Drop your file here"}),f.jsx("p",{className:"text-white/80",children:"to upload instantly"})]}),f.jsxs("div",{className:"absolute left-3 top-0 bottom-0 flex items-center plus-menu-container",children:[" ",f.jsx("button",{type:"button",onClick:()=>L(!P),className:`text-dark-muted hover:text-brand-primary transition-colors flex items-center justify-center ${P?"text-brand-primary":""}`,title:"Add attachment",disabled:!Q,children:f.jsx(oR,{size:26})}),P&&f.jsxs("div",{className:"absolute bottom-full left-0 mb-2 w-48 bg-dark-sidebar border border-dark-hover rounded-lg shadow-xl overflow-hidden z-50 animate-fade-in-up",children:[f.jsxs("button",{type:"button",onClick:()=>{He.current?.click(),L(!1)},className:"w-full flex items-center gap-3 px-4 py-3 hover:bg-dark-hover text-left transition-colors",children:[f.jsx(yv,{className:"text-green-400",size:20}),f.jsx("span",{className:"text-sm text-dark-text font-medium",children:"Upload File"})]}),f.jsxs("button",{type:"button",onClick:()=>{z(!0),L(!1)},className:"w-full flex items-center gap-3 px-4 py-3 hover:bg-dark-hover text-left transition-colors",disabled:!n,children:[f.jsx(OS,{className:"text-brand-primary",size:20}),f.jsx("span",{className:"text-sm text-dark-text font-medium",children:"Create Poll"})]})]})]}),f.jsx("input",{type:"file",ref:He,onChange:In,className:"hidden"}),f.jsxs("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 flex items-center gap-2",children:[f.jsx("button",{type:"button",onClick:()=>D(!N),className:`text-dark-muted hover:text-brand-primary
                        transition-colors border-2 border-current rounded px-1 text-[10px] font-bold h-6 flex items-center justify-center mr-1`,title:"Add GIF",children:"GIF"}),s==="admin"||s==="premium"||i?.badges?.includes("premium")||i?.plan==="premium"?f.jsx("button",{type:"button",onClick:()=>k(!S),className:`transition-colors ${S?"text-brand-primary":"text-dark-muted hover:text-brand-primary"}`,title:"Premium Stickers",children:f.jsx(jB,{size:24})}):null,f.jsx("button",{type:"button",onClick:()=>C(!j),className:`text-dark-muted hover:text-brand-primary
                       transition-colors`,title:"Add emoji",children:f.jsx(XP,{size:24})}),!h.trim()&&f.jsx("button",{type:"button",onClick:sn,className:"text-dark-muted hover:text-brand-primary transition-colors",title:"Record Voice Message",disabled:g||i?.isMuted||!Q,children:f.jsx(_l,{size:24})}),f.jsx("button",{type:"submit",disabled:!h.trim()||g||i?.isMuted||!Q,className:`text-dark-muted hover:text-brand-primary
                       transition-colors disabled:opacity-50 disabled:cursor-not-allowed ml-1`,children:f.jsx(i1,{size:24})})]})]}),U&&f.jsx(dY,{onSubmit:Lt,onClose:()=>z(!1)})]})},zM=({messages:n,users:e,onResultClick:t})=>{const[r,i]=T.useState(""),[s,c]=T.useState([]),[l,d]=T.useState(!1),h=g=>{if(i(g),!g.trim()){c([]);return}const b=n.filter(_=>_.text.toLowerCase().includes(g.toLowerCase())).slice(0,20);c(b)},m=g=>e.find(b=>b.id===g)||{displayName:"Unknown"};return l?f.jsxs("div",{className:"relative flex-1 max-w-md",children:[f.jsx("input",{type:"text",value:r,onChange:g=>h(g.target.value),placeholder:"Search messages...",autoFocus:!0,className:`w-full bg-dark-input text-dark-text px-4 py-2 pr-10 rounded-lg
                   border border-transparent focus:border-brand-primary
                   outline-none transition-colors placeholder:text-dark-muted`}),f.jsx("button",{onClick:()=>{d(!1),i(""),c([])},className:"absolute right-2 top-1/2 -translate-y-1/2 text-dark-muted hover:text-dark-text",children:f.jsx(mr,{size:20})}),s.length>0&&f.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-dark-sidebar border border-dark-hover rounded-lg shadow-xl max-h-96 overflow-y-auto z-50",children:s.map(g=>f.jsxs("button",{onClick:()=>{t&&t(g),d(!1),i(""),c([])},className:"w-full px-4 py-3 text-left hover:bg-dark-hover transition-colors border-b border-dark-hover last:border-b-0",children:[f.jsx("div",{className:"text-xs text-brand-primary font-semibold mb-1",children:m(g.userId).displayName}),f.jsx("div",{className:"text-sm text-dark-text line-clamp-2",children:g.text})]},g.id))})]}):f.jsx("button",{onClick:()=>d(!0),className:"p-2 hover:bg-dark-hover rounded transition-colors",title:"Search messages",children:f.jsx(MS,{size:20,className:"text-dark-muted"})})},pY=({messages:n,users:e,onClose:t,onJumpToMessage:r})=>{const i=n.filter(c=>c.pinned),s=c=>e.find(l=>l.id===c)||{displayName:"Unknown"};return i.length===0?f.jsxs("div",{className:"w-80 bg-dark-sidebar border-l border-dark-hover h-full flex flex-col",children:[f.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-dark-hover",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx(Yu,{className:"text-blue-400",size:20}),f.jsx("h3",{className:"font-semibold text-dark-text",children:"Pinned Messages"})]}),f.jsx("button",{onClick:t,className:"text-dark-muted hover:text-dark-text transition-colors",children:f.jsx(mr,{size:20})})]}),f.jsx("div",{className:"flex-1 flex items-center justify-center text-dark-muted text-sm",children:"No pinned messages"})]}):f.jsxs("div",{className:"w-80 bg-dark-sidebar border-l border-dark-hover h-full flex flex-col",children:[f.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-dark-hover",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx(Yu,{className:"text-blue-400",size:20}),f.jsx("h3",{className:"font-semibold text-dark-text",children:"Pinned Messages"}),f.jsxs("span",{className:"text-xs text-dark-muted",children:["(",i.length,")"]})]}),f.jsx("button",{onClick:t,className:"text-dark-muted hover:text-dark-text transition-colors",children:f.jsx(mr,{size:20})})]}),f.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:i.map(c=>{const l=s(c.userId);return f.jsx("div",{onClick:()=>r(c.id),className:"bg-dark-bg p-3 rounded-lg cursor-pointer hover:bg-dark-hover transition-colors border border-transparent hover:border-brand-primary",children:f.jsxs("div",{className:"flex items-start gap-2 mb-2",children:[l.photoUrl?f.jsx("img",{src:l.photoUrl,alt:l.displayName,className:"w-8 h-8 rounded-full object-cover",onError:d=>{d.target.style.display="none",d.target.nextSibling.style.display="flex"}}):null,f.jsx("div",{className:"w-8 h-8 rounded-full bg-brand-primary flex items-center justify-center text-white font-semibold text-sm",style:{display:l.photoUrl?"none":"flex"},children:l.displayName?.[0]?.toUpperCase()||"U"}),f.jsxs("div",{className:"flex-1 min-w-0",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("span",{className:"font-semibold text-dark-text text-sm",children:l.displayName}),f.jsx("span",{className:"text-xs text-dark-muted",children:v0(c.timestamp)})]}),f.jsx("div",{className:"text-dark-text text-sm mt-1 line-clamp-3",children:f.jsx(i3,{children:c.text})}),c.pinnedBy&&f.jsxs("div",{className:"text-xs text-blue-400 mt-2 flex items-center gap-1",children:[f.jsx(Yu,{size:12}),f.jsxs("span",{children:["Pinned by ",s(c.pinnedBy).displayName]})]})]})]})},c.id)})})]})},mY=({currentStatus:n,onStatusChange:e,onClose:t})=>{const[r,i]=T.useState(!1),[s,c]=T.useState(""),[l,d]=T.useState(""),h=b=>{e(b),t()},m=()=>{l.trim()&&(e({emoji:s,text:l.trim(),type:"custom"}),t())},g=()=>{e(null),t()};return f.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:f.jsxs("div",{className:"bg-dark-sidebar rounded-lg p-6 w-96 max-w-full mx-4",children:[f.jsxs("div",{className:"flex items-center justify-between mb-4",children:[f.jsx("h3",{className:"text-lg font-semibold text-dark-text",children:"Set Status"}),f.jsx("button",{onClick:t,className:"text-dark-muted hover:text-dark-text transition-colors",children:f.jsx(mr,{size:24})})]}),r?f.jsx(f.Fragment,{children:f.jsxs("div",{className:"space-y-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"text-sm text-dark-muted mb-2 block",children:"Emoji"}),f.jsx("input",{type:"text",value:s,onChange:b=>c(b.target.value.slice(0,2)),className:"w-full bg-dark-input text-dark-text px-4 py-2 rounded-lg text-2xl text-center",placeholder:"",maxLength:2})]}),f.jsxs("div",{children:[f.jsx("label",{className:"text-sm text-dark-muted mb-2 block",children:"Status Text"}),f.jsx("input",{type:"text",value:l,onChange:b=>d(b.target.value),className:"w-full bg-dark-input text-dark-text px-4 py-2 rounded-lg",placeholder:"What's on your mind?",maxLength:50,autoFocus:!0}),f.jsxs("div",{className:"text-xs text-dark-muted mt-1 text-right",children:[l.length,"/50"]})]}),f.jsxs("div",{className:"flex gap-2",children:[f.jsx("button",{onClick:()=>i(!1),className:"flex-1 px-4 py-2 rounded-lg bg-dark-bg hover:bg-dark-hover transition-colors text-dark-text",children:"Back"}),f.jsx("button",{onClick:m,disabled:!l.trim(),className:"flex-1 px-4 py-2 rounded-lg bg-brand-primary hover:bg-brand-primary/80 transition-colors text-white font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:"Set Status"})]})]})}):f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"space-y-2 mb-4",children:Aq.map(b=>f.jsxs("button",{onClick:()=>h(b),className:"w-full px-4 py-3 rounded-lg bg-dark-bg hover:bg-dark-hover transition-colors text-left flex items-center gap-3",children:[f.jsx("span",{className:"text-2xl",children:b.emoji}),f.jsx("span",{className:"text-dark-text",children:b.text})]},b.type))}),f.jsx("button",{onClick:()=>i(!0),className:"w-full px-4 py-3 rounded-lg bg-brand-primary hover:bg-brand-primary/80 transition-colors text-white font-medium",children:" Custom Status"}),n&&f.jsx("button",{onClick:g,className:"w-full mt-2 px-4 py-2 rounded-lg bg-dark-bg hover:bg-dark-hover transition-colors text-admin text-sm",children:"Clear Status"})]})]})})},gY=()=>{const n=[{name:"Screen Sharing",free:"",premium:"1080p 60fps"},{name:"Profile Badge",free:"",premium:""},{name:"Custom Backgrounds",free:"",premium:""},{name:"Upload Limit",free:"10MB",premium:"200MB"},{name:"GIF Avatar",free:"",premium:""},{name:"Animated Banner",free:"",premium:""},{name:"Profile Themes",free:"",premium:""},{name:"Exclusive Stickers",free:"",premium:""},{name:"Soundboard",free:"",premium:""}];return f.jsxs("div",{className:"bg-dark-sidebar/50 rounded-xl overflow-hidden border border-dark-hover",children:[f.jsxs("div",{className:"grid grid-cols-3 bg-dark-hover/50 p-4 text-sm font-bold text-dark-text uppercase tracking-wider",children:[f.jsx("div",{children:"Feature"}),f.jsx("div",{className:"text-center text-dark-muted",children:"Free"}),f.jsx("div",{className:"text-center text-brand-primary",children:"Premium"})]}),f.jsx("div",{className:"divide-y divide-dark-hover",children:n.map((e,t)=>f.jsxs("div",{className:"grid grid-cols-3 p-4 text-sm hover:bg-white/5 transition-colors",children:[f.jsx("div",{className:"font-medium text-dark-text",children:e.name}),f.jsx("div",{className:"text-center text-dark-muted",children:e.free}),f.jsx("div",{className:"text-center font-bold text-white",children:e.premium})]},t))})]})},vY=({question:n,answer:e})=>{const[t,r]=T.useState(!1);return f.jsxs("div",{className:"",children:[f.jsxs("button",{className:"w-full flex items-center justify-between p-5 text-left font-medium text-dark-text hover:text-white transition-colors",onClick:()=>r(!t),children:[f.jsx("span",{children:n}),f.jsx(QP,{className:`transform transition-transform duration-300 ${t?"rotate-180":""}`,size:20})]}),f.jsx("div",{className:`overflow-hidden transition-all duration-300 ${t?"max-h-40 opacity-100":"max-h-0 opacity-0"}`,children:f.jsx("p",{className:"text-sm text-dark-muted leading-relaxed px-5 pb-5 pt-0",children:e})})]})},yY=()=>{const{info:n}=Ss(),e=[{icon:If,title:"HD Screen Sharing",description:"Share your screen in 1080p 60fps quality with friends.",color:"text-blue-400",bg:"bg-blue-400/10"},{icon:zB,title:"Exclusive Profile Badge",description:"Stand out with the shiny Premium badge on your profile.",color:"text-purple-400",bg:"bg-purple-400/10"},{icon:QB,title:"Custom Profile Backgrounds",description:"Personalize your profile with custom banner images.",color:"text-yellow-400",bg:"bg-yellow-400/10"},{icon:XP,title:"Exclusive Stickers",description:"Access a library of premium stickers and custom emojis.",color:"text-orange-400",bg:"bg-orange-400/10"},{icon:_x,title:"Soundboard",description:"Play fun sound effects in voice channels.",color:"text-pink-400",bg:"bg-pink-400/10"},{icon:HB,title:"Priority Support",description:"Get faster responses for all your support tickets.",color:"text-green-400",bg:"bg-green-400/10"}],t=[{q:"Can I cancel anytime?",a:"Yes, you can cancel your subscription at any time from your account settings. Your benefits will continue until the end of the billing period."},{q:"Is payment secure?",a:"Absolutely. We use Stripe for payment processing, which is the industry standard for security. We never store your card details."},{q:"Do benefits apply to all servers?",a:"Yes! Your Premium benefits travel with you to any server you join on Lumo Chat."}];return f.jsxs("div",{className:"animate-fade-in pb-10",children:[f.jsx("style",{children:`
        @keyframes shine {
          0% { transform: translateX(-100%); }
          100% { transform: translateX(100%); }
        }
        @keyframes float {
          0%, 100% { transform: translateY(0); }
          50% { transform: translateY(-10px); }
        }
        .shine-effect::after {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          width: 50%;
          height: 100%;
          background: linear-gradient(to right, transparent, rgba(255,255,255,0.3), transparent);
          transform: skewX(-20deg) translateX(-150%);
          animation: shine 3s infinite;
        }
        .float-animation {
          animation: float 6s ease-in-out infinite;
        }
      `}),f.jsxs("div",{className:"relative overflow-hidden rounded-2xl bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-600 p-8 text-white shadow-2xl transform transition-all hover:scale-[1.005] mb-8",children:[f.jsx("div",{className:"absolute top-0 right-0 -mr-16 -mt-16 w-80 h-80 rounded-full bg-white/10 blur-3xl animate-pulse"}),f.jsx("div",{className:"absolute bottom-0 left-0 -ml-16 -mb-16 w-64 h-64 rounded-full bg-black/20 blur-3xl animate-pulse",style:{animationDelay:"1s"}}),f.jsxs("div",{className:"relative z-10 flex flex-col md:flex-row items-center gap-6",children:[f.jsx("div",{className:"float-animation p-5 bg-white/10 backdrop-blur-md rounded-full shadow-inner ring-4 ring-white/20 shrink-0",children:f.jsx(xl,{size:56,className:"text-white drop-shadow-[0_0_15px_rgba(255,255,255,0.5)]"})}),f.jsxs("div",{className:"text-center md:text-left",children:[f.jsxs("h1",{className:"text-4xl font-extrabold tracking-tight mb-2 drop-shadow-md",children:["Release the ",f.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-yellow-300 to-orange-300",children:"Boost!"})]}),f.jsx("p",{className:"text-indigo-100 font-medium text-lg leading-relaxed max-w-2xl",children:"Unlock the full potential of Lumo Chat. Get special perks, enhanced quality, and support the development."})]})]})]}),f.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-8",children:[f.jsxs("div",{className:"space-y-8",children:[f.jsxs("div",{children:[f.jsxs("h2",{className:"text-xl font-bold text-dark-text mb-6 flex items-center gap-2",children:[f.jsx("span",{className:"w-1 h-6 bg-brand-primary rounded-full box-shadow-glow"}),"Premium Perks"]}),f.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:e.map((r,i)=>f.jsxs("div",{className:"group relative overflow-hidden p-5 rounded-xl bg-dark-sidebar border border-dark-hover hover:border-brand-primary/50 transition-all duration-300 hover:shadow-xl hover:shadow-brand-primary/10 hover:-translate-y-1",style:{animationDelay:`${i*100}ms`},children:[f.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/5 to-transparent translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-700 ease-in-out pointer-events-none"}),f.jsxs("div",{className:"flex items-start gap-4",children:[f.jsx("div",{className:`p-3 rounded-lg ${r.bg} group-hover:scale-110 transition-transform duration-300`,children:f.jsx(r.icon,{size:28,className:`${r.color} drop-shadow-sm`})}),f.jsxs("div",{children:[f.jsx("h3",{className:"font-bold text-dark-text mb-1 group-hover:text-white transition-colors text-lg",children:r.title}),f.jsx("p",{className:"text-sm text-dark-muted leading-relaxed group-hover:text-gray-300",children:r.description})]})]})]},i))})]}),f.jsxs("div",{className:"bg-dark-bg rounded-2xl p-1 border-2 border-brand-primary/30 group hover:border-brand-primary/60 transition-colors relative overflow-hidden shadow-2xl",children:[f.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 opacity-20 group-hover:opacity-40 transition-opacity"}),f.jsxs("div",{className:"bg-dark-sidebar/90 backdrop-blur-xl rounded-xl p-8 flex flex-col sm:flex-row items-center justify-between gap-6 relative z-10",children:[f.jsxs("div",{children:[f.jsx("div",{className:"inline-block px-3 py-1 rounded-full bg-gradient-to-r from-indigo-500 to-pink-500 text-[10px] font-bold text-white uppercase tracking-widest mb-3 shadow-lg",children:"BEST VALUE"}),f.jsx("h3",{className:"text-3xl font-bold text-white mb-2",children:"Monthly"}),f.jsxs("p",{className:"text-dark-muted text-sm flex items-center gap-2",children:[f.jsx(Sl,{size:16,className:"text-green-500"})," Secure payment"]})]}),f.jsxs("div",{className:"flex flex-col items-center gap-4",children:[f.jsxs("div",{className:"text-4xl font-extrabold text-white",children:["$4.99",f.jsx("span",{className:"text-sm text-dark-muted font-normal ml-1",children:"/mo"})]}),f.jsx("button",{className:"relative overflow-hidden px-10 py-4 bg-gradient-to-r from-indigo-600 to-pink-600 hover:from-indigo-500 hover:to-pink-500 rounded-xl text-white font-bold shadow-lg transform transition-all hover:scale-105 active:scale-95 shine-effect whitespace-nowrap",onClick:()=>n("deme sistemi u anda bakmda."),children:f.jsxs("span",{className:"relative z-10 flex items-center gap-2",children:["Subscribe Now ",f.jsx(xl,{})]})})]})]})]})]}),f.jsx("div",{className:"space-y-8",children:f.jsxs("div",{children:[f.jsxs("h2",{className:"text-xl font-bold text-dark-text mb-6 flex items-center gap-2",children:[f.jsx("span",{className:"w-1 h-6 bg-purple-500 rounded-full box-shadow-glow"}),"Why Go Premium?"]}),f.jsx(gY,{})]})})]}),f.jsxs("div",{className:"mt-12",children:[f.jsxs("h2",{className:"text-xl font-bold text-dark-text mb-6 flex items-center gap-2",children:[f.jsx("span",{className:"w-1 h-6 bg-gray-500 rounded-full"}),"Common Questions"]}),f.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:t.map((r,i)=>f.jsx("div",{className:"bg-dark-sidebar rounded-xl border border-dark-hover overflow-hidden",children:f.jsx(vY,{question:r.q,answer:r.a})},i))})]})]})},bY=[{id:"premium",label:"Premium",icon:xl,category:"User Settings"},{id:"account",label:"My Account",icon:YB,category:"User Settings"},{id:"security",label:"Privacy & Security",icon:DB,category:"User Settings"},{id:"about",label:"About",icon:IS,category:"App Settings"}],xY=({isOpen:n,onClose:e})=>{const{currentUser:t,userProfile:r}=Ar(),{success:i,error:s,info:c}=Ss(),[l,d]=T.useState("account"),[h,m]=T.useState(r?.photoUrl||""),[g,b]=T.useState(r?.bannerUrl||""),[_,R]=T.useState(r?.themeColor||"#6366f1"),[E,A]=T.useState(r?.bio||""),[M,F]=T.useState(!1),[j,C]=T.useState(!1),[N,D]=T.useState({progress:0,speed:""}),[S,k]=T.useState(!1),[P,L]=T.useState({progress:0,speed:""}),U=T.useRef(null),z=T.useRef(null),[V,le]=T.useState(!1),[ve,K]=T.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[oe,ee]=T.useState(!1),Me=r?.role==="admin"||r?.role==="premium";T.useEffect(()=>{m(r?.photoUrl||""),b(r?.bannerUrl||""),R(r?.themeColor||"#6366f1"),A(r?.bio||"")},[r]),T.useEffect(()=>{const Ce=Re=>{Re.key==="Escape"&&n&&e()};return n&&(document.addEventListener("keydown",Ce),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",Ce),document.body.style.overflow="unset"}},[n,e]);const je=async Ce=>{if(!(!Ce||!t)){if(!Ce.type.startsWith("image/")){s("Please select an image file");return}if(Ce.type==="image/gif"&&!Me){s("Animated GIF avatars are for Premium members only!");return}if(Ce.size>10*1024*1024){s("Image size must be less than 10MB");return}C(!0);try{const Re=await Rv(Ce,(He,de)=>{D({progress:He,speed:de})});await at(Be(_e,"users",t.uid),{photoUrl:Re.url}),m(Re.url),i("Profile photo updated successfully!")}catch(Re){console.error("Error uploading photo:",Re),s("Failed to upload photo")}finally{C(!1),D({progress:0,speed:""}),U.current&&(U.current.value="")}}},q=async Ce=>{if(!(!Ce||!t)){if(!Me){c("Custom banners are a Premium feature. Upgrade to unlock!");return}if(!Ce.type.startsWith("image/")){s("Please select an image file");return}if(Ce.size>10*1024*1024){s("Image size must be less than 10MB");return}k(!0);try{const Re=await Rv(Ce,(He,de)=>{L({progress:He,speed:de})});await at(Be(_e,"users",t.uid),{bannerUrl:Re.url}),b(Re.url),i("Banner updated successfully!")}catch(Re){console.error("Error uploading banner:",Re),s("Failed to upload banner")}finally{k(!1),L({progress:0,speed:""}),z.current&&(z.current.value="")}}},te=async Ce=>{const Re=Ce.target.value;R(Re)},fe=async()=>{if(t){if(!Me){c("Custom themes are a Premium feature!"),R(r?.themeColor||"#6366f1");return}F(!0);try{await at(Be(_e,"users",t.uid),{themeColor:_}),i("Appearance updated!")}catch(Ce){console.error("Error updating appearance:",Ce),s("Failed to update appearance")}finally{F(!1)}}},Se=async()=>{if(t){F(!0);try{await at(Be(_e,"users",t.uid),{bio:E.trim()}),i("Bio updated successfully")}catch(Ce){console.error("Error updating bio:",Ce),s("Failed to update bio")}finally{F(!1)}}},Oe=async()=>{if(!(!t||!t.email)){if(!ve.currentPassword||!ve.newPassword||!ve.confirmPassword){s("Please fill in all password fields");return}if(ve.newPassword.length<6){s("New password must be at least 6 characters");return}if(ve.newPassword!==ve.confirmPassword){s("New passwords do not match");return}ee(!0);try{const Ce=Nl.credential(t.email,ve.currentPassword);await K8(t,Ce),await Q8(t,ve.newPassword),i("Password changed successfully"),K({currentPassword:"",newPassword:"",confirmPassword:""})}catch(Ce){console.error("Error changing password:",Ce),Ce.code==="auth/wrong-password"?s("Current password is incorrect"):Ce.code==="auth/weak-password"?s("New password is too weak"):s("Failed to change password")}finally{ee(!1)}}},Te=async Ce=>{if(t)try{await at(Be(_e,"users",t.uid),{status:Ce}),i(Ce?"Status updated":"Status cleared")}catch(Re){console.error("Error updating status:",Re),s("Failed to update status")}},we=async Ce=>{if(t)try{await at(Be(_e,"users",t.uid),{presence:Ce}),i(`Status set to ${Ce}`)}catch{s("Failed to update status")}};if(!n)return null;const Ge=bY.reduce((Ce,Re)=>(Ce[Re.category]||(Ce[Re.category]=[]),Ce[Re.category].push(Re),Ce),{}),Ke=()=>{switch(l){case"premium":return f.jsx(yY,{});case"account":return f.jsxs("div",{className:"space-y-8",children:[f.jsx("h1",{className:"text-2xl font-bold text-dark-text",children:"My Account"}),f.jsxs("div",{className:"rounded-lg overflow-hidden border border-dark-hover relative min-h-[300px]",style:{borderColor:_},children:[f.jsx("div",{className:"absolute inset-0 bg-cover bg-center transition-colors",style:{backgroundColor:_,backgroundImage:g?`url(${g})`:`linear-gradient(to bottom right, ${_}, #000)`}}),f.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/90 via-black/40 to-transparent"}),g?.endsWith(".gif")&&f.jsx("div",{className:"absolute top-2 right-2 px-2 py-1 bg-black/50 text-white text-[10px] rounded backdrop-blur-sm font-bold z-10",children:"GIF"}),f.jsxs("div",{className:"relative z-10 p-6 flex flex-col items-center justify-end h-full min-h-[300px] text-center mt-auto",children:[f.jsxs("div",{className:"relative group mb-4",children:[h?f.jsx("img",{src:h,alt:"Profile",className:"w-28 h-28 rounded-full object-cover border-4",style:{borderColor:_},onError:Ce=>{Ce.target.style.display="none",Ce.target.nextSibling.style.display="flex"}},h):null,f.jsx("div",{className:"w-28 h-28 rounded-full flex items-center justify-center text-white font-bold text-4xl border-4",style:{display:h?"none":"flex",backgroundColor:_,borderColor:_},children:r?.displayName?.[0]?.toUpperCase()||"U"}),f.jsx("div",{className:"absolute inset-0 rounded-full bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer border-4 border-transparent",onClick:()=>U.current?.click(),children:f.jsx(yv,{className:"text-white",size:32})})]}),f.jsxs("div",{className:"space-y-1",children:[f.jsxs("h2",{className:"text-2xl font-bold text-white flex items-center justify-center gap-2 shadow-black drop-shadow-md",children:[r?.displayName,Me&&f.jsx(xl,{className:"text-brand-primary",title:"Premium Member"})]}),f.jsx("p",{className:"text-gray-200 text-sm font-medium shadow-black drop-shadow-md",children:t?.email}),f.jsx("div",{className:"flex justify-center gap-2 mt-3",children:f.jsx("span",{className:"text-xs px-3 py-1 rounded-full bg-black/40 backdrop-blur-md border border-white/20 text-white capitalize font-medium",children:r?.role||"member"})})]})]})]}),f.jsxs("div",{className:"bg-dark-bg rounded-lg p-4",children:[f.jsx("h3",{className:"text-sm font-semibold text-dark-muted uppercase tracking-wide mb-4",children:"Profile Photo"}),f.jsx("input",{type:"file",ref:U,onChange:Ce=>je(Ce.target.files?.[0]),accept:"image/*",className:"hidden"}),f.jsx("div",{className:"flex gap-3 mb-4",children:f.jsx("button",{onClick:()=>U.current?.click(),className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-dark-sidebar hover:bg-dark-hover border border-dark-hover text-dark-text rounded-lg transition-colors disabled:opacity-50",disabled:j,children:j?f.jsxs("span",{className:"text-sm",children:["Uploading ",Math.round(N.progress),"%..."]}):f.jsxs(f.Fragment,{children:[f.jsx(Sx,{size:20}),"Upload New Photo"]})})})]}),f.jsxs("div",{className:`rounded-lg p-4 relative ${Me?"bg-dark-bg":"bg-dark-bg/50"}`,children:[!Me&&f.jsxs("div",{className:"absolute inset-0 z-10 bg-black/60 backdrop-blur-[1px] rounded-lg flex flex-col items-center justify-center text-center p-4",children:[f.jsx(xl,{size:32,className:"text-brand-primary mb-2 animate-bounce"}),f.jsx("h3",{className:"text-lg font-bold text-white mb-1",children:"Unlock Profile Appearance"}),f.jsx("p",{className:"text-sm text-dark-muted mb-4 max-w-xs",children:"Customize your banner, theme colors, and use animated GIFs with Premium."}),f.jsx(ut,{variant:"primary",onClick:()=>d("premium"),children:"View Premium Plans"})]}),f.jsxs("h3",{className:"text-sm font-semibold text-dark-muted uppercase tracking-wide mb-6 flex items-center gap-2",children:[f.jsx(UB,{})," Profile Appearance ",f.jsx("span",{className:"text-xs normal-case px-2 py-0.5 bg-brand-primary/20 text-brand-primary rounded",children:"Premium"})]}),f.jsxs("div",{className:"mb-6",children:[f.jsx("label",{className:"block text-sm font-medium text-dark-text mb-2",children:"Profile Banner"}),f.jsxs("div",{className:"flex gap-3",children:[f.jsx("input",{type:"file",ref:z,onChange:Ce=>q(Ce.target.files?.[0]),accept:"image/*",className:"hidden"}),f.jsx("button",{onClick:()=>z.current?.click(),className:"flex-1 flex items-center justify-center gap-2 px-4 py-8 border-2 border-dashed border-dark-hover hover:border-brand-primary rounded-lg text-dark-muted hover:text-brand-primary transition-colors disabled:opacity-50",disabled:S,children:S?f.jsxs("span",{children:["Uploading ",Math.round(P.progress),"%..."]}):f.jsxs("div",{className:"text-center",children:[f.jsx(yv,{size:24,className:"mx-auto mb-1"}),f.jsx("div",{children:"Upload Banner Image"}),f.jsx("div",{className:"text-xs opacity-70",children:"JPG, PNG, GIF"})]})}),g&&f.jsxs("div",{className:"w-32 h-24 rounded-lg overflow-hidden relative group shrink-0",children:[f.jsx("img",{src:g,className:"w-full h-full object-cover"}),f.jsx("button",{onClick:()=>{b(""),at(Be(_e,"users",t.uid),{bannerUrl:""})},className:"absolute inset-0 bg-black/60 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity text-red-500 font-bold",children:"Remove"})]})]})]}),f.jsxs("div",{className:"mb-6",children:[f.jsx("label",{className:"block text-sm font-medium text-dark-text mb-2",children:"Theme Color"}),f.jsxs("div",{className:"flex gap-4 items-center",children:[f.jsx("input",{type:"color",value:_,onChange:te,className:"w-16 h-16 rounded-lg cursor-pointer bg-transparent border-0 p-0"}),f.jsxs("div",{children:[f.jsx("div",{className:"text-dark-text font-mono bg-dark-input px-3 py-1 rounded border border-dark-hover",children:_}),f.jsx("div",{className:"text-xs text-dark-muted mt-1",children:"Select a color to accent your profile."})]}),f.jsx("div",{className:"flex-1 text-right",children:f.jsx(ut,{onClick:fe,disabled:_===r?.themeColor,children:"Save Color"})})]})]})]}),f.jsxs("div",{className:"bg-dark-bg rounded-lg p-4",children:[f.jsx("h3",{className:"text-sm font-semibold text-dark-muted uppercase tracking-wide mb-4",children:"Online Status"}),f.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[{key:"online",label:"Online",color:"bg-green-500",desc:"Visible"},{key:"idle",label:"Idle",color:"bg-yellow-500",desc:"Away"},{key:"dnd",label:"Do Not Disturb",color:"bg-red-500",desc:"No notifications"},{key:"invisible",label:"Invisible",color:"bg-gray-500",desc:"Hidden"}].map(Ce=>f.jsxs("button",{onClick:()=>we(Ce.key),className:`p-3 rounded-lg border transition-all text-left flex items-center gap-3 ${r?.presence===Ce.key||!r?.presence&&Ce.key==="online"?"border-brand-primary bg-brand-primary/10":"border-dark-hover hover:border-dark-muted bg-dark-sidebar"}`,children:[f.jsx("span",{className:`w-3 h-3 rounded-full ${Ce.color}`}),f.jsxs("div",{children:[f.jsx("div",{className:"text-sm font-medium text-dark-text",children:Ce.label}),f.jsx("div",{className:"text-[10px] text-dark-muted",children:Ce.desc})]})]},Ce.key))})]}),f.jsxs("div",{className:"bg-dark-bg rounded-lg p-4",children:[f.jsx("h3",{className:"text-sm font-semibold text-dark-muted uppercase tracking-wide mb-4",children:"Custom Status"}),r?.status?f.jsxs("div",{className:"flex items-center justify-between p-3 bg-dark-sidebar rounded-lg",children:[f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx("span",{className:"text-2xl",children:r.status.emoji}),f.jsx("span",{className:"text-dark-text",children:r.status.text})]}),f.jsxs("div",{className:"flex gap-2",children:[f.jsx(ut,{variant:"secondary",onClick:()=>le(!0),children:"Edit"}),f.jsx(ut,{variant:"danger",onClick:()=>Te(null),children:"Clear"})]})]}):f.jsxs("div",{className:"text-center py-4 border border-dashed border-dark-hover rounded-lg",children:[f.jsx("p",{className:"text-dark-muted text-sm mb-3",children:"No custom status set"}),f.jsx(ut,{variant:"primary",size:"sm",onClick:()=>le(!0),children:"Set a Status"})]})]}),f.jsxs("div",{className:"bg-dark-bg rounded-lg p-4",children:[f.jsx("h3",{className:"text-sm font-semibold text-dark-muted uppercase tracking-wide mb-4",children:"About Me"}),f.jsx("textarea",{placeholder:"Tell others about yourself...",value:E,onChange:Ce=>A(Ce.target.value),maxLength:190,rows:4,className:`w-full bg-dark-input text-dark-text px-4 py-3 rounded-lg
                           border border-transparent focus:border-brand-primary
                           outline-none transition-colors duration-200
                           placeholder:text-dark-muted resize-none`}),f.jsxs("div",{className:"flex justify-between items-center mt-2",children:[f.jsxs("span",{className:"text-xs text-dark-muted",children:[E.length,"/190"]}),f.jsx(ut,{variant:"primary",onClick:Se,disabled:M||E===r?.bio,children:M?"Updating...":"Save"})]})]}),f.jsxs("div",{className:"bg-dark-bg rounded-lg p-4",children:[f.jsx("h3",{className:"text-sm font-semibold text-dark-muted uppercase tracking-wide mb-4",children:"Account Info"}),f.jsxs("div",{className:"space-y-4",children:[f.jsx("div",{className:"flex justify-between items-center py-2 border-b border-dark-hover",children:f.jsxs("div",{children:[f.jsx("div",{className:"text-xs text-dark-muted uppercase",children:"Display Name"}),f.jsx("div",{className:"text-dark-text font-medium",children:r?.displayName})]})}),f.jsx("div",{className:"flex justify-between items-center py-2 border-b border-dark-hover",children:f.jsxs("div",{children:[f.jsx("div",{className:"text-xs text-dark-muted uppercase",children:"Email"}),f.jsx("div",{className:"text-dark-text font-medium",children:t?.email})]})}),f.jsx("div",{className:"flex justify-between items-center py-2",children:f.jsxs("div",{children:[f.jsx("div",{className:"text-xs text-dark-muted uppercase",children:"Role"}),f.jsx("div",{className:"text-dark-text font-medium capitalize",children:r?.role||"member"})]})})]})]})]});case"security":return f.jsxs("div",{className:"space-y-8",children:[f.jsx("h1",{className:"text-2xl font-bold text-dark-text",children:"Privacy & Security"}),f.jsxs("div",{className:"bg-dark-bg rounded-lg p-4",children:[f.jsx("h3",{className:"text-sm font-semibold text-dark-muted uppercase tracking-wide mb-4",children:"Change Password"}),f.jsxs("div",{className:"space-y-4 max-w-md",children:[f.jsx(Vn,{label:"Current Password",type:"password",placeholder:"Enter current password",value:ve.currentPassword,onChange:Ce=>K({...ve,currentPassword:Ce.target.value})}),f.jsx(Vn,{label:"New Password",type:"password",placeholder:"Enter new password (min 6 characters)",value:ve.newPassword,onChange:Ce=>K({...ve,newPassword:Ce.target.value})}),f.jsx(Vn,{label:"Confirm New Password",type:"password",placeholder:"Confirm new password",value:ve.confirmPassword,onChange:Ce=>K({...ve,confirmPassword:Ce.target.value})}),f.jsx(ut,{variant:"primary",onClick:Oe,disabled:oe||!ve.currentPassword||!ve.newPassword||!ve.confirmPassword,children:oe?"Changing Password...":"Change Password"})]})]})]});case"about":return f.jsxs("div",{className:"space-y-8",children:[f.jsx("h1",{className:"text-2xl font-bold text-dark-text",children:"About"}),f.jsxs("div",{className:"bg-dark-bg rounded-lg p-6",children:[f.jsx("h2",{className:"text-xl font-bold text-dark-text mb-2",children:"Lumo Chat"}),f.jsxs("div",{className:"space-y-4 text-dark-muted text-sm",children:[f.jsx("p",{children:"A modern real-time chat application built for seamless communication."}),f.jsxs("div",{children:[f.jsx("div",{className:"font-semibold text-dark-text",children:"Version"}),f.jsx("div",{children:"1.6.5"})]}),f.jsxs("div",{children:[f.jsx("div",{className:"font-semibold text-dark-text",children:"Developer"}),f.jsx("div",{children:"Dazlakss"})]}),f.jsxs("div",{children:[f.jsx("div",{className:"font-semibold text-dark-text",children:"Tech Stack"}),f.jsx("div",{children:"React, Firebase, TailwindCSS, Electron"})]})]})]}),f.jsxs("div",{className:"bg-dark-bg rounded-lg p-4",children:[f.jsx("h3",{className:"text-sm font-semibold text-dark-muted uppercase tracking-wide mb-4",children:"Acknowledgments"}),f.jsxs("div",{className:"space-y-4",children:[f.jsx("div",{className:"flex items-center gap-4 p-3 bg-dark-sidebar rounded-lg border border-dark-hover",children:f.jsxs("div",{className:"flex-1",children:[f.jsx("div",{className:"text-dark-text font-medium",children:"GIPHY"}),f.jsx("div",{className:"text-xs text-dark-muted",children:"We use GIPHY for finding and sharing GIFs."}),f.jsx("a",{href:"https://giphy.com",target:"_blank",rel:"noopener noreferrer",className:"mt-2 text-sm font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500 block w-fit hover:opacity-80 transition-opacity",children:"Powered by GIPHY"})]})}),f.jsx("div",{className:"flex items-center gap-4 p-3 bg-dark-sidebar rounded-lg border border-dark-hover",children:f.jsxs("div",{className:"flex-1",children:[f.jsx("div",{className:"text-dark-text font-medium",children:"Cloudinary"}),f.jsx("div",{className:"text-xs text-dark-muted",children:"Robust cloud storage and delivery for images and files."}),f.jsx("a",{href:"https://cloudinary.com",target:"_blank",rel:"noopener noreferrer",className:"mt-2 text-sm font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-sky-400 block w-fit hover:opacity-80 transition-opacity",children:"Powered by Cloudinary"})]})}),f.jsx("div",{className:"flex items-center gap-4 p-3 bg-dark-sidebar rounded-lg border border-dark-hover",children:f.jsxs("div",{className:"flex-1",children:[f.jsx("div",{className:"text-dark-text font-medium",children:"ImgBB"}),f.jsx("div",{className:"text-xs text-dark-muted",children:"Simple and fast image hosting service."}),f.jsx("a",{href:"https://imgbb.com",target:"_blank",rel:"noopener noreferrer",className:"mt-2 text-sm font-bold text-transparent bg-clip-text bg-gradient-to-r from-gray-200 to-gray-400 block w-fit hover:opacity-80 transition-opacity",children:"Powered by ImgBB"})]})})]})]})]});default:return null}};return f.jsxs("div",{className:"fixed inset-0 bg-black/80 z-50 flex flex-col md:flex-row",role:"dialog","aria-modal":"true",children:[f.jsx("div",{className:"w-full md:w-56 bg-dark-sidebar flex flex-col shrink-0 border-b md:border-b-0 md:border-r border-dark-hover",children:f.jsx("div",{className:"flex md:flex-col overflow-x-auto md:overflow-y-auto py-2 md:py-4 px-2 gap-2 md:gap-0 no-scrollbar",children:Object.entries(Ge).map(([Ce,Re])=>f.jsxs("div",{className:"mb-0 md:mb-4 flex md:block gap-2 md:gap-0 shrink-0",children:[f.jsx("div",{className:"hidden md:block px-3 py-2 text-xs font-semibold text-dark-muted uppercase tracking-wide",children:Ce}),Re.map(He=>{const de=He.icon;return f.jsxs("button",{onClick:()=>d(He.id),className:`whitespace-nowrap flex items-center gap-2 md:gap-3 px-3 py-2 rounded-md text-left transition-colors ${l===He.id?"bg-dark-hover text-dark-text":"text-dark-muted hover:text-dark-text hover:bg-dark-hover/50"}`,children:[f.jsx(de,{size:18}),f.jsx("span",{className:"text-sm",children:He.label})]},He.id)})]},Ce))})}),f.jsxs("div",{className:"flex-1 flex flex-col bg-dark-bg overflow-hidden min-w-0",children:[f.jsx("div",{className:"flex justify-end p-4 shrink-0",children:f.jsx("button",{onClick:e,className:"p-2 hover:bg-dark-hover rounded-full transition-colors group",title:"Close",children:f.jsx(mr,{size:24,className:"text-dark-muted group-hover:text-dark-text"})})}),f.jsx("div",{className:"flex-1 overflow-y-auto px-4 md:px-10 pb-10",children:f.jsx("div",{className:l==="premium"?"w-full":"max-w-2xl mx-auto md:mx-0",children:Ke()})})]}),V&&f.jsx(mY,{currentStatus:r?.status,onStatusChange:Te,onClose:()=>le(!1)})]})},_Y=()=>{const[n,e]=T.useState([]),{channels:t}=dp();T.useEffect(()=>{const i=Yi(St(_e,"adminLogs"),dv("timestamp","desc"),vx(100));return oi(i,c=>{const l=[];c.forEach(d=>{l.push({id:d.id,...d.data()})}),e(l)})},[]);const r=i=>{const s=t.find(c=>c.id===i);return s?`#${s.name}`:"Unknown Channel"};return f.jsxs("div",{children:[f.jsx("h3",{className:"text-2xl font-bold text-dark-text mb-6",children:"Admin Logs"}),f.jsx("div",{className:"space-y-3 max-h-[520px] overflow-y-auto pr-2",children:n.length===0?f.jsx("div",{className:"text-center text-dark-muted py-8",children:"No logs yet"}):n.map(i=>f.jsxs("div",{className:"bg-dark-bg p-5 rounded-xl hover:bg-dark-hover transition-colors",children:[f.jsxs("div",{className:"flex items-start justify-between mb-2",children:[f.jsx("div",{className:"flex items-center gap-2",children:i.type==="message_delete"?f.jsxs(f.Fragment,{children:[f.jsx(Ka,{className:"text-admin",size:20}),f.jsx("span",{className:"font-semibold text-dark-text",children:"Message Deleted"})]}):i.type==="message_edit"?f.jsxs(f.Fragment,{children:[f.jsx(Qu,{className:"text-blue-400",size:20}),f.jsx("span",{className:"font-semibold text-dark-text",children:"Message Edited"})]}):f.jsx("span",{className:"font-semibold text-dark-text",children:i.type})}),f.jsx("span",{className:"text-xs text-dark-muted",children:i.timestamp&&v0(i.timestamp)})]}),f.jsxs("div",{className:"space-y-1 text-sm",children:[f.jsxs("div",{className:"flex gap-2",children:[f.jsx("span",{className:"text-dark-muted",children:"Channel:"}),f.jsx("span",{className:"text-dark-text font-medium",children:r(i.channelId)})]}),i.type==="message_delete"&&f.jsxs(f.Fragment,{children:[f.jsxs("div",{className:"flex gap-2",children:[f.jsx("span",{className:"text-dark-muted",children:"Original Author:"}),f.jsx("span",{className:"text-dark-text",children:i.originalAuthorName||i.originalUserName||"Unknown"})]}),f.jsxs("div",{className:"flex gap-2",children:[f.jsx("span",{className:"text-dark-muted",children:"Message:"}),f.jsxs("span",{className:"text-dark-text italic",children:['"',i.messageText||i.deletedText||"(empty message)",'"']})]})]}),i.type==="message_edit"&&f.jsxs(f.Fragment,{children:[f.jsxs("div",{className:"flex gap-2",children:[f.jsx("span",{className:"text-dark-muted",children:"Before:"}),f.jsxs("span",{className:"text-dark-text italic",children:['"',i.originalText,'"']})]}),f.jsxs("div",{className:"flex gap-2",children:[f.jsx("span",{className:"text-dark-muted",children:"After:"}),f.jsxs("span",{className:"text-blue-400 italic",children:['"',i.newText,'"']})]})]})]})]},i.id))})]})},SY=[{id:"users",label:"Users",icon:DS,category:"Moderation"},{id:"roles",label:"Roles",icon:YP,category:"Moderation"},{id:"channels",label:"Channels",icon:y0,category:"Server Settings"},{id:"server",label:"Overview",icon:IS,category:"Server Settings"},{id:"logs",label:"Audit Log",icon:fB,category:"Server Settings"},{id:"cleanup",label:"Cleanup",icon:VB,category:"Maintenance"}],TY=({isOpen:n,onClose:e})=>{const{userProfile:t}=Ar(),{users:r,channels:i,server:s,currentServer:c}=dp(),[l,d]=T.useState("users"),[h,m]=T.useState(null),[g,b]=T.useState(""),[_,R]=T.useState(""),[E,A]=T.useState("text"),[M,F]=T.useState(null),[j,C]=T.useState([]),[N,D]=T.useState(null),[S,k]=T.useState({name:"",color:"#5865f2"}),[P,L]=T.useState(null),[U,z]=T.useState(null),{success:V,error:le}=Ss(),[ve,K]=T.useState(0),[oe,ee]=T.useState(!1),[Me,je]=T.useState(null);T.useEffect(()=>{const Q=Pe=>{Pe.key==="Escape"&&n&&e()};return n&&(document.addEventListener("keydown",Q),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",Q),document.body.style.overflow="unset"}},[n,e]),T.useEffect(()=>{if(!c||c==="home")return;const Q=Yi(St(_e,"servers",c,"roles"));return oi(Q,Fe=>{const ht=[];Fe.forEach(Vt=>{ht.push({id:Vt.id,...Vt.data()})}),C(ht)})},[c]),T.useEffect(()=>{if(l!=="cleanup")return;(async()=>{try{const Pe=await bl(St(_e,"inviteCodes")),Fe=new Date;let ht=0;Pe.forEach(Vt=>{const Lt=Vt.data(),Yt=Lt.expiresAt?.toDate()<Fe,In=!Lt.isActive||Lt.uses>=Lt.maxUses;(Yt||In)&&ht++}),K(ht)}catch(Pe){console.error("Error fetching cleanup stats:",Pe)}})()},[l]);const q=async()=>{ee(!0);try{const Q=await bl(St(_e,"inviteCodes")),Pe=new Date,Fe=J2(_e);let ht=0;Q.forEach(Vt=>{const Lt=Vt.data(),Yt=Lt.expiresAt?.toDate()<Pe,In=!Lt.isActive||Lt.uses>=Lt.maxUses;(Yt||In)&&(Fe.delete(Be(_e,"inviteCodes",Vt.id)),ht++)}),ht>0?(await Fe.commit(),V(`${ht} expired invite code(s) deleted`),K(0)):V("No expired invite codes to delete")}catch(Q){console.error("Error cleaning invite codes:",Q),le("Failed to clean invite codes")}finally{ee(!1),je(null)}};if(!n||t?.role!=="admin")return null;const te=async(Q,Pe)=>{try{await at(Be(_e,"users",Q),{role:Pe}),c&&await at(Be(_e,"servers",c,"members",Q),{role:Pe}),V(`Role updated to ${Pe}`),m(null)}catch(Fe){console.error("Error updating user role:",Fe),le(`Failed to update role: ${Fe.message}`)}},fe=async(Q,Pe)=>{try{await at(Be(_e,"users",Q),{isMuted:!Pe})}catch(Fe){console.error("Error toggling mute:",Fe)}},Se=async(Q,Pe)=>{try{await at(Be(_e,"users",Q),{isBanned:!Pe})}catch(Fe){console.error("Error toggling ban:",Fe)}},Oe=async()=>{if(!(!g.trim()||!c))try{await Ln(St(_e,"servers",c,"channels"),{name:g.trim(),type:E,description:_.trim(),position:i.length,createdAt:bt()}),b(""),R(""),A("text")}catch(Q){console.error("Error creating channel:",Q)}},Te=async(Q,Pe)=>{try{await at(Be(_e,"servers",c,"channels",Q),Pe),F(null)}catch(Fe){console.error("Error updating channel:",Fe)}},we=async()=>{if(!(!U?.data||!c))try{await ec(Be(_e,"servers",c,"channels",U.data))}catch(Q){console.error("Error deleting channel:",Q)}},Ge=async(Q,Pe)=>{if(c)try{await at(Be(_e,"servers",c,"channels",Q),{locked:!Pe})}catch(Fe){console.error("Error toggling channel lock:",Fe)}},Ke=async()=>{if(S.name.trim())try{const Q=j.reduce((Pe,Fe)=>Math.max(Pe,Fe.position||0),0);c&&await Ln(St(_e,"servers",c,"roles"),{name:S.name.trim(),color:S.color,position:Q+1,createdAt:bt()}),k({name:"",color:"#5865f2"})}catch(Q){console.error("Error creating role:",Q)}},Ce=async(Q,Pe)=>{if(c)try{await at(Be(_e,"servers",c,"roles",Q),Pe),D(null)}catch(Fe){console.error("Error updating role:",Fe)}},Re=async()=>{if(!U?.data)return;const Q=U.data;try{const Pe=j.find(Lt=>Lt.id===Q);if(!Pe)return;const Fe=Pe.name,ht=J2(_e),Vt=r.filter(Lt=>(Lt.serverRole||Lt.role)===Fe);if(Vt.forEach(Lt=>{if(Lt.role===Fe){const Yt=Be(_e,"users",Lt.id);ht.update(Yt,{role:"member"})}if(c){const Yt=Be(_e,"servers",c,"members",Lt.id);ht.update(Yt,{role:"member"})}}),c){const Lt=Be(_e,"servers",c,"roles",Q);ht.delete(Lt),await ht.commit(),V(`Role '${Fe}' deleted and ${Vt.length} users reassigned to Member`)}}catch(Pe){console.error("Error deleting role:",Pe),le(`Failed to delete role: ${Pe.message}`)}},He=[{id:"admin",name:"admin",color:"#f23f42",isDefault:!0,position:-3},{id:"moderator",name:"moderator",color:"#faa81a",isDefault:!0,position:-2},{id:"member",name:"member",color:"#80848e",isDefault:!0,position:-1},...j].sort((Q,Pe)=>(Q.position??999)-(Pe.position??999)),de=(Q,Pe)=>{L(Pe),Q.dataTransfer.effectAllowed="move"},Ie=Q=>{Q.preventDefault(),Q.dataTransfer.dropEffect="move"},qe=async(Q,Pe)=>{if(Q.preventDefault(),!P||P===Pe){L(null);return}const Fe=He.find(Vt=>Vt.id===P),ht=He.find(Vt=>Vt.id===Pe);if(Fe?.isDefault||ht?.isDefault){L(null);return}try{const Vt=Fe.position??0,Lt=ht.position??0;c&&(await at(Be(_e,"servers",c,"roles",P),{position:Lt}),await at(Be(_e,"servers",c,"roles",Pe),{position:Vt}))}catch(Vt){console.error("Error reordering roles:",Vt)}L(null)},ot=SY.reduce((Q,Pe)=>(Q[Pe.category]||(Q[Pe.category]=[]),Q[Pe.category].push(Pe),Q),{}),$e=()=>{switch(l){case"users":return f.jsxs("div",{className:"space-y-6",children:[f.jsx("h1",{className:"text-2xl font-bold text-dark-text",children:"User Management"}),f.jsx("p",{className:"text-dark-muted",children:"Manage server members, assign roles, and moderate users."}),f.jsxs("div",{className:"bg-dark-bg rounded-lg p-4",children:[f.jsxs("h3",{className:"text-sm font-semibold text-dark-muted uppercase tracking-wide mb-4",children:["Members  ",r.length]}),f.jsx("div",{className:"space-y-2 max-h-[500px] overflow-y-auto",children:r.map(Q=>f.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg hover:bg-dark-hover transition-colors",children:[f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx("div",{className:"w-10 h-10 rounded-full bg-brand-primary flex items-center justify-center text-white font-semibold",children:Q.displayName?.[0]?.toUpperCase()||"U"}),f.jsxs("div",{children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("span",{className:"font-medium text-dark-text",children:Q.displayName}),f.jsx("span",{className:"text-xs px-2 py-0.5 rounded",style:{backgroundColor:`${He.find(Pe=>Pe.name===(Q.serverRole||Q.role))?.color}20`,color:He.find(Pe=>Pe.name===(Q.serverRole||Q.role))?.color},children:Q.serverRole||Q.role}),Q.isMuted&&f.jsx("span",{className:"text-xs text-yellow-500",children:"MUTED"}),Q.isBanned&&f.jsx("span",{className:"text-xs text-red-500",children:"BANNED"})]}),f.jsx("div",{className:"text-sm text-dark-muted",children:Q.email})]})]}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx(ut,{size:"sm",variant:Q.isMuted?"warning":"secondary",onClick:()=>fe(Q.id,Q.isMuted),children:Q.isMuted?"Unmute":"Mute"}),f.jsx(ut,{size:"sm",variant:Q.isBanned?"danger":"secondary",onClick:()=>Se(Q.id,Q.isBanned),children:Q.isBanned?"Unban":"Ban"}),f.jsx(ut,{size:"sm",variant:"ghost",onClick:()=>m(Q),children:f.jsx(Qu,{size:16})})]})]},Q.id))})]})]});case"roles":return f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{children:[f.jsx("h1",{className:"text-2xl font-bold text-dark-text",children:"Roles"}),f.jsx("p",{className:"text-dark-muted mt-1",children:"Use roles to organize your members and customize permissions."})]}),f.jsxs("div",{className:"bg-dark-bg rounded-xl p-6 border border-dark-hover",children:[f.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[f.jsx("div",{className:"w-10 h-10 rounded-full bg-brand-primary/20 flex items-center justify-center",children:f.jsx(Wu,{className:"text-brand-primary",size:24})}),f.jsxs("div",{children:[f.jsx("h3",{className:"text-lg font-semibold text-dark-text",children:"Create New Role"}),f.jsx("p",{className:"text-sm text-dark-muted",children:"Add a custom role with a unique color"})]})]}),f.jsxs("div",{className:"flex gap-4 items-end",children:[f.jsxs("div",{className:"flex-1",children:[f.jsx("label",{className:"block text-xs font-medium text-dark-muted uppercase tracking-wide mb-2",children:"Role Name"}),f.jsx(Vn,{placeholder:"e.g. VIP, Helper, Supporter...",value:S.name,onChange:Q=>k({...S,name:Q.target.value})})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-xs font-medium text-dark-muted uppercase tracking-wide mb-2",children:"Color"}),f.jsx("div",{className:"relative",children:f.jsx("input",{type:"color",value:S.color,onChange:Q=>k({...S,color:Q.target.value}),className:"w-14 h-10 rounded-lg cursor-pointer border-2 border-dark-hover hover:border-brand-primary transition-colors",style:{backgroundColor:S.color}})})]}),f.jsxs(ut,{onClick:Ke,disabled:!S.name.trim(),className:"px-6",children:[f.jsx(Wu,{size:18,className:"mr-1"}),"Create Role"]})]})]}),f.jsxs("div",{className:"bg-dark-bg rounded-xl border border-dark-hover overflow-hidden",children:[f.jsxs("div",{className:"px-6 py-4 border-b border-dark-hover flex items-center justify-between",children:[f.jsxs("h3",{className:"text-sm font-semibold text-dark-muted uppercase tracking-wide",children:["Roles  ",He.length]}),f.jsx("span",{className:"text-xs text-dark-muted",children:"Drag custom roles to reorder hierarchy"})]}),f.jsxs("div",{className:"divide-y divide-dark-hover",children:[He.map((Q,Pe)=>f.jsxs("div",{draggable:!Q.isDefault,onDragStart:Fe=>de(Fe,Q.id),onDragOver:Ie,onDrop:Fe=>qe(Fe,Q.id),className:Ct("group flex items-center justify-between px-6 py-4 transition-colors",!Q.isDefault&&"cursor-grab active:cursor-grabbing hover:bg-dark-sidebar/50",Q.isDefault&&"opacity-70",P===Q.id&&"opacity-50 bg-brand-primary/10"),children:[f.jsxs("div",{className:"flex items-center gap-4",children:[!Q.isDefault&&f.jsx("div",{className:"text-dark-muted opacity-0 group-hover:opacity-100 transition-opacity",children:f.jsx(RB,{size:20})}),f.jsx("div",{className:"w-5 h-5 rounded-full ring-2 ring-offset-2 ring-offset-dark-bg",style:{backgroundColor:Q.color,ringColor:Q.color}}),f.jsxs("div",{children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("span",{className:"font-semibold text-dark-text",style:{color:Q.color},children:Q.name}),Q.isDefault&&f.jsx("span",{className:"text-[10px] px-2 py-0.5 bg-dark-hover text-dark-muted rounded-full uppercase font-medium",children:"System"})]}),f.jsx("p",{className:"text-xs text-dark-muted mt-0.5",children:Q.isDefault?"Default system role":`Position: ${Q.position??0}`})]})]}),!Q.isDefault&&f.jsxs("div",{className:"flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[f.jsx("button",{onClick:()=>D(Q),className:"p-2 rounded-lg hover:bg-dark-hover text-dark-muted hover:text-brand-primary transition-colors",title:"Edit Role",children:f.jsx(Qu,{size:18})}),f.jsx("button",{onClick:()=>z({type:"role",data:Q.id,name:Q.name}),className:"p-2 rounded-lg hover:bg-red-500/20 text-dark-muted hover:text-red-500 transition-colors",title:"Delete Role",children:f.jsx(Ka,{size:18})})]})]},Q.id)),He.length===0&&f.jsxs("div",{className:"px-6 py-12 text-center",children:[f.jsx(YP,{className:"mx-auto text-dark-muted mb-3",size:40}),f.jsx("p",{className:"text-dark-muted",children:"No roles created yet"}),f.jsx("p",{className:"text-xs text-dark-muted mt-1",children:"Create your first role above!"})]})]})]})]});case"channels":return f.jsxs("div",{className:"space-y-6",children:[f.jsx("h1",{className:"text-2xl font-bold text-dark-text",children:"Channels"}),f.jsx("p",{className:"text-dark-muted",children:"Create and manage server channels."}),f.jsxs("div",{className:"bg-dark-bg rounded-lg p-4",children:[f.jsx("h3",{className:"text-sm font-semibold text-dark-muted uppercase tracking-wide mb-4",children:"Create New Channel"}),f.jsxs("div",{className:"flex gap-3",children:[f.jsxs("div",{className:"flex-1 space-y-2",children:[f.jsxs("div",{className:"flex gap-2",children:[f.jsx(Vn,{placeholder:"Channel name",value:g,onChange:Q=>b(Q.target.value),className:"flex-1"}),f.jsxs("select",{value:E,onChange:Q=>A(Q.target.value),className:"bg-dark-input text-dark-text border border-dark-hover rounded-lg px-3 outline-none focus:border-brand-primary",children:[f.jsx("option",{value:"text",children:"Text Channel"}),f.jsx("option",{value:"voice",children:"Voice Channel"})]})]}),f.jsx(Vn,{placeholder:"Channel topic/description (Optional)",value:_,onChange:Q=>R(Q.target.value)})]}),f.jsxs(ut,{onClick:Oe,className:"h-fit mt-auto",children:[f.jsx(Wu,{size:20}),"Create"]})]})]}),f.jsxs("div",{className:"bg-dark-bg rounded-lg p-4",children:[f.jsxs("h3",{className:"text-sm font-semibold text-dark-muted uppercase tracking-wide mb-4",children:["Text Channels  ",i.length]}),f.jsx("div",{className:"space-y-2",children:i.map(Q=>f.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg hover:bg-dark-hover transition-colors",children:[f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx(y0,{className:"text-dark-muted"}),f.jsxs("div",{children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("span",{className:"font-medium text-dark-text",children:Q.name}),Q.description&&f.jsx("span",{className:"text-xs text-dark-muted ml-2 truncate max-w-[200px]",children:Q.description}),Q.locked&&f.jsxs("span",{className:"text-xs px-2 py-0.5 rounded bg-yellow-500/20 text-yellow-500 flex items-center gap-1",children:[f.jsx(Rf,{size:12}),"LOCKED"]})]}),f.jsx("div",{className:"text-xs text-dark-muted",children:Q.locked?"Only admins can send messages":"Everyone can send messages"})]})]}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx(ut,{size:"sm",variant:"ghost",onClick:()=>F(Q),children:f.jsx(Qu,{size:16})}),f.jsx(ut,{size:"sm",variant:Q.locked?"warning":"secondary",onClick:()=>Ge(Q.id,Q.locked),children:Q.locked?"Unlock":"Lock"}),f.jsx(ut,{size:"sm",variant:"danger",onClick:()=>z({type:"channel",data:Q.id,name:Q.name}),children:f.jsx(Ka,{size:16})})]})]},Q.id))})]})]});case"server":return f.jsxs("div",{className:"space-y-6",children:[f.jsx("h1",{className:"text-2xl font-bold text-dark-text",children:"Server Overview"}),f.jsx("p",{className:"text-dark-muted",children:"View server statistics and information."}),f.jsxs("div",{className:"bg-dark-bg rounded-lg p-6",children:[f.jsxs("div",{className:"mb-6",children:[f.jsx("div",{className:"text-xs text-dark-muted uppercase tracking-wide mb-1",children:"Server Name"}),f.jsx("div",{className:"text-2xl font-bold text-dark-text",children:s?.name||"Unknown"})]}),f.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[f.jsxs("div",{className:"bg-dark-sidebar p-4 rounded-lg text-center",children:[f.jsx("div",{className:"text-3xl font-bold text-brand-primary mb-1",children:r.length}),f.jsx("div",{className:"text-sm text-dark-muted",children:"Members"})]}),f.jsxs("div",{className:"bg-dark-sidebar p-4 rounded-lg text-center",children:[f.jsx("div",{className:"text-3xl font-bold text-green-500 mb-1",children:i.length}),f.jsx("div",{className:"text-sm text-dark-muted",children:"Channels"})]}),f.jsxs("div",{className:"bg-dark-sidebar p-4 rounded-lg text-center",children:[f.jsx("div",{className:"text-3xl font-bold text-purple-500 mb-1",children:He.length}),f.jsx("div",{className:"text-sm text-dark-muted",children:"Roles"})]})]})]})]});case"logs":return f.jsxs("div",{className:"space-y-6",children:[f.jsx("h1",{className:"text-2xl font-bold text-dark-text",children:"Audit Log"}),f.jsx("p",{className:"text-dark-muted",children:"View server activity and moderation history."}),f.jsx(_Y,{})]});case"cleanup":return f.jsxs("div",{className:"space-y-6",children:[f.jsx("h1",{className:"text-2xl font-bold text-dark-text",children:"Database Cleanup"}),f.jsx("p",{className:"text-dark-muted",children:"Remove unused data to keep your database clean and reduce storage costs."}),f.jsx("div",{className:"grid gap-4",children:f.jsxs("div",{className:"bg-dark-bg rounded-lg p-6 border border-dark-hover",children:[f.jsxs("div",{className:"flex items-center justify-between mb-4",children:[f.jsxs("div",{children:[f.jsx("h3",{className:"text-lg font-semibold text-dark-text",children:"Expired Invite Codes"}),f.jsx("p",{className:"text-sm text-dark-muted mt-1",children:"Expired, used, or deactivated invite codes that are no longer valid."})]}),f.jsx("div",{className:"text-3xl font-bold text-yellow-500",children:ve})]}),f.jsxs(ut,{variant:"warning",onClick:()=>je("invites"),disabled:ve===0||oe,className:"w-full",children:[f.jsx(Ka,{size:20}),oe?"Cleaning...":"Clean Invite Codes"]})]})}),f.jsxs("div",{className:"text-xs text-dark-muted bg-dark-sidebar p-4 rounded-lg",children:[f.jsx("strong",{children:"Note:"})," These actions are irreversible. Deleted data cannot be recovered. Running cleanup periodically helps keep your Firestore quota usage low."]})]});default:return null}};return f.jsxs("div",{className:"fixed inset-0 bg-black/80 z-[100] flex flex-col md:flex-row",children:[f.jsx("div",{className:"w-full md:w-56 bg-dark-sidebar flex flex-col shrink-0 border-b md:border-b-0 md:border-r border-dark-hover",children:f.jsx("div",{className:"flex md:flex-col overflow-x-auto md:overflow-y-auto py-2 md:py-4 px-2 gap-2 md:gap-0 no-scrollbar",children:Object.entries(ot).map(([Q,Pe])=>f.jsxs("div",{className:"mb-0 md:mb-4 flex md:block gap-2 md:gap-0 shrink-0",children:[f.jsx("div",{className:"hidden md:block px-3 py-2 text-xs font-semibold text-dark-muted uppercase tracking-wide",children:Q}),Pe.map(Fe=>{const ht=Fe.icon;return f.jsxs("button",{onClick:()=>d(Fe.id),className:Ct("whitespace-nowrap flex items-center gap-2 md:gap-3 px-3 py-2 rounded-md text-left transition-colors",l===Fe.id?"bg-dark-hover text-dark-text":"text-dark-muted hover:text-dark-text hover:bg-dark-hover/50"),children:[f.jsx(ht,{size:18}),f.jsx("span",{className:"text-sm",children:Fe.label})]},Fe.id)})]},Q))})}),f.jsxs("div",{className:"flex-1 flex flex-col bg-dark-bg overflow-hidden min-w-0",children:[f.jsx("div",{className:"flex justify-end p-4 shrink-0",children:f.jsx("button",{onClick:e,className:"p-2 hover:bg-dark-hover rounded-full transition-colors group",title:"Close (ESC)",children:f.jsx(mr,{size:24,className:"text-dark-muted group-hover:text-dark-text"})})}),f.jsx("div",{className:"flex-1 overflow-y-auto px-4 md:px-10 pb-10",children:f.jsx("div",{className:"max-w-3xl mx-auto md:mx-0",children:$e()})})]}),h&&(()=>{const Q=r.find(Pe=>Pe.id===h.id)||h;return f.jsx(ea,{isOpen:!!h,onClose:()=>m(null),title:"Edit User Role",size:"sm",children:f.jsxs("div",{className:"space-y-4",children:[f.jsxs("div",{children:[f.jsx("div",{className:"text-sm text-dark-muted mb-1",children:"User"}),f.jsx("div",{className:"font-medium text-dark-text",children:Q.displayName})]}),f.jsxs("div",{children:[f.jsx("div",{className:"text-sm text-dark-muted mb-2",children:"Select Role"}),f.jsx("div",{className:"space-y-2",children:He.map(Pe=>f.jsxs("button",{onClick:()=>te(h.id,Pe.name),className:Ct("w-full px-3 py-2 rounded-lg border text-left transition-all flex items-center gap-3",(Q.serverRole||Q.role)===Pe.name?"border-brand-primary bg-brand-primary/20":"border-dark-hover hover:bg-dark-hover"),children:[f.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:Pe.color}}),f.jsx("span",{className:"text-dark-text",children:Pe.name})]},Pe.id))})]})]})})})(),N&&f.jsx(ea,{isOpen:!!N,onClose:()=>D(null),title:"Edit Role",size:"sm",children:f.jsxs("div",{className:"space-y-4",children:[f.jsx(Vn,{label:"Role Name",value:N.name,onChange:Q=>D({...N,name:Q.target.value})}),f.jsxs("div",{children:[f.jsx("label",{className:"text-sm font-medium text-dark-text mb-2 block",children:"Role Color"}),f.jsxs("div",{className:"flex gap-3",children:[f.jsx("input",{type:"color",value:N.color,onChange:Q=>D({...N,color:Q.target.value}),className:"w-14 h-10 rounded cursor-pointer"}),f.jsx(Vn,{value:N.color,onChange:Q=>D({...N,color:Q.target.value}),className:"flex-1"})]})]}),f.jsx(ut,{variant:"primary",className:"w-full",onClick:()=>Ce(N.id,{name:N.name,color:N.color}),children:"Save Changes"})]})}),M&&f.jsx(ea,{isOpen:!!M,onClose:()=>F(null),title:"Edit Channel",size:"sm",children:f.jsxs("div",{className:"space-y-4",children:[f.jsx(Vn,{label:"Channel Name",value:M.name,onChange:Q=>F({...M,name:Q.target.value})}),f.jsx(Vn,{label:"Channel Topic / Description",value:M.description||"",onChange:Q=>F({...M,description:Q.target.value})}),f.jsx(ut,{variant:"primary",className:"w-full",onClick:()=>Te(M.id,{name:M.name,description:M.description}),children:"Save Changes"})]})}),f.jsx(gd,{isOpen:!!U,onClose:()=>z(null),onConfirm:U?.type==="channel"?we:Re,title:`Delete ${U?.type==="channel"?"Channel":"Role"}`,message:`Are you sure you want to delete "${U?.name}"? This cannot be undone.`,confirmText:"Delete",variant:"danger"}),f.jsx(gd,{isOpen:!!Me,onClose:()=>je(null),onConfirm:q,title:"Clean Invite Codes",message:`Are you sure you want to delete ${ve} expired/used invite code(s)? This action cannot be undone.`,confirmText:"Clean",variant:"danger"})]})},kY=({isOpen:n,onClose:e,userId:t,onSuccess:r})=>{const[i,s]=T.useState(""),[c,l]=T.useState(null),[d,h]=T.useState(null),[m,g]=T.useState(!1),[b,_]=T.useState({progress:0,speed:""}),R=T.useRef(null),{success:E,error:A}=Ss(),M=j=>{const C=j.target.files?.[0];if(C){if(!C.type.startsWith("image/")){A("Please select an image file");return}if(C.size>10*1024*1024){A("Image size must be less than 10MB");return}l(C),h(URL.createObjectURL(C))}},F=async()=>{if(!i.trim()){A("Server name is required");return}g(!0);try{let j=null;c&&(j=await $S(c,(N,D)=>{_({progress:N,speed:D})}));const C=await Ln(St(_e,"servers"),{name:i.trim(),icon:j,ownerId:t,createdAt:bt(),isDefault:!1,memberCount:1});await md(Be(_e,"servers",C.id,"members",t),{userId:t,joinedAt:bt(),role:"admin"}),await Ln(St(_e,"servers",C.id,"channels"),{name:"general",type:"text",description:"General discussion",position:0,createdAt:bt()}),await at(Be(_e,"users",t),{servers:up(C.id),currentServer:C.id}),E("Server created successfully!"),s(""),l(null),d&&URL.revokeObjectURL(d),h(null),r&&r(C.id),e()}catch(j){console.error("Error creating server:",j),A("Failed to create server")}finally{g(!1),_({progress:0,speed:""})}};return f.jsx(ea,{isOpen:n,onClose:e,title:"Create Server",size:"sm",children:f.jsxs("div",{className:"space-y-4",children:[f.jsxs("div",{className:"flex flex-col items-center",children:[f.jsx("input",{type:"file",ref:R,onChange:M,accept:"image/*",className:"hidden"}),f.jsx("button",{onClick:()=>R.current?.click(),className:"w-20 h-20 rounded-full bg-dark-hover border-2 border-dashed border-dark-muted hover:border-brand-primary flex items-center justify-center transition-colors overflow-hidden",children:d?f.jsx("img",{src:d,alt:"Preview",className:"w-full h-full object-cover"}):f.jsx(OB,{size:32,className:"text-dark-muted"})}),f.jsx("span",{className:"text-xs text-dark-muted mt-2",children:"Server Icon (Optional)"})]}),m&&c&&b.progress>0&&f.jsxs("div",{className:"text-xs text-dark-muted text-center",children:["Uploading icon: ",Math.round(b.progress),"% (",b.speed,")"]}),f.jsx(Vn,{label:"Server Name",placeholder:"My Awesome Server",value:i,onChange:j=>s(j.target.value),maxLength:50,autoFocus:!0}),f.jsxs("div",{className:"text-xs text-dark-muted",children:[i.length,"/50 characters"]}),f.jsxs("div",{className:"flex gap-2",children:[f.jsx(ut,{variant:"secondary",onClick:e,className:"flex-1",children:"Cancel"}),f.jsx(ut,{variant:"primary",onClick:F,disabled:!i.trim()||m,className:"flex-1",children:m?"Creating...":"Create Server"})]})]})})},CY=({isOpen:n,onClose:e,userId:t,onSuccess:r})=>{const[i,s]=T.useState(""),[c,l]=T.useState(!1),{success:d,error:h}=Ss(),m=async()=>{if(!i.trim()){h("Invite code is required");return}l(!0);try{const g=i.trim().toUpperCase(),b=Be(_e,"inviteCodes",g),_=await g0(b);if(!_.exists()){h("Invalid invite code");return}const R=_.data();if(!R.isActive){h("This invite code has already been used");return}const E=R.isUnlimited===!0||R.maxUses===-1;if(!E&&R.uses>=R.maxUses){h("This invite code has reached its usage limit");return}if(R.expiresAt.toDate()<new Date){h("This invite code has expired");return}await md(Be(_e,"servers",R.serverId,"members",t),{userId:t,joinedAt:bt(),role:"member"}),await at(Be(_e,"users",t),{servers:up(R.serverId),currentServer:R.serverId});const A={uses:fv(1)};E||(A.isActive=!1),await at(b,A),await at(Be(_e,"servers",R.serverId),{memberCount:fv(1)}),d("Successfully joined server!"),s(""),r&&r(R.serverId),e()}catch(g){console.error("Error joining server:",g),console.error("Error code:",g.code),console.error("Error message:",g.message),g.code!=="permission-denied"?g.code==="not-found"?h("Server not found"):h(`Failed to join server: ${g.message}`):e()}finally{l(!1)}};return f.jsx(ea,{isOpen:n,onClose:e,title:"Join Server",size:"sm",children:f.jsxs("div",{className:"space-y-4",children:[f.jsx(Vn,{label:"Invite Code",placeholder:"ABC12XYZ",value:i,onChange:g=>s(g.target.value.toUpperCase()),maxLength:8,autoFocus:!0}),f.jsx("div",{className:"text-xs text-dark-muted",children:"Enter the 8-character invite code"}),f.jsxs("div",{className:"flex gap-2",children:[f.jsx(ut,{variant:"secondary",onClick:e,className:"flex-1",children:"Cancel"}),f.jsx(ut,{variant:"primary",onClick:m,disabled:i.length!==8||c,className:"flex-1",children:c?"Joining...":"Join Server"})]})]})})},C4=()=>{if(window.electron&&window.electron.desktopCapturer)return window.electron.desktopCapturer;if(window.require)try{return window.require("electron").desktopCapturer}catch{return null}return null},wY=({isOpen:n,onClose:e,onConfirm:t})=>{const[r,i]=T.useState(720),[s,c]=T.useState(30),[l,d]=T.useState("screens"),[h,m]=T.useState({screens:[],windows:[]}),[g,b]=T.useState(null),[_,R]=T.useState(!1),E=!!C4();T.useEffect(()=>{if(n&&E){A();const F=setInterval(A,3e3);return()=>clearInterval(F)}},[n,E]);const A=async()=>{const F=C4();if(F)try{const j=await F.getSources({types:["window","screen"],thumbnailSize:{width:300,height:200}}),C=j.filter(D=>D.id.startsWith("screen:")),N=j.filter(D=>!D.id.startsWith("screen:"));m({screens:C,windows:N}),!g&&C.length>0&&b(C[0].id)}catch(j){console.error("Error loading sources:",j)}};if(!n)return null;const M=()=>{let F,j;r===1080?(F=1920,j=1080):(F=1280,j=720),t({width:F,height:j,frameRate:s,sourceId:g,displaySurface:l==="screens"?"monitor":"window"}),e()};return f.jsx("div",{className:"fixed inset-0 bg-black/80 z-[100] flex items-center justify-center animate-fade-in",children:f.jsxs("div",{className:"bg-dark-elem w-full max-w-2xl rounded-2xl shadow-2xl border border-dark-hover overflow-hidden transform transition-all scale-100 p-6 relative flex flex-col max-h-[90vh]",children:[f.jsxs("div",{className:"flex justify-between items-center mb-6 shrink-0",children:[f.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[f.jsx(If,{className:"text-brand-primary"}),"Screen Share"]}),f.jsx("button",{onClick:e,className:"p-1 hover:bg-dark-hover rounded-full transition-colors text-dark-muted hover:text-white",children:f.jsx(mr,{size:24})})]}),f.jsxs("div",{className:"flex gap-6 overflow-hidden flex-1",children:[f.jsxs("div",{className:"w-64 flex flex-col gap-6 shrink-0 border-r border-dark-hover pr-6",children:[f.jsxs("div",{children:[f.jsx("div",{className:"text-xs font-bold text-dark-muted uppercase tracking-wider mb-3",children:"Resolution"}),f.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[f.jsx("button",{onClick:()=>i(720),className:`p-2 rounded-lg border text-xs font-bold ${r===720?"border-brand-primary bg-brand-primary/10 text-white":"border-dark-hover bg-dark-input text-gray-400"}`,children:"720p"}),f.jsx("button",{onClick:()=>i(1080),className:`p-2 rounded-lg border text-xs font-bold ${r===1080?"border-brand-primary bg-brand-primary/10 text-white":"border-dark-hover bg-dark-input text-gray-400"}`,children:"1080p"})]})]}),f.jsxs("div",{children:[f.jsx("div",{className:"text-xs font-bold text-dark-muted uppercase tracking-wider mb-3",children:"Frame Rate"}),f.jsx("div",{className:"grid grid-cols-3 gap-2",children:[15,30,60].map(F=>f.jsx("button",{onClick:()=>c(F),className:`p-2 rounded-lg border text-xs font-bold ${s===F?"border-brand-primary bg-brand-primary/10 text-white":"border-dark-hover bg-dark-input text-gray-400"}`,children:F},F))})]})]}),f.jsx("div",{className:"flex-1 flex flex-col min-h-0",children:E?f.jsxs(f.Fragment,{children:[f.jsxs("div",{className:"flex gap-4 border-b border-dark-hover mb-4 shrink-0",children:[f.jsxs("button",{onClick:()=>d("screens"),className:`pb-2 text-sm font-bold flex items-center gap-2 transition-colors ${l==="screens"?"text-brand-primary border-b-2 border-brand-primary":"text-gray-400 hover:text-white"}`,children:[f.jsx(IB,{size:18})," Screens"]}),f.jsxs("button",{onClick:()=>d("windows"),className:`pb-2 text-sm font-bold flex items-center gap-2 transition-colors ${l==="windows"?"text-brand-primary border-b-2 border-brand-primary":"text-gray-400 hover:text-white"}`,children:[f.jsx(KB,{size:18})," Windows"]})]}),f.jsx("div",{className:"grid grid-cols-2 gap-3 overflow-y-auto pr-2 custom-scrollbar content-start",children:(l==="screens"?h.screens:h.windows).map(F=>f.jsxs("button",{onClick:()=>b(F.id),className:`group relative rounded-lg overflow-hidden border-2 transition-all text-left ${g===F.id?"border-brand-primary ring-2 ring-brand-primary/20":"border-transparent hover:border-gray-600 bg-black/40"}`,children:[f.jsxs("div",{className:"aspect-video bg-black relative",children:[f.jsx("img",{src:F.thumbnail.toDataURL(),alt:F.name,className:"w-full h-full object-contain"}),g===F.id&&f.jsx("div",{className:"absolute inset-0 bg-brand-primary/10 flex items-center justify-center",children:f.jsx(Sl,{className:"text-brand-primary drop-shadow-lg",size:48})})]}),f.jsx("div",{className:"p-2 bg-dark-input truncate text-xs font-medium text-gray-300 group-hover:text-white",children:F.name})]},F.id))})]}):f.jsx("div",{className:"flex items-center justify-center h-full text-center text-gray-500",children:f.jsxs("div",{className:"max-w-xs",children:[f.jsx(If,{size:48,className:"mx-auto mb-4 opacity-50"}),f.jsxs("p",{className:"text-sm",children:["Browser limits source selection here.",f.jsx("br",{}),'Click "Go Live" to pick a screen or window.']})]})})})]}),f.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-dark-hover mt-4 shrink-0",children:[f.jsx(ut,{variant:"ghost",onClick:e,className:"text-dark-text hover:text-white",children:"Cancel"}),f.jsx(ut,{variant:"primary",onClick:M,className:"px-8 shadow-lg shadow-brand-primary/20",disabled:E&&!g,children:"Go Live"})]})]})})},EY=({isOpen:n,onClose:e})=>{const{availableDevices:t,selectedMicId:r,setSelectedMicId:i,selectedCameraId:s,setSelectedCameraId:c}=Xi();return n?f.jsx("div",{className:"fixed inset-0 bg-black/80 z-[100] flex items-center justify-center animate-fade-in",children:f.jsxs("div",{className:"bg-dark-elem w-full max-w-md rounded-2xl shadow-2xl border border-dark-hover overflow-hidden p-6 relative",children:[f.jsxs("div",{className:"flex justify-between items-center mb-6",children:[f.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[f.jsx(Rf,{size:28,className:"text-brand-primary"}),"Device Settings"]}),f.jsx("button",{onClick:e,className:"p-1 hover:bg-dark-hover rounded-full transition-colors text-dark-muted hover:text-white",children:f.jsx(mr,{size:24})})]}),f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{children:[f.jsxs("label",{className:"block text-xs font-bold text-dark-muted uppercase tracking-wider mb-2 flex items-center gap-2",children:[f.jsx(_l,{size:16})," Microphone"]}),f.jsxs("select",{className:"w-full bg-dark-input border border-dark-hover rounded-lg p-3 text-white focus:ring-2 focus:ring-brand-primary outline-none transition-all",value:r,onChange:l=>i(l.target.value),children:[t.audioInputs.map(l=>f.jsx("option",{value:l.deviceId,children:l.label||`Microphone ${l.deviceId.slice(0,5)}...`},l.deviceId)),t.audioInputs.length===0&&f.jsx("option",{value:"",children:"No microphone found"})]})]}),f.jsxs("div",{children:[f.jsxs("label",{className:"block text-xs font-bold text-dark-muted uppercase tracking-wider mb-2 flex items-center gap-2",children:[f.jsx(Nf,{size:16})," Camera"]}),f.jsxs("select",{className:"w-full bg-dark-input border border-dark-hover rounded-lg p-3 text-white focus:ring-2 focus:ring-brand-primary outline-none transition-all",value:s,onChange:l=>c(l.target.value),children:[t.videoInputs.map(l=>f.jsx("option",{value:l.deviceId,children:l.label||`Camera ${l.deviceId.slice(0,5)}...`},l.deviceId)),t.videoInputs.length===0&&f.jsx("option",{value:"",children:"No camera found"})]})]}),f.jsx("div",{className:"pt-4 border-t border-dark-hover flex justify-end",children:f.jsx(ut,{variant:"primary",onClick:e,children:"Done"})})]})]})}):null};var Bh={exports:{}},y1={},b1={exports:{}},x1,w4;function RY(){if(w4)return x1;w4=1;var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return x1=n,x1}var _1,E4;function AY(){if(E4)return _1;E4=1;var n=RY();function e(){}function t(){}return t.resetWarningCache=e,_1=function(){function r(c,l,d,h,m,g){if(g!==n){var b=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw b.name="Invariant Violation",b}}r.isRequired=r;function i(){return r}var s={array:r,bigint:r,bool:r,func:r,number:r,object:r,string:r,symbol:r,any:r,arrayOf:i,element:r,elementType:r,instanceOf:i,node:r,objectOf:i,oneOf:i,oneOfType:i,shape:i,exact:i,checkPropTypes:t,resetWarningCache:e};return s.PropTypes=s,s},_1}var R4;function FM(){return R4||(R4=1,b1.exports=AY()()),b1.exports}var tg={exports:{}},A4;function NY(){if(A4)return tg.exports;A4=1;function n(t){var r,i,s="";if(typeof t=="string"||typeof t=="number")s+=t;else if(typeof t=="object")if(Array.isArray(t)){var c=t.length;for(r=0;r<c;r++)t[r]&&(i=n(t[r]))&&(s&&(s+=" "),s+=i)}else for(i in t)t[i]&&(s&&(s+=" "),s+=i);return s}function e(){for(var t,r,i=0,s="",c=arguments.length;i<c;i++)(t=arguments[i])&&(r=n(t))&&(s&&(s+=" "),s+=r);return s}return tg.exports=e,tg.exports.clsx=e,tg.exports}var jn={},Bo={},N4;function N0(){if(N4)return Bo;N4=1,Object.defineProperty(Bo,"__esModule",{value:!0}),Bo.dontSetMe=i,Bo.findInArray=n,Bo.int=r,Bo.isFunction=e,Bo.isNum=t;function n(s,c){for(let l=0,d=s.length;l<d;l++)if(c.apply(c,[s[l],l,s]))return s[l]}function e(s){return typeof s=="function"||Object.prototype.toString.call(s)==="[object Function]"}function t(s){return typeof s=="number"&&!isNaN(s)}function r(s){return parseInt(s,10)}function i(s,c,l){if(s[c])return new Error(`Invalid prop ${c} passed to ${l} - do not set this, set it on the child.`)}return Bo}var $o={},I4;function IY(){if(I4)return $o;I4=1,Object.defineProperty($o,"__esModule",{value:!0}),$o.browserPrefixToKey=t,$o.browserPrefixToStyle=r,$o.default=void 0,$o.getPrefix=e;const n=["Moz","Webkit","O","ms"];function e(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"transform";if(typeof window>"u")return"";const c=window.document?.documentElement?.style;if(!c||s in c)return"";for(let l=0;l<n.length;l++)if(t(s,n[l])in c)return n[l];return""}function t(s,c){return c?`${c}${i(s)}`:s}function r(s,c){return c?`-${c.toLowerCase()}-${s}`:s}function i(s){let c="",l=!0;for(let d=0;d<s.length;d++)l?(c+=s[d].toUpperCase(),l=!1):s[d]==="-"?l=!0:c+=s[d];return c}return $o.default=e(),$o}var P4;function lT(){if(P4)return jn;P4=1,Object.defineProperty(jn,"__esModule",{value:!0}),jn.addClassName=N,jn.addEvent=c,jn.addUserSelectStyles=F,jn.createCSSTransform=_,jn.createSVGTransform=R,jn.getTouch=A,jn.getTouchIdentifier=M,jn.getTranslation=E,jn.innerHeight=m,jn.innerWidth=g,jn.matchesSelector=i,jn.matchesSelectorAndParentsTo=s,jn.offsetXYFromParent=b,jn.outerHeight=d,jn.outerWidth=h,jn.removeClassName=D,jn.removeEvent=l,jn.scheduleRemoveUserSelectStyles=j;var n=N0(),e=t(IY());function t(S,k){if(typeof WeakMap=="function")var P=new WeakMap,L=new WeakMap;return(t=function(U,z){if(!z&&U&&U.__esModule)return U;var V,le,ve={__proto__:null,default:U};if(U===null||typeof U!="object"&&typeof U!="function")return ve;if(V=z?L:P){if(V.has(U))return V.get(U);V.set(U,ve)}for(const K in U)K!=="default"&&{}.hasOwnProperty.call(U,K)&&((le=(V=Object.defineProperty)&&Object.getOwnPropertyDescriptor(U,K))&&(le.get||le.set)?V(ve,K,le):ve[K]=U[K]);return ve})(S,k)}let r="";function i(S,k){return r||(r=(0,n.findInArray)(["matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector"],function(P){return(0,n.isFunction)(S[P])})),(0,n.isFunction)(S[r])?S[r](k):!1}function s(S,k,P){let L=S;do{if(i(L,k))return!0;if(L===P)return!1;L=L.parentNode}while(L);return!1}function c(S,k,P,L){if(!S)return;const U={capture:!0,...L};S.addEventListener?S.addEventListener(k,P,U):S.attachEvent?S.attachEvent("on"+k,P):S["on"+k]=P}function l(S,k,P,L){if(!S)return;const U={capture:!0,...L};S.removeEventListener?S.removeEventListener(k,P,U):S.detachEvent?S.detachEvent("on"+k,P):S["on"+k]=null}function d(S){let k=S.clientHeight;const P=S.ownerDocument.defaultView.getComputedStyle(S);return k+=(0,n.int)(P.borderTopWidth),k+=(0,n.int)(P.borderBottomWidth),k}function h(S){let k=S.clientWidth;const P=S.ownerDocument.defaultView.getComputedStyle(S);return k+=(0,n.int)(P.borderLeftWidth),k+=(0,n.int)(P.borderRightWidth),k}function m(S){let k=S.clientHeight;const P=S.ownerDocument.defaultView.getComputedStyle(S);return k-=(0,n.int)(P.paddingTop),k-=(0,n.int)(P.paddingBottom),k}function g(S){let k=S.clientWidth;const P=S.ownerDocument.defaultView.getComputedStyle(S);return k-=(0,n.int)(P.paddingLeft),k-=(0,n.int)(P.paddingRight),k}function b(S,k,P){const U=k===k.ownerDocument.body?{left:0,top:0}:k.getBoundingClientRect(),z=(S.clientX+k.scrollLeft-U.left)/P,V=(S.clientY+k.scrollTop-U.top)/P;return{x:z,y:V}}function _(S,k){const P=E(S,k,"px");return{[(0,e.browserPrefixToKey)("transform",e.default)]:P}}function R(S,k){return E(S,k,"")}function E(S,k,P){let{x:L,y:U}=S,z=`translate(${L}${P},${U}${P})`;if(k){const V=`${typeof k.x=="string"?k.x:k.x+P}`,le=`${typeof k.y=="string"?k.y:k.y+P}`;z=`translate(${V}, ${le})`+z}return z}function A(S,k){return S.targetTouches&&(0,n.findInArray)(S.targetTouches,P=>k===P.identifier)||S.changedTouches&&(0,n.findInArray)(S.changedTouches,P=>k===P.identifier)}function M(S){if(S.targetTouches&&S.targetTouches[0])return S.targetTouches[0].identifier;if(S.changedTouches&&S.changedTouches[0])return S.changedTouches[0].identifier}function F(S){if(!S)return;let k=S.getElementById("react-draggable-style-el");k||(k=S.createElement("style"),k.type="text/css",k.id="react-draggable-style-el",k.innerHTML=`.react-draggable-transparent-selection *::-moz-selection {all: inherit;}
`,k.innerHTML+=`.react-draggable-transparent-selection *::selection {all: inherit;}
`,S.getElementsByTagName("head")[0].appendChild(k)),S.body&&N(S.body,"react-draggable-transparent-selection")}function j(S){window.requestAnimationFrame?window.requestAnimationFrame(()=>{C(S)}):C(S)}function C(S){if(S)try{if(S.body&&D(S.body,"react-draggable-transparent-selection"),S.selection)S.selection.empty();else{const k=(S.defaultView||window).getSelection();k&&k.type!=="Caret"&&k.removeAllRanges()}}catch{}}function N(S,k){S.classList?S.classList.add(k):S.className.match(new RegExp(`(?:^|\\s)${k}(?!\\S)`))||(S.className+=` ${k}`)}function D(S,k){S.classList?S.classList.remove(k):S.className=S.className.replace(new RegExp(`(?:^|\\s)${k}(?!\\S)`,"g"),"")}return jn}var Fs={},M4;function BM(){if(M4)return Fs;M4=1,Object.defineProperty(Fs,"__esModule",{value:!0}),Fs.canDragX=i,Fs.canDragY=s,Fs.createCoreData=l,Fs.createDraggableData=d,Fs.getBoundPosition=t,Fs.getControlPosition=c,Fs.snapToGrid=r;var n=N0(),e=lT();function t(g,b,_){if(!g.props.bounds)return[b,_];let{bounds:R}=g.props;R=typeof R=="string"?R:h(R);const E=m(g);if(typeof R=="string"){const{ownerDocument:A}=E,M=A.defaultView;let F;if(R==="parent"?F=E.parentNode:F=E.getRootNode().querySelector(R),!(F instanceof M.HTMLElement))throw new Error('Bounds selector "'+R+'" could not find an element.');const j=F,C=M.getComputedStyle(E),N=M.getComputedStyle(j);R={left:-E.offsetLeft+(0,n.int)(N.paddingLeft)+(0,n.int)(C.marginLeft),top:-E.offsetTop+(0,n.int)(N.paddingTop)+(0,n.int)(C.marginTop),right:(0,e.innerWidth)(j)-(0,e.outerWidth)(E)-E.offsetLeft+(0,n.int)(N.paddingRight)-(0,n.int)(C.marginRight),bottom:(0,e.innerHeight)(j)-(0,e.outerHeight)(E)-E.offsetTop+(0,n.int)(N.paddingBottom)-(0,n.int)(C.marginBottom)}}return(0,n.isNum)(R.right)&&(b=Math.min(b,R.right)),(0,n.isNum)(R.bottom)&&(_=Math.min(_,R.bottom)),(0,n.isNum)(R.left)&&(b=Math.max(b,R.left)),(0,n.isNum)(R.top)&&(_=Math.max(_,R.top)),[b,_]}function r(g,b,_){const R=Math.round(b/g[0])*g[0],E=Math.round(_/g[1])*g[1];return[R,E]}function i(g){return g.props.axis==="both"||g.props.axis==="x"}function s(g){return g.props.axis==="both"||g.props.axis==="y"}function c(g,b,_){const R=typeof b=="number"?(0,e.getTouch)(g,b):null;if(typeof b=="number"&&!R)return null;const E=m(_),A=_.props.offsetParent||E.offsetParent||E.ownerDocument.body;return(0,e.offsetXYFromParent)(R||g,A,_.props.scale)}function l(g,b,_){const R=!(0,n.isNum)(g.lastX),E=m(g);return R?{node:E,deltaX:0,deltaY:0,lastX:b,lastY:_,x:b,y:_}:{node:E,deltaX:b-g.lastX,deltaY:_-g.lastY,lastX:g.lastX,lastY:g.lastY,x:b,y:_}}function d(g,b){const _=g.props.scale;return{node:b.node,x:g.state.x+b.deltaX/_,y:g.state.y+b.deltaY/_,deltaX:b.deltaX/_,deltaY:b.deltaY/_,lastX:g.state.x,lastY:g.state.y}}function h(g){return{left:g.left,top:g.top,right:g.right,bottom:g.bottom}}function m(g){const b=g.findDOMNode();if(!b)throw new Error("<DraggableCore>: Unmounted during event!");return b}return Fs}var $h={},ng={},D4;function $M(){if(D4)return ng;D4=1,Object.defineProperty(ng,"__esModule",{value:!0}),ng.default=n;function n(){}return ng}var O4;function PY(){if(O4)return $h;O4=1,Object.defineProperty($h,"__esModule",{value:!0}),$h.default=void 0;var n=d(Sc()),e=l(FM()),t=l(E_()),r=lT(),i=BM(),s=N0(),c=l($M());function l(E){return E&&E.__esModule?E:{default:E}}function d(E,A){if(typeof WeakMap=="function")var M=new WeakMap,F=new WeakMap;return(d=function(j,C){if(!C&&j&&j.__esModule)return j;var N,D,S={__proto__:null,default:j};if(j===null||typeof j!="object"&&typeof j!="function")return S;if(N=C?F:M){if(N.has(j))return N.get(j);N.set(j,S)}for(const k in j)k!=="default"&&{}.hasOwnProperty.call(j,k)&&((D=(N=Object.defineProperty)&&Object.getOwnPropertyDescriptor(j,k))&&(D.get||D.set)?N(S,k,D):S[k]=j[k]);return S})(E,A)}function h(E,A,M){return(A=m(A))in E?Object.defineProperty(E,A,{value:M,enumerable:!0,configurable:!0,writable:!0}):E[A]=M,E}function m(E){var A=g(E,"string");return typeof A=="symbol"?A:A+""}function g(E,A){if(typeof E!="object"||!E)return E;var M=E[Symbol.toPrimitive];if(M!==void 0){var F=M.call(E,A);if(typeof F!="object")return F;throw new TypeError("@@toPrimitive must return a primitive value.")}return(A==="string"?String:Number)(E)}const b={touch:{start:"touchstart",move:"touchmove",stop:"touchend"},mouse:{start:"mousedown",move:"mousemove",stop:"mouseup"}};let _=b.mouse,R=class extends n.Component{constructor(){super(...arguments),h(this,"dragging",!1),h(this,"lastX",NaN),h(this,"lastY",NaN),h(this,"touchIdentifier",null),h(this,"mounted",!1),h(this,"handleDragStart",A=>{if(this.props.onMouseDown(A),!this.props.allowAnyClick&&typeof A.button=="number"&&A.button!==0)return!1;const M=this.findDOMNode();if(!M||!M.ownerDocument||!M.ownerDocument.body)throw new Error("<DraggableCore> not mounted on DragStart!");const{ownerDocument:F}=M;if(this.props.disabled||!(A.target instanceof F.defaultView.Node)||this.props.handle&&!(0,r.matchesSelectorAndParentsTo)(A.target,this.props.handle,M)||this.props.cancel&&(0,r.matchesSelectorAndParentsTo)(A.target,this.props.cancel,M))return;A.type==="touchstart"&&!this.props.allowMobileScroll&&A.preventDefault();const j=(0,r.getTouchIdentifier)(A);this.touchIdentifier=j;const C=(0,i.getControlPosition)(A,j,this);if(C==null)return;const{x:N,y:D}=C,S=(0,i.createCoreData)(this,N,D);(0,c.default)("DraggableCore: handleDragStart: %j",S),(0,c.default)("calling",this.props.onStart),!(this.props.onStart(A,S)===!1||this.mounted===!1)&&(this.props.enableUserSelectHack&&(0,r.addUserSelectStyles)(F),this.dragging=!0,this.lastX=N,this.lastY=D,(0,r.addEvent)(F,_.move,this.handleDrag),(0,r.addEvent)(F,_.stop,this.handleDragStop))}),h(this,"handleDrag",A=>{const M=(0,i.getControlPosition)(A,this.touchIdentifier,this);if(M==null)return;let{x:F,y:j}=M;if(Array.isArray(this.props.grid)){let D=F-this.lastX,S=j-this.lastY;if([D,S]=(0,i.snapToGrid)(this.props.grid,D,S),!D&&!S)return;F=this.lastX+D,j=this.lastY+S}const C=(0,i.createCoreData)(this,F,j);if((0,c.default)("DraggableCore: handleDrag: %j",C),this.props.onDrag(A,C)===!1||this.mounted===!1){try{this.handleDragStop(new MouseEvent("mouseup"))}catch{const S=document.createEvent("MouseEvents");S.initMouseEvent("mouseup",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),this.handleDragStop(S)}return}this.lastX=F,this.lastY=j}),h(this,"handleDragStop",A=>{if(!this.dragging)return;const M=(0,i.getControlPosition)(A,this.touchIdentifier,this);if(M==null)return;let{x:F,y:j}=M;if(Array.isArray(this.props.grid)){let S=F-this.lastX||0,k=j-this.lastY||0;[S,k]=(0,i.snapToGrid)(this.props.grid,S,k),F=this.lastX+S,j=this.lastY+k}const C=(0,i.createCoreData)(this,F,j);if(this.props.onStop(A,C)===!1||this.mounted===!1)return!1;const D=this.findDOMNode();D&&this.props.enableUserSelectHack&&(0,r.scheduleRemoveUserSelectStyles)(D.ownerDocument),(0,c.default)("DraggableCore: handleDragStop: %j",C),this.dragging=!1,this.lastX=NaN,this.lastY=NaN,D&&((0,c.default)("DraggableCore: Removing handlers"),(0,r.removeEvent)(D.ownerDocument,_.move,this.handleDrag),(0,r.removeEvent)(D.ownerDocument,_.stop,this.handleDragStop))}),h(this,"onMouseDown",A=>(_=b.mouse,this.handleDragStart(A))),h(this,"onMouseUp",A=>(_=b.mouse,this.handleDragStop(A))),h(this,"onTouchStart",A=>(_=b.touch,this.handleDragStart(A))),h(this,"onTouchEnd",A=>(_=b.touch,this.handleDragStop(A)))}componentDidMount(){this.mounted=!0;const A=this.findDOMNode();A&&(0,r.addEvent)(A,b.touch.start,this.onTouchStart,{passive:!1})}componentWillUnmount(){this.mounted=!1;const A=this.findDOMNode();if(A){const{ownerDocument:M}=A;(0,r.removeEvent)(M,b.mouse.move,this.handleDrag),(0,r.removeEvent)(M,b.touch.move,this.handleDrag),(0,r.removeEvent)(M,b.mouse.stop,this.handleDragStop),(0,r.removeEvent)(M,b.touch.stop,this.handleDragStop),(0,r.removeEvent)(A,b.touch.start,this.onTouchStart,{passive:!1}),this.props.enableUserSelectHack&&(0,r.scheduleRemoveUserSelectStyles)(M)}}findDOMNode(){return this.props?.nodeRef?this.props?.nodeRef?.current:t.default.findDOMNode(this)}render(){return n.cloneElement(n.Children.only(this.props.children),{onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,onTouchEnd:this.onTouchEnd})}};return $h.default=R,h(R,"displayName","DraggableCore"),h(R,"propTypes",{allowAnyClick:e.default.bool,allowMobileScroll:e.default.bool,children:e.default.node.isRequired,disabled:e.default.bool,enableUserSelectHack:e.default.bool,offsetParent:function(E,A){if(E[A]&&E[A].nodeType!==1)throw new Error("Draggable's offsetParent must be a DOM Node.")},grid:e.default.arrayOf(e.default.number),handle:e.default.string,cancel:e.default.string,nodeRef:e.default.object,onStart:e.default.func,onDrag:e.default.func,onStop:e.default.func,onMouseDown:e.default.func,scale:e.default.number,className:s.dontSetMe,style:s.dontSetMe,transform:s.dontSetMe}),h(R,"defaultProps",{allowAnyClick:!1,allowMobileScroll:!1,disabled:!1,enableUserSelectHack:!0,onStart:function(){},onDrag:function(){},onStop:function(){},onMouseDown:function(){},scale:1}),$h}var j4;function MY(){return j4||(j4=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"DraggableCore",{enumerable:!0,get:function(){return d.default}}),n.default=void 0;var e=g(Sc()),t=m(FM()),r=m(E_()),i=NY(),s=lT(),c=BM(),l=N0(),d=m(PY()),h=m($M());function m(M){return M&&M.__esModule?M:{default:M}}function g(M,F){if(typeof WeakMap=="function")var j=new WeakMap,C=new WeakMap;return(g=function(N,D){if(!D&&N&&N.__esModule)return N;var S,k,P={__proto__:null,default:N};if(N===null||typeof N!="object"&&typeof N!="function")return P;if(S=D?C:j){if(S.has(N))return S.get(N);S.set(N,P)}for(const L in N)L!=="default"&&{}.hasOwnProperty.call(N,L)&&((k=(S=Object.defineProperty)&&Object.getOwnPropertyDescriptor(N,L))&&(k.get||k.set)?S(P,L,k):P[L]=N[L]);return P})(M,F)}function b(){return b=Object.assign?Object.assign.bind():function(M){for(var F=1;F<arguments.length;F++){var j=arguments[F];for(var C in j)({}).hasOwnProperty.call(j,C)&&(M[C]=j[C])}return M},b.apply(null,arguments)}function _(M,F,j){return(F=R(F))in M?Object.defineProperty(M,F,{value:j,enumerable:!0,configurable:!0,writable:!0}):M[F]=j,M}function R(M){var F=E(M,"string");return typeof F=="symbol"?F:F+""}function E(M,F){if(typeof M!="object"||!M)return M;var j=M[Symbol.toPrimitive];if(j!==void 0){var C=j.call(M,F);if(typeof C!="object")return C;throw new TypeError("@@toPrimitive must return a primitive value.")}return(F==="string"?String:Number)(M)}class A extends e.Component{static getDerivedStateFromProps(F,j){let{position:C}=F,{prevPropsPosition:N}=j;return C&&(!N||C.x!==N.x||C.y!==N.y)?((0,h.default)("Draggable: getDerivedStateFromProps %j",{position:C,prevPropsPosition:N}),{x:C.x,y:C.y,prevPropsPosition:{...C}}):null}constructor(F){super(F),_(this,"onDragStart",(j,C)=>{if((0,h.default)("Draggable: onDragStart: %j",C),this.props.onStart(j,(0,c.createDraggableData)(this,C))===!1)return!1;this.setState({dragging:!0,dragged:!0})}),_(this,"onDrag",(j,C)=>{if(!this.state.dragging)return!1;(0,h.default)("Draggable: onDrag: %j",C);const N=(0,c.createDraggableData)(this,C),D={x:N.x,y:N.y,slackX:0,slackY:0};if(this.props.bounds){const{x:k,y:P}=D;D.x+=this.state.slackX,D.y+=this.state.slackY;const[L,U]=(0,c.getBoundPosition)(this,D.x,D.y);D.x=L,D.y=U,D.slackX=this.state.slackX+(k-D.x),D.slackY=this.state.slackY+(P-D.y),N.x=D.x,N.y=D.y,N.deltaX=D.x-this.state.x,N.deltaY=D.y-this.state.y}if(this.props.onDrag(j,N)===!1)return!1;this.setState(D)}),_(this,"onDragStop",(j,C)=>{if(!this.state.dragging||this.props.onStop(j,(0,c.createDraggableData)(this,C))===!1)return!1;(0,h.default)("Draggable: onDragStop: %j",C);const D={dragging:!1,slackX:0,slackY:0};if(!!this.props.position){const{x:k,y:P}=this.props.position;D.x=k,D.y=P}this.setState(D)}),this.state={dragging:!1,dragged:!1,x:F.position?F.position.x:F.defaultPosition.x,y:F.position?F.position.y:F.defaultPosition.y,prevPropsPosition:{...F.position},slackX:0,slackY:0,isElementSVG:!1},F.position&&!(F.onDrag||F.onStop)&&console.warn("A `position` was applied to this <Draggable>, without drag handlers. This will make this component effectively undraggable. Please attach `onDrag` or `onStop` handlers so you can adjust the `position` of this element.")}componentDidMount(){typeof window.SVGElement<"u"&&this.findDOMNode()instanceof window.SVGElement&&this.setState({isElementSVG:!0})}componentWillUnmount(){this.state.dragging&&this.setState({dragging:!1})}findDOMNode(){return this.props?.nodeRef?.current??r.default.findDOMNode(this)}render(){const{axis:F,bounds:j,children:C,defaultPosition:N,defaultClassName:D,defaultClassNameDragging:S,defaultClassNameDragged:k,position:P,positionOffset:L,scale:U,...z}=this.props;let V={},le=null;const K=!!!P||this.state.dragging,oe=P||N,ee={x:(0,c.canDragX)(this)&&K?this.state.x:oe.x,y:(0,c.canDragY)(this)&&K?this.state.y:oe.y};this.state.isElementSVG?le=(0,s.createSVGTransform)(ee,L):V=(0,s.createCSSTransform)(ee,L);const Me=(0,i.clsx)(C.props.className||"",D,{[S]:this.state.dragging,[k]:this.state.dragged});return e.createElement(d.default,b({},z,{onStart:this.onDragStart,onDrag:this.onDrag,onStop:this.onDragStop}),e.cloneElement(e.Children.only(C),{className:Me,style:{...C.props.style,...V},transform:le}))}}n.default=A,_(A,"displayName","Draggable"),_(A,"propTypes",{...d.default.propTypes,axis:t.default.oneOf(["both","x","y","none"]),bounds:t.default.oneOfType([t.default.shape({left:t.default.number,right:t.default.number,top:t.default.number,bottom:t.default.number}),t.default.string,t.default.oneOf([!1])]),defaultClassName:t.default.string,defaultClassNameDragging:t.default.string,defaultClassNameDragged:t.default.string,defaultPosition:t.default.shape({x:t.default.number,y:t.default.number}),positionOffset:t.default.shape({x:t.default.oneOfType([t.default.number,t.default.string]),y:t.default.oneOfType([t.default.number,t.default.string])}),position:t.default.shape({x:t.default.number,y:t.default.number}),className:l.dontSetMe,style:l.dontSetMe,transform:l.dontSetMe}),_(A,"defaultProps",{...d.default.defaultProps,axis:"both",bounds:!1,defaultClassName:"react-draggable",defaultClassNameDragging:"react-draggable-dragging",defaultClassNameDragged:"react-draggable-dragged",defaultPosition:{x:0,y:0},scale:1})})(y1)),y1}var L4;function DY(){if(L4)return Bh.exports;L4=1;const{default:n,DraggableCore:e}=MY();return Bh.exports=n,Bh.exports.default=n,Bh.exports.DraggableCore=e,Bh.exports}var OY=DY();const qM=Wf(OY);var Td;(function(n){n.Unimplemented="UNIMPLEMENTED",n.Unavailable="UNAVAILABLE"})(Td||(Td={}));class S1 extends Error{constructor(e,t,r){super(e),this.message=e,this.code=t,this.data=r}}const jY=n=>{var e,t;return n?.androidBridge?"android":!((t=(e=n?.webkit)===null||e===void 0?void 0:e.messageHandlers)===null||t===void 0)&&t.bridge?"ios":"web"},LY=n=>{const e=n.CapacitorCustomPlatform||null,t=n.Capacitor||{},r=t.Plugins=t.Plugins||{},i=()=>e!==null?e.name:jY(n),s=()=>i()!=="web",c=g=>{const b=h.get(g);return!!(b?.platforms.has(i())||l(g))},l=g=>{var b;return(b=t.PluginHeaders)===null||b===void 0?void 0:b.find(_=>_.name===g)},d=g=>n.console.error(g),h=new Map,m=(g,b={})=>{const _=h.get(g);if(_)return console.warn(`Capacitor plugin "${g}" already registered. Cannot register plugins twice.`),_.proxy;const R=i(),E=l(g);let A;const M=async()=>(!A&&R in b?A=typeof b[R]=="function"?A=await b[R]():A=b[R]:e!==null&&!A&&"web"in b&&(A=typeof b.web=="function"?A=await b.web():A=b.web),A),F=(k,P)=>{var L,U;if(E){const z=E?.methods.find(V=>P===V.name);if(z)return z.rtype==="promise"?V=>t.nativePromise(g,P.toString(),V):(V,le)=>t.nativeCallback(g,P.toString(),V,le);if(k)return(L=k[P])===null||L===void 0?void 0:L.bind(k)}else{if(k)return(U=k[P])===null||U===void 0?void 0:U.bind(k);throw new S1(`"${g}" plugin is not implemented on ${R}`,Td.Unimplemented)}},j=k=>{let P;const L=(...U)=>{const z=M().then(V=>{const le=F(V,k);if(le){const ve=le(...U);return P=ve?.remove,ve}else throw new S1(`"${g}.${k}()" is not implemented on ${R}`,Td.Unimplemented)});return k==="addListener"&&(z.remove=async()=>P()),z};return L.toString=()=>`${k.toString()}() { [capacitor code] }`,Object.defineProperty(L,"name",{value:k,writable:!1,configurable:!1}),L},C=j("addListener"),N=j("removeListener"),D=(k,P)=>{const L=C({eventName:k},P),U=async()=>{const V=await L;N({eventName:k,callbackId:V},P)},z=new Promise(V=>L.then(()=>V({remove:U})));return z.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await U()},z},S=new Proxy({},{get(k,P){switch(P){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return E?D:C;case"removeListener":return N;default:return j(P)}}});return r[g]=S,h.set(g,{name:g,proxy:S,platforms:new Set([...Object.keys(b),...E?[R]:[]])}),S};return t.convertFileSrc||(t.convertFileSrc=g=>g),t.getPlatform=i,t.handleError=d,t.isNativePlatform=s,t.isPluginAvailable=c,t.registerPlugin=m,t.Exception=S1,t.DEBUG=!!t.DEBUG,t.isLoggingEnabled=!!t.isLoggingEnabled,t},UY=n=>n.Capacitor=LY(n),Tl=UY(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),I0=Tl.registerPlugin;class uT{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(e,t){let r=!1;this.listeners[e]||(this.listeners[e]=[],r=!0),this.listeners[e].push(t);const s=this.windowListeners[e];s&&!s.registered&&this.addWindowListener(s),r&&this.sendRetainedArgumentsForEvent(e);const c=async()=>this.removeListener(e,t);return Promise.resolve({remove:c})}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,t,r){const i=this.listeners[e];if(!i){if(r){let s=this.retainedEventArguments[e];s||(s=[]),s.push(t),this.retainedEventArguments[e]=s}return}i.forEach(s=>s(t))}hasListeners(e){var t;return!!(!((t=this.listeners[e])===null||t===void 0)&&t.length)}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:r=>{this.notifyListeners(t,r)}}}unimplemented(e="not implemented"){return new Tl.Exception(e,Td.Unimplemented)}unavailable(e="not available"){return new Tl.Exception(e,Td.Unavailable)}async removeListener(e,t){const r=this.listeners[e];if(!r)return;const i=r.indexOf(t);this.listeners[e].splice(i,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){const t=this.retainedEventArguments[e];t&&(delete this.retainedEventArguments[e],t.forEach(r=>{this.notifyListeners(e,r)}))}}const U4=n=>encodeURIComponent(n).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),V4=n=>n.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class VY extends uT{async getCookies(){const e=document.cookie,t={};return e.split(";").forEach(r=>{if(r.length<=0)return;let[i,s]=r.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");i=V4(i).trim(),s=V4(s).trim(),t[i]=s}),t}async setCookie(e){try{const t=U4(e.key),r=U4(e.value),i=`; expires=${(e.expires||"").replace("expires=","")}`,s=(e.path||"/").replace("path=",""),c=e.url!=null&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${t}=${r||""}${i}; path=${s}; ${c};`}catch(t){return Promise.reject(t)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(t){return Promise.reject(t)}}async clearCookies(){try{const e=document.cookie.split(";")||[];for(const t of e)document.cookie=t.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}I0("CapacitorCookies",{web:()=>new VY});const zY=async n=>new Promise((e,t)=>{const r=new FileReader;r.onload=()=>{const i=r.result;e(i.indexOf(",")>=0?i.split(",")[1]:i)},r.onerror=i=>t(i),r.readAsDataURL(n)}),FY=(n={})=>{const e=Object.keys(n);return Object.keys(n).map(i=>i.toLocaleLowerCase()).reduce((i,s,c)=>(i[s]=n[e[c]],i),{})},BY=(n,e=!0)=>n?Object.entries(n).reduce((r,i)=>{const[s,c]=i;let l,d;return Array.isArray(c)?(d="",c.forEach(h=>{l=e?encodeURIComponent(h):h,d+=`${s}=${l}&`}),d.slice(0,-1)):(l=e?encodeURIComponent(c):c,d=`${s}=${l}`),`${r}&${d}`},"").substr(1):null,$Y=(n,e={})=>{const t=Object.assign({method:n.method||"GET",headers:n.headers},e),i=FY(n.headers)["content-type"]||"";if(typeof n.data=="string")t.body=n.data;else if(i.includes("application/x-www-form-urlencoded")){const s=new URLSearchParams;for(const[c,l]of Object.entries(n.data||{}))s.set(c,l);t.body=s.toString()}else if(i.includes("multipart/form-data")||n.data instanceof FormData){const s=new FormData;if(n.data instanceof FormData)n.data.forEach((l,d)=>{s.append(d,l)});else for(const l of Object.keys(n.data))s.append(l,n.data[l]);t.body=s;const c=new Headers(t.headers);c.delete("content-type"),t.headers=c}else(i.includes("application/json")||typeof n.data=="object")&&(t.body=JSON.stringify(n.data));return t};class qY extends uT{async request(e){const t=$Y(e,e.webFetchExtra),r=BY(e.params,e.shouldEncodeUrlParams),i=r?`${e.url}?${r}`:e.url,s=await fetch(i,t),c=s.headers.get("content-type")||"";let{responseType:l="text"}=s.ok?e:{};c.includes("application/json")&&(l="json");let d,h;switch(l){case"arraybuffer":case"blob":h=await s.blob(),d=await zY(h);break;case"json":d=await s.json();break;case"document":case"text":default:d=await s.text()}const m={};return s.headers.forEach((g,b)=>{m[b]=g}),{data:d,headers:m,status:s.status,url:s.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}I0("CapacitorHttp",{web:()=>new qY});var z4;(function(n){n.Dark="DARK",n.Light="LIGHT",n.Default="DEFAULT"})(z4||(z4={}));var F4;(function(n){n.StatusBar="StatusBar",n.NavigationBar="NavigationBar"})(F4||(F4={}));class HY extends uT{async setStyle(){this.unavailable("not available for web")}async setAnimation(){this.unavailable("not available for web")}async show(){this.unavailable("not available for web")}async hide(){this.unavailable("not available for web")}}I0("SystemBars",{web:()=>new HY});const GY=()=>{const{callStatus:n,incomingCall:e,outgoingCallUser:t,answerCall:r,endCall:i,localStream:s,remoteStream:c,toggleAudio:l,toggleVideo:d,isMuted:h,isVideoOff:m,activeCall:g,isScreenSharing:b,toggleScreenShare:_,availableDevices:R,selectedMicId:E,selectedCameraId:A,setSelectedMicId:M,setSelectedCameraId:F,playSound:j,customSounds:C,addSound:N,removeSound:D}=Xi(),S=T.useRef(null),k=T.useRef(null),P=T.useRef(null),[L,U]=T.useState(!1),[z,V]=T.useState(!1),[le,ve]=T.useState(100),[K,oe]=T.useState(!1),[ee,Me]=T.useState(!1),[je,q]=T.useState(!1),[te,fe]=T.useState(!1),[Se,Oe]=T.useState(!1),{userProfile:Te}=Ar(),{role:we}=Ar(),Ge=Te?.roles?.includes("premium")||Te?.roles?.includes("admin")||Te?.plan==="premium"||Te?.badges?.includes("premium"),Ke=t3(Te,qa.SCREEN_SHARE),Ce=T.useRef(null),Re=async Ie=>{const qe=Ie.target.files[0];if(!qe)return;const ot=qe.name.split(".")[0].slice(0,10);await N(ot,qe),Ce.current&&(Ce.current.value="")},[He,de]=T.useState(!1);return T.useEffect(()=>{S.current&&s&&(S.current.srcObject=s)},[s,n]),T.useEffect(()=>{k.current&&c&&(k.current.srcObject=c)},[c,n]),T.useEffect(()=>{if(c){const Ie=c.getVideoTracks()[0];if(Ie){const qe=!Ie.muted&&Ie.readyState==="live";de(qe);const ot=()=>de(!1),$e=()=>de(!0),Q=()=>de(!1);return Ie.addEventListener("mute",ot),Ie.addEventListener("unmute",$e),Ie.addEventListener("ended",Q),()=>{Ie.removeEventListener("mute",ot),Ie.removeEventListener("unmute",$e),Ie.removeEventListener("ended",Q)}}else de(!1)}else de(!1)},[c]),T.useEffect(()=>{k.current&&(k.current.volume=le/100)},[le,c]),T.useEffect(()=>{n==="idle"&&(U(!1),Oe(!1),Me(!1),fe(!1),oe(!1),q(!1))},[n]),n==="idle"?null:n==="incoming"?f.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/50 backdrop-blur-sm animate-fade-in",role:"dialog","aria-modal":"true",children:f.jsxs("div",{className:"bg-dark-sidebar p-6 rounded-2xl shadow-2xl w-80 text-center border border-dark-hover",children:[f.jsxs("div",{className:"w-24 h-24 mx-auto mb-4 relative",children:[e?.callerPhotoUrl?f.jsx("img",{src:e.callerPhotoUrl,alt:"Caller",className:"w-full h-full rounded-full object-cover border-4 border-dark-bg"}):f.jsx("div",{className:"w-full h-full rounded-full bg-brand-primary flex items-center justify-center text-3xl font-bold text-white border-4 border-dark-bg",children:e?.callerName?.[0]?.toUpperCase()}),f.jsx("div",{className:"absolute -bottom-1 -right-1 bg-green-500 rounded-full p-2 animate-bounce",children:f.jsx(gR,{size:16,className:"text-white"})})]}),f.jsx("h3",{className:"text-xl font-bold text-white mb-1",children:e?.callerName}),f.jsxs("p",{className:"text-dark-muted mb-6",children:["Incoming ",e?.type," call..."]}),f.jsxs("div",{className:"flex gap-4 justify-center",children:[f.jsx("button",{onClick:()=>i(!0),className:"w-12 h-12 rounded-full bg-red-500 flex items-center justify-center text-white hover:bg-red-600 transition-colors",children:f.jsx(ff,{size:24})}),f.jsx("button",{onClick:r,className:"w-12 h-12 rounded-full bg-green-500 flex items-center justify-center text-white hover:bg-green-600 transition-colors",children:f.jsx(gR,{size:20})})]})]})}):f.jsx(qM,{nodeRef:P,disabled:!L,bounds:"body",onStart:()=>V(!0),onStop:()=>V(!1),children:f.jsxs("div",{role:"dialog","aria-modal":"true",ref:P,style:L?void 0:{transform:"none !important"},className:Ct("fixed z-[100] bg-gray-900 shadow-2xl overflow-hidden border border-gray-700 group",!z&&"transition-all duration-300",L?"bottom-4 right-4 w-64 h-48 rounded-lg cursor-move":"inset-0 flex flex-col !transform-none"),children:[f.jsxs("div",{className:Ct("absolute top-0 left-0 right-0 p-4 z-50 flex justify-between items-start bg-gradient-to-b from-black/80 to-transparent transition-opacity duration-200 opacity-100"),children:[f.jsx("div",{className:"flex gap-2",children:f.jsxs("div",{className:"bg-black/40 backdrop-blur px-3 py-1 rounded-full flex items-center gap-2",children:[f.jsx("span",{className:Ct("w-2 h-2 rounded-full",g?"bg-green-500":"bg-yellow-500 animate-pulse")}),f.jsx("span",{className:"text-xs text-white font-medium",children:g?"Connected":"Calling..."})]})}),f.jsx("button",{onClick:()=>U(!L),className:"p-2 rounded-full bg-black/40 hover:bg-white/10 text-white backdrop-blur transition-colors",title:L?"Maximize":"Minimize",children:L?f.jsx(BB,{size:20}):f.jsx(FB,{size:20})})]}),f.jsxs("div",{className:"relative flex-1 bg-black flex items-center justify-center w-full h-full",children:[f.jsx("video",{ref:k,autoPlay:!0,playsInline:!0,className:Ct("w-full h-full object-contain",(!c||!He)&&"hidden")}),(!c||!He)&&f.jsxs("div",{className:"text-center absolute inset-0 flex flex-col items-center justify-center z-10",children:[f.jsx("div",{className:"w-32 h-32 mx-auto mb-4 rounded-full bg-gray-800 flex items-center justify-center text-6xl font-bold text-gray-500 animate-pulse",children:t?.displayName?.[0]||g?.metadata?.name?.[0]||"?"}),f.jsx("p",{className:"text-xl text-white font-medium",children:n==="outgoing"?"Calling...":n==="connected"?"No Video / Audio Only":"Connecting..."}),f.jsx("p",{className:"text-gray-400 text-sm mt-1",children:t?.displayName})]}),!L&&s&&f.jsx(KY,{})]}),f.jsxs("div",{className:Ct("absolute bottom-4 md:bottom-8 left-1/2 -translate-x-1/2 z-50 flex flex-wrap justify-center items-center gap-2 md:gap-4 p-2 md:p-3 bg-gray-900/80 backdrop-blur-md rounded-xl md:rounded-2xl border border-gray-700 shadow-xl transition-opacity duration-300 hover:opacity-100 w-[95%] md:w-auto max-w-screen-sm",L&&"hidden"),children:[f.jsx("button",{onClick:l,className:Ct("p-3 rounded-xl transition-all hover:scale-110 active:scale-95",h?"bg-red-500/20 text-red-500":"bg-gray-700/50 text-white hover:bg-gray-600"),title:h?"Unmute":"Mute",children:h?f.jsx(Af,{size:22}):f.jsx(_l,{size:22})}),f.jsx("button",{onClick:d,className:Ct("p-3 rounded-xl transition-all hover:scale-110 active:scale-95",m?"bg-red-500/20 text-red-500":"bg-gray-700/50 text-white hover:bg-gray-600"),title:m?"Turn Video On":"Turn Video Off",children:m?f.jsx(bx,{size:22}):f.jsx(Nf,{size:22})}),!Tl.isNativePlatform()&&f.jsxs("div",{className:"relative",onMouseEnter:()=>q(!0),onMouseLeave:()=>q(!1),children:[f.jsx("button",{onClick:()=>{b?_():fe(!0)},disabled:!g||!Ke,className:Ct("p-3 rounded-xl transition-all hover:scale-110 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed",b?"bg-green-500 text-white":Ke?"bg-gray-700/50 text-white hover:bg-gray-600":"bg-gray-800 text-gray-500 cursor-not-allowed"),title:Ke?b?"Stop Sharing":"Share Screen":void 0,children:b?f.jsx(WP,{size:22}):f.jsx(If,{size:22})}),!Ke&&f.jsxs("div",{className:Ct("absolute bottom-full mb-2 left-1/2 -translate-x-1/2 px-2 py-1 bg-black text-rose-500 text-xs font-bold rounded shadow-lg whitespace-nowrap transition-opacity pointer-events-none z-50",je?"opacity-100":"opacity-0"),children:["Requires Premium ",f.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-black"})]})]}),f.jsx("div",{className:"w-px h-8 bg-gray-700 mx-2"}),f.jsxs("div",{className:"relative",children:[f.jsx("button",{onClick:()=>oe(!K),onDoubleClick:()=>ve(le>0?0:100),className:Ct("p-3 rounded-xl transition-all hover:scale-110 active:scale-95",le===0?"bg-red-500/20 text-red-500":"bg-gray-700/50 text-white hover:bg-gray-600"),title:`Volume: ${le}% (click to show slider, double-click to mute)`,children:le===0?f.jsx(aR,{size:22}):le<50?f.jsx(_B,{size:22}):f.jsx(xx,{size:22})}),K&&f.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-3 p-3 bg-gray-900/95 backdrop-blur-md rounded-xl border border-gray-700 shadow-xl",children:f.jsxs("div",{className:"flex flex-col items-center gap-2",children:[f.jsxs("span",{className:"text-xs text-gray-400 font-medium",children:[le,"%"]}),f.jsx("input",{type:"range",min:"0",max:"100",value:le,onChange:Ie=>ve(Number(Ie.target.value)),className:`w-24 h-2 appearance-none bg-gray-700 rounded-full cursor-pointer accent-brand-primary
                     [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-4 [&::-webkit-slider-thumb]:h-4 
                     [&::-webkit-slider-thumb]:bg-brand-primary [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:cursor-pointer
                     [&::-webkit-slider-thumb]:shadow-lg [&::-webkit-slider-thumb]:hover:scale-110 [&::-webkit-slider-thumb]:transition-transform`,style:{background:`linear-gradient(to right, rgb(88, 101, 242) ${le}%, rgb(55, 65, 81) ${le}%)`}}),f.jsx("span",{className:"text-[10px] text-gray-500",children:"Remote Volume"})]})})]}),f.jsxs("div",{className:"relative",children:[f.jsx("button",{onClick:()=>Oe(!Se),className:Ct("p-3 rounded-xl transition-all hover:scale-110 active:scale-95",Se?"bg-brand-primary/20 text-brand-primary":"bg-gray-700/50 text-white hover:bg-gray-600"),title:"Soundboard",children:f.jsx(_x,{size:22})}),Se&&f.jsxs("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-3 w-64 bg-gray-900/95 backdrop-blur-md border border-gray-700 rounded-xl shadow-2xl p-4 animate-fade-in-up z-50",children:[f.jsxs("h4",{className:"text-white text-sm font-semibold mb-3 flex items-center justify-between",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx(_x,{className:"text-brand-primary"}),"Soundboard"]}),f.jsxs("span",{className:"text-[10px] text-gray-400",children:[C.length,"/10"]})]}),f.jsxs("div",{className:"flex flex-col gap-1 mb-3 max-h-48 overflow-y-auto custom-scrollbar",children:[C.length===0&&f.jsx("div",{className:"text-center text-gray-500 text-xs py-4 italic",children:"No sounds added yet."}),C.map(Ie=>f.jsxs("div",{className:"relative group flex items-center gap-2",children:[f.jsxs("button",{onClick:()=>{Ge&&j(Ie.id)},className:"flex-1 bg-gray-800 hover:bg-gray-700 text-white text-xs py-2 px-3 rounded-lg transition-colors border border-gray-700 hover:border-brand-primary flex items-center gap-3 active:scale-95",children:[f.jsx("span",{className:"text-sm",children:""}),f.jsx("span",{className:"text-xs font-medium truncate flex-1 text-left",children:Ie.name})]}),f.jsx("button",{onClick:qe=>{qe.stopPropagation(),D(Ie.id)},className:"bg-red-500/10 hover:bg-red-500 text-red-500 hover:text-white rounded-lg p-2 transition-colors opacity-0 group-hover:opacity-100",title:"Remove sound",children:f.jsx(Ka,{size:14})})]},Ie.id))]}),C.length<10&&f.jsxs("button",{onClick:()=>Ce.current?.click(),className:"w-full py-2 border border-dashed border-gray-600 text-gray-400 rounded-lg hover:border-brand-primary hover:text-brand-primary transition-colors flex items-center justify-center gap-2 text-xs",children:[f.jsx(Wu,{size:14})," Add Sound (MP3/WAV)"]}),f.jsx("input",{type:"file",ref:Ce,className:"hidden",accept:"audio/mp3,audio/wav,audio/mpeg",onChange:Re}),!Ge&&f.jsx("div",{className:"absolute inset-0 bg-black/80 flex items-center justify-center rounded-xl p-4 text-center",children:f.jsxs("div",{children:[f.jsx("p",{className:"text-brand-primary font-bold mb-1",children:"Premium Only"}),f.jsx("p",{className:"text-white text-xs",children:"Unlock Soundboard with Premium!"})]})})]})]}),f.jsxs("div",{className:"relative",children:[f.jsx("button",{onClick:()=>Me(!ee),className:Ct("p-3 rounded-xl transition-all hover:scale-110 active:scale-95",ee?"bg-brand-primary/20 text-brand-primary":"bg-gray-700/50 text-white hover:bg-gray-600"),title:"Audio/Video Settings",children:f.jsx(Rf,{size:22})}),ee&&f.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-3 p-4 bg-gray-900/95 backdrop-blur-md rounded-xl border border-gray-700 shadow-xl w-64",children:f.jsxs("div",{className:"space-y-4",children:[f.jsx("h4",{className:"text-sm font-semibold text-white mb-3",children:"Device Settings"}),f.jsxs("div",{children:[f.jsx("label",{className:"text-xs text-gray-400 block mb-1",children:"Microphone"}),f.jsx("select",{value:E,onChange:Ie=>M(Ie.target.value),className:"w-full bg-gray-800 text-white text-sm rounded-lg px-3 py-2 border border-gray-700 focus:border-brand-primary outline-none cursor-pointer",children:R.audioInputs.map(Ie=>f.jsx("option",{value:Ie.deviceId,children:Ie.label||`Microphone ${Ie.deviceId.slice(0,8)}...`},Ie.deviceId))})]}),f.jsxs("div",{children:[f.jsx("label",{className:"text-xs text-gray-400 block mb-1",children:"Camera"}),f.jsx("select",{value:A,onChange:Ie=>F(Ie.target.value),className:"w-full bg-gray-800 text-white text-sm rounded-lg px-3 py-2 border border-gray-700 focus:border-brand-primary outline-none cursor-pointer",children:R.videoInputs.map(Ie=>f.jsx("option",{value:Ie.deviceId,children:Ie.label||`Camera ${Ie.deviceId.slice(0,8)}...`},Ie.deviceId))})]}),f.jsx("p",{className:"text-[10px] text-gray-500 mt-2",children:"Changes apply on next call"})]})})]}),f.jsx("div",{className:"w-px h-8 bg-gray-700 mx-2"}),f.jsx("button",{onClick:()=>i(!0),className:"p-3 rounded-xl bg-red-600 text-white hover:bg-red-700 transition-all hover:scale-110 active:scale-95 shadow-lg shadow-red-900/20",title:"End Call",children:f.jsx(ff,{size:24})})]}),L&&f.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-2 flex justify-center gap-2 bg-gradient-to-t from-black/90 to-transparent opacity-0 group-hover:opacity-100 transition-opacity z-50",children:[f.jsx("button",{onMouseDown:Ie=>Ie.stopPropagation(),onClick:l,className:Ct("p-1.5 rounded-full text-white hover:bg-white/20",h&&"bg-red-500/50 text-red-100"),title:"Mute",children:h?f.jsx(Af,{size:16}):f.jsx(_l,{size:16})}),f.jsx("button",{onMouseDown:Ie=>Ie.stopPropagation(),onClick:d,className:Ct("p-1.5 rounded-full text-white hover:bg-white/20",m&&"bg-red-500/50 text-red-100"),title:"Camera",children:m?f.jsx(bx,{size:16}):f.jsx(Nf,{size:16})}),f.jsx("button",{onMouseDown:Ie=>Ie.stopPropagation(),onClick:()=>ve(le===0?100:0),className:Ct("p-1.5 rounded-full text-white hover:bg-white/20",le===0&&"bg-red-500/50 text-red-100"),title:"Volume Toggle",children:le===0?f.jsx(aR,{size:16}):f.jsx(xx,{size:16})}),f.jsx("button",{onMouseDown:Ie=>Ie.stopPropagation(),onClick:()=>i(!0),className:"p-1.5 rounded-full bg-red-600/80 text-white hover:bg-red-600",title:"End Call",children:f.jsx(ff,{size:16})})]}),ee&&f.jsx(EY,{isOpen:ee,onClose:()=>Me(!1)}),f.jsx(wY,{isOpen:te,onClose:()=>fe(!1),onConfirm:Ie=>_(Ie)})]})})},KY=()=>{const n=T.useRef(null),{localStream:e,isMuted:t,isVideoOff:r}=Xi(),i=T.useRef(null);return T.useEffect(()=>{i.current&&e&&(i.current.srcObject=e)},[e]),f.jsx(qM,{bounds:"parent",nodeRef:n,children:f.jsxs("div",{ref:n,className:"absolute bottom-24 right-4 w-48 h-36 bg-gray-800 rounded-lg overflow-hidden shadow-lg border border-gray-700 cursor-move hover:scale-105 transition-transform z-50",children:[f.jsx("video",{ref:i,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"}),f.jsxs("div",{className:"absolute bottom-2 left-2 flex gap-1",children:[t&&f.jsx("div",{className:"bg-red-500/80 p-1 rounded",children:f.jsx(Af,{size:12,className:"text-white"})}),r&&f.jsx("div",{className:"bg-red-500/80 p-1 rounded",children:f.jsx(bx,{size:12,className:"text-white"})})]})]})})},WY=()=>{const{currentUser:n,logout:e,resendVerification:t}=Ar(),[r,i]=T.useState(!1),[s,c]=T.useState(""),l=async()=>{i(!0);try{await t(),c("Verification email sent! Check your inbox.")}catch(h){c("Error sending email: "+h.message)}finally{i(!1)}},d=async()=>{i(!0);try{await n.reload(),n.emailVerified?window.location.reload():c("Email is not verified yet. Please check your inbox.")}catch(h){console.error(h)}finally{i(!1)}};return f.jsx("div",{className:"min-h-screen flex items-center justify-center bg-dark-bg p-4",children:f.jsxs("div",{className:"w-full max-w-md bg-dark-sidebar rounded-lg shadow-2xl p-8 text-center space-y-6",children:[f.jsx("div",{className:"bg-brand-primary/10 w-16 h-16 rounded-full flex items-center justify-center mx-auto text-3xl",children:""}),f.jsx("h1",{className:"text-2xl font-bold text-dark-text",children:"Verify Your Email"}),f.jsxs("p",{className:"text-dark-muted",children:["We've sent a verification email to ",f.jsx("br",{}),f.jsx("span",{className:"font-semibold text-white",children:n?.email})]}),f.jsxs("div",{className:"bg-yellow-500/10 text-yellow-500 p-3 rounded-md text-sm",children:[" Please check your ",f.jsx("b",{children:"Spam/Junk"})," folder if you don't see the email in your inbox."]}),f.jsx("p",{className:"text-sm text-dark-muted",children:"You must verify your email address to access Lumo. To prevent spam, unverified accounts are restricted."}),s&&f.jsx("div",{className:"p-3 bg-brand-primary/20 text-brand-primary rounded-md text-sm",children:s}),f.jsxs("div",{className:"space-y-3 pt-4",children:[f.jsx(ut,{onClick:d,className:"w-full",disabled:r,children:"I've Verified My Email"}),f.jsx(ut,{onClick:l,variant:"secondary",className:"w-full",disabled:r,children:"Resend Verification Email"}),f.jsx("button",{onClick:e,className:"text-sm text-dark-muted hover:text-dark-text underline mt-4",children:"Logout"})]})]})})},YY=({dmId:n,dms:e})=>{const{currentUser:t,userProfile:r}=Ar(),{users:i}=dp(),{startCall:s}=Xi(),[c,l]=T.useState(null),[d,h]=T.useState(null),[m,g]=T.useState([]),b=e.find(E=>E.id===n),_=b?.participants.find(E=>E!==t?.uid);T.useEffect(()=>{(async()=>{if(_)try{const A=await g0(Be(_e,"users",_));A.exists()&&l({id:A.id,...A.data()})}catch(A){console.error("Error fetching DM user:",A)}})()},[_]);const R=T.useMemo(()=>[{id:t.uid,displayName:t.displayName||r?.displayName||"User",photoUrl:t.photoURL||r?.photoUrl,role:r?.role},c].filter(Boolean),[t,r,c]);return b?f.jsxs("div",{className:"flex-1 flex flex-col h-full bg-dark-bg",children:[f.jsxs("div",{className:"h-12 px-4 flex items-center justify-between border-b border-dark-hover shadow-sm bg-dark-bg",children:[f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx("div",{className:"relative",children:c?.photoUrl?f.jsx("img",{src:c.photoUrl,alt:c.displayName,className:"w-8 h-8 rounded-full object-cover"}):f.jsx("div",{className:"w-8 h-8 rounded-full bg-brand-primary flex items-center justify-center text-white text-sm font-bold",children:c?.displayName?.[0]?.toUpperCase()||"?"})}),f.jsx("span",{className:"font-semibold text-dark-text",children:c?.displayName||"Loading..."})]}),f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx("button",{onClick:()=>s(c,"voice"),className:"text-dark-muted hover:text-dark-text transition-colors p-1 rounded hover:bg-dark-hover",title:"Start Voice Call",disabled:!c,children:f.jsx(SB,{size:22})}),f.jsx("button",{onClick:()=>s(c,"video"),className:"text-dark-muted hover:text-dark-text transition-colors p-1 rounded hover:bg-dark-hover",title:"Start Video Call",disabled:!c,children:f.jsx(Nf,{size:22})}),f.jsx("div",{className:"w-px h-6 bg-dark-hover mx-1"}),f.jsx(zM,{messages:m,users:R,onResultClick:E=>document.getElementById(`message-${E.id}`)?.scrollIntoView({behavior:"smooth",block:"center"})})]})]}),f.jsx(u3,{serverId:null,channelId:n,users:R,currentUserId:t?.uid,userRole:r?.role,onReply:h,onMessagesChange:g}),f.jsx(VM,{serverId:null,channelId:n,channel:{id:n,name:c?.displayName},userId:t?.uid,userProfile:r,userRole:r?.role,users:R,replyingTo:d,onCancelReply:()=>h(null)})]}):f.jsx("div",{className:"flex-1 flex items-center justify-center text-dark-muted",children:"Select a conversation"})},QY="lumo",XY="1.6.5",JY="module",ZY="electron/main.cjs",eQ={dev:"vite",build:"vite build",lint:"eslint .",preview:"vite preview",predeploy:"npm run build",deploy:"gh-pages -d dist","electron:dev":'concurrently -k "npm run dev" "wait-on tcp:5173 && electron ."',"electron:build":"vite build && electron-builder","build:electron":"npm run electron:build"},tQ={"@capacitor/android":"^8.0.0","@capacitor/cli":"^8.0.0","@capacitor/core":"^8.0.0","@capacitor/push-notifications":"^8.0.0","@giphy/js-fetch-api":"^5.7.0","@giphy/react-components":"^10.1.0","@livekit/components-react":"^2.9.17","@livekit/components-styles":"^1.2.0",clsx:"^2.1.1","date-fns":"^4.1.0",dotenv:"^17.2.3","electron-log":"^5.4.3","electron-updater":"^6.6.2","emoji-picker-react":"^4.16.1",firebase:"^12.6.0","livekit-client":"^2.16.1","livekit-server-sdk":"^2.15.0",peerjs:"^1.5.5",react:"^19.2.3","react-color":"^2.19.3","react-dom":"^19.2.3","react-draggable":"^4.5.0","react-icons":"^5.5.0","react-router-dom":"^7.10.0","simple-peer":"^9.11.1","tailwind-merge":"^3.4.0"},nQ="Lumo - Modern Chat Application",rQ="Hasan",iQ={appId:"com.hasan.lumo",productName:"Lumo",files:["dist/**/*","electron/**/*","public/**/*"],directories:{output:"dist"},extraResources:[".env"],win:{target:"nsis",icon:"public/lumo-logo.png",artifactName:"LumoSetup_win-${version}.${ext}"},mac:{target:"dmg",icon:"public/lumo-logo.png",category:"public.app-category.social-networking",extendInfo:{NSCameraUsageDescription:"Lumo needs access to your camera for video calls.",NSMicrophoneUsageDescription:"Lumo needs access to your microphone for voice and video calls.",NSScreenCaptureUsageDescription:"Lumo needs access to share your screen."},artifactName:"LumoSetup_mac-${version}.${ext}"},linux:{target:"AppImage",icon:"public/lumo-logo.png",category:"Network",artifactName:"LumoSetup_linux-${version}.${ext}"},publish:[{provider:"github",owner:"opsdazlakss",repo:"lumobuild"}]},sQ={type:"git",url:"https://github.com/opsdazlakss/lumobuild.git"},aQ={"@eslint/js":"^9.39.1","@types/react":"^19.2.5","@types/react-dom":"^19.2.3","@vitejs/plugin-react":"^5.1.1",autoprefixer:"^10.4.22",concurrently:"^9.2.1",electron:"^39.2.6","electron-builder":"^26.0.12",eslint:"^9.39.1","eslint-plugin-react-hooks":"^7.0.1","eslint-plugin-react-refresh":"^0.4.24","gh-pages":"^6.3.0",globals:"^16.5.0",postcss:"^8.5.6",tailwindcss:"^3.4.18",vite:"^7.2.4","wait-on":"^9.0.3"},T1={name:QY,private:!0,version:XY,type:JY,main:ZY,scripts:eQ,dependencies:tQ,description:nQ,author:rQ,build:iQ,repository:sQ,devDependencies:aQ},oQ=({isOpen:n,onClose:e,version:t,downloadUrl:r,forceUpdate:i})=>f.jsx(ea,{isOpen:n,onClose:i?()=>{}:e,title:"Update Available",size:"sm",children:f.jsxs("div",{className:"flex flex-col items-center text-center space-y-4",children:[f.jsx("div",{className:"w-16 h-16 bg-brand-primary/20 rounded-full flex items-center justify-center animate-bounce",children:f.jsx(GB,{size:32,className:"text-brand-primary"})}),f.jsxs("div",{children:[f.jsxs("h3",{className:"text-lg font-semibold text-white",children:["New Version ",t," Available!"]}),f.jsx("p",{className:"text-dark-muted text-sm mt-2",children:"A new version of Lumo is available. Please update to get the latest features and fixes."})]}),f.jsxs("div",{className:"w-full space-y-2 pt-2",children:[f.jsxs(ut,{variant:"primary",className:"w-full flex items-center justify-center gap-2",onClick:()=>{window.open(r,"_system")},children:[f.jsx(GP,{size:20}),"Download Update"]}),!i&&f.jsx(ut,{variant:"secondary",className:"w-full",onClick:e,children:"Update Later"})]})]})}),cQ=()=>{const{currentUser:n,userProfile:e,logout:t}=Ar(),{users:r,channels:i,server:s,servers:c,currentServer:l,setCurrentServer:d,unreadMentions:h,dms:m}=dp();Vq(n?.uid);const[g,b]=T.useState(null),[_,R]=T.useState(null),[E,A]=T.useState(!1),[M,F]=T.useState(!1),[j,C]=T.useState(!1),[N,D]=T.useState(!1),[S,k]=T.useState(!1),P=K$({onSwipeLeft:()=>{if(N){D(!1);return}l!=="home"&&k(!0)},onSwipeRight:()=>{if(S){k(!1);return}D(!0)}}),[L,U]=T.useState(!1),[z,V]=T.useState(!1),[le,ve]=T.useState(null),[K,oe]=T.useState([]),[ee,Me]=T.useState(!1),[je,q]=T.useState(null),[te,fe]=T.useState("idle");T.useEffect(()=>{if(!Tl.isNativePlatform())return;(async()=>{fe("checking");const we=Date.now();try{const Ge=Be(_e,"system","app_version"),Ke=await g0(Ge);let Ce=!1,Re=null;if(Ke.exists()){const de=Ke.data(),Ie=T1.version,qe=de.android;if(qe&&qe!==Ie){const ot=Ie.split(".").map(Number),$e=qe.split(".").map(Number);for(let Q=0;Q<Math.max(ot.length,$e.length);Q++){const Pe=ot[Q]||0,Fe=$e[Q]||0;if(Fe>Pe){Ce=!0;break}else if(Fe<Pe)break}Ce&&(Re={version:qe,downloadUrl:de.downloadUrl,forceUpdate:de.forceUpdate||!1})}}const He=Date.now()-we;He<1500&&await new Promise(de=>setTimeout(de,1500-He)),Ce?(q(Re),fe("available"),Me(!0)):(fe("uptodate"),setTimeout(()=>{fe("idle")},1500))}catch(Ge){console.error("Failed to check for updates:",Ge),fe("idle")}})()},[]),T.useEffect(()=>{!n||!l||!h||h[l]?.count>0&&at(Be(_e,"users",n.uid),{[`unreadMentions.${l}`]:SF()}).catch(Te=>{console.error("Error clearing unread mentions:",Te)})},[l,n,h]),T.useEffect(()=>{const Te=()=>{window.innerWidth<768&&!g&&!_&&D(!0)};return window.innerWidth<768&&D(!0),window.addEventListener("resize",Te),()=>window.removeEventListener("resize",Te)},[g,_]),T.useEffect(()=>{i.length>0?b(i[0]):b(null)},[l,i]);const Se=async Te=>{if(d(Te),n)try{await at(Be(_e,"users",n.uid),{currentServer:Te})}catch(we){console.error("Failed to persist server selection:",we)}},Oe=async Te=>{if(!n||!Te)return;const we=m.find(Ge=>Ge.participants.includes(Te.id)&&Ge.participants.includes(n.uid));if(we)R(we),Se("home");else try{const Ge=await Ln(St(_e,"dms"),{participants:[n.uid,Te.id],createdAt:bt(),updatedAt:bt(),lastMessage:null});Se("home")}catch(Ge){console.error("Error creating DM:",Ge)}};return n&&!n.emailVerified?f.jsx(WY,{}):f.jsxs("div",{className:"flex h-screen bg-dark-bg overflow-hidden",...P,children:[f.jsxs("div",{className:"hidden md:flex h-full",children:[f.jsx(IR,{servers:c,currentServerId:l,onServerChange:Se,onCreateServer:()=>U(!0),onJoinServer:()=>V(!0),userRole:e?.role,userId:n?.uid,unreadMentions:h}),f.jsx(NR,{server:s,channels:i,selectedChannel:g,onSelectChannel:b,onOpenSettings:()=>A(!0),onOpenAdmin:()=>F(!0),onLogout:t,userProfile:e,serverId:l,userRole:e?.role,userId:n?.uid,dms:m,selectedDm:_,onSelectDm:R})]}),N&&f.jsxs("div",{className:"fixed inset-0 z-50 flex md:hidden",children:[f.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:()=>D(!1)}),f.jsxs("div",{className:"relative flex h-full animate-slide-in-left",children:[f.jsx(IR,{servers:c,currentServerId:l,onServerChange:Te=>{Se(Te)},onCreateServer:()=>U(!0),onJoinServer:()=>V(!0),userRole:e?.role,userId:n?.uid,unreadMentions:h}),f.jsx(NR,{server:s,channels:i,selectedChannel:g,onSelectChannel:Te=>{b(Te),D(!1)},onOpenSettings:()=>{A(!0),D(!1)},onOpenAdmin:()=>{F(!0),D(!1)},onLogout:t,userProfile:e,serverId:l,userRole:e?.role,userId:n?.uid,dms:m,selectedDm:_,onSelectDm:Te=>{R(Te),D(!1)}}),f.jsx("button",{onClick:()=>D(!1),className:"absolute top-2 right-2 p-2 bg-dark-bg/50 rounded-full text-white md:hidden",style:{right:"-3rem"},children:f.jsx(mr,{size:24})})]})]}),f.jsx("div",{className:"flex-1 flex flex-col",children:l==="home"?_?f.jsx(YY,{dmId:_.id,dms:m}):f.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-dark-muted relative",children:[f.jsx("button",{onClick:()=>D(!0),className:"absolute top-4 left-4 md:hidden p-2 text-dark-muted hover:text-dark-text",children:f.jsx(cR,{size:32})}),f.jsxs("div",{className:"text-center",children:[f.jsx("p",{className:"mb-2 text-lg",children:" Welcome!"}),f.jsx("p",{children:"Select a conversation to start chatting"})]})]}):f.jsxs(f.Fragment,{children:[f.jsxs("div",{className:"h-12 px-4 flex items-center justify-between border-b border-dark-hover shadow-sm bg-dark-bg",children:[f.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[f.jsx("button",{onClick:()=>D(!0),className:"md:hidden p-1 mr-1 text-dark-muted hover:text-dark-text",children:f.jsx(cR,{size:24})}),f.jsx(y0,{className:"text-dark-muted flex-shrink-0"}),f.jsxs("h2",{className:"font-semibold text-dark-text flex items-center min-w-0",children:[f.jsx("span",{className:"truncate",children:g?.name||"Select a channel"}),g?.description&&f.jsx("span",{className:"hidden md:block ml-4 text-sm text-dark-muted font-normal border-l border-dark-muted/30 pl-4 truncate max-w-md",children:g.description})]})]}),f.jsx("div",{className:"flex items-center gap-3",children:g&&f.jsxs(f.Fragment,{children:[K.filter(Te=>Te.pinned).length>0&&f.jsxs("button",{onClick:()=>C(!j),className:`hidden sm:flex items-center gap-2 px-3 py-1.5 rounded transition-colors ${j?"bg-brand-primary text-white":"bg-dark-hover text-dark-text hover:bg-dark-input"}`,children:[f.jsx(Yu,{size:16}),f.jsxs("span",{className:"text-sm font-medium",children:[K.filter(Te=>Te.pinned).length," Pinned"]})]}),f.jsx("div",{className:"hidden sm:block",children:f.jsx(zM,{messages:K,users:r,onResultClick:Te=>console.log("Scroll to:",Te)})}),l!=="home"&&f.jsx("button",{onClick:()=>k(!0),className:"lg:hidden p-2 text-dark-muted hover:text-dark-text",children:f.jsx(DS,{size:24})})]})})]}),g?f.jsxs(f.Fragment,{children:[f.jsx(u3,{serverId:l,channelId:g.id,users:r,currentUserId:n?.uid,userRole:e?.role,onReply:ve,onMessagesChange:oe}),f.jsx(VM,{serverId:l,channelId:g.id,channel:g,userId:n?.uid,userProfile:e,userRole:e?.role,users:r,replyingTo:le,onCancelReply:()=>ve(null)})]}):f.jsx("div",{className:"flex-1 flex items-center justify-center text-dark-muted",children:"Select a channel to start chatting"})]})}),f.jsx("div",{className:"hidden lg:block h-full",children:l!=="home"&&f.jsx(PR,{users:r,currentUserId:n?.uid,onStartDm:Oe})}),S&&l!=="home"&&f.jsxs("div",{className:"fixed inset-0 z-50 flex justify-end lg:hidden",children:[f.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:()=>k(!1)}),f.jsxs("div",{className:"relative h-full bg-dark-sidebar shadow-xl w-64 animate-slide-in-right",children:[f.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-dark-hover",children:[f.jsx("h3",{className:"font-semibold text-dark-text",children:"Members"}),f.jsx("button",{onClick:()=>k(!1),children:f.jsx(mr,{size:24,className:"text-dark-muted"})})]}),f.jsx("div",{className:"h-[calc(100%-60px)]",children:f.jsx(PR,{users:r,currentUserId:n?.uid,onStartDm:Te=>{Oe(Te),k(!1)}})})]})]}),j&&g&&f.jsx(pY,{messages:K,users:r,onClose:()=>C(!1),onJumpToMessage:Te=>{const we=document.getElementById(`message-${Te}`);we&&(we.scrollIntoView({behavior:"smooth",block:"center"}),we.classList.add("bg-brand-primary/10"),setTimeout(()=>{we.classList.remove("bg-brand-primary/10")},2e3)),C(!1)}}),f.jsx(GY,{}),f.jsx(xY,{isOpen:E,onClose:()=>A(!1),onOpenAdmin:()=>F(!0)}),f.jsx(TY,{isOpen:M,onClose:()=>F(!1)}),f.jsx(kY,{isOpen:L,onClose:()=>U(!1),userId:n?.uid,onSuccess:Te=>d(Te)}),f.jsx(CY,{isOpen:z,onClose:()=>V(!1),userId:n?.uid,onSuccess:Te=>d(Te)}),ee&&f.jsx(oQ,{isOpen:ee,onClose:()=>!je?.forceUpdate&&Me(!1),version:je?.version,downloadUrl:je?.downloadUrl,forceUpdate:je?.forceUpdate}),["checking","uptodate"].includes(te)&&f.jsxs("div",{className:"fixed inset-0 z-[60] bg-dark-bg flex flex-col items-center justify-center text-white transition-opacity duration-300",children:[te==="checking"&&f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-brand-primary mb-6"}),f.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Checking for updates..."}),f.jsxs("p",{className:"text-dark-muted font-mono text-sm",children:["v",T1.version]})]}),te==="uptodate"&&f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"rounded-full bg-green-500/20 p-4 mb-6",children:f.jsx(GP,{size:48,className:"text-green-500"})}),f.jsx("h2",{className:"text-xl font-semibold mb-2 text-green-400",children:"You are up to date!"}),f.jsxs("p",{className:"text-dark-muted font-mono text-sm",children:["v",T1.version]})]})]})]})},qo=I0("PushNotifications",{}),lQ={initialize:async n=>{if(!Tl.isNativePlatform()){console.log("Push notifications not supported on web/PWA");return}let e=await qo.checkPermissions();if(e.receive==="prompt"&&(e=await qo.requestPermissions()),e.receive!=="granted"){console.error("User denied permissions!");return}await qo.register(),qo.addListener("registration",async t=>{if(console.log("Push Registration Token:",t.value),n)try{const r=Be(_e,"users",n);await at(r,{fcmTokens:up(t.value)}),console.log("FCM token saved to Firestore")}catch(r){console.error("Error saving FCM token to Firestore:",r)}}),qo.addListener("registrationError",t=>{console.error("Error on registration:",t)}),qo.addListener("pushNotificationReceived",t=>{console.log("Push notification received: ",t)}),qo.addListener("pushNotificationActionPerformed",t=>{console.log("Push notification action performed",t.actionId,t.inputValue)})},cleanup:async()=>{Tl.isNativePlatform()&&await qo.removeAllListeners()}};class uQ extends be.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("ErrorBoundary caught an error:",e,t),this.setState({errorInfo:t})}render(){return this.state.hasError?f.jsxs("div",{className:"min-h-screen bg-gray-900 text-white p-8 flex flex-col items-center justify-center text-center",children:[f.jsx("h1",{className:"text-2xl font-bold text-red-500 mb-4",children:"Something went wrong"}),f.jsxs("div",{className:"bg-gray-800 p-4 rounded overflow-auto max-w-full text-left font-mono text-xs",children:[f.jsx("p",{className:"font-bold text-yellow-400 mb-2",children:this.state.error&&this.state.error.toString()}),f.jsx("pre",{className:"text-gray-400 whitespace-pre-wrap",children:this.state.errorInfo&&this.state.errorInfo.componentStack})]}),f.jsx("button",{className:"mt-6 px-4 py-2 bg-blue-600 rounded hover:bg-blue-700",onClick:()=>window.location.reload(),children:"Reload App"})]}):this.props.children}}var B4={};function dQ(n,e){return e.forEach(function(t){t&&typeof t!="string"&&!Array.isArray(t)&&Object.keys(t).forEach(function(r){if(r!=="default"&&!(r in n)){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}})}),Object.freeze(n)}var hQ=Object.defineProperty,fQ=(n,e,t)=>e in n?hQ(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,$4=(n,e,t)=>fQ(n,typeof e!="symbol"?e+"":e,t);class Hr{constructor(){$4(this,"_locking"),$4(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let e;const t=new Promise(i=>e=()=>{this._locks-=1,i()}),r=this._locking.then(()=>e);return this._locking=this._locking.then(()=>t),r}}function Rn(n,e){if(!n)throw new Error(e)}const pQ=34028234663852886e22,mQ=-34028234663852886e22,gQ=4294967295,vQ=2147483647,yQ=-2147483648;function Ig(n){if(typeof n!="number")throw new Error("invalid int 32: "+typeof n);if(!Number.isInteger(n)||n>vQ||n<yQ)throw new Error("invalid int 32: "+n)}function Kx(n){if(typeof n!="number")throw new Error("invalid uint 32: "+typeof n);if(!Number.isInteger(n)||n>gQ||n<0)throw new Error("invalid uint 32: "+n)}function HM(n){if(typeof n!="number")throw new Error("invalid float 32: "+typeof n);if(Number.isFinite(n)&&(n>pQ||n<mQ))throw new Error("invalid float 32: "+n)}const GM=Symbol("@bufbuild/protobuf/enum-type");function bQ(n){const e=n[GM];return Rn(e,"missing enum type on enum object"),e}function KM(n,e,t,r){n[GM]=WM(e,t.map(i=>({no:i.no,name:i.name,localName:n[i.no]})))}function WM(n,e,t){const r=Object.create(null),i=Object.create(null),s=[];for(const c of e){const l=YM(c);s.push(l),r[c.name]=l,i[c.no]=l}return{typeName:n,values:s,findName(c){return r[c]},findNumber(c){return i[c]}}}function xQ(n,e,t){const r={};for(const i of e){const s=YM(i);r[s.localName]=s.no,r[s.no]=s.localName}return KM(r,n,e),r}function YM(n){return"localName"in n?n:Object.assign(Object.assign({},n),{localName:n.name})}class dT{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,t){const r=this.getType(),i=r.runtime.bin,s=i.makeReadOptions(t);return i.readMessage(this,s.readerFactory(e),e.byteLength,s),this}fromJson(e,t){const r=this.getType(),i=r.runtime.json,s=i.makeReadOptions(t);return i.readMessage(r,e,s,this),this}fromJsonString(e,t){let r;try{r=JSON.parse(e)}catch(i){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(i instanceof Error?i.message:String(i)))}return this.fromJson(r,t)}toBinary(e){const t=this.getType(),r=t.runtime.bin,i=r.makeWriteOptions(e),s=i.writerFactory();return r.writeMessage(this,s,i),s.finish()}toJson(e){const t=this.getType(),r=t.runtime.json,i=r.makeWriteOptions(e);return r.writeMessage(this,i)}toJsonString(e){var t;const r=this.toJson(e);return JSON.stringify(r,null,(t=e?.prettySpaces)!==null&&t!==void 0?t:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function _Q(n,e,t,r){var i;const s=(i=r?.localName)!==null&&i!==void 0?i:e.substring(e.lastIndexOf(".")+1),c={[s]:function(l){n.util.initFields(this),n.util.initPartial(l,this)}}[s];return Object.setPrototypeOf(c.prototype,new dT),Object.assign(c,{runtime:n,typeName:e,fields:n.util.newFieldList(t),fromBinary(l,d){return new c().fromBinary(l,d)},fromJson(l,d){return new c().fromJson(l,d)},fromJsonString(l,d){return new c().fromJsonString(l,d)},equals(l,d){return n.util.equals(c,l,d)}}),c}function SQ(){let n=0,e=0;for(let r=0;r<28;r+=7){let i=this.buf[this.pos++];if(n|=(i&127)<<r,(i&128)==0)return this.assertBounds(),[n,e]}let t=this.buf[this.pos++];if(n|=(t&15)<<28,e=(t&112)>>4,(t&128)==0)return this.assertBounds(),[n,e];for(let r=3;r<=31;r+=7){let i=this.buf[this.pos++];if(e|=(i&127)<<r,(i&128)==0)return this.assertBounds(),[n,e]}throw new Error("invalid varint")}function k1(n,e,t){for(let s=0;s<28;s=s+7){const c=n>>>s,l=!(!(c>>>7)&&e==0),d=(l?c|128:c)&255;if(t.push(d),!l)return}const r=n>>>28&15|(e&7)<<4,i=e>>3!=0;if(t.push((i?r|128:r)&255),!!i){for(let s=3;s<31;s=s+7){const c=e>>>s,l=!!(c>>>7),d=(l?c|128:c)&255;if(t.push(d),!l)return}t.push(e>>>31&1)}}const Pg=4294967296;function q4(n){const e=n[0]==="-";e&&(n=n.slice(1));const t=1e6;let r=0,i=0;function s(c,l){const d=Number(n.slice(c,l));i*=t,r=r*t+d,r>=Pg&&(i=i+(r/Pg|0),r=r%Pg)}return s(-24,-18),s(-18,-12),s(-12,-6),s(-6),e?XM(r,i):hT(r,i)}function TQ(n,e){let t=hT(n,e);const r=t.hi&2147483648;r&&(t=XM(t.lo,t.hi));const i=QM(t.lo,t.hi);return r?"-"+i:i}function QM(n,e){if({lo:n,hi:e}=kQ(n,e),e<=2097151)return String(Pg*e+n);const t=n&16777215,r=(n>>>24|e<<8)&16777215,i=e>>16&65535;let s=t+r*6777216+i*6710656,c=r+i*8147497,l=i*2;const d=1e7;return s>=d&&(c+=Math.floor(s/d),s%=d),c>=d&&(l+=Math.floor(c/d),c%=d),l.toString()+H4(c)+H4(s)}function kQ(n,e){return{lo:n>>>0,hi:e>>>0}}function hT(n,e){return{lo:n|0,hi:e|0}}function XM(n,e){return e=~e,n?n=~n+1:e+=1,hT(n,e)}const H4=n=>{const e=String(n);return"0000000".slice(e.length)+e};function G4(n,e){if(n>=0){for(;n>127;)e.push(n&127|128),n=n>>>7;e.push(n)}else{for(let t=0;t<9;t++)e.push(n&127|128),n=n>>7;e.push(1)}}function CQ(){let n=this.buf[this.pos++],e=n&127;if((n&128)==0)return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<7,(n&128)==0)return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<14,(n&128)==0)return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<21,(n&128)==0)return this.assertBounds(),e;n=this.buf[this.pos++],e|=(n&15)<<28;for(let t=5;(n&128)!==0&&t<10;t++)n=this.buf[this.pos++];if((n&128)!=0)throw new Error("invalid varint");return this.assertBounds(),e>>>0}function wQ(){const n=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof n.getBigInt64=="function"&&typeof n.getBigUint64=="function"&&typeof n.setBigInt64=="function"&&typeof n.setBigUint64=="function"&&(typeof process!="object"||typeof B4!="object"||B4.BUF_BIGINT_DISABLE!=="1")){const i=BigInt("-9223372036854775808"),s=BigInt("9223372036854775807"),c=BigInt("0"),l=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(d){const h=typeof d=="bigint"?d:BigInt(d);if(h>s||h<i)throw new Error("int64 invalid: ".concat(d));return h},uParse(d){const h=typeof d=="bigint"?d:BigInt(d);if(h>l||h<c)throw new Error("uint64 invalid: ".concat(d));return h},enc(d){return n.setBigInt64(0,this.parse(d),!0),{lo:n.getInt32(0,!0),hi:n.getInt32(4,!0)}},uEnc(d){return n.setBigInt64(0,this.uParse(d),!0),{lo:n.getInt32(0,!0),hi:n.getInt32(4,!0)}},dec(d,h){return n.setInt32(0,d,!0),n.setInt32(4,h,!0),n.getBigInt64(0,!0)},uDec(d,h){return n.setInt32(0,d,!0),n.setInt32(4,h,!0),n.getBigUint64(0,!0)}}}const t=i=>Rn(/^-?[0-9]+$/.test(i),"int64 invalid: ".concat(i)),r=i=>Rn(/^[0-9]+$/.test(i),"uint64 invalid: ".concat(i));return{zero:"0",supported:!1,parse(i){return typeof i!="string"&&(i=i.toString()),t(i),i},uParse(i){return typeof i!="string"&&(i=i.toString()),r(i),i},enc(i){return typeof i!="string"&&(i=i.toString()),t(i),q4(i)},uEnc(i){return typeof i!="string"&&(i=i.toString()),r(i),q4(i)},dec(i,s){return TQ(i,s)},uDec(i,s){return QM(i,s)}}}const xn=wQ();var Ae;(function(n){n[n.DOUBLE=1]="DOUBLE",n[n.FLOAT=2]="FLOAT",n[n.INT64=3]="INT64",n[n.UINT64=4]="UINT64",n[n.INT32=5]="INT32",n[n.FIXED64=6]="FIXED64",n[n.FIXED32=7]="FIXED32",n[n.BOOL=8]="BOOL",n[n.STRING=9]="STRING",n[n.BYTES=12]="BYTES",n[n.UINT32=13]="UINT32",n[n.SFIXED32=15]="SFIXED32",n[n.SFIXED64=16]="SFIXED64",n[n.SINT32=17]="SINT32",n[n.SINT64=18]="SINT64"})(Ae||(Ae={}));var xc;(function(n){n[n.BIGINT=0]="BIGINT",n[n.STRING=1]="STRING"})(xc||(xc={}));function Ho(n,e,t){if(e===t)return!0;if(n==Ae.BYTES){if(!(e instanceof Uint8Array)||!(t instanceof Uint8Array)||e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}switch(n){case Ae.UINT64:case Ae.FIXED64:case Ae.INT64:case Ae.SFIXED64:case Ae.SINT64:return e==t}return!1}function kd(n,e){switch(n){case Ae.BOOL:return!1;case Ae.UINT64:case Ae.FIXED64:case Ae.INT64:case Ae.SFIXED64:case Ae.SINT64:return e==0?xn.zero:"0";case Ae.DOUBLE:case Ae.FLOAT:return 0;case Ae.BYTES:return new Uint8Array(0);case Ae.STRING:return"";default:return 0}}function JM(n,e){switch(n){case Ae.BOOL:return e===!1;case Ae.STRING:return e==="";case Ae.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}var zn;(function(n){n[n.Varint=0]="Varint",n[n.Bit64=1]="Bit64",n[n.LengthDelimited=2]="LengthDelimited",n[n.StartGroup=3]="StartGroup",n[n.EndGroup=4]="EndGroup",n[n.Bit32=5]="Bit32"})(zn||(zn={}));class EQ{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let i=0;i<this.chunks.length;i++)e+=this.chunks[i].length;let t=new Uint8Array(e),r=0;for(let i=0;i<this.chunks.length;i++)t.set(this.chunks[i],r),r+=this.chunks[i].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(Kx(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return Ig(e),G4(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.textEncoder.encode(e);return this.uint32(t.byteLength),this.raw(t)}float(e){HM(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){Kx(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){Ig(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return Ig(e),e=(e<<1^e>>31)>>>0,G4(e,this.buf),this}sfixed64(e){let t=new Uint8Array(8),r=new DataView(t.buffer),i=xn.enc(e);return r.setInt32(0,i.lo,!0),r.setInt32(4,i.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),r=new DataView(t.buffer),i=xn.uEnc(e);return r.setInt32(0,i.lo,!0),r.setInt32(4,i.hi,!0),this.raw(t)}int64(e){let t=xn.enc(e);return k1(t.lo,t.hi,this.buf),this}sint64(e){let t=xn.enc(e),r=t.hi>>31,i=t.lo<<1^r,s=(t.hi<<1|t.lo>>>31)^r;return k1(i,s,this.buf),this}uint64(e){let t=xn.uEnc(e);return k1(t.lo,t.hi,this.buf),this}}class RQ{constructor(e,t){this.varint64=SQ,this.uint32=CQ,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=t??new TextDecoder}tag(){let e=this.uint32(),t=e>>>3,r=e&7;if(t<=0||r<0||r>5)throw new Error("illegal tag: field no "+t+" wire type "+r);return[t,r]}skip(e,t){let r=this.pos;switch(e){case zn.Varint:for(;this.buf[this.pos++]&128;);break;case zn.Bit64:this.pos+=4;case zn.Bit32:this.pos+=4;break;case zn.LengthDelimited:let i=this.uint32();this.pos+=i;break;case zn.StartGroup:for(;;){const[s,c]=this.tag();if(c===zn.EndGroup){if(t!==void 0&&s!==t)throw new Error("invalid end group tag");break}this.skip(c,s)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(r,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return xn.dec(...this.varint64())}uint64(){return xn.uDec(...this.varint64())}sint64(){let[e,t]=this.varint64(),r=-(e&1);return e=(e>>>1|(t&1)<<31)^r,t=t>>>1^r,xn.dec(e,t)}bool(){let[e,t]=this.varint64();return e!==0||t!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return xn.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return xn.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.textDecoder.decode(this.bytes())}}function AQ(n,e,t,r){let i;return{typeName:e,extendee:t,get field(){if(!i){const s=typeof r=="function"?r():r;s.name=e.split(".").pop(),s.jsonName="[".concat(e,"]"),i=n.util.newFieldList([s]).list()[0]}return i},runtime:n}}function ZM(n){const e=n.field.localName,t=Object.create(null);return t[e]=NQ(n),[t,()=>t[e]]}function NQ(n){const e=n.field;if(e.repeated)return[];if(e.default!==void 0)return e.default;switch(e.kind){case"enum":return e.T.values[0].no;case"scalar":return kd(e.T,e.L);case"message":const t=e.T,r=new t;return t.fieldWrapper?t.fieldWrapper.unwrapField(r):r;case"map":throw"map fields are not allowed to be extensions"}}function IQ(n,e){if(!e.repeated&&(e.kind=="enum"||e.kind=="scalar")){for(let t=n.length-1;t>=0;--t)if(n[t].no==e.no)return[n[t]];return[]}return n.filter(t=>t.no===e.no)}let Ua="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),P0=[];for(let n=0;n<Ua.length;n++)P0[Ua[n].charCodeAt(0)]=n;P0[45]=Ua.indexOf("+");P0[95]=Ua.indexOf("/");const eD={dec(n){let e=n.length*3/4;n[n.length-2]=="="?e-=2:n[n.length-1]=="="&&(e-=1);let t=new Uint8Array(e),r=0,i=0,s,c=0;for(let l=0;l<n.length;l++){if(s=P0[n.charCodeAt(l)],s===void 0)switch(n[l]){case"=":i=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(i){case 0:c=s,i=1;break;case 1:t[r++]=c<<2|(s&48)>>4,c=s,i=2;break;case 2:t[r++]=(c&15)<<4|(s&60)>>2,c=s,i=3;break;case 3:t[r++]=(c&3)<<6|s,i=0;break}}if(i==1)throw Error("invalid base64 string.");return t.subarray(0,r)},enc(n){let e="",t=0,r,i=0;for(let s=0;s<n.length;s++)switch(r=n[s],t){case 0:e+=Ua[r>>2],i=(r&3)<<4,t=1;break;case 1:e+=Ua[i|r>>4],i=(r&15)<<2,t=2;break;case 2:e+=Ua[i|r>>6],e+=Ua[r&63],t=0;break}return t&&(e+=Ua[i],e+="=",t==1&&(e+="=")),e}};function PQ(n,e,t){nD(e,n);const r=e.runtime.bin.makeReadOptions(t),i=IQ(n.getType().runtime.bin.listUnknownFields(n),e.field),[s,c]=ZM(e);for(const l of i)e.runtime.bin.readField(s,r.readerFactory(l.data),e.field,l.wireType,r);return c()}function MQ(n,e,t,r){nD(e,n);const i=e.runtime.bin.makeReadOptions(r),s=e.runtime.bin.makeWriteOptions(r);if(tD(n,e)){const h=n.getType().runtime.bin.listUnknownFields(n).filter(m=>m.no!=e.field.no);n.getType().runtime.bin.discardUnknownFields(n);for(const m of h)n.getType().runtime.bin.onUnknownField(n,m.no,m.wireType,m.data)}const c=s.writerFactory();let l=e.field;!l.opt&&!l.repeated&&(l.kind=="enum"||l.kind=="scalar")&&(l=Object.assign(Object.assign({},e.field),{opt:!0})),e.runtime.bin.writeField(l,t,c,s);const d=i.readerFactory(c.finish());for(;d.pos<d.len;){const[h,m]=d.tag(),g=d.skip(m,h);n.getType().runtime.bin.onUnknownField(n,h,m,g)}}function tD(n,e){const t=n.getType();return e.extendee.typeName===t.typeName&&!!t.runtime.bin.listUnknownFields(n).find(r=>r.no==e.field.no)}function nD(n,e){Rn(n.extendee.typeName==e.getType().typeName,"extension ".concat(n.typeName," can only be applied to message ").concat(n.extendee.typeName))}function rD(n,e){const t=n.localName;if(n.repeated)return e[t].length>0;if(n.oneof)return e[n.oneof.localName].case===t;switch(n.kind){case"enum":case"scalar":return n.opt||n.req?e[t]!==void 0:n.kind=="enum"?e[t]!==n.T.values[0].no:!JM(n.T,e[t]);case"message":return e[t]!==void 0;case"map":return Object.keys(e[t]).length>0}}function K4(n,e){const t=n.localName,r=!n.opt&&!n.req;if(n.repeated)e[t]=[];else if(n.oneof)e[n.oneof.localName]={case:void 0};else switch(n.kind){case"map":e[t]={};break;case"enum":e[t]=r?n.T.values[0].no:void 0;break;case"scalar":e[t]=r?kd(n.T,n.L):void 0;break;case"message":e[t]=void 0;break}}function Va(n,e){if(n===null||typeof n!="object"||!Object.getOwnPropertyNames(dT.prototype).every(r=>r in n&&typeof n[r]=="function"))return!1;const t=n.getType();return t===null||typeof t!="function"||!("typeName"in t)||typeof t.typeName!="string"?!1:e===void 0?!0:t.typeName==e.typeName}function iD(n,e){return Va(e)||!n.fieldWrapper?e:n.fieldWrapper.wrapField(e)}Ae.DOUBLE,Ae.FLOAT,Ae.INT64,Ae.UINT64,Ae.INT32,Ae.UINT32,Ae.BOOL,Ae.STRING,Ae.BYTES;const W4={ignoreUnknownFields:!1},Y4={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function DQ(n){return n?Object.assign(Object.assign({},W4),n):W4}function OQ(n){return n?Object.assign(Object.assign({},Y4),n):Y4}const Av=Symbol(),Mg=Symbol();function jQ(){return{makeReadOptions:DQ,makeWriteOptions:OQ,readMessage(n,e,t,r){if(e==null||Array.isArray(e)||typeof e!="object")throw new Error("cannot decode message ".concat(n.typeName," from JSON: ").concat(Hs(e)));r=r??new n;const i=new Map,s=t.typeRegistry;for(const[c,l]of Object.entries(e)){const d=n.fields.findJsonName(c);if(d){if(d.oneof){if(l===null&&d.kind=="scalar")continue;const h=i.get(d.oneof);if(h!==void 0)throw new Error("cannot decode message ".concat(n.typeName,' from JSON: multiple keys for oneof "').concat(d.oneof.name,'" present: "').concat(h,'", "').concat(c,'"'));i.set(d.oneof,c)}Q4(r,l,d,t,n)}else{let h=!1;if(s?.findExtension&&c.startsWith("[")&&c.endsWith("]")){const m=s.findExtension(c.substring(1,c.length-1));if(m&&m.extendee.typeName==n.typeName){h=!0;const[g,b]=ZM(m);Q4(g,l,m.field,t,m),MQ(r,m,b(),t)}}if(!h&&!t.ignoreUnknownFields)throw new Error("cannot decode message ".concat(n.typeName,' from JSON: key "').concat(c,'" is unknown'))}}return r},writeMessage(n,e){const t=n.getType(),r={};let i;try{for(i of t.fields.byNumber()){if(!rD(i,n)){if(i.req)throw"required field not set";if(!e.emitDefaultValues||!UQ(i))continue}const c=i.oneof?n[i.oneof.localName].value:n[i.localName],l=X4(i,c,e);l!==void 0&&(r[e.useProtoFieldName?i.name:i.jsonName]=l)}const s=e.typeRegistry;if(s?.findExtensionFor)for(const c of t.runtime.bin.listUnknownFields(n)){const l=s.findExtensionFor(t.typeName,c.no);if(l&&tD(n,l)){const d=PQ(n,l,e),h=X4(l.field,d,e);h!==void 0&&(r[l.field.jsonName]=h)}}}catch(s){const c=i?"cannot encode field ".concat(t.typeName,".").concat(i.name," to JSON"):"cannot encode message ".concat(t.typeName," to JSON"),l=s instanceof Error?s.message:String(s);throw new Error(c+(l.length>0?": ".concat(l):""))}return r},readScalar(n,e,t){return mf(n,e,t??xc.BIGINT,!0)},writeScalar(n,e,t){if(e!==void 0&&(t||JM(n,e)))return Dg(n,e)},debug:Hs}}function Hs(n){if(n===null)return"null";switch(typeof n){case"object":return Array.isArray(n)?"array":"object";case"string":return n.length>100?"string":'"'.concat(n.split('"').join('\\"'),'"');default:return String(n)}}function Q4(n,e,t,r,i){let s=t.localName;if(t.repeated){if(Rn(t.kind!="map"),e===null)return;if(!Array.isArray(e))throw new Error("cannot decode field ".concat(i.typeName,".").concat(t.name," from JSON: ").concat(Hs(e)));const c=n[s];for(const l of e){if(l===null)throw new Error("cannot decode field ".concat(i.typeName,".").concat(t.name," from JSON: ").concat(Hs(l)));switch(t.kind){case"message":c.push(t.T.fromJson(l,r));break;case"enum":const d=C1(t.T,l,r.ignoreUnknownFields,!0);d!==Mg&&c.push(d);break;case"scalar":try{c.push(mf(t.T,l,t.L,!0))}catch(h){let m="cannot decode field ".concat(i.typeName,".").concat(t.name," from JSON: ").concat(Hs(l));throw h instanceof Error&&h.message.length>0&&(m+=": ".concat(h.message)),new Error(m)}break}}}else if(t.kind=="map"){if(e===null)return;if(typeof e!="object"||Array.isArray(e))throw new Error("cannot decode field ".concat(i.typeName,".").concat(t.name," from JSON: ").concat(Hs(e)));const c=n[s];for(const[l,d]of Object.entries(e)){if(d===null)throw new Error("cannot decode field ".concat(i.typeName,".").concat(t.name," from JSON: map value null"));let h;try{h=LQ(t.K,l)}catch(m){let g="cannot decode map key for field ".concat(i.typeName,".").concat(t.name," from JSON: ").concat(Hs(e));throw m instanceof Error&&m.message.length>0&&(g+=": ".concat(m.message)),new Error(g)}switch(t.V.kind){case"message":c[h]=t.V.T.fromJson(d,r);break;case"enum":const m=C1(t.V.T,d,r.ignoreUnknownFields,!0);m!==Mg&&(c[h]=m);break;case"scalar":try{c[h]=mf(t.V.T,d,xc.BIGINT,!0)}catch(g){let b="cannot decode map value for field ".concat(i.typeName,".").concat(t.name," from JSON: ").concat(Hs(e));throw g instanceof Error&&g.message.length>0&&(b+=": ".concat(g.message)),new Error(b)}break}}}else switch(t.oneof&&(n=n[t.oneof.localName]={case:s},s="value"),t.kind){case"message":const c=t.T;if(e===null&&c.typeName!="google.protobuf.Value")return;let l=n[s];Va(l)?l.fromJson(e,r):(n[s]=l=c.fromJson(e,r),c.fieldWrapper&&!t.oneof&&(n[s]=c.fieldWrapper.unwrapField(l)));break;case"enum":const d=C1(t.T,e,r.ignoreUnknownFields,!1);switch(d){case Av:K4(t,n);break;case Mg:break;default:n[s]=d;break}break;case"scalar":try{const h=mf(t.T,e,t.L,!1);switch(h){case Av:K4(t,n);break;default:n[s]=h;break}}catch(h){let m="cannot decode field ".concat(i.typeName,".").concat(t.name," from JSON: ").concat(Hs(e));throw h instanceof Error&&h.message.length>0&&(m+=": ".concat(h.message)),new Error(m)}break}}function LQ(n,e){if(n===Ae.BOOL)switch(e){case"true":e=!0;break;case"false":e=!1;break}return mf(n,e,xc.BIGINT,!0).toString()}function mf(n,e,t,r){if(e===null)return r?kd(n,t):Av;switch(n){case Ae.DOUBLE:case Ae.FLOAT:if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const i=Number(e);if(Number.isNaN(i)||!Number.isFinite(i))break;return n==Ae.FLOAT&&HM(i),i;case Ae.INT32:case Ae.FIXED32:case Ae.SFIXED32:case Ae.SINT32:case Ae.UINT32:let s;if(typeof e=="number"?s=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(s=Number(e)),s===void 0)break;return n==Ae.UINT32||n==Ae.FIXED32?Kx(s):Ig(s),s;case Ae.INT64:case Ae.SFIXED64:case Ae.SINT64:if(typeof e!="number"&&typeof e!="string")break;const c=xn.parse(e);return t?c.toString():c;case Ae.FIXED64:case Ae.UINT64:if(typeof e!="number"&&typeof e!="string")break;const l=xn.uParse(e);return t?l.toString():l;case Ae.BOOL:if(typeof e!="boolean")break;return e;case Ae.STRING:if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case Ae.BYTES:if(e==="")return new Uint8Array(0);if(typeof e!="string")break;return eD.dec(e)}throw new Error}function C1(n,e,t,r){if(e===null)return n.typeName=="google.protobuf.NullValue"?0:r?n.values[0].no:Av;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const i=n.findName(e);if(i!==void 0)return i.no;if(t)return Mg;break}throw new Error("cannot decode enum ".concat(n.typeName," from JSON: ").concat(Hs(e)))}function UQ(n){return n.repeated||n.kind=="map"?!0:!(n.oneof||n.kind=="message"||n.opt||n.req)}function X4(n,e,t){if(n.kind=="map"){Rn(typeof e=="object"&&e!=null);const r={},i=Object.entries(e);switch(n.V.kind){case"scalar":for(const[c,l]of i)r[c.toString()]=Dg(n.V.T,l);break;case"message":for(const[c,l]of i)r[c.toString()]=l.toJson(t);break;case"enum":const s=n.V.T;for(const[c,l]of i)r[c.toString()]=w1(s,l,t.enumAsInteger);break}return t.emitDefaultValues||i.length>0?r:void 0}if(n.repeated){Rn(Array.isArray(e));const r=[];switch(n.kind){case"scalar":for(let i=0;i<e.length;i++)r.push(Dg(n.T,e[i]));break;case"enum":for(let i=0;i<e.length;i++)r.push(w1(n.T,e[i],t.enumAsInteger));break;case"message":for(let i=0;i<e.length;i++)r.push(e[i].toJson(t));break}return t.emitDefaultValues||r.length>0?r:void 0}switch(n.kind){case"scalar":return Dg(n.T,e);case"enum":return w1(n.T,e,t.enumAsInteger);case"message":return iD(n.T,e).toJson(t)}}function w1(n,e,t){var r;if(Rn(typeof e=="number"),n.typeName=="google.protobuf.NullValue")return null;if(t)return e;const i=n.findNumber(e);return(r=i?.name)!==null&&r!==void 0?r:e}function Dg(n,e){switch(n){case Ae.INT32:case Ae.SFIXED32:case Ae.SINT32:case Ae.FIXED32:case Ae.UINT32:return Rn(typeof e=="number"),e;case Ae.FLOAT:case Ae.DOUBLE:return Rn(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case Ae.STRING:return Rn(typeof e=="string"),e;case Ae.BOOL:return Rn(typeof e=="boolean"),e;case Ae.UINT64:case Ae.FIXED64:case Ae.INT64:case Ae.SFIXED64:case Ae.SINT64:return Rn(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),e.toString();case Ae.BYTES:return Rn(e instanceof Uint8Array),eD.enc(e)}}const Iu=Symbol("@bufbuild/protobuf/unknown-fields"),J4={readUnknownFields:!0,readerFactory:n=>new RQ(n)},Z4={writeUnknownFields:!0,writerFactory:()=>new EQ};function VQ(n){return n?Object.assign(Object.assign({},J4),n):J4}function zQ(n){return n?Object.assign(Object.assign({},Z4),n):Z4}function FQ(){return{makeReadOptions:VQ,makeWriteOptions:zQ,listUnknownFields(n){var e;return(e=n[Iu])!==null&&e!==void 0?e:[]},discardUnknownFields(n){delete n[Iu]},writeUnknownFields(n,e){const r=n[Iu];if(r)for(const i of r)e.tag(i.no,i.wireType).raw(i.data)},onUnknownField(n,e,t,r){const i=n;Array.isArray(i[Iu])||(i[Iu]=[]),i[Iu].push({no:e,wireType:t,data:r})},readMessage(n,e,t,r,i){const s=n.getType(),c=i?e.len:e.pos+t;let l,d;for(;e.pos<c&&([l,d]=e.tag(),!(i===!0&&d==zn.EndGroup));){const h=s.fields.find(l);if(!h){const m=e.skip(d,l);r.readUnknownFields&&this.onUnknownField(n,l,d,m);continue}eA(n,e,h,d,r)}if(i&&(d!=zn.EndGroup||l!==t))throw new Error("invalid end group tag")},readField:eA,writeMessage(n,e,t){const r=n.getType();for(const i of r.fields.byNumber()){if(!rD(i,n)){if(i.req)throw new Error("cannot encode field ".concat(r.typeName,".").concat(i.name," to binary: required field not set"));continue}const s=i.oneof?n[i.oneof.localName].value:n[i.localName];tA(i,s,e,t)}return t.writeUnknownFields&&this.writeUnknownFields(n,e),e},writeField(n,e,t,r){e!==void 0&&tA(n,e,t,r)}}}function eA(n,e,t,r,i){let{repeated:s,localName:c}=t;switch(t.oneof&&(n=n[t.oneof.localName],n.case!=c&&delete n.value,n.case=c,c="value"),t.kind){case"scalar":case"enum":const l=t.kind=="enum"?Ae.INT32:t.T;let d=Nv;if(t.kind=="scalar"&&t.L>0&&(d=$Q),s){let b=n[c];if(r==zn.LengthDelimited&&l!=Ae.STRING&&l!=Ae.BYTES){let R=e.uint32()+e.pos;for(;e.pos<R;)b.push(d(e,l))}else b.push(d(e,l))}else n[c]=d(e,l);break;case"message":const h=t.T;s?n[c].push(Og(e,new h,i,t)):Va(n[c])?Og(e,n[c],i,t):(n[c]=Og(e,new h,i,t),h.fieldWrapper&&!t.oneof&&!t.repeated&&(n[c]=h.fieldWrapper.unwrapField(n[c])));break;case"map":let[m,g]=BQ(t,e,i);n[c][m]=g;break}}function Og(n,e,t,r){const i=e.getType().runtime.bin,s=r?.delimited;return i.readMessage(e,n,s?r.no:n.uint32(),t,s),e}function BQ(n,e,t){const r=e.uint32(),i=e.pos+r;let s,c;for(;e.pos<i;){const[l]=e.tag();switch(l){case 1:s=Nv(e,n.K);break;case 2:switch(n.V.kind){case"scalar":c=Nv(e,n.V.T);break;case"enum":c=e.int32();break;case"message":c=Og(e,new n.V.T,t,void 0);break}break}}if(s===void 0&&(s=kd(n.K,xc.BIGINT)),typeof s!="string"&&typeof s!="number"&&(s=s.toString()),c===void 0)switch(n.V.kind){case"scalar":c=kd(n.V.T,xc.BIGINT);break;case"enum":c=n.V.T.values[0].no;break;case"message":c=new n.V.T;break}return[s,c]}function $Q(n,e){const t=Nv(n,e);return typeof t=="bigint"?t.toString():t}function Nv(n,e){switch(e){case Ae.STRING:return n.string();case Ae.BOOL:return n.bool();case Ae.DOUBLE:return n.double();case Ae.FLOAT:return n.float();case Ae.INT32:return n.int32();case Ae.INT64:return n.int64();case Ae.UINT64:return n.uint64();case Ae.FIXED64:return n.fixed64();case Ae.BYTES:return n.bytes();case Ae.FIXED32:return n.fixed32();case Ae.SFIXED32:return n.sfixed32();case Ae.SFIXED64:return n.sfixed64();case Ae.SINT64:return n.sint64();case Ae.UINT32:return n.uint32();case Ae.SINT32:return n.sint32()}}function tA(n,e,t,r){Rn(e!==void 0);const i=n.repeated;switch(n.kind){case"scalar":case"enum":let s=n.kind=="enum"?Ae.INT32:n.T;if(i)if(Rn(Array.isArray(e)),n.packed)HQ(t,s,n.no,e);else for(const c of e)gf(t,s,n.no,c);else gf(t,s,n.no,e);break;case"message":if(i){Rn(Array.isArray(e));for(const c of e)nA(t,r,n,c)}else nA(t,r,n,e);break;case"map":Rn(typeof e=="object"&&e!=null);for(const[c,l]of Object.entries(e))qQ(t,r,n,c,l);break}}function qQ(n,e,t,r,i){n.tag(t.no,zn.LengthDelimited),n.fork();let s=r;switch(t.K){case Ae.INT32:case Ae.FIXED32:case Ae.UINT32:case Ae.SFIXED32:case Ae.SINT32:s=Number.parseInt(r);break;case Ae.BOOL:Rn(r=="true"||r=="false"),s=r=="true";break}switch(gf(n,t.K,1,s),t.V.kind){case"scalar":gf(n,t.V.T,2,i);break;case"enum":gf(n,Ae.INT32,2,i);break;case"message":Rn(i!==void 0),n.tag(2,zn.LengthDelimited).bytes(i.toBinary(e));break}n.join()}function nA(n,e,t,r){const i=iD(t.T,r);t.delimited?n.tag(t.no,zn.StartGroup).raw(i.toBinary(e)).tag(t.no,zn.EndGroup):n.tag(t.no,zn.LengthDelimited).bytes(i.toBinary(e))}function gf(n,e,t,r){Rn(r!==void 0);let[i,s]=sD(e);n.tag(t,i)[s](r)}function HQ(n,e,t,r){if(!r.length)return;n.tag(t,zn.LengthDelimited).fork();let[,i]=sD(e);for(let s=0;s<r.length;s++)n[i](r[s]);n.join()}function sD(n){let e=zn.Varint;switch(n){case Ae.BYTES:case Ae.STRING:e=zn.LengthDelimited;break;case Ae.DOUBLE:case Ae.FIXED64:case Ae.SFIXED64:e=zn.Bit64;break;case Ae.FIXED32:case Ae.SFIXED32:case Ae.FLOAT:e=zn.Bit32;break}const t=Ae[n].toLowerCase();return[e,t]}function GQ(){return{setEnumType:KM,initPartial(n,e){if(n===void 0)return;const t=e.getType();for(const r of t.fields.byMember()){const i=r.localName,s=e,c=n;if(c[i]!=null)switch(r.kind){case"oneof":const l=c[i].case;if(l===void 0)continue;const d=r.findField(l);let h=c[i].value;d&&d.kind=="message"&&!Va(h,d.T)?h=new d.T(h):d&&d.kind==="scalar"&&d.T===Ae.BYTES&&(h=qh(h)),s[i]={case:l,value:h};break;case"scalar":case"enum":let m=c[i];r.T===Ae.BYTES&&(m=r.repeated?m.map(qh):qh(m)),s[i]=m;break;case"map":switch(r.V.kind){case"scalar":case"enum":if(r.V.T===Ae.BYTES)for(const[_,R]of Object.entries(c[i]))s[i][_]=qh(R);else Object.assign(s[i],c[i]);break;case"message":const b=r.V.T;for(const _ of Object.keys(c[i])){let R=c[i][_];b.fieldWrapper||(R=new b(R)),s[i][_]=R}break}break;case"message":const g=r.T;if(r.repeated)s[i]=c[i].map(b=>Va(b,g)?b:new g(b));else{const b=c[i];g.fieldWrapper?g.typeName==="google.protobuf.BytesValue"?s[i]=qh(b):s[i]=b:s[i]=Va(b,g)?b:new g(b)}break}}},equals(n,e,t){return e===t?!0:!e||!t?!1:n.fields.byMember().every(r=>{const i=e[r.localName],s=t[r.localName];if(r.repeated){if(i.length!==s.length)return!1;switch(r.kind){case"message":return i.every((c,l)=>r.T.equals(c,s[l]));case"scalar":return i.every((c,l)=>Ho(r.T,c,s[l]));case"enum":return i.every((c,l)=>Ho(Ae.INT32,c,s[l]))}throw new Error("repeated cannot contain ".concat(r.kind))}switch(r.kind){case"message":let c=i,l=s;return r.T.fieldWrapper&&(c!==void 0&&!Va(c)&&(c=r.T.fieldWrapper.wrapField(c)),l!==void 0&&!Va(l)&&(l=r.T.fieldWrapper.wrapField(l))),r.T.equals(c,l);case"enum":return Ho(Ae.INT32,i,s);case"scalar":return Ho(r.T,i,s);case"oneof":if(i.case!==s.case)return!1;const d=r.findField(i.case);if(d===void 0)return!0;switch(d.kind){case"message":return d.T.equals(i.value,s.value);case"enum":return Ho(Ae.INT32,i.value,s.value);case"scalar":return Ho(d.T,i.value,s.value)}throw new Error("oneof cannot contain ".concat(d.kind));case"map":const h=Object.keys(i).concat(Object.keys(s));switch(r.V.kind){case"message":const m=r.V.T;return h.every(b=>m.equals(i[b],s[b]));case"enum":return h.every(b=>Ho(Ae.INT32,i[b],s[b]));case"scalar":const g=r.V.T;return h.every(b=>Ho(g,i[b],s[b]))}break}})},clone(n){const e=n.getType(),t=new e,r=t;for(const i of e.fields.byMember()){const s=n[i.localName];let c;if(i.repeated)c=s.map(rg);else if(i.kind=="map"){c=r[i.localName];for(const[l,d]of Object.entries(s))c[l]=rg(d)}else i.kind=="oneof"?c=i.findField(s.case)?{case:s.case,value:rg(s.value)}:{case:void 0}:c=rg(s);r[i.localName]=c}for(const i of e.runtime.bin.listUnknownFields(n))e.runtime.bin.onUnknownField(r,i.no,i.wireType,i.data);return t}}}function rg(n){if(n===void 0)return n;if(Va(n))return n.clone();if(n instanceof Uint8Array){const e=new Uint8Array(n.byteLength);return e.set(n),e}return n}function qh(n){return n instanceof Uint8Array?n:new Uint8Array(n)}function KQ(n,e,t){return{syntax:n,json:jQ(),bin:FQ(),util:Object.assign(Object.assign({},GQ()),{newFieldList:e,initFields:t}),makeMessageType(r,i,s){return _Q(this,r,i,s)},makeEnum:xQ,makeEnumType:WM,getEnumType:bQ,makeExtension(r,i,s){return AQ(this,r,i,s)}}}class WQ{constructor(e,t){this._fields=e,this._normalizer=t}findJsonName(e){if(!this.jsonNames){const t={};for(const r of this.list())t[r.jsonName]=t[r.name]=r;this.jsonNames=t}return this.jsonNames[e]}find(e){if(!this.numbers){const t={};for(const r of this.list())t[r.no]=r;this.numbers=t}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,t)=>e.no-t.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let t;for(const r of this.list())r.oneof?r.oneof!==t&&(t=r.oneof,e.push(t)):e.push(r)}return this.members}}function aD(n,e){const t=oD(n);return e?t:eX(ZQ(t))}function YQ(n){return aD(n,!1)}const QQ=oD;function oD(n){let e=!1;const t=[];for(let r=0;r<n.length;r++){let i=n.charAt(r);switch(i){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":t.push(i),e=!1;break;default:e&&(e=!1,i=i.toUpperCase()),t.push(i);break}}return t.join("")}const XQ=new Set(["constructor","toString","toJSON","valueOf"]),JQ=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),cD=n=>"".concat(n,"$"),ZQ=n=>JQ.has(n)?cD(n):n,eX=n=>XQ.has(n)?cD(n):n;class tX{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=YQ(e)}addField(e){Rn(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let t=0;t<this.fields.length;t++)this._lookup[this.fields[t].localName]=this.fields[t]}return this._lookup[e]}}function nX(n,e){var t,r,i,s,c,l;const d=[];let h;for(const m of typeof n=="function"?n():n){const g=m;if(g.localName=aD(m.name,m.oneof!==void 0),g.jsonName=(t=m.jsonName)!==null&&t!==void 0?t:QQ(m.name),g.repeated=(r=m.repeated)!==null&&r!==void 0?r:!1,m.kind=="scalar"&&(g.L=(i=m.L)!==null&&i!==void 0?i:xc.BIGINT),g.delimited=(s=m.delimited)!==null&&s!==void 0?s:!1,g.req=(c=m.req)!==null&&c!==void 0?c:!1,g.opt=(l=m.opt)!==null&&l!==void 0?l:!1,m.packed===void 0&&(g.packed=m.kind=="enum"||m.kind=="scalar"&&m.T!=Ae.BYTES&&m.T!=Ae.STRING),m.oneof!==void 0){const b=typeof m.oneof=="string"?m.oneof:m.oneof.name;(!h||h.name!=b)&&(h=new tX(b)),g.oneof=h,h.addField(g)}d.push(g)}return d}const se=KQ("proto3",n=>new WQ(n,e=>nX(e)),n=>{for(const e of n.getType().fields.byMember()){if(e.opt)continue;const t=e.localName,r=n;if(e.repeated){r[t]=[];continue}switch(e.kind){case"oneof":r[t]={case:void 0};break;case"enum":r[t]=0;break;case"map":r[t]={};break;case"scalar":r[t]=kd(e.T,e.L);break}}});class ci extends dT{constructor(e){super(),this.seconds=xn.zero,this.nanos=0,se.util.initPartial(e,this)}fromJson(e,t){if(typeof e!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(se.json.debug(e)));const r=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!r)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const i=Date.parse(r[1]+"-"+r[2]+"-"+r[3]+"T"+r[4]+":"+r[5]+":"+r[6]+(r[8]?r[8]:"Z"));if(Number.isNaN(i))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(i<Date.parse("0001-01-01T00:00:00Z")||i>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=xn.parse(i/1e3),this.nanos=0,r[7]&&(this.nanos=parseInt("1"+r[7]+"0".repeat(9-r[7].length))-1e9),this}toJson(e){const t=Number(this.seconds)*1e3;if(t<Date.parse("0001-01-01T00:00:00Z")||t>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let r="Z";if(this.nanos>0){const i=(this.nanos+1e9).toString().substring(1);i.substring(3)==="000000"?r="."+i.substring(0,3)+"Z":i.substring(6)==="000"?r="."+i.substring(0,6)+"Z":r="."+i+"Z"}return new Date(t).toISOString().replace(".000Z",r)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return ci.fromDate(new Date)}static fromDate(e){const t=e.getTime();return new ci({seconds:xn.parse(Math.floor(t/1e3)),nanos:t%1e3*1e6})}static fromBinary(e,t){return new ci().fromBinary(e,t)}static fromJson(e,t){return new ci().fromJson(e,t)}static fromJsonString(e,t){return new ci().fromJsonString(e,t)}static equals(e,t){return se.util.equals(ci,e,t)}}ci.runtime=se;ci.typeName="google.protobuf.Timestamp";ci.fields=se.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const rX=se.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:ci},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:iX,repeated:!0},{no:5,name:"events",kind:"message",T:aX,repeated:!0}]),iX=se.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:sX,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),sX=se.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:ci},{no:3,name:"value",kind:"scalar",T:2}]),aX=se.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:ci},{no:7,name:"normalized_end_timestamp",kind:"message",T:ci,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),lD=se.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),ds=se.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),Xn=se.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),fT=se.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),af=se.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),Vf=se.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),vs=se.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"},{no:14,name:"CONNECTION_TIMEOUT"},{no:15,name:"MEDIA_FAILURE"}]),sl=se.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),oX=se.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),hr=se.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"},{no:6,name:"TF_PRECONNECT_BUFFER"}]),M0=se.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:Iv,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:SD}]),Iv=se.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),cX=se.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:se.getEnumType(Xn),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),kl=se.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:se.getEnumType(Ju)},{no:4,name:"tracks",kind:"message",T:zu,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:cX},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:se.getEnumType(zf)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:se.getEnumType(vs)},{no:18,name:"kind_details",kind:"enum",T:se.getEnumType(lX),repeated:!0}]),Ju=se.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),zf=se.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"},{no:7,name:"CONNECTOR"}]),lX=se.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"}]),sr=se.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),uX=se.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:lc,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:se.getEnumType(uD)},{no:6,name:"sdp_cid",kind:"scalar",T:9}]),zu=se.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:se.getEnumType(ds)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:se.getEnumType(Xn)},{no:10,name:"layers",kind:"message",T:lc,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:uX,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:se.getEnumType(sr)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:SD},{no:19,name:"audio_features",kind:"enum",T:se.getEnumType(hr),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:se.getEnumType(lD)}]),lc=se.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:se.getEnumType(fT)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13},{no:6,name:"spatial_layer",kind:"scalar",T:5},{no:7,name:"rid",kind:"scalar",T:9}]),uD=se.makeEnum("livekit.VideoLayer.Mode",[{no:0,name:"MODE_UNUSED"},{no:1,name:"ONE_SPATIAL_LAYER_PER_STREAM"},{no:2,name:"MULTIPLE_SPATIAL_LAYERS_PER_STREAM"},{no:3,name:"ONE_SPATIAL_LAYER_PER_STREAM_INCOMPLETE_RTCP_SR"}]),Fr=se.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:se.getEnumType(wt)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:pT,oneof:"value"},{no:3,name:"speaker",kind:"message",T:dX,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:pD,oneof:"value"},{no:7,name:"transcription",kind:"message",T:hX,oneof:"value"},{no:8,name:"metrics",kind:"message",T:rX,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:Pv,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:mT,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:gT,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:vT,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:Mv,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:Dv,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:Ov,oneof:"value"},{no:18,name:"encrypted_packet",kind:"message",T:dD,oneof:"value"},{no:16,name:"sequence",kind:"scalar",T:13},{no:17,name:"participant_sid",kind:"scalar",T:9}]),wt=se.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),dD=se.makeMessageType("livekit.EncryptedPacket",()=>[{no:1,name:"encryption_type",kind:"enum",T:se.getEnumType(sr)},{no:2,name:"iv",kind:"scalar",T:12},{no:3,name:"key_index",kind:"scalar",T:13},{no:4,name:"encrypted_value",kind:"scalar",T:12}]),hD=se.makeMessageType("livekit.EncryptedPacketPayload",()=>[{no:1,name:"user",kind:"message",T:pT,oneof:"value"},{no:3,name:"chat_message",kind:"message",T:Pv,oneof:"value"},{no:4,name:"rpc_request",kind:"message",T:mT,oneof:"value"},{no:5,name:"rpc_ack",kind:"message",T:gT,oneof:"value"},{no:6,name:"rpc_response",kind:"message",T:vT,oneof:"value"},{no:7,name:"stream_header",kind:"message",T:Mv,oneof:"value"},{no:8,name:"stream_chunk",kind:"message",T:Dv,oneof:"value"},{no:9,name:"stream_trailer",kind:"message",T:Ov,oneof:"value"}]),dX=se.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:fD,repeated:!0}]),fD=se.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),pT=se.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),pD=se.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),hX=se.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:fX,repeated:!0}]),fX=se.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),Pv=se.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),mT=se.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),gT=se.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),vT=se.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:mD,oneof:"value"}]),mD=se.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),gD=se.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),vD=se.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:se.getEnumType(yD)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),yD=se.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),bD=se.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:se.getEnumType(xD)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),xD=se.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"},{no:13,name:"UNREAL"},{no:14,name:"ESP32"}]),_D=se.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:rA},{no:2,name:"screen",kind:"message",T:rA},{no:3,name:"resume_connection",kind:"enum",T:se.getEnumType(Vf)},{no:4,name:"disabled_codecs",kind:"message",T:pX},{no:5,name:"force_relay",kind:"enum",T:se.getEnumType(Vf)}]),rA=se.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:se.getEnumType(Vf)}]),pX=se.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:Iv,repeated:!0},{no:2,name:"publish",kind:"message",T:Iv,repeated:!0}]),SD=se.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),Wx=se.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),TD=se.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:se.getEnumType(Wx)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),kD=se.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),Mv=se.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:se.getEnumType(sr)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:TD,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:kD,oneof:"content_header"}],{localName:"DataStream_Header"}),Dv=se.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),Ov=se.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),mX=se.makeMessageType("livekit.SubscribedAudioCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"enabled",kind:"scalar",T:8}]),hs=se.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),Yx=se.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),gX=se.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),vX=se.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:_c,oneof:"message"},{no:2,name:"answer",kind:"message",T:_c,oneof:"message"},{no:3,name:"trickle",kind:"message",T:D0,oneof:"message"},{no:4,name:"add_track",kind:"message",T:Ff,oneof:"message"},{no:5,name:"mute",kind:"message",T:O0,oneof:"message"},{no:6,name:"subscription",kind:"message",T:j0,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:CD,oneof:"message"},{no:8,name:"leave",kind:"message",T:L0,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:ED,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:ND,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:ST,oneof:"message"},{no:13,name:"simulate",kind:"message",T:Bs,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:xT,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:MD,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:bT,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:wD,oneof:"message"}]),iA=se.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:yX,oneof:"message"},{no:2,name:"answer",kind:"message",T:_c,oneof:"message"},{no:3,name:"offer",kind:"message",T:_c,oneof:"message"},{no:4,name:"trickle",kind:"message",T:D0,oneof:"message"},{no:5,name:"update",kind:"message",T:_X,oneof:"message"},{no:6,name:"track_published",kind:"message",T:yT,oneof:"message"},{no:8,name:"leave",kind:"message",T:L0,oneof:"message"},{no:9,name:"mute",kind:"message",T:O0,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:SX,oneof:"message"},{no:11,name:"room_update",kind:"message",T:TX,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:CX,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:EX,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:AX,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:IX,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:xX,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:bX,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:MX,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:jX,oneof:"message"},{no:22,name:"request_response",kind:"message",T:LX,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:UX,oneof:"message"},{no:24,name:"room_moved",kind:"message",T:PX,oneof:"message"},{no:25,name:"media_sections_requirement",kind:"message",T:BX,oneof:"message"},{no:26,name:"subscribed_audio_codec_update",kind:"message",T:NX,oneof:"message"}]),Qx=se.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:lc,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:se.getEnumType(uD)}]),Ff=se.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:se.getEnumType(ds)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:se.getEnumType(Xn)},{no:9,name:"layers",kind:"message",T:lc,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:Qx,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:se.getEnumType(sr)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:se.getEnumType(lD)},{no:17,name:"audio_features",kind:"enum",T:se.getEnumType(hr),repeated:!0}]),D0=se.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:se.getEnumType(hs)},{no:3,name:"final",kind:"scalar",T:8}]),O0=se.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),yX=se.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:M0},{no:2,name:"participant",kind:"message",T:kl},{no:3,name:"other_participants",kind:"message",T:kl,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:RD,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:_D},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:vD},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:Iv,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),bX=se.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:RD,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:_D},{no:3,name:"server_info",kind:"message",T:vD},{no:4,name:"last_message_seq",kind:"scalar",T:13}]),yT=se.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:zu}]),xX=se.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),_c=se.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"id",kind:"scalar",T:13},{no:4,name:"mid_to_track_id",kind:"map",K:9,V:{kind:"scalar",T:9}}]),_X=se.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:kl,repeated:!0}]),j0=se.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:gD,repeated:!0}]),CD=se.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:se.getEnumType(fT)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),bT=se.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:se.getEnumType(hr),repeated:!0}]),wD=se.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),L0=se.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:se.getEnumType(vs)},{no:3,name:"action",kind:"enum",T:se.getEnumType(Zu)},{no:4,name:"regions",kind:"message",T:DX}]),Zu=se.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),ED=se.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:lc,repeated:!0}]),xT=se.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),RD=se.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),SX=se.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:fD,repeated:!0}]),TX=se.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:M0}]),kX=se.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:se.getEnumType(af)},{no:3,name:"score",kind:"scalar",T:2}]),CX=se.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:kX,repeated:!0}]),wX=se.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:se.getEnumType(Yx)}]),EX=se.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:wX,repeated:!0}]),_T=se.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:se.getEnumType(fT)},{no:2,name:"enabled",kind:"scalar",T:8}]),RX=se.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:_T,repeated:!0}]),AX=se.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:_T,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:RX,repeated:!0}]),NX=se.makeMessageType("livekit.SubscribedAudioCodecUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_audio_codecs",kind:"message",T:mX,repeated:!0}]),AD=se.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),ND=se.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:AD,repeated:!0}]),IX=se.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),PX=se.makeMessageType("livekit.RoomMovedResponse",()=>[{no:1,name:"room",kind:"message",T:M0},{no:2,name:"token",kind:"scalar",T:9},{no:3,name:"participant",kind:"message",T:kl},{no:4,name:"other_participants",kind:"message",T:kl,repeated:!0}]),ST=se.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:_c},{no:2,name:"subscription",kind:"message",T:j0},{no:3,name:"publish_tracks",kind:"message",T:yT,repeated:!0},{no:4,name:"data_channels",kind:"message",T:PD,repeated:!0},{no:5,name:"offer",kind:"message",T:_c},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0},{no:7,name:"datachannel_receive_states",kind:"message",T:ID,repeated:!0}]),ID=se.makeMessageType("livekit.DataChannelReceiveState",()=>[{no:1,name:"publisher_sid",kind:"scalar",T:9},{no:2,name:"last_seq",kind:"scalar",T:13}]),PD=se.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:se.getEnumType(hs)}]),Bs=se.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:se.getEnumType(gX),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),MD=se.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),MX=se.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),DX=se.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:OX,repeated:!0}]),OX=se.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),jX=se.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:se.getEnumType(oX)}]),LX=se.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:se.getEnumType(TT)},{no:3,name:"message",kind:"scalar",T:9},{no:4,name:"trickle",kind:"message",T:D0,oneof:"request"},{no:5,name:"add_track",kind:"message",T:Ff,oneof:"request"},{no:6,name:"mute",kind:"message",T:O0,oneof:"request"},{no:7,name:"update_metadata",kind:"message",T:xT,oneof:"request"},{no:8,name:"update_audio_track",kind:"message",T:bT,oneof:"request"},{no:9,name:"update_video_track",kind:"message",T:wD,oneof:"request"}]),TT=se.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"},{no:4,name:"QUEUED"},{no:5,name:"UNSUPPORTED_TYPE"},{no:6,name:"UNCLASSIFIED_ERROR"}]),UX=se.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),DD=se.makeMessageType("livekit.ConnectionSettings",()=>[{no:1,name:"auto_subscribe",kind:"scalar",T:8},{no:2,name:"adaptive_stream",kind:"scalar",T:8},{no:3,name:"subscriber_allow_pause",kind:"scalar",T:8,opt:!0},{no:4,name:"disable_ice_lite",kind:"scalar",T:8}]),VX=se.makeMessageType("livekit.JoinRequest",()=>[{no:1,name:"client_info",kind:"message",T:bD},{no:2,name:"connection_settings",kind:"message",T:DD},{no:3,name:"metadata",kind:"scalar",T:9},{no:4,name:"participant_attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:5,name:"add_track_requests",kind:"message",T:Ff,repeated:!0},{no:6,name:"publisher_offer",kind:"message",T:_c},{no:7,name:"reconnect",kind:"scalar",T:8},{no:8,name:"reconnect_reason",kind:"enum",T:se.getEnumType(sl)},{no:9,name:"participant_sid",kind:"scalar",T:9},{no:10,name:"sync_state",kind:"message",T:ST}]),zX=se.makeMessageType("livekit.WrappedJoinRequest",()=>[{no:1,name:"compression",kind:"enum",T:se.getEnumType(FX)},{no:2,name:"join_request",kind:"scalar",T:12}]),FX=se.makeEnum("livekit.WrappedJoinRequest.Compression",[{no:0,name:"NONE"},{no:1,name:"GZIP"}]),BX=se.makeMessageType("livekit.MediaSectionsRequirement",()=>[{no:1,name:"num_audios",kind:"scalar",T:13},{no:2,name:"num_videos",kind:"scalar",T:13}]);function $X(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var jg={exports:{}},qX=jg.exports,sA;function HX(){return sA||(sA=1,(function(n){(function(e,t){n.exports?n.exports=t():e.log=t()})(qX,function(){var e=function(){},t="undefined",r=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"],s={},c=null;function l(E,A){var M=E[A];if(typeof M.bind=="function")return M.bind(E);try{return Function.prototype.bind.call(M,E)}catch{return function(){return Function.prototype.apply.apply(M,[E,arguments])}}}function d(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function h(E){return E==="debug"&&(E="log"),typeof console===t?!1:E==="trace"&&r?d:console[E]!==void 0?l(console,E):console.log!==void 0?l(console,"log"):e}function m(){for(var E=this.getLevel(),A=0;A<i.length;A++){var M=i[A];this[M]=A<E?e:this.methodFactory(M,E,this.name)}if(this.log=this.debug,typeof console===t&&E<this.levels.SILENT)return"No console available for logging"}function g(E){return function(){typeof console!==t&&(m.call(this),this[E].apply(this,arguments))}}function b(E,A,M){return h(E)||g.apply(this,arguments)}function _(E,A){var M=this,F,j,C,N="loglevel";typeof E=="string"?N+=":"+E:typeof E=="symbol"&&(N=void 0);function D(U){var z=(i[U]||"silent").toUpperCase();if(!(typeof window===t||!N)){try{window.localStorage[N]=z;return}catch{}try{window.document.cookie=encodeURIComponent(N)+"="+z+";"}catch{}}}function S(){var U;if(!(typeof window===t||!N)){try{U=window.localStorage[N]}catch{}if(typeof U===t)try{var z=window.document.cookie,V=encodeURIComponent(N),le=z.indexOf(V+"=");le!==-1&&(U=/^([^;]+)/.exec(z.slice(le+V.length+1))[1])}catch{}return M.levels[U]===void 0&&(U=void 0),U}}function k(){if(!(typeof window===t||!N)){try{window.localStorage.removeItem(N)}catch{}try{window.document.cookie=encodeURIComponent(N)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function P(U){var z=U;if(typeof z=="string"&&M.levels[z.toUpperCase()]!==void 0&&(z=M.levels[z.toUpperCase()]),typeof z=="number"&&z>=0&&z<=M.levels.SILENT)return z;throw new TypeError("log.setLevel() called with invalid level: "+U)}M.name=E,M.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},M.methodFactory=A||b,M.getLevel=function(){return C??j??F},M.setLevel=function(U,z){return C=P(U),z!==!1&&D(C),m.call(M)},M.setDefaultLevel=function(U){j=P(U),S()||M.setLevel(U,!1)},M.resetLevel=function(){C=null,k(),m.call(M)},M.enableAll=function(U){M.setLevel(M.levels.TRACE,U)},M.disableAll=function(U){M.setLevel(M.levels.SILENT,U)},M.rebuild=function(){if(c!==M&&(F=P(c.getLevel())),m.call(M),c===M)for(var U in s)s[U].rebuild()},F=P(c?c.getLevel():"WARN");var L=S();L!=null&&(C=P(L)),m.call(M)}c=new _,c.getLogger=function(A){if(typeof A!="symbol"&&typeof A!="string"||A==="")throw new TypeError("You must supply a name when creating a logger.");var M=s[A];return M||(M=s[A]=new _(A,c.methodFactory)),M};var R=typeof window!==t?window.log:void 0;return c.noConflict=function(){return typeof window!==t&&window.log===c&&(window.log=R),c},c.getLoggers=function(){return s},c.default=c,c})})(jg)),jg.exports}var U0=HX(),Xx;(function(n){n[n.trace=0]="trace",n[n.debug=1]="debug",n[n.info=2]="info",n[n.warn=3]="warn",n[n.error=4]="error",n[n.silent=5]="silent"})(Xx||(Xx={}));var _s;(function(n){n.Default="livekit",n.Room="livekit-room",n.TokenSource="livekit-token-source",n.Participant="livekit-participant",n.Track="livekit-track",n.Publication="livekit-track-publication",n.Engine="livekit-engine",n.Signal="livekit-signal",n.PCManager="livekit-pc-manager",n.PCTransport="livekit-pc-transport",n.E2EE="lk-e2ee"})(_s||(_s={}));let gt=U0.getLogger("livekit");Object.values(_s).map(n=>U0.getLogger(n));gt.setDefaultLevel(Xx.info);function eo(n){const e=U0.getLogger(n);return e.setDefaultLevel(gt.getLevel()),e}const GX=U0.getLogger("lk-e2ee"),Hh=7e3,KX=[0,300,4*300,9*300,16*300,Hh,Hh,Hh,Hh,Hh];class WX{constructor(e){this._retryDelays=e!==void 0?[...e]:KX}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const t=this._retryDelays[e.retryCount];return e.retryCount<=1?t:t+Math.random()*1e3}}function YX(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t}function H(n,e,t,r){function i(s){return s instanceof t?s:new t(function(c){c(s)})}return new(t||(t=Promise))(function(s,c){function l(m){try{h(r.next(m))}catch(g){c(g)}}function d(m){try{h(r.throw(m))}catch(g){c(g)}}function h(m){m.done?s(m.value):i(m.value).then(l,d)}h((r=r.apply(n,e||[])).next())})}function aA(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function za(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof aA=="function"?aA(n):n[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(s){t[s]=n[s]&&function(c){return new Promise(function(l,d){c=n[s](c),i(l,d,c.done,c.value)})}}function i(s,c,l,d){Promise.resolve(d).then(function(h){s({value:h,done:l})},c)}}var ig={exports:{}},oA;function QX(){if(oA)return ig.exports;oA=1;var n=typeof Reflect=="object"?Reflect:null,e=n&&typeof n.apply=="function"?n.apply:function(N,D,S){return Function.prototype.apply.call(N,D,S)},t;n&&typeof n.ownKeys=="function"?t=n.ownKeys:Object.getOwnPropertySymbols?t=function(N){return Object.getOwnPropertyNames(N).concat(Object.getOwnPropertySymbols(N))}:t=function(N){return Object.getOwnPropertyNames(N)};function r(C){console&&console.warn&&console.warn(C)}var i=Number.isNaN||function(N){return N!==N};function s(){s.init.call(this)}ig.exports=s,ig.exports.once=M,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var c=10;function l(C){if(typeof C!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof C)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(C){if(typeof C!="number"||C<0||i(C))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+C+".");c=C}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(N){if(typeof N!="number"||N<0||i(N))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+N+".");return this._maxListeners=N,this};function d(C){return C._maxListeners===void 0?s.defaultMaxListeners:C._maxListeners}s.prototype.getMaxListeners=function(){return d(this)},s.prototype.emit=function(N){for(var D=[],S=1;S<arguments.length;S++)D.push(arguments[S]);var k=N==="error",P=this._events;if(P!==void 0)k=k&&P.error===void 0;else if(!k)return!1;if(k){var L;if(D.length>0&&(L=D[0]),L instanceof Error)throw L;var U=new Error("Unhandled error."+(L?" ("+L.message+")":""));throw U.context=L,U}var z=P[N];if(z===void 0)return!1;if(typeof z=="function")e(z,this,D);else for(var V=z.length,le=R(z,V),S=0;S<V;++S)e(le[S],this,D);return!0};function h(C,N,D,S){var k,P,L;if(l(D),P=C._events,P===void 0?(P=C._events=Object.create(null),C._eventsCount=0):(P.newListener!==void 0&&(C.emit("newListener",N,D.listener?D.listener:D),P=C._events),L=P[N]),L===void 0)L=P[N]=D,++C._eventsCount;else if(typeof L=="function"?L=P[N]=S?[D,L]:[L,D]:S?L.unshift(D):L.push(D),k=d(C),k>0&&L.length>k&&!L.warned){L.warned=!0;var U=new Error("Possible EventEmitter memory leak detected. "+L.length+" "+String(N)+" listeners added. Use emitter.setMaxListeners() to increase limit");U.name="MaxListenersExceededWarning",U.emitter=C,U.type=N,U.count=L.length,r(U)}return C}s.prototype.addListener=function(N,D){return h(this,N,D,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(N,D){return h(this,N,D,!0)};function m(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function g(C,N,D){var S={fired:!1,wrapFn:void 0,target:C,type:N,listener:D},k=m.bind(S);return k.listener=D,S.wrapFn=k,k}s.prototype.once=function(N,D){return l(D),this.on(N,g(this,N,D)),this},s.prototype.prependOnceListener=function(N,D){return l(D),this.prependListener(N,g(this,N,D)),this},s.prototype.removeListener=function(N,D){var S,k,P,L,U;if(l(D),k=this._events,k===void 0)return this;if(S=k[N],S===void 0)return this;if(S===D||S.listener===D)--this._eventsCount===0?this._events=Object.create(null):(delete k[N],k.removeListener&&this.emit("removeListener",N,S.listener||D));else if(typeof S!="function"){for(P=-1,L=S.length-1;L>=0;L--)if(S[L]===D||S[L].listener===D){U=S[L].listener,P=L;break}if(P<0)return this;P===0?S.shift():E(S,P),S.length===1&&(k[N]=S[0]),k.removeListener!==void 0&&this.emit("removeListener",N,U||D)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(N){var D,S,k;if(S=this._events,S===void 0)return this;if(S.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):S[N]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete S[N]),this;if(arguments.length===0){var P=Object.keys(S),L;for(k=0;k<P.length;++k)L=P[k],L!=="removeListener"&&this.removeAllListeners(L);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(D=S[N],typeof D=="function")this.removeListener(N,D);else if(D!==void 0)for(k=D.length-1;k>=0;k--)this.removeListener(N,D[k]);return this};function b(C,N,D){var S=C._events;if(S===void 0)return[];var k=S[N];return k===void 0?[]:typeof k=="function"?D?[k.listener||k]:[k]:D?A(k):R(k,k.length)}s.prototype.listeners=function(N){return b(this,N,!0)},s.prototype.rawListeners=function(N){return b(this,N,!1)},s.listenerCount=function(C,N){return typeof C.listenerCount=="function"?C.listenerCount(N):_.call(C,N)},s.prototype.listenerCount=_;function _(C){var N=this._events;if(N!==void 0){var D=N[C];if(typeof D=="function")return 1;if(D!==void 0)return D.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]};function R(C,N){for(var D=new Array(N),S=0;S<N;++S)D[S]=C[S];return D}function E(C,N){for(;N+1<C.length;N++)C[N]=C[N+1];C.pop()}function A(C){for(var N=new Array(C.length),D=0;D<N.length;++D)N[D]=C[D].listener||C[D];return N}function M(C,N){return new Promise(function(D,S){function k(L){C.removeListener(N,P),S(L)}function P(){typeof C.removeListener=="function"&&C.removeListener("error",k),D([].slice.call(arguments))}j(C,N,P,{once:!0}),N!=="error"&&F(C,k,{once:!0})})}function F(C,N,D){typeof C.on=="function"&&j(C,"error",N,D)}function j(C,N,D,S){if(typeof C.on=="function")S.once?C.once(N,D):C.on(N,D);else if(typeof C.addEventListener=="function")C.addEventListener(N,function k(P){S.once&&C.removeEventListener(N,k),D(P)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof C)}return ig.exports}var da=QX();let OD=!0,jD=!0;function of(n,e,t){const r=n.match(e);return r&&r.length>=t&&parseFloat(r[t],10)}function Vl(n,e,t){if(!n.RTCPeerConnection)return;const r=n.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(c,l){if(c!==e)return i.apply(this,arguments);const d=h=>{const m=t(h);m&&(l.handleEvent?l.handleEvent(m):l(m))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(l,d),i.apply(this,[c,d])};const s=r.removeEventListener;r.removeEventListener=function(c,l){if(c!==e||!this._eventMap||!this._eventMap[e])return s.apply(this,arguments);if(!this._eventMap[e].has(l))return s.apply(this,arguments);const d=this._eventMap[e].get(l);return this._eventMap[e].delete(l),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[c,d])},Object.defineProperty(r,"on"+e,{get(){return this["_on"+e]},set(c){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),c&&this.addEventListener(e,this["_on"+e]=c)},enumerable:!0,configurable:!0})}function XX(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(OD=n,n?"adapter.js logging disabled":"adapter.js logging enabled")}function JX(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(jD=!n,"adapter.js deprecation warnings "+(n?"disabled":"enabled"))}function LD(){if(typeof window=="object"){if(OD)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function kT(n,e){jD&&console.warn(n+" is deprecated, please use "+e+" instead.")}function ZX(n){const e={browser:null,version:null};if(typeof n>"u"||!n.navigator||!n.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:t}=n;if(t.userAgentData&&t.userAgentData.brands){const r=t.userAgentData.brands.find(i=>i.brand==="Chromium");if(r)return{browser:"chrome",version:parseInt(r.version,10)}}if(t.mozGetUserMedia)e.browser="firefox",e.version=parseInt(of(t.userAgent,/Firefox\/(\d+)\./,1));else if(t.webkitGetUserMedia||n.isSecureContext===!1&&n.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(of(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(n.RTCPeerConnection&&t.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(of(t.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=n.RTCRtpTransceiver&&"currentDirection"in n.RTCRtpTransceiver.prototype,e._safariVersion=of(t.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function cA(n){return Object.prototype.toString.call(n)==="[object Object]"}function UD(n){return cA(n)?Object.keys(n).reduce(function(e,t){const r=cA(n[t]),i=r?UD(n[t]):n[t],s=r&&!Object.keys(i).length;return i===void 0||s?e:Object.assign(e,{[t]:i})},{}):n}function Jx(n,e,t){!e||t.has(e.id)||(t.set(e.id,e),Object.keys(e).forEach(r=>{r.endsWith("Id")?Jx(n,n.get(e[r]),t):r.endsWith("Ids")&&e[r].forEach(i=>{Jx(n,n.get(i),t)})}))}function lA(n,e,t){const r=t?"outbound-rtp":"inbound-rtp",i=new Map;if(e===null)return i;const s=[];return n.forEach(c=>{c.type==="track"&&c.trackIdentifier===e.id&&s.push(c)}),s.forEach(c=>{n.forEach(l=>{l.type===r&&l.trackId===c.id&&Jx(n,l,i)})}),i}const uA=LD;function VD(n,e){const t=n&&n.navigator;if(!t.mediaDevices)return;const r=function(l){if(typeof l!="object"||l.mandatory||l.optional)return l;const d={};return Object.keys(l).forEach(h=>{if(h==="require"||h==="advanced"||h==="mediaSource")return;const m=typeof l[h]=="object"?l[h]:{ideal:l[h]};m.exact!==void 0&&typeof m.exact=="number"&&(m.min=m.max=m.exact);const g=function(b,_){return b?b+_.charAt(0).toUpperCase()+_.slice(1):_==="deviceId"?"sourceId":_};if(m.ideal!==void 0){d.optional=d.optional||[];let b={};typeof m.ideal=="number"?(b[g("min",h)]=m.ideal,d.optional.push(b),b={},b[g("max",h)]=m.ideal,d.optional.push(b)):(b[g("",h)]=m.ideal,d.optional.push(b))}m.exact!==void 0&&typeof m.exact!="number"?(d.mandatory=d.mandatory||{},d.mandatory[g("",h)]=m.exact):["min","max"].forEach(b=>{m[b]!==void 0&&(d.mandatory=d.mandatory||{},d.mandatory[g(b,h)]=m[b])})}),l.advanced&&(d.optional=(d.optional||[]).concat(l.advanced)),d},i=function(l,d){if(e.version>=61)return d(l);if(l=JSON.parse(JSON.stringify(l)),l&&typeof l.audio=="object"){const h=function(m,g,b){g in m&&!(b in m)&&(m[b]=m[g],delete m[g])};l=JSON.parse(JSON.stringify(l)),h(l.audio,"autoGainControl","googAutoGainControl"),h(l.audio,"noiseSuppression","googNoiseSuppression"),l.audio=r(l.audio)}if(l&&typeof l.video=="object"){let h=l.video.facingMode;h=h&&(typeof h=="object"?h:{ideal:h});const m=e.version<66;if(h&&(h.exact==="user"||h.exact==="environment"||h.ideal==="user"||h.ideal==="environment")&&!(t.mediaDevices.getSupportedConstraints&&t.mediaDevices.getSupportedConstraints().facingMode&&!m)){delete l.video.facingMode;let g;if(h.exact==="environment"||h.ideal==="environment"?g=["back","rear"]:(h.exact==="user"||h.ideal==="user")&&(g=["front"]),g)return t.mediaDevices.enumerateDevices().then(b=>{b=b.filter(R=>R.kind==="videoinput");let _=b.find(R=>g.some(E=>R.label.toLowerCase().includes(E)));return!_&&b.length&&g.includes("back")&&(_=b[b.length-1]),_&&(l.video.deviceId=h.exact?{exact:_.deviceId}:{ideal:_.deviceId}),l.video=r(l.video),uA("chrome: "+JSON.stringify(l)),d(l)})}l.video=r(l.video)}return uA("chrome: "+JSON.stringify(l)),d(l)},s=function(l){return e.version>=64?l:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[l.name]||l.name,message:l.message,constraint:l.constraint||l.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},c=function(l,d,h){i(l,m=>{t.webkitGetUserMedia(m,d,g=>{h&&h(s(g))})})};if(t.getUserMedia=c.bind(t),t.mediaDevices.getUserMedia){const l=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(d){return i(d,h=>l(h).then(m=>{if(h.audio&&!m.getAudioTracks().length||h.video&&!m.getVideoTracks().length)throw m.getTracks().forEach(g=>{g.stop()}),new DOMException("","NotFoundError");return m},m=>Promise.reject(s(m))))}}}function zD(n){n.MediaStream=n.MediaStream||n.webkitMediaStream}function FD(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("ontrack"in n.RTCPeerConnection.prototype)){Object.defineProperty(n.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(t){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=t)},enumerable:!0,configurable:!0});const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",i=>{let s;n.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(l=>l.track&&l.track.id===i.track.id):s={track:i.track};const c=new Event("track");c.track=i.track,c.receiver=s,c.transceiver={receiver:s},c.streams=[r.stream],this.dispatchEvent(c)}),r.stream.getTracks().forEach(i=>{let s;n.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(l=>l.track&&l.track.id===i.id):s={track:i};const c=new Event("track");c.track=i,c.receiver=s,c.transceiver={receiver:s},c.streams=[r.stream],this.dispatchEvent(c)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Vl(n,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function BD(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("getSenders"in n.RTCPeerConnection.prototype)&&"createDTMFSender"in n.RTCPeerConnection.prototype){const e=function(i,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=i.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:i}};if(!n.RTCPeerConnection.prototype.getSenders){n.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(l,d){let h=i.apply(this,arguments);return h||(h=e(this,l),this._senders.push(h)),h};const s=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(l){s.apply(this,arguments);const d=this._senders.indexOf(l);d!==-1&&this._senders.splice(d,1)}}const t=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],t.apply(this,[s]),s.getTracks().forEach(c=>{this._senders.push(e(this,c))})};const r=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],r.apply(this,[s]),s.getTracks().forEach(c=>{const l=this._senders.find(d=>d.track===c);l&&this._senders.splice(this._senders.indexOf(l),1)})}}else if(typeof n=="object"&&n.RTCPeerConnection&&"getSenders"in n.RTCPeerConnection.prototype&&"createDTMFSender"in n.RTCPeerConnection.prototype&&n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)){const e=n.RTCPeerConnection.prototype.getSenders;n.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(i=>i._pc=this),r},Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function $D(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender&&n.RTCRtpReceiver))return;if(!("getStats"in n.RTCRtpSender.prototype)){const t=n.RTCPeerConnection.prototype.getSenders;t&&(n.RTCPeerConnection.prototype.getSenders=function(){const s=t.apply(this,[]);return s.forEach(c=>c._pc=this),s});const r=n.RTCPeerConnection.prototype.addTrack;r&&(n.RTCPeerConnection.prototype.addTrack=function(){const s=r.apply(this,arguments);return s._pc=this,s}),n.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(c=>lA(c,s.track,!0))}}if(!("getStats"in n.RTCRtpReceiver.prototype)){const t=n.RTCPeerConnection.prototype.getReceivers;t&&(n.RTCPeerConnection.prototype.getReceivers=function(){const i=t.apply(this,[]);return i.forEach(s=>s._pc=this),i}),Vl(n,"track",r=>(r.receiver._pc=r.srcElement,r)),n.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(s=>lA(s,i.track,!1))}}if(!("getStats"in n.RTCRtpSender.prototype&&"getStats"in n.RTCRtpReceiver.prototype))return;const e=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof n.MediaStreamTrack){const r=arguments[0];let i,s,c;return this.getSenders().forEach(l=>{l.track===r&&(i?c=!0:i=l)}),this.getReceivers().forEach(l=>(l.track===r&&(s?c=!0:s=l),l.track===r)),c||i&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function qD(n){n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(c=>this._shimmedLocalStreams[c][0])};const e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(c,l){if(!l)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const d=e.apply(this,arguments);return this._shimmedLocalStreams[l.id]?this._shimmedLocalStreams[l.id].indexOf(d)===-1&&this._shimmedLocalStreams[l.id].push(d):this._shimmedLocalStreams[l.id]=[l,d],d};const t=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(c){this._shimmedLocalStreams=this._shimmedLocalStreams||{},c.getTracks().forEach(h=>{if(this.getSenders().find(g=>g.track===h))throw new DOMException("Track already exists.","InvalidAccessError")});const l=this.getSenders();t.apply(this,arguments);const d=this.getSenders().filter(h=>l.indexOf(h)===-1);this._shimmedLocalStreams[c.id]=[c].concat(d)};const r=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(c){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[c.id],r.apply(this,arguments)};const i=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(c){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},c&&Object.keys(this._shimmedLocalStreams).forEach(l=>{const d=this._shimmedLocalStreams[l].indexOf(c);d!==-1&&this._shimmedLocalStreams[l].splice(d,1),this._shimmedLocalStreams[l].length===1&&delete this._shimmedLocalStreams[l]}),i.apply(this,arguments)}}function HD(n,e){if(!n.RTCPeerConnection)return;if(n.RTCPeerConnection.prototype.addTrack&&e.version>=65)return qD(n);const t=n.RTCPeerConnection.prototype.getLocalStreams;n.RTCPeerConnection.prototype.getLocalStreams=function(){const m=t.apply(this);return this._reverseStreams=this._reverseStreams||{},m.map(g=>this._reverseStreams[g.id])};const r=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(m){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},m.getTracks().forEach(g=>{if(this.getSenders().find(_=>_.track===g))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[m.id]){const g=new n.MediaStream(m.getTracks());this._streams[m.id]=g,this._reverseStreams[g.id]=m,m=g}r.apply(this,[m])};const i=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(m){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[m.id]||m]),delete this._reverseStreams[this._streams[m.id]?this._streams[m.id].id:m.id],delete this._streams[m.id]},n.RTCPeerConnection.prototype.addTrack=function(m,g){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const b=[].slice.call(arguments,1);if(b.length!==1||!b[0].getTracks().find(E=>E===m))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(E=>E.track===m))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const R=this._streams[g.id];if(R)R.addTrack(m),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const E=new n.MediaStream([m]);this._streams[g.id]=E,this._reverseStreams[E.id]=g,this.addStream(E)}return this.getSenders().find(E=>E.track===m)};function s(h,m){let g=m.sdp;return Object.keys(h._reverseStreams||[]).forEach(b=>{const _=h._reverseStreams[b],R=h._streams[_.id];g=g.replace(new RegExp(R.id,"g"),_.id)}),new RTCSessionDescription({type:m.type,sdp:g})}function c(h,m){let g=m.sdp;return Object.keys(h._reverseStreams||[]).forEach(b=>{const _=h._reverseStreams[b],R=h._streams[_.id];g=g.replace(new RegExp(_.id,"g"),R.id)}),new RTCSessionDescription({type:m.type,sdp:g})}["createOffer","createAnswer"].forEach(function(h){const m=n.RTCPeerConnection.prototype[h],g={[h](){const b=arguments;return arguments.length&&typeof arguments[0]=="function"?m.apply(this,[R=>{const E=s(this,R);b[0].apply(null,[E])},R=>{b[1]&&b[1].apply(null,R)},arguments[2]]):m.apply(this,arguments).then(R=>s(this,R))}};n.RTCPeerConnection.prototype[h]=g[h]});const l=n.RTCPeerConnection.prototype.setLocalDescription;n.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?l.apply(this,arguments):(arguments[0]=c(this,arguments[0]),l.apply(this,arguments))};const d=Object.getOwnPropertyDescriptor(n.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(n.RTCPeerConnection.prototype,"localDescription",{get(){const h=d.get.apply(this);return h.type===""?h:s(this,h)}}),n.RTCPeerConnection.prototype.removeTrack=function(m){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!m._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(m._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let b;Object.keys(this._streams).forEach(_=>{this._streams[_].getTracks().find(E=>m.track===E)&&(b=this._streams[_])}),b&&(b.getTracks().length===1?this.removeStream(this._reverseStreams[b.id]):b.removeTrack(m.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Zx(n,e){!n.RTCPeerConnection&&n.webkitRTCPeerConnection&&(n.RTCPeerConnection=n.webkitRTCPeerConnection),n.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const r=n.RTCPeerConnection.prototype[t],i={[t](){return arguments[0]=new(t==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};n.RTCPeerConnection.prototype[t]=i[t]})}function GD(n,e){Vl(n,"negotiationneeded",t=>{const r=t.target;if(!((e.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return t})}var dA=Object.freeze({__proto__:null,fixNegotiationNeeded:GD,shimAddTrackRemoveTrack:HD,shimAddTrackRemoveTrackWithNative:qD,shimGetSendersWithDtmf:BD,shimGetUserMedia:VD,shimMediaStream:zD,shimOnTrack:FD,shimPeerConnection:Zx,shimSenderReceiverGetStats:$D});function KD(n,e){const t=n&&n.navigator,r=n&&n.MediaStreamTrack;if(t.getUserMedia=function(i,s,c){kT("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),t.mediaDevices.getUserMedia(i).then(s,c)},!(e.version>55&&"autoGainControl"in t.mediaDevices.getSupportedConstraints())){const i=function(c,l,d){l in c&&!(d in c)&&(c[d]=c[l],delete c[l])},s=t.mediaDevices.getUserMedia.bind(t.mediaDevices);if(t.mediaDevices.getUserMedia=function(c){return typeof c=="object"&&typeof c.audio=="object"&&(c=JSON.parse(JSON.stringify(c)),i(c.audio,"autoGainControl","mozAutoGainControl"),i(c.audio,"noiseSuppression","mozNoiseSuppression")),s(c)},r&&r.prototype.getSettings){const c=r.prototype.getSettings;r.prototype.getSettings=function(){const l=c.apply(this,arguments);return i(l,"mozAutoGainControl","autoGainControl"),i(l,"mozNoiseSuppression","noiseSuppression"),l}}if(r&&r.prototype.applyConstraints){const c=r.prototype.applyConstraints;r.prototype.applyConstraints=function(l){return this.kind==="audio"&&typeof l=="object"&&(l=JSON.parse(JSON.stringify(l)),i(l,"autoGainControl","mozAutoGainControl"),i(l,"noiseSuppression","mozNoiseSuppression")),c.apply(this,[l])}}}}function eJ(n,e){n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||n.navigator.mediaDevices&&(n.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return r.video===!0?r.video={mediaSource:e}:r.video.mediaSource=e,n.navigator.mediaDevices.getUserMedia(r)})}function WD(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function e_(n,e){if(typeof n!="object"||!(n.RTCPeerConnection||n.mozRTCPeerConnection))return;!n.RTCPeerConnection&&n.mozRTCPeerConnection&&(n.RTCPeerConnection=n.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const s=n.RTCPeerConnection.prototype[i],c={[i](){return arguments[0]=new(i==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};n.RTCPeerConnection.prototype[i]=c[i]});const t={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[s,c,l]=arguments;return r.apply(this,[s||null]).then(d=>{if(e.version<53&&!c)try{d.forEach(h=>{h.type=t[h.type]||h.type})}catch(h){if(h.name!=="TypeError")throw h;d.forEach((m,g)=>{d.set(g,Object.assign({},m,{type:t[m.type]||m.type}))})}return d}).then(c,l)}}function YD(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpSender.prototype)return;const e=n.RTCPeerConnection.prototype.getSenders;e&&(n.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(s=>s._pc=this),i});const t=n.RTCPeerConnection.prototype.addTrack;t&&(n.RTCPeerConnection.prototype.addTrack=function(){const i=t.apply(this,arguments);return i._pc=this,i}),n.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function QD(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpReceiver.prototype)return;const e=n.RTCPeerConnection.prototype.getReceivers;e&&(n.RTCPeerConnection.prototype.getReceivers=function(){const r=e.apply(this,[]);return r.forEach(i=>i._pc=this),r}),Vl(n,"track",t=>(t.receiver._pc=t.srcElement,t)),n.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function XD(n){!n.RTCPeerConnection||"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(t){kT("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&t.getTracks().includes(r.track)&&this.removeTrack(r)})})}function JD(n){n.DataChannel&&!n.RTCDataChannel&&(n.RTCDataChannel=n.DataChannel)}function ZD(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.addTransceiver;e&&(n.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const i=r.length>0;i&&r.forEach(c=>{if("rid"in c&&!/^[a-z0-9]{0,16}$/i.test(c.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in c&&!(parseFloat(c.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in c&&!(parseFloat(c.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=e.apply(this,arguments);if(i){const{sender:c}=s,l=c.getParameters();(!("encodings"in l)||l.encodings.length===1&&Object.keys(l.encodings[0]).length===0)&&(l.encodings=r,c.sendEncodings=r,this.setParametersPromises.push(c.setParameters(l).then(()=>{delete c.sendEncodings}).catch(()=>{delete c.sendEncodings})))}return s})}function eO(n){if(!(typeof n=="object"&&n.RTCRtpSender))return;const e=n.RTCRtpSender.prototype.getParameters;e&&(n.RTCRtpSender.prototype.getParameters=function(){const r=e.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function tO(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function nO(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.createAnswer;n.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var hA=Object.freeze({__proto__:null,shimAddTransceiver:ZD,shimCreateAnswer:nO,shimCreateOffer:tO,shimGetDisplayMedia:eJ,shimGetParameters:eO,shimGetUserMedia:KD,shimOnTrack:WD,shimPeerConnection:e_,shimRTCDataChannel:JD,shimReceiverGetStats:QD,shimRemoveStream:XD,shimSenderGetStats:YD});function rO(n){if(!(typeof n!="object"||!n.RTCPeerConnection)){if("getLocalStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in n.RTCPeerConnection.prototype)){const e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(i=>e.call(this,i,r)),r.getVideoTracks().forEach(i=>e.call(this,i,r))},n.RTCPeerConnection.prototype.addTrack=function(r){for(var i=arguments.length,s=new Array(i>1?i-1:0),c=1;c<i;c++)s[c-1]=arguments[c];return s&&s.forEach(l=>{this._localStreams?this._localStreams.includes(l)||this._localStreams.push(l):this._localStreams=[l]}),e.apply(this,arguments)}}"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(t);if(r===-1)return;this._localStreams.splice(r,1);const i=t.getTracks();this.getSenders().forEach(s=>{i.includes(s.track)&&this.removeTrack(s)})})}}function iO(n){if(!(typeof n!="object"||!n.RTCPeerConnection)&&("getRemoteStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in n.RTCPeerConnection.prototype))){Object.defineProperty(n.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(t){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=t),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(i=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(i))return;this._remoteStreams.push(i);const s=new Event("addstream");s.stream=i,this.dispatchEvent(s)})})}});const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(s=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(s)>=0)return;r._remoteStreams.push(s);const c=new Event("addstream");c.stream=s,r.dispatchEvent(c)})}),e.apply(r,arguments)}}}function sO(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const e=n.RTCPeerConnection.prototype,t=e.createOffer,r=e.createAnswer,i=e.setLocalDescription,s=e.setRemoteDescription,c=e.addIceCandidate;e.createOffer=function(h,m){const g=arguments.length>=2?arguments[2]:arguments[0],b=t.apply(this,[g]);return m?(b.then(h,m),Promise.resolve()):b},e.createAnswer=function(h,m){const g=arguments.length>=2?arguments[2]:arguments[0],b=r.apply(this,[g]);return m?(b.then(h,m),Promise.resolve()):b};let l=function(d,h,m){const g=i.apply(this,[d]);return m?(g.then(h,m),Promise.resolve()):g};e.setLocalDescription=l,l=function(d,h,m){const g=s.apply(this,[d]);return m?(g.then(h,m),Promise.resolve()):g},e.setRemoteDescription=l,l=function(d,h,m){const g=c.apply(this,[d]);return m?(g.then(h,m),Promise.resolve()):g},e.addIceCandidate=l}function aO(n){const e=n&&n.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const t=e.mediaDevices,r=t.getUserMedia.bind(t);e.mediaDevices.getUserMedia=i=>r(oO(i))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(r,i,s){e.mediaDevices.getUserMedia(r).then(i,s)}).bind(e))}function oO(n){return n&&n.video!==void 0?Object.assign({},n,{video:UD(n.video)}):n}function cO(n){if(!n.RTCPeerConnection)return;const e=n.RTCPeerConnection;n.RTCPeerConnection=function(r,i){if(r&&r.iceServers){const s=[];for(let c=0;c<r.iceServers.length;c++){let l=r.iceServers[c];l.urls===void 0&&l.url?(kT("RTCIceServer.url","RTCIceServer.urls"),l=JSON.parse(JSON.stringify(l)),l.urls=l.url,delete l.url,s.push(l)):s.push(r.iceServers[c])}r.iceServers=s}return new e(r,i)},n.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function lO(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function uO(n){const e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const i=this.getTransceivers().find(c=>c.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):r.offerToReceiveAudio===!0&&!i&&this.addTransceiver("audio",{direction:"recvonly"}),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const s=this.getTransceivers().find(c=>c.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):r.offerToReceiveVideo===!0&&!s&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function dO(n){typeof n!="object"||n.AudioContext||(n.AudioContext=n.webkitAudioContext)}var fA=Object.freeze({__proto__:null,shimAudioContext:dO,shimCallbacksAPI:sO,shimConstraints:oO,shimCreateOfferLegacy:uO,shimGetUserMedia:aO,shimLocalStreamsAPI:rO,shimRTCIceServerUrls:cO,shimRemoteStreamsAPI:iO,shimTrackEventTransceiver:lO}),E1={exports:{}},pA;function tJ(){return pA||(pA=1,(function(n){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(t){return t.trim().split(`
`).map(r=>r.trim())},e.splitSections=function(t){return t.split(`
m=`).map((i,s)=>(s>0?"m="+i:i).trim()+`\r
`)},e.getDescription=function(t){const r=e.splitSections(t);return r&&r[0]},e.getMediaSections=function(t){const r=e.splitSections(t);return r.shift(),r},e.matchPrefix=function(t,r){return e.splitLines(t).filter(i=>i.indexOf(r)===0)},e.parseCandidate=function(t){let r;t.indexOf("a=candidate:")===0?r=t.substring(12).split(" "):r=t.substring(10).split(" ");const i={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let s=8;s<r.length;s+=2)switch(r[s]){case"raddr":i.relatedAddress=r[s+1];break;case"rport":i.relatedPort=parseInt(r[s+1],10);break;case"tcptype":i.tcpType=r[s+1];break;case"ufrag":i.ufrag=r[s+1],i.usernameFragment=r[s+1];break;default:i[r[s]]===void 0&&(i[r[s]]=r[s+1]);break}return i},e.writeCandidate=function(t){const r=[];r.push(t.foundation);const i=t.component;i==="rtp"?r.push(1):i==="rtcp"?r.push(2):r.push(i),r.push(t.protocol.toUpperCase()),r.push(t.priority),r.push(t.address||t.ip),r.push(t.port);const s=t.type;return r.push("typ"),r.push(s),s!=="host"&&t.relatedAddress&&t.relatedPort&&(r.push("raddr"),r.push(t.relatedAddress),r.push("rport"),r.push(t.relatedPort)),t.tcpType&&t.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(t.tcpType)),(t.usernameFragment||t.ufrag)&&(r.push("ufrag"),r.push(t.usernameFragment||t.ufrag)),"candidate:"+r.join(" ")},e.parseIceOptions=function(t){return t.substring(14).split(" ")},e.parseRtpMap=function(t){let r=t.substring(9).split(" ");const i={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),i.name=r[0],i.clockRate=parseInt(r[1],10),i.channels=r.length===3?parseInt(r[2],10):1,i.numChannels=i.channels,i},e.writeRtpMap=function(t){let r=t.payloadType;t.preferredPayloadType!==void 0&&(r=t.preferredPayloadType);const i=t.channels||t.numChannels||1;return"a=rtpmap:"+r+" "+t.name+"/"+t.clockRate+(i!==1?"/"+i:"")+`\r
`},e.parseExtmap=function(t){const r=t.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},e.writeExtmap=function(t){return"a=extmap:"+(t.id||t.preferredId)+(t.direction&&t.direction!=="sendrecv"?"/"+t.direction:"")+" "+t.uri+(t.attributes?" "+t.attributes:"")+`\r
`},e.parseFmtp=function(t){const r={};let i;const s=t.substring(t.indexOf(" ")+1).split(";");for(let c=0;c<s.length;c++)i=s[c].trim().split("="),r[i[0].trim()]=i[1];return r},e.writeFmtp=function(t){let r="",i=t.payloadType;if(t.preferredPayloadType!==void 0&&(i=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){const s=[];Object.keys(t.parameters).forEach(c=>{t.parameters[c]!==void 0?s.push(c+"="+t.parameters[c]):s.push(c)}),r+="a=fmtp:"+i+" "+s.join(";")+`\r
`}return r},e.parseRtcpFb=function(t){const r=t.substring(t.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},e.writeRtcpFb=function(t){let r="",i=t.payloadType;return t.preferredPayloadType!==void 0&&(i=t.preferredPayloadType),t.rtcpFeedback&&t.rtcpFeedback.length&&t.rtcpFeedback.forEach(s=>{r+="a=rtcp-fb:"+i+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),r},e.parseSsrcMedia=function(t){const r=t.indexOf(" "),i={ssrc:parseInt(t.substring(7,r),10)},s=t.indexOf(":",r);return s>-1?(i.attribute=t.substring(r+1,s),i.value=t.substring(s+1)):i.attribute=t.substring(r+1),i},e.parseSsrcGroup=function(t){const r=t.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(i=>parseInt(i,10))}},e.getMid=function(t){const r=e.matchPrefix(t,"a=mid:")[0];if(r)return r.substring(6)},e.parseFingerprint=function(t){const r=t.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},e.getDtlsParameters=function(t,r){return{role:"auto",fingerprints:e.matchPrefix(t+r,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(t,r){let i="a=setup:"+r+`\r
`;return t.fingerprints.forEach(s=>{i+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),i},e.parseCryptoLine=function(t){const r=t.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},e.writeCryptoLine=function(t){return"a=crypto:"+t.tag+" "+t.cryptoSuite+" "+(typeof t.keyParams=="object"?e.writeCryptoKeyParams(t.keyParams):t.keyParams)+(t.sessionParams?" "+t.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(t){if(t.indexOf("inline:")!==0)return null;const r=t.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(t){return t.keyMethod+":"+t.keySalt+(t.lifeTime?"|"+t.lifeTime:"")+(t.mkiValue&&t.mkiLength?"|"+t.mkiValue+":"+t.mkiLength:"")},e.getCryptoParameters=function(t,r){return e.matchPrefix(t+r,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(t,r){const i=e.matchPrefix(t+r,"a=ice-ufrag:")[0],s=e.matchPrefix(t+r,"a=ice-pwd:")[0];return i&&s?{usernameFragment:i.substring(12),password:s.substring(10)}:null},e.writeIceParameters=function(t){let r="a=ice-ufrag:"+t.usernameFragment+`\r
a=ice-pwd:`+t.password+`\r
`;return t.iceLite&&(r+=`a=ice-lite\r
`),r},e.parseRtpParameters=function(t){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=e.splitLines(t)[0].split(" ");r.profile=s[2];for(let l=3;l<s.length;l++){const d=s[l],h=e.matchPrefix(t,"a=rtpmap:"+d+" ")[0];if(h){const m=e.parseRtpMap(h),g=e.matchPrefix(t,"a=fmtp:"+d+" ");switch(m.parameters=g.length?e.parseFmtp(g[0]):{},m.rtcpFeedback=e.matchPrefix(t,"a=rtcp-fb:"+d+" ").map(e.parseRtcpFb),r.codecs.push(m),m.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(m.name.toUpperCase());break}}}e.matchPrefix(t,"a=extmap:").forEach(l=>{r.headerExtensions.push(e.parseExtmap(l))});const c=e.matchPrefix(t,"a=rtcp-fb:* ").map(e.parseRtcpFb);return r.codecs.forEach(l=>{c.forEach(d=>{l.rtcpFeedback.find(m=>m.type===d.type&&m.parameter===d.parameter)||l.rtcpFeedback.push(d)})}),r},e.writeRtpDescription=function(t,r){let i="";i+="m="+t+" ",i+=r.codecs.length>0?"9":"0",i+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=r.codecs.map(c=>c.preferredPayloadType!==void 0?c.preferredPayloadType:c.payloadType).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(c=>{i+=e.writeRtpMap(c),i+=e.writeFmtp(c),i+=e.writeRtcpFb(c)});let s=0;return r.codecs.forEach(c=>{c.maxptime>s&&(s=c.maxptime)}),s>0&&(i+="a=maxptime:"+s+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(c=>{i+=e.writeExtmap(c)}),i},e.parseRtpEncodingParameters=function(t){const r=[],i=e.parseRtpParameters(t),s=i.fecMechanisms.indexOf("RED")!==-1,c=i.fecMechanisms.indexOf("ULPFEC")!==-1,l=e.matchPrefix(t,"a=ssrc:").map(b=>e.parseSsrcMedia(b)).filter(b=>b.attribute==="cname"),d=l.length>0&&l[0].ssrc;let h;const m=e.matchPrefix(t,"a=ssrc-group:FID").map(b=>b.substring(17).split(" ").map(R=>parseInt(R,10)));m.length>0&&m[0].length>1&&m[0][0]===d&&(h=m[0][1]),i.codecs.forEach(b=>{if(b.name.toUpperCase()==="RTX"&&b.parameters.apt){let _={ssrc:d,codecPayloadType:parseInt(b.parameters.apt,10)};d&&h&&(_.rtx={ssrc:h}),r.push(_),s&&(_=JSON.parse(JSON.stringify(_)),_.fec={ssrc:d,mechanism:c?"red+ulpfec":"red"},r.push(_))}}),r.length===0&&d&&r.push({ssrc:d});let g=e.matchPrefix(t,"b=");return g.length&&(g[0].indexOf("b=TIAS:")===0?g=parseInt(g[0].substring(7),10):g[0].indexOf("b=AS:")===0?g=parseInt(g[0].substring(5),10)*1e3*.95-2e3*8:g=void 0,r.forEach(b=>{b.maxBitrate=g})),r},e.parseRtcpParameters=function(t){const r={},i=e.matchPrefix(t,"a=ssrc:").map(l=>e.parseSsrcMedia(l)).filter(l=>l.attribute==="cname")[0];i&&(r.cname=i.value,r.ssrc=i.ssrc);const s=e.matchPrefix(t,"a=rtcp-rsize");r.reducedSize=s.length>0,r.compound=s.length===0;const c=e.matchPrefix(t,"a=rtcp-mux");return r.mux=c.length>0,r},e.writeRtcpParameters=function(t){let r="";return t.reducedSize&&(r+=`a=rtcp-rsize\r
`),t.mux&&(r+=`a=rtcp-mux\r
`),t.ssrc!==void 0&&t.cname&&(r+="a=ssrc:"+t.ssrc+" cname:"+t.cname+`\r
`),r},e.parseMsid=function(t){let r;const i=e.matchPrefix(t,"a=msid:");if(i.length===1)return r=i[0].substring(7).split(" "),{stream:r[0],track:r[1]};const s=e.matchPrefix(t,"a=ssrc:").map(c=>e.parseSsrcMedia(c)).filter(c=>c.attribute==="msid");if(s.length>0)return r=s[0].value.split(" "),{stream:r[0],track:r[1]}},e.parseSctpDescription=function(t){const r=e.parseMLine(t),i=e.matchPrefix(t,"a=max-message-size:");let s;i.length>0&&(s=parseInt(i[0].substring(19),10)),isNaN(s)&&(s=65536);const c=e.matchPrefix(t,"a=sctp-port:");if(c.length>0)return{port:parseInt(c[0].substring(12),10),protocol:r.fmt,maxMessageSize:s};const l=e.matchPrefix(t,"a=sctpmap:");if(l.length>0){const d=l[0].substring(10).split(" ");return{port:parseInt(d[0],10),protocol:d[1],maxMessageSize:s}}},e.writeSctpDescription=function(t,r){let i=[];return t.protocol!=="DTLS/SCTP"?i=["m="+t.kind+" 9 "+t.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:i=["m="+t.kind+" 9 "+t.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&i.push("a=max-message-size:"+r.maxMessageSize+`\r
`),i.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(t,r,i){let s;const c=r!==void 0?r:2;return t?s=t:s=e.generateSessionId(),`v=0\r
o=`+(i||"thisisadapterortc")+" "+s+" "+c+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(t,r){const i=e.splitLines(t);for(let s=0;s<i.length;s++)switch(i[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[s].substring(2)}return r?e.getDirection(r):"sendrecv"},e.getKind=function(t){return e.splitLines(t)[0].split(" ")[0].substring(2)},e.isRejected=function(t){return t.split(" ",2)[1]==="0"},e.parseMLine=function(t){const i=e.splitLines(t)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},e.parseOLine=function(t){const i=e.matchPrefix(t,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},e.isValidSDP=function(t){if(typeof t!="string"||t.length===0)return!1;const r=e.splitLines(t);for(let i=0;i<r.length;i++)if(r[i].length<2||r[i].charAt(1)!=="=")return!1;return!0},n.exports=e})(E1)),E1.exports}var hO=tJ(),ed=$X(hO),nJ=dQ({__proto__:null,default:ed},[hO]);function Lg(n){if(!n.RTCIceCandidate||n.RTCIceCandidate&&"foundation"in n.RTCIceCandidate.prototype)return;const e=n.RTCIceCandidate;n.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substring(2)),r.candidate&&r.candidate.length){const i=new e(r),s=ed.parseCandidate(r.candidate);for(const c in s)c in i||Object.defineProperty(i,c,{value:s[c]});return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new e(r)},n.RTCIceCandidate.prototype=e.prototype,Vl(n,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new n.RTCIceCandidate(t.candidate),writable:"false"}),t))}function t_(n){!n.RTCIceCandidate||n.RTCIceCandidate&&"relayProtocol"in n.RTCIceCandidate.prototype||Vl(n,"icecandidate",e=>{if(e.candidate){const t=ed.parseCandidate(e.candidate.candidate);t.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e})}function Ug(n,e){if(!n.RTCPeerConnection)return;"sctp"in n.RTCPeerConnection.prototype||Object.defineProperty(n.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const t=function(l){if(!l||!l.sdp)return!1;const d=ed.splitSections(l.sdp);return d.shift(),d.some(h=>{const m=ed.parseMLine(h);return m&&m.kind==="application"&&m.protocol.indexOf("SCTP")!==-1})},r=function(l){const d=l.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(d===null||d.length<2)return-1;const h=parseInt(d[1],10);return h!==h?-1:h},i=function(l){let d=65536;return e.browser==="firefox"&&(e.version<57?l===-1?d=16384:d=2147483637:e.version<60?d=e.version===57?65535:65536:d=2147483637),d},s=function(l,d){let h=65536;e.browser==="firefox"&&e.version===57&&(h=65535);const m=ed.matchPrefix(l.sdp,"a=max-message-size:");return m.length>0?h=parseInt(m[0].substring(19),10):e.browser==="firefox"&&d!==-1&&(h=2147483637),h},c=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:d}=this.getConfiguration();d==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(t(arguments[0])){const d=r(arguments[0]),h=i(d),m=s(arguments[0],d);let g;h===0&&m===0?g=Number.POSITIVE_INFINITY:h===0||m===0?g=Math.max(h,m):g=Math.min(h,m);const b={};Object.defineProperty(b,"maxMessageSize",{get(){return g}}),this._sctp=b}return c.apply(this,arguments)}}function Vg(n){if(!(n.RTCPeerConnection&&"createDataChannel"in n.RTCPeerConnection.prototype))return;function e(r,i){const s=r.send;r.send=function(){const l=arguments[0],d=l.length||l.size||l.byteLength;if(r.readyState==="open"&&i.sctp&&d>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return s.apply(r,arguments)}}const t=n.RTCPeerConnection.prototype.createDataChannel;n.RTCPeerConnection.prototype.createDataChannel=function(){const i=t.apply(this,arguments);return e(i,this),i},Vl(n,"datachannel",r=>(e(r.channel,r.target),r))}function n_(n){if(!n.RTCPeerConnection||"connectionState"in n.RTCPeerConnection.prototype)return;const e=n.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(t){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),t&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=t)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(t=>{const r=e[t];e[t]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const s=i.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const c=new Event("connectionstatechange",i);s.dispatchEvent(c)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function r_(n,e){if(!n.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const t=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=i.sdp.split(`
`).filter(c=>c.trim()!=="a=extmap-allow-mixed").join(`
`);n.RTCSessionDescription&&i instanceof n.RTCSessionDescription?arguments[0]=new n.RTCSessionDescription({type:i.type,sdp:s}):i.sdp=s}return t.apply(this,arguments)}}function zg(n,e){if(!(n.RTCPeerConnection&&n.RTCPeerConnection.prototype))return;const t=n.RTCPeerConnection.prototype.addIceCandidate;!t||t.length===0||(n.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Fg(n,e){if(!(n.RTCPeerConnection&&n.RTCPeerConnection.prototype))return;const t=n.RTCPeerConnection.prototype.setLocalDescription;!t||t.length===0||(n.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return t.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer";break}return i.sdp||i.type!=="offer"&&i.type!=="answer"?t.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(c=>t.apply(this,[c]))})}var rJ=Object.freeze({__proto__:null,removeExtmapAllowMixed:r_,shimAddIceCandidateNullOrEmpty:zg,shimConnectionState:n_,shimMaxMessageSize:Ug,shimParameterlessSetLocalDescription:Fg,shimRTCIceCandidate:Lg,shimRTCIceCandidateRelayProtocol:t_,shimSendThrowTypeError:Vg});function iJ(){let{window:n}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const t=LD,r=ZX(n),i={browserDetails:r,commonShim:rJ,extractVersion:of,disableLog:XX,disableWarnings:JX,sdp:nJ};switch(r.browser){case"chrome":if(!dA||!Zx||!e.shimChrome)return t("Chrome shim is not included in this adapter release."),i;if(r.version===null)return t("Chrome shim can not determine version, not shimming."),i;t("adapter.js shimming chrome."),i.browserShim=dA,zg(n,r),Fg(n),VD(n,r),zD(n),Zx(n,r),FD(n),HD(n,r),BD(n),$D(n),GD(n,r),Lg(n),t_(n),n_(n),Ug(n,r),Vg(n),r_(n,r);break;case"firefox":if(!hA||!e_||!e.shimFirefox)return t("Firefox shim is not included in this adapter release."),i;t("adapter.js shimming firefox."),i.browserShim=hA,zg(n,r),Fg(n),KD(n,r),e_(n,r),WD(n),XD(n),YD(n),QD(n),JD(n),ZD(n),eO(n),tO(n),nO(n),Lg(n),n_(n),Ug(n,r),Vg(n);break;case"safari":if(!fA||!e.shimSafari)return t("Safari shim is not included in this adapter release."),i;t("adapter.js shimming safari."),i.browserShim=fA,zg(n,r),Fg(n),cO(n),uO(n),sO(n),rO(n),iO(n),lO(n),aO(n),dO(n),Lg(n),t_(n),Ug(n,r),Vg(n),r_(n,r);break;default:t("Unsupported browser!");break}return i}iJ({window:typeof window>"u"?void 0:window});const sJ=/version\/(\d+(\.?_?\d+)+)/i;let R1;function Gr(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof navigator>"u")return;const t=navigator.userAgent.toLowerCase();if(R1===void 0||e){const r=aJ.find(i=>{let{test:s}=i;return s.test(t)});R1=r?.describe(t)}return R1}const aJ=[{test:/firefox|iceweasel|fxios/i,describe(n){return{name:"Firefox",version:Bg(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,n),os:n.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:A1(n)}}},{test:/chrom|crios|crmo/i,describe(n){return{name:"Chrome",version:Bg(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,n),os:n.toLowerCase().includes("crios")?"iOS":void 0,osVersion:A1(n)}}},{test:/safari|applewebkit/i,describe(n){return{name:"Safari",version:Bg(sJ,n),os:n.includes("mobile/")?"iOS":"macOS",osVersion:A1(n)}}}];function Bg(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const r=e.match(n);return r&&r.length>=t&&r[t]||""}function A1(n){return n.includes("mac os")?Bg(/\(.+?(\d+_\d+(:?_\d+)?)/,n,1).replace(/_/g,"."):void 0}var oJ="2.16.1";const cJ=oJ,lJ=16;class ha extends Error{constructor(e,t){super(t||"an error has occured"),this.name="LiveKitError",this.code=e}}var gn;(function(n){n[n.NotAllowed=0]="NotAllowed",n[n.ServerUnreachable=1]="ServerUnreachable",n[n.InternalError=2]="InternalError",n[n.Cancelled=3]="Cancelled",n[n.LeaveRequest=4]="LeaveRequest",n[n.Timeout=5]="Timeout",n[n.WebSocket=6]="WebSocket"})(gn||(gn={}));class dt extends ha{constructor(e,t,r,i){super(1,e),this.name="ConnectionError",this.status=r,this.reason=t,this.context=i,this.reasonName=gn[t]}static notAllowed(e,t,r){return new dt(e,gn.NotAllowed,t,r)}static timeout(e){return new dt(e,gn.Timeout)}static leaveRequest(e,t){return new dt(e,gn.LeaveRequest,void 0,t)}static internal(e,t){return new dt(e,gn.InternalError,void 0,t)}static cancelled(e){return new dt(e,gn.Cancelled)}static serverUnreachable(e,t){return new dt(e,gn.ServerUnreachable,t)}static websocket(e,t,r){return new dt(e,gn.WebSocket,t,r)}}class CT extends ha{constructor(e){super(21,e??"device is unsupported"),this.name="DeviceUnsupportedError"}}class Fa extends ha{constructor(e){super(20,e??"track is invalid"),this.name="TrackInvalidError"}}class uJ extends ha{constructor(e){super(10,e??"unsupported server"),this.name="UnsupportedServer"}}class ir extends ha{constructor(e){super(12,e??"unexpected connection state"),this.name="UnexpectedConnectionState"}}class i_ extends ha{constructor(e){super(13,e??"unable to negotiate"),this.name="NegotiationError"}}class mA extends ha{constructor(e,t){super(15,e),this.name="PublishTrackError",this.status=t}}class gA extends ha{constructor(e,t){super(15,e),this.name="SignalRequestError",this.reason=t,this.reasonName=typeof t=="string"?t:TT[t]}}var zr;(function(n){n[n.AlreadyOpened=0]="AlreadyOpened",n[n.AbnormalEnd=1]="AbnormalEnd",n[n.DecodeFailed=2]="DecodeFailed",n[n.LengthExceeded=3]="LengthExceeded",n[n.Incomplete=4]="Incomplete",n[n.HandlerAlreadyRegistered=7]="HandlerAlreadyRegistered",n[n.EncryptionTypeMismatch=8]="EncryptionTypeMismatch"})(zr||(zr={}));class Ki extends ha{constructor(e,t){super(16,e),this.name="DataStreamError",this.reason=t,this.reasonName=zr[t]}}class Pu extends ha{constructor(e){super(18,e),this.name="SignalReconnectError"}}var Bf;(function(n){n.PermissionDenied="PermissionDenied",n.NotFound="NotFound",n.DeviceInUse="DeviceInUse",n.Other="Other"})(Bf||(Bf={}));(function(n){function e(t){if(t&&"name"in t)return t.name==="NotFoundError"||t.name==="DevicesNotFoundError"?n.NotFound:t.name==="NotAllowedError"||t.name==="PermissionDeniedError"?n.PermissionDenied:t.name==="NotReadableError"||t.name==="TrackStartError"?n.DeviceInUse:n.Other}n.getFailure=e})(Bf||(Bf={}));class wr{}wr.setTimeout=function(){return setTimeout(...arguments)};wr.setInterval=function(){return setInterval(...arguments)};wr.clearTimeout=function(){return clearTimeout(...arguments)};wr.clearInterval=function(){return clearInterval(...arguments)};var pe;(function(n){n.Connected="connected",n.Reconnecting="reconnecting",n.SignalReconnecting="signalReconnecting",n.Reconnected="reconnected",n.Disconnected="disconnected",n.ConnectionStateChanged="connectionStateChanged",n.Moved="moved",n.MediaDevicesChanged="mediaDevicesChanged",n.ParticipantConnected="participantConnected",n.ParticipantDisconnected="participantDisconnected",n.TrackPublished="trackPublished",n.TrackSubscribed="trackSubscribed",n.TrackSubscriptionFailed="trackSubscriptionFailed",n.TrackUnpublished="trackUnpublished",n.TrackUnsubscribed="trackUnsubscribed",n.TrackMuted="trackMuted",n.TrackUnmuted="trackUnmuted",n.LocalTrackPublished="localTrackPublished",n.LocalTrackUnpublished="localTrackUnpublished",n.LocalAudioSilenceDetected="localAudioSilenceDetected",n.ActiveSpeakersChanged="activeSpeakersChanged",n.ParticipantMetadataChanged="participantMetadataChanged",n.ParticipantNameChanged="participantNameChanged",n.ParticipantAttributesChanged="participantAttributesChanged",n.ParticipantActive="participantActive",n.RoomMetadataChanged="roomMetadataChanged",n.DataReceived="dataReceived",n.SipDTMFReceived="sipDTMFReceived",n.TranscriptionReceived="transcriptionReceived",n.ConnectionQualityChanged="connectionQualityChanged",n.TrackStreamStateChanged="trackStreamStateChanged",n.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",n.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",n.AudioPlaybackStatusChanged="audioPlaybackChanged",n.VideoPlaybackStatusChanged="videoPlaybackChanged",n.MediaDevicesError="mediaDevicesError",n.ParticipantPermissionsChanged="participantPermissionsChanged",n.SignalConnected="signalConnected",n.RecordingStatusChanged="recordingStatusChanged",n.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",n.EncryptionError="encryptionError",n.DCBufferStatusChanged="dcBufferStatusChanged",n.ActiveDeviceChanged="activeDeviceChanged",n.ChatMessage="chatMessage",n.LocalTrackSubscribed="localTrackSubscribed",n.MetricsReceived="metricsReceived"})(pe||(pe={}));var ye;(function(n){n.TrackPublished="trackPublished",n.TrackSubscribed="trackSubscribed",n.TrackSubscriptionFailed="trackSubscriptionFailed",n.TrackUnpublished="trackUnpublished",n.TrackUnsubscribed="trackUnsubscribed",n.TrackMuted="trackMuted",n.TrackUnmuted="trackUnmuted",n.LocalTrackPublished="localTrackPublished",n.LocalTrackUnpublished="localTrackUnpublished",n.LocalTrackCpuConstrained="localTrackCpuConstrained",n.LocalSenderCreated="localSenderCreated",n.ParticipantMetadataChanged="participantMetadataChanged",n.ParticipantNameChanged="participantNameChanged",n.DataReceived="dataReceived",n.SipDTMFReceived="sipDTMFReceived",n.TranscriptionReceived="transcriptionReceived",n.IsSpeakingChanged="isSpeakingChanged",n.ConnectionQualityChanged="connectionQualityChanged",n.TrackStreamStateChanged="trackStreamStateChanged",n.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",n.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",n.TrackCpuConstrained="trackCpuConstrained",n.MediaDevicesError="mediaDevicesError",n.AudioStreamAcquired="audioStreamAcquired",n.ParticipantPermissionsChanged="participantPermissionsChanged",n.PCTrackAdded="pcTrackAdded",n.AttributesChanged="attributesChanged",n.LocalTrackSubscribed="localTrackSubscribed",n.ChatMessage="chatMessage",n.Active="active"})(ye||(ye={}));var Ve;(function(n){n.TransportsCreated="transportsCreated",n.Connected="connected",n.Disconnected="disconnected",n.Resuming="resuming",n.Resumed="resumed",n.Restarting="restarting",n.Restarted="restarted",n.SignalResumed="signalResumed",n.SignalRestarted="signalRestarted",n.Closing="closing",n.MediaTrackAdded="mediaTrackAdded",n.ActiveSpeakersUpdate="activeSpeakersUpdate",n.DataPacketReceived="dataPacketReceived",n.RTPVideoMapUpdate="rtpVideoMapUpdate",n.DCBufferStatusChanged="dcBufferStatusChanged",n.ParticipantUpdate="participantUpdate",n.RoomUpdate="roomUpdate",n.SpeakersChanged="speakersChanged",n.StreamStateChanged="streamStateChanged",n.ConnectionQualityUpdate="connectionQualityUpdate",n.SubscriptionError="subscriptionError",n.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",n.RemoteMute="remoteMute",n.SubscribedQualityUpdate="subscribedQualityUpdate",n.LocalTrackUnpublished="localTrackUnpublished",n.LocalTrackSubscribed="localTrackSubscribed",n.Offline="offline",n.SignalRequestResponse="signalRequestResponse",n.SignalConnected="signalConnected",n.RoomMoved="roomMoved"})(Ve||(Ve={}));var De;(function(n){n.Message="message",n.Muted="muted",n.Unmuted="unmuted",n.Restarted="restarted",n.Ended="ended",n.Subscribed="subscribed",n.Unsubscribed="unsubscribed",n.CpuConstrained="cpuConstrained",n.UpdateSettings="updateSettings",n.UpdateSubscription="updateSubscription",n.AudioPlaybackStarted="audioPlaybackStarted",n.AudioPlaybackFailed="audioPlaybackFailed",n.AudioSilenceDetected="audioSilenceDetected",n.VisibilityChanged="visibilityChanged",n.VideoDimensionsChanged="videoDimensionsChanged",n.VideoPlaybackStarted="videoPlaybackStarted",n.VideoPlaybackFailed="videoPlaybackFailed",n.ElementAttached="elementAttached",n.ElementDetached="elementDetached",n.UpstreamPaused="upstreamPaused",n.UpstreamResumed="upstreamResumed",n.SubscriptionPermissionChanged="subscriptionPermissionChanged",n.SubscriptionStatusChanged="subscriptionStatusChanged",n.SubscriptionFailed="subscriptionFailed",n.TrackProcessorUpdate="trackProcessorUpdate",n.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",n.TranscriptionReceived="transcriptionReceived",n.TimeSyncUpdate="timeSyncUpdate",n.PreConnectBufferFlushed="preConnectBufferFlushed"})(De||(De={}));function dJ(n){return typeof n>"u"?n:typeof structuredClone=="function"?typeof n=="object"&&n!==null?structuredClone(Object.assign({},n)):structuredClone(n):JSON.parse(JSON.stringify(n))}class rn{constructor(e,t,r,i,s){if(typeof e=="object")this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else if(t!==void 0&&r!==void 0)this.width=e,this.height=t,this.aspectRatio=e/t,this.encoding={maxBitrate:r,maxFramerate:i,priority:s};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const hJ=["vp8","h264"],fJ=["vp8","h264","vp9","av1","h265"];function pJ(n){return!!hJ.find(e=>e===n)}const mJ=pJ;var vA;(function(n){n[n.PREFER_REGRESSION=0]="PREFER_REGRESSION",n[n.SIMULCAST=1]="SIMULCAST",n[n.REGRESSION=2]="REGRESSION"})(vA||(vA={}));var s_;(function(n){n.telephone={maxBitrate:12e3},n.speech={maxBitrate:24e3},n.music={maxBitrate:48e3},n.musicStereo={maxBitrate:64e3},n.musicHighQuality={maxBitrate:96e3},n.musicHighQualityStereo={maxBitrate:128e3}})(s_||(s_={}));const $f={h90:new rn(160,90,9e4,20),h180:new rn(320,180,16e4,20),h216:new rn(384,216,18e4,20),h360:new rn(640,360,45e4,20),h540:new rn(960,540,8e5,25),h720:new rn(1280,720,17e5,30),h1080:new rn(1920,1080,3e6,30),h1440:new rn(2560,1440,5e6,30),h2160:new rn(3840,2160,8e6,30)},a_={h120:new rn(160,120,7e4,20),h180:new rn(240,180,125e3,20),h240:new rn(320,240,14e4,20),h360:new rn(480,360,33e4,20),h480:new rn(640,480,5e5,20),h540:new rn(720,540,6e5,25),h720:new rn(960,720,13e5,30),h1080:new rn(1440,1080,23e5,30),h1440:new rn(1920,1440,38e5,30)},wT={h360fps3:new rn(640,360,2e5,3,"medium"),h360fps15:new rn(640,360,4e5,15,"medium"),h720fps5:new rn(1280,720,8e5,5,"medium"),h720fps15:new rn(1280,720,15e5,15,"medium"),h720fps30:new rn(1280,720,2e6,30,"medium"),h1080fps15:new rn(1920,1080,25e5,15,"medium"),h1080fps30:new rn(1920,1080,5e6,30,"medium"),original:new rn(0,0,7e6,30,"medium")};function fO(n,e,t){var r,i,s,c;const{optionsWithoutProcessor:l,audioProcessor:d,videoProcessor:h}=gO(n??{}),m=e?.processor,g=t?.processor,b=l??{};return b.audio===!0&&(b.audio={}),b.video===!0&&(b.video={}),b.audio&&(o_(b.audio,e),(r=(s=b.audio).deviceId)!==null&&r!==void 0||(s.deviceId={ideal:"default"}),(d||m)&&(b.audio.processor=d??m)),b.video&&(o_(b.video,t),(i=(c=b.video).deviceId)!==null&&i!==void 0||(c.deviceId={ideal:"default"}),(h||g)&&(b.video.processor=h??g)),b}function o_(n,e){return Object.keys(e).forEach(t=>{n[t]===void 0&&(n[t]=e[t])}),n}function ET(n){var e,t,r,i;const s={};if(n.video)if(typeof n.video=="object"){const c={},l=c,d=n.video;Object.keys(d).forEach(h=>{switch(h){case"resolution":o_(l,d.resolution);break;default:l[h]=d[h]}}),s.video=c,(e=(r=s.video).deviceId)!==null&&e!==void 0||(r.deviceId={ideal:"default"})}else s.video=n.video?{deviceId:{ideal:"default"}}:!1;else s.video=!1;return n.audio?typeof n.audio=="object"?(s.audio=n.audio,(t=(i=s.audio).deviceId)!==null&&t!==void 0||(i.deviceId={ideal:"default"})):s.audio={deviceId:{ideal:"default"}}:s.audio=!1,s}function pO(n){return H(this,arguments,void 0,function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return(function*(){const r=mO();if(r){const i=r.createAnalyser();i.fftSize=2048;const s=i.frequencyBinCount,c=new Uint8Array(s);r.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(i),yield Er(t),i.getByteTimeDomainData(c);const d=c.some(h=>h!==128&&h!==0);return r.close(),!d}return!1})()})}function mO(){var n;const e=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(e){const t=new e({latencyHint:"interactive"});if(t.state==="suspended"&&typeof window<"u"&&(!((n=window.document)===null||n===void 0)&&n.body)){const r=()=>H(this,void 0,void 0,function*(){var i;try{t.state==="suspended"&&(yield t.resume())}catch(s){console.warn("Error trying to auto-resume audio context",s)}finally{(i=window.document.body)===null||i===void 0||i.removeEventListener("click",r)}});t.addEventListener("statechange",()=>{var i;t.state==="closed"&&((i=window.document.body)===null||i===void 0||i.removeEventListener("click",r))}),window.document.body.addEventListener("click",r)}return t}}function gJ(n){return n==="audioinput"?he.Source.Microphone:n==="videoinput"?he.Source.Camera:he.Source.Unknown}function c_(n){return n===he.Source.Microphone?"audioinput":n===he.Source.Camera?"videoinput":void 0}function vJ(n){var e,t;let r=(e=n.video)!==null&&e!==void 0?e:!0;return n.resolution&&n.resolution.width>0&&n.resolution.height>0&&(r=typeof r=="boolean"?{}:r,wl()?r=Object.assign(Object.assign({},r),{width:{max:n.resolution.width},height:{max:n.resolution.height},frameRate:n.resolution.frameRate}):r=Object.assign(Object.assign({},r),{width:{ideal:n.resolution.width},height:{ideal:n.resolution.height},frameRate:n.resolution.frameRate})),{audio:(t=n.audio)!==null&&t!==void 0?t:!1,video:r,controller:n.controller,selfBrowserSurface:n.selfBrowserSurface,surfaceSwitching:n.surfaceSwitching,systemAudio:n.systemAudio,preferCurrentTab:n.preferCurrentTab}}function vf(n){return n.split("/")[1].toLowerCase()}function yJ(n){const e=[];return n.forEach(t=>{t.track!==void 0&&e.push(new yT({cid:t.track.mediaStreamID,track:t.trackInfo}))}),e}function At(n){return"mediaStreamTrack"in n?{trackID:n.sid,source:n.source,muted:n.isMuted,enabled:n.mediaStreamTrack.enabled,kind:n.kind,streamID:n.mediaStreamID,streamTrackID:n.mediaStreamTrack.id}:{trackID:n.trackSid,enabled:n.isEnabled,muted:n.isMuted,trackInfo:Object.assign({mimeType:n.mimeType,name:n.trackName,encrypted:n.isEncrypted,kind:n.kind,source:n.source},n.track?At(n.track):{})}}function bJ(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function xJ(n,e){var t;n===void 0&&(n={}),e===void 0&&(e={});const r=[...Object.keys(e),...Object.keys(n)],i={};for(const s of r)n[s]!==e[s]&&(i[s]=(t=e[s])!==null&&t!==void 0?t:"");return i}function gO(n){const e=Object.assign({},n);let t,r;return typeof e.audio=="object"&&e.audio.processor&&(t=e.audio.processor,e.audio=Object.assign(Object.assign({},e.audio),{processor:void 0})),typeof e.video=="object"&&e.video.processor&&(r=e.video.processor,e.video=Object.assign(Object.assign({},e.video),{processor:void 0})),{audioProcessor:t,videoProcessor:r,optionsWithoutProcessor:dJ(e)}}function _J(n){switch(n){case Xn.CAMERA:return he.Source.Camera;case Xn.MICROPHONE:return he.Source.Microphone;case Xn.SCREEN_SHARE:return he.Source.ScreenShare;case Xn.SCREEN_SHARE_AUDIO:return he.Source.ScreenShareAudio;default:return he.Source.Unknown}}function yA(n,e){return n.width*n.height<e.width*e.height}function SJ(n,e){var t;return(t=n.layers)===null||t===void 0?void 0:t.find(r=>r.quality===e)}const TJ=5e3,Gh=[];var Ai;(function(n){n[n.LOW=0]="LOW",n[n.MEDIUM=1]="MEDIUM",n[n.HIGH=2]="HIGH"})(Ai||(Ai={}));class he extends da.EventEmitter{get streamState(){return this._streamState}setStreamState(e){this._streamState=e}constructor(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var i;super(),this.attachedElements=[],this.isMuted=!1,this._streamState=he.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=gt,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),TJ):this.handleAppVisibilityChanged()},this.log=eo((i=r.loggerName)!==null&&i!==void 0?i:_s.Track),this.loggerContextCb=r.loggerContextCb,this.setMaxListeners(100),this.kind=t,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=he.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),At(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let t="audio";this.kind===he.Kind.Video&&(t="video"),this.attachedElements.length===0&&this.kind===he.Kind.Video&&this.addAppVisibilityListener(),e||(t==="audio"&&(Gh.forEach(s=>{s.parentElement===null&&!e&&(e=s)}),e&&Gh.splice(Gh.indexOf(e),1)),e||(e=document.createElement(t))),this.attachedElements.includes(e)||this.attachedElements.push(e),Fu(this.mediaStreamTrack,e);const r=e.srcObject.getTracks(),i=r.some(s=>s.kind==="audio");return e.play().then(()=>{this.emit(i?De.AudioPlaybackStarted:De.VideoPlaybackStarted)}).catch(s=>{s.name==="NotAllowedError"?this.emit(i?De.AudioPlaybackFailed:De.VideoPlaybackFailed,s):s.name==="AbortError"?gt.debug("".concat(i?"audio":"video"," playback aborted, likely due to new play request")):gt.warn("could not playback ".concat(i?"audio":"video"),s),i&&e&&r.some(c=>c.kind==="video")&&s.name==="NotAllowedError"&&(e.muted=!0,e.play().catch(()=>{}))}),this.emit(De.ElementAttached,e),e}detach(e){try{if(e){td(this.mediaStreamTrack,e);const r=this.attachedElements.indexOf(e);return r>=0&&(this.attachedElements.splice(r,1),this.recycleElement(e),this.emit(De.ElementDetached,e)),e}const t=[];return this.attachedElements.forEach(r=>{td(this.mediaStreamTrack,r),t.push(r),this.recycleElement(r),this.emit(De.ElementDetached,r)}),this.attachedElements=[],t}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=eo(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let t=!0;e.pause(),Gh.forEach(r=>{r.parentElement||(t=!1)}),t&&Gh.push(e)}}handleAppVisibilityChanged(){return H(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===he.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(e=>e.play().catch(()=>{})),0)})}addAppVisibilityListener(){di()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){di()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function Fu(n,e){let t;e.srcObject instanceof MediaStream?t=e.srcObject:t=new MediaStream;let r;n.kind==="audio"?r=t.getAudioTracks():r=t.getVideoTracks(),r.includes(n)||(r.forEach(i=>{t.removeTrack(i)}),t.addTrack(n)),(!wl()||!(e instanceof HTMLVideoElement))&&(e.autoplay=!0),e.muted=t.getAudioTracks().length===0,e instanceof HTMLVideoElement&&(e.playsInline=!0),e.srcObject!==t&&(e.srcObject=t,(wl()||Cl())&&e instanceof HTMLVideoElement&&setTimeout(()=>{e.srcObject=t,e.play().catch(()=>{})},0))}function td(n,e){if(e.srcObject instanceof MediaStream){const t=e.srcObject;t.removeTrack(n),t.getTracks().length>0?e.srcObject=t:e.srcObject=null}}(function(n){let e;(function(h){h.Audio="audio",h.Video="video",h.Unknown="unknown"})(e=n.Kind||(n.Kind={}));let t;(function(h){h.Camera="camera",h.Microphone="microphone",h.ScreenShare="screen_share",h.ScreenShareAudio="screen_share_audio",h.Unknown="unknown"})(t=n.Source||(n.Source={}));let r;(function(h){h.Active="active",h.Paused="paused",h.Unknown="unknown"})(r=n.StreamState||(n.StreamState={}));function i(h){switch(h){case e.Audio:return ds.AUDIO;case e.Video:return ds.VIDEO;default:return ds.DATA}}n.kindToProto=i;function s(h){switch(h){case ds.AUDIO:return e.Audio;case ds.VIDEO:return e.Video;default:return e.Unknown}}n.kindFromProto=s;function c(h){switch(h){case t.Camera:return Xn.CAMERA;case t.Microphone:return Xn.MICROPHONE;case t.ScreenShare:return Xn.SCREEN_SHARE;case t.ScreenShareAudio:return Xn.SCREEN_SHARE_AUDIO;default:return Xn.UNKNOWN}}n.sourceToProto=c;function l(h){switch(h){case Xn.CAMERA:return t.Camera;case Xn.MICROPHONE:return t.Microphone;case Xn.SCREEN_SHARE:return t.ScreenShare;case Xn.SCREEN_SHARE_AUDIO:return t.ScreenShareAudio;default:return t.Unknown}}n.sourceFromProto=l;function d(h){switch(h){case Yx.ACTIVE:return r.Active;case Yx.PAUSED:return r.Paused;default:return r.Unknown}}n.streamStateFromProto=d})(he||(he={}));const kJ="|",bA="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function CJ(n){const e=n.split(kJ);return e.length>1?[e[0],n.substr(e[0].length+1)]:[n,""]}function Er(n){return H(this,void 0,void 0,function*(){return new Promise(e=>wr.setTimeout(e,n))})}function l_(){return"addTransceiver"in RTCPeerConnection.prototype}function u_(){return"addTrack"in RTCPeerConnection.prototype}function wJ(){if(!("getCapabilities"in RTCRtpSender)||wl()||Cl())return!1;const n=RTCRtpSender.getCapabilities("video");let e=!1;if(n){for(const t of n.codecs)if(t.mimeType.toLowerCase()==="video/av1"){e=!0;break}}return e}function EJ(){if(!("getCapabilities"in RTCRtpSender)||Cl())return!1;if(wl()){const t=Gr();if(t?.version&&aa(t.version,"16")<0||t?.os==="iOS"&&t?.osVersion&&aa(t.osVersion,"16")<0)return!1}const n=RTCRtpSender.getCapabilities("video");let e=!1;if(n){for(const t of n.codecs)if(t.mimeType.toLowerCase()==="video/vp9"){e=!0;break}}return e}function fs(n){return n==="av1"||n==="vp9"}function d_(n){return!document||qf()?!1:(n||(n=document.createElement("audio")),"setSinkId"in n)}function RJ(){return typeof RTCPeerConnection>"u"?!1:l_()||u_()}function Cl(){var n;return((n=Gr())===null||n===void 0?void 0:n.name)==="Firefox"}function xA(){const n=Gr();return!!n&&n.name==="Chrome"&&n.os!=="iOS"}function wl(){var n;return((n=Gr())===null||n===void 0?void 0:n.name)==="Safari"}function qf(){const n=Gr();return n?.name==="Safari"||n?.os==="iOS"}function AJ(){const n=Gr();return n?.name==="Safari"&&n.version.startsWith("17.")||n?.os==="iOS"&&!!n?.osVersion&&aa(n.osVersion,"17")>=0}function NJ(n){return n||(n=Gr()),n?.name==="Safari"&&aa(n.version,"18.3")>0||n?.os==="iOS"&&!!n?.osVersion&&aa(n.osVersion,"18.3")>0}function vO(){var n,e;return di()?(e=(n=navigator.userAgentData)===null||n===void 0?void 0:n.mobile)!==null&&e!==void 0?e:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function IJ(){const n=Gr(),e="17.2";if(n)return n.name!=="Safari"&&n.os!=="iOS"||n.os==="iOS"&&n.osVersion&&aa(n.osVersion,e)>=0?!0:n.name==="Safari"&&aa(n.version,e)>=0}function di(){return typeof document<"u"}function sa(){return navigator.product=="ReactNative"}function Cd(n){return n.hostname.endsWith(".livekit.cloud")||n.hostname.endsWith(".livekit.run")}function N1(n){return Cd(n)?n.hostname.split(".")[0]:null}function yO(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function bO(){if(!sa())return;let n=yO();if(n)return n.platform}function _A(){if(di())return window.devicePixelRatio;if(sa()){let n=yO();if(n)return n.devicePixelRatio}return 1}function aa(n,e){const t=n.split("."),r=e.split("."),i=Math.min(t.length,r.length);for(let s=0;s<i;++s){const c=parseInt(t[s],10),l=parseInt(r[s],10);if(c>l)return 1;if(c<l)return-1;if(s===i-1&&c===l)return 0}return n===""&&e!==""?-1:e===""?1:t.length==r.length?0:t.length<r.length?-1:1}function PJ(n){for(const e of n)e.target.handleResize(e)}function MJ(n){for(const e of n)e.target.handleVisibilityChanged(e)}let I1=null;const SA=()=>(I1||(I1=new ResizeObserver(PJ)),I1);let P1=null;const TA=()=>(P1||(P1=new IntersectionObserver(MJ,{root:null,rootMargin:"0px"})),P1);function DJ(){var n;const e=new bD({sdk:xD.JS,protocol:lJ,version:cJ});return sa()&&(e.os=(n=bO())!==null&&n!==void 0?n:""),e}function kA(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const i=document.createElement("canvas");i.width=n,i.height=e;const s=i.getContext("2d");s?.fillRect(0,0,i.width,i.height),r&&s&&(s.beginPath(),s.arc(n/2,e/2,50,0,Math.PI*2,!0),s.closePath(),s.fillStyle="grey",s.fill());const c=i.captureStream(),[l]=c.getTracks();if(!l)throw Error("Could not get empty media stream video track");return l.enabled=t,l}let Kh;function M1(){if(!Kh){const n=new AudioContext,e=n.createOscillator(),t=n.createGain();t.gain.setValueAtTime(0,0);const r=n.createMediaStreamDestination();if(e.connect(t),t.connect(r),e.start(),[Kh]=r.stream.getAudioTracks(),!Kh)throw Error("Could not get empty media stream audio track");Kh.enabled=!1}return Kh.clone()}class Qi{get isResolved(){return this._isResolved}constructor(e,t){this._isResolved=!1,this.onFinally=t,this.promise=new Promise((r,i)=>H(this,void 0,void 0,function*(){this.resolve=r,this.reject=i,e&&(yield e(r,i))})).finally(()=>{var r;this._isResolved=!0,(r=this.onFinally)===null||r===void 0||r.call(this)})}}function OJ(n){return fJ.includes(n)}function uc(n){if(typeof n=="string"||typeof n=="number")return n;if(Array.isArray(n))return n[0];if(n.exact!==void 0)return Array.isArray(n.exact)?n.exact[0]:n.exact;if(n.ideal!==void 0)return Array.isArray(n.ideal)?n.ideal[0]:n.ideal;throw Error("could not unwrap constraint")}function jJ(n){return n.startsWith("http")?n.replace(/^(http)/,"ws"):n}function Hf(n){return n.startsWith("ws")?n.replace(/^(ws)/,"http"):n}function LJ(n,e){return n.segments.map(t=>{let{id:r,text:i,language:s,startTime:c,endTime:l,final:d}=t;var h;const m=(h=e.get(r))!==null&&h!==void 0?h:Date.now(),g=Date.now();return d?e.delete(r):e.set(r,m),{id:r,text:i,startTime:Number.parseInt(c.toString()),endTime:Number.parseInt(l.toString()),final:d,language:s,firstReceivedTime:m,lastReceivedTime:g}})}function UJ(n){const{id:e,timestamp:t,message:r,editTimestamp:i}=n;return{id:e,timestamp:Number.parseInt(t.toString()),editTimestamp:i?Number.parseInt(i.toString()):void 0,message:r}}function CA(n){switch(n.reason){case gn.LeaveRequest:return n.context;case gn.Cancelled:return vs.CLIENT_INITIATED;case gn.NotAllowed:return vs.USER_REJECTED;case gn.ServerUnreachable:return vs.JOIN_FAILURE;default:return vs.UNKNOWN_REASON}}function $g(n){return n!==void 0?Number(n):void 0}function al(n){return n!==void 0?BigInt(n):void 0}function fl(n){return!!n&&!(n instanceof MediaStreamTrack)&&n.isLocal}function ta(n){return!!n&&n.kind==he.Kind.Audio}function wc(n){return!!n&&n.kind==he.Kind.Video}function Go(n){return fl(n)&&wc(n)}function Oa(n){return fl(n)&&ta(n)}function h_(n){return!!n&&!n.isLocal}function VJ(n){return!!n&&!n.isLocal}function D1(n){return h_(n)&&wc(n)}function zJ(n){return n.isLocal}function FJ(n,e){const t=[];let r=new TextEncoder().encode(n);for(;r.length>e;){let i=e;for(;i>0;){const s=r[i];if(s!==void 0&&(s&192)!==128)break;i--}t.push(r.slice(0,i)),r=r.slice(i)}return r.length>0&&t.push(r),t}function BJ(n){var e;const t=n.get("Cache-Control");if(t){const r=(e=t.match(/(?:^|[,\s])max-age=(\d+)/))===null||e===void 0?void 0:e[1];if(r)return parseInt(r,10)}}function $J(n,e){const t=new URL(jJ(n));return e.forEach((r,i)=>{t.searchParams.set(i,r)}),_O(t,"rtc")}function qJ(n){const e=new URL(Hf(n));return _O(e,"validate")}function xO(n){return n.endsWith("/")?n:"".concat(n,"/")}function _O(n,e){return n.pathname="".concat(xO(n.pathname)).concat(e),n.toString()}function wA(n){if(typeof n=="string")return iA.fromJson(JSON.parse(n),{ignoreUnknownFields:!0});if(n instanceof ArrayBuffer)return iA.fromBinary(new Uint8Array(n));throw new Error("could not decode websocket message: ".concat(typeof n))}function HJ(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Unknown reason";if(!(n instanceof AbortSignal))return e;const t=n.reason;switch(typeof t){case"string":return t;case"object":return t instanceof Error?t.message:e;default:return"toString"in t?t.toString():e}}const GJ=10,Wh="lk_e2ee",KJ="LKFrameEncryptionKey",WJ={sharedKey:!1,ratchetSalt:KJ,ratchetWindowSize:8,failureTolerance:GJ,keyringSize:16};var dc;(function(n){n.SetKey="setKey",n.RatchetRequest="ratchetRequest",n.KeyRatcheted="keyRatcheted"})(dc||(dc={}));var EA;(function(n){n.KeyRatcheted="keyRatcheted"})(EA||(EA={}));var rc;(function(n){n.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",n.EncryptionError="encryptionError"})(rc||(rc={}));var RA;(function(n){n.Error="cryptorError"})(RA||(RA={}));function YJ(){return QJ()||f_()}function f_(){return typeof window.RTCRtpScriptTransform<"u"}function QJ(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}function XJ(n){var e,t,r,i,s;if(((e=n.value)===null||e===void 0?void 0:e.case)!=="sipDtmf"&&((t=n.value)===null||t===void 0?void 0:t.case)!=="metrics"&&((r=n.value)===null||r===void 0?void 0:r.case)!=="speaker"&&((i=n.value)===null||i===void 0?void 0:i.case)!=="transcription"&&((s=n.value)===null||s===void 0?void 0:s.case)!=="encryptedPacket")return new hD({value:n.value})}class Gre extends da.EventEmitter{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(t,r,i)=>{gt.debug("key ratcheted event received",{ratchetResult:t,participantId:r,keyIndex:i})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},WJ),e),this.on(dc.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(e,t,r){const i={key:e,participantIdentity:t,keyIndex:r};if(!this.options.sharedKey&&!t)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(t??"shared","-").concat(r??0),i),this.emit(dc.SetKey,i)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(e,t){this.emit(dc.RatchetRequest,e,t)}}var AA;(function(n){n[n.InvalidKey=0]="InvalidKey",n[n.MissingKey=1]="MissingKey",n[n.InternalError=2]="InternalError"})(AA||(AA={}));class JJ extends da.EventEmitter{constructor(e,t){super(),this.decryptDataRequests=new Map,this.encryptDataRequests=new Map,this.onWorkerMessage=r=>{var i,s;const{kind:c,data:l}=r.data;switch(c){case"error":if(gt.error(l.error.message),l.uuid){const m=this.decryptDataRequests.get(l.uuid);if(m?.reject){m.reject(l.error);break}const g=this.encryptDataRequests.get(l.uuid);if(g?.reject){g.reject(l.error);break}}this.emit(rc.EncryptionError,l.error,l.participantIdentity);break;case"initAck":l.enabled&&this.keyProvider.getKeys().forEach(m=>{this.postKey(m)});break;case"enable":if(l.enabled&&this.keyProvider.getKeys().forEach(m=>{this.postKey(m)}),this.encryptionEnabled!==l.enabled&&l.participantIdentity===((i=this.room)===null||i===void 0?void 0:i.localParticipant.identity))this.emit(rc.ParticipantEncryptionStatusChanged,l.enabled,this.room.localParticipant),this.encryptionEnabled=l.enabled;else if(l.participantIdentity){const m=(s=this.room)===null||s===void 0?void 0:s.getParticipantByIdentity(l.participantIdentity);if(!m)throw TypeError("couldn't set encryption status, participant not found".concat(l.participantIdentity));this.emit(rc.ParticipantEncryptionStatusChanged,l.enabled,m)}break;case"ratchetKey":this.keyProvider.emit(dc.KeyRatcheted,l.ratchetResult,l.participantIdentity,l.keyIndex);break;case"decryptDataResponse":const d=this.decryptDataRequests.get(l.uuid);d?.resolve&&d.resolve(l);break;case"encryptDataResponse":const h=this.encryptDataRequests.get(l.uuid);h?.resolve&&h.resolve(l);break}},this.onWorkerError=r=>{gt.error("e2ee worker encountered an error:",{error:r.error}),this.emit(rc.EncryptionError,r.error,void 0)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1,this.dataChannelEncryptionEnabled=t}get isEnabled(){return this.encryptionEnabled}get isDataChannelEncryptionEnabled(){return this.isEnabled&&this.dataChannelEncryptionEnabled}setup(e){if(!YJ())throw new CT("tried to setup end-to-end encryption on an unsupported browser");if(gt.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const t={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:GX.getLevel()}};this.worker&&(gt.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(t))}}setParticipantCryptorEnabled(e,t){gt.debug("set e2ee to ".concat(e," for participant ").concat(t)),this.postEnable(e,t)}setSifTrailer(e){!e||e.length===0?gt.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(e)}setupEngine(e){e.on(Ve.RTPVideoMapUpdate,t=>{this.postRTPMap(t)})}setupEventListeners(e,t){e.on(pe.TrackPublished,(r,i)=>this.setParticipantCryptorEnabled(r.trackInfo.encryption!==sr.NONE,i.identity)),e.on(pe.ConnectionStateChanged,r=>{r===Ht.Connected&&e.remoteParticipants.forEach(i=>{i.trackPublications.forEach(s=>{this.setParticipantCryptorEnabled(s.trackInfo.encryption!==sr.NONE,i.identity)})})}).on(pe.TrackUnsubscribed,(r,i,s)=>{var c;const l={kind:"removeTransform",data:{participantIdentity:s.identity,trackId:r.mediaStreamID}};(c=this.worker)===null||c===void 0||c.postMessage(l)}).on(pe.TrackSubscribed,(r,i,s)=>{this.setupE2EEReceiver(r,s.identity,i.trackInfo)}).on(pe.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");t.getKeys().forEach(r=>{this.postKey(r)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),e.localParticipant.on(ye.LocalSenderCreated,(r,i)=>H(this,void 0,void 0,function*(){this.setupE2EESender(i,r)})),e.localParticipant.on(ye.LocalTrackPublished,r=>{if(!wc(r.track)||!qf())return;const i={kind:"updateCodec",data:{trackId:r.track.mediaStreamID,codec:vf(r.trackInfo.codecs[0].mimeType),participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(i)}),t.on(dc.SetKey,r=>this.postKey(r)).on(dc.RatchetRequest,(r,i)=>this.postRatchetRequest(r,i))}encryptData(e){return H(this,void 0,void 0,function*(){if(!this.worker)throw Error("could not encrypt data, worker is missing");const t=crypto.randomUUID(),r={kind:"encryptDataRequest",data:{uuid:t,payload:e,participantIdentity:this.room.localParticipant.identity}},i=new Qi;return i.onFinally=()=>{this.encryptDataRequests.delete(t)},this.encryptDataRequests.set(t,i),this.worker.postMessage(r),i.promise})}handleEncryptedData(e,t,r,i){if(!this.worker)throw Error("could not handle encrypted data, worker is missing");const s=crypto.randomUUID(),c={kind:"decryptDataRequest",data:{uuid:s,payload:e,iv:t,participantIdentity:r,keyIndex:i}},l=new Qi;return l.onFinally=()=>{this.decryptDataRequests.delete(s)},this.decryptDataRequests.set(s,l),this.worker.postMessage(c),l.promise}postRatchetRequest(e,t){if(!this.worker)throw Error("could not ratchet key, worker is missing");const r={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:t}};this.worker.postMessage(r)}postKey(e){let{key:t,participantIdentity:r,keyIndex:i}=e;var s;if(!this.worker)throw Error("could not set key, worker is missing");const c={kind:"setKey",data:{participantIdentity:r,isPublisher:r===((s=this.room)===null||s===void 0?void 0:s.localParticipant.identity),key:t,keyIndex:i}};this.worker.postMessage(c)}postEnable(e,t){if(this.worker){const r={kind:"enable",data:{enabled:e,participantIdentity:t}};this.worker.postMessage(r)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(e){var t;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((t=this.room)===null||t===void 0)&&t.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const r={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(r)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const t={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(t)}setupE2EEReceiver(e,t,r){if(e.receiver){if(!r?.mimeType||r.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,t,e.kind==="video"?vf(r.mimeType):void 0)}}setupE2EESender(e,t){if(!fl(e)||!t){t||gt.warn("early return because sender is not ready");return}this.handleSender(t,e.mediaStreamID,void 0)}handleReceiver(e,t,r,i){return H(this,void 0,void 0,function*(){if(this.worker){if(f_()&&!xA()){const s={kind:"decode",participantIdentity:r,trackId:t,codec:i};e.transform=new RTCRtpScriptTransform(this.worker,s)}else{if(Wh in e&&i){const d={kind:"updateCodec",data:{trackId:t,codec:i,participantIdentity:r}};this.worker.postMessage(d);return}let s=e.writableStream,c=e.readableStream;if(!s||!c){const d=e.createEncodedStreams();e.writableStream=d.writable,s=d.writable,e.readableStream=d.readable,c=d.readable}const l={kind:"decode",data:{readableStream:c,writableStream:s,trackId:t,codec:i,participantIdentity:r,isReuse:Wh in e}};this.worker.postMessage(l,[c,s])}e[Wh]=!0}})}handleSender(e,t,r){var i;if(!(Wh in e||!this.worker)){if(!(!((i=this.room)===null||i===void 0)&&i.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(f_()&&!xA()){gt.info("initialize script transform");const s={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:t,codec:r};e.transform=new RTCRtpScriptTransform(this.worker,s)}else{gt.info("initialize encoded streams");const s=e.createEncodedStreams(),c={kind:"encode",data:{readableStream:s.readable,writableStream:s.writable,codec:r,trackId:t,participantIdentity:this.room.localParticipant.identity,isReuse:!1}};this.worker.postMessage(c,[s.readable,s.writable])}e[Wh]=!0}}}const ZJ=500,eZ=15e3;class nd{constructor(){this.failedConnectionAttempts=new Map,this.backOffPromises=new Map}static getInstance(){return this._instance||(this._instance=new nd),this._instance}addFailedConnectionAttempt(e){var t;const r=new URL(e),i=N1(r);if(!i)return;let s=(t=this.failedConnectionAttempts.get(i))!==null&&t!==void 0?t:0;this.failedConnectionAttempts.set(i,s+1),this.backOffPromises.set(i,Er(Math.min(ZJ*Math.pow(2,s),eZ)))}getBackOffPromise(e){const t=new URL(e),r=t&&N1(t);return r&&this.backOffPromises.get(r)||Promise.resolve()}resetFailedConnectionAttempts(e){const t=new URL(e),r=t&&N1(t);r&&(this.failedConnectionAttempts.set(r,0),this.backOffPromises.set(r,Promise.resolve()))}resetAll(){this.backOffPromises.clear(),this.failedConnectionAttempts.clear()}}nd._instance=null;const O1="default";class fr{constructor(){this._previousDevices=[]}static getInstance(){return this.instance===void 0&&(this.instance=new fr),this.instance}get previousDevices(){return this._previousDevices}getDevices(e){return H(this,arguments,void 0,function(t){var r=this;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var s;if(((s=fr.userMediaPromiseMap)===null||s===void 0?void 0:s.size)>0){gt.debug("awaiting getUserMedia promise");try{t?yield fr.userMediaPromiseMap.get(t):yield Promise.all(fr.userMediaPromiseMap.values())}catch{gt.warn("error waiting for media permissons")}}let c=yield navigator.mediaDevices.enumerateDevices();if(i&&!(wl()&&r.hasDeviceInUse(t))&&(c.filter(d=>d.kind===t).length===0||c.some(d=>{const h=d.label==="",m=t?d.kind===t:!0;return h&&m}))){const d={video:t!=="audioinput"&&t!=="audiooutput",audio:t!=="videoinput"&&{deviceId:{ideal:"default"}}},h=yield navigator.mediaDevices.getUserMedia(d);c=yield navigator.mediaDevices.enumerateDevices(),h.getTracks().forEach(m=>{m.stop()})}return r._previousDevices=c,t&&(c=c.filter(l=>l.kind===t)),c})()})}normalizeDeviceId(e,t,r){return H(this,void 0,void 0,function*(){if(t!==O1)return t;const i=yield this.getDevices(e),s=i.find(l=>l.deviceId===O1);if(!s){gt.warn("could not reliably determine default device");return}const c=i.find(l=>l.deviceId!==O1&&l.groupId===(r??s.groupId));if(!c){gt.warn("could not reliably determine default device");return}return c?.deviceId})}hasDeviceInUse(e){return e?fr.userMediaPromiseMap.has(e):fr.userMediaPromiseMap.size>0}}fr.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];fr.userMediaPromiseMap=new Map;var yf;(function(n){n[n.WAITING=0]="WAITING",n[n.RUNNING=1]="RUNNING",n[n.COMPLETED=2]="COMPLETED"})(yf||(yf={}));class tZ{constructor(){this.pendingTasks=new Map,this.taskMutex=new Hr,this.nextTaskIndex=0}run(e){return H(this,void 0,void 0,function*(){const t={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:yf.WAITING};this.pendingTasks.set(t.id,t);const r=yield this.taskMutex.lock();try{return t.executedAt=Date.now(),t.status=yf.RUNNING,yield e()}finally{t.status=yf.COMPLETED,this.pendingTasks.delete(t.id),r()}})}flush(){return H(this,void 0,void 0,function*(){return this.run(()=>H(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}class nZ{get readyState(){return this.ws.readyState}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var r,i;if(!((r=t.signal)===null||r===void 0)&&r.aborted)throw new DOMException("This operation was aborted","AbortError");this.url=e;const s=new WebSocket(e,(i=t.protocols)!==null&&i!==void 0?i:[]);s.binaryType="arraybuffer",this.ws=s;const c=function(){let{closeCode:l,reason:d}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return s.close(l,d)};this.opened=new Promise((l,d)=>{s.onopen=()=>{l({readable:new ReadableStream({start(h){s.onmessage=m=>{let{data:g}=m;return h.enqueue(g)},s.onerror=m=>h.error(m)},cancel:c}),writable:new WritableStream({write(h){s.send(h)},abort(){s.close()},close:c}),protocol:s.protocol,extensions:s.extensions}),s.removeEventListener("error",d)},s.addEventListener("error",d)}),this.closed=new Promise((l,d)=>{const h=()=>H(this,void 0,void 0,function*(){const m=new Promise(b=>{s.readyState!==WebSocket.CLOSED&&s.addEventListener("close",_=>{b(_)},{once:!0})}),g=yield Promise.race([Er(250),m]);g?l(g):d(new Error("Encountered unspecified websocket error without a timely close event"))});s.onclose=m=>{let{code:g,reason:b}=m;l({closeCode:g,reason:b}),s.removeEventListener("error",h)},s.addEventListener("error",h)}),t.signal&&(t.signal.onabort=()=>s.close()),this.close=c}}const rZ=["syncState","trickle","offer","answer","simulate","leave"];function iZ(n){const e=rZ.indexOf(n.case)>=0;return gt.trace("request allowed to bypass queue:",{canPass:e,req:n}),e}var on;(function(n){n[n.CONNECTING=0]="CONNECTING",n[n.CONNECTED=1]="CONNECTED",n[n.RECONNECTING=2]="RECONNECTING",n[n.DISCONNECTING=3]="DISCONNECTING",n[n.DISCONNECTED=4]="DISCONNECTED"})(on||(on={}));const sZ=250;class RT{get currentState(){return this.state}get isDisconnected(){return this.state===on.DISCONNECTING||this.state===on.DISCONNECTED}get isEstablishingConnection(){return this.state===on.CONNECTING||this.state===on.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var r;this.rtt=0,this.state=on.DISCONNECTED,this.log=gt,this._requestId=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0,this.onMediaSectionsRequirement=void 0},this.log=eo((r=t.loggerName)!==null&&r!==void 0?r:_s.Signal),this.loggerContextCb=t.loggerContextCb,this.useJSON=e,this.requestQueue=new tZ,this.queuedRequests=[],this.closingLock=new Hr,this.connectionLock=new Hr,this.state=on.DISCONNECTED}get logContext(){var e,t;return(t=(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this))!==null&&t!==void 0?t:{}}join(e,t,r,i){return H(this,void 0,void 0,function*(){return this.state=on.CONNECTING,this.options=r,yield this.connect(e,t,r,i)})}reconnect(e,t,r,i){return H(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=on.RECONNECTING,this.clearPingInterval(),yield this.connect(e,t,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:r,reconnectReason:i}))})}connect(e,t,r,i){return H(this,void 0,void 0,function*(){const s=yield this.connectionLock.lock();this.connectOptions=r;const c=DJ(),l=r.singlePeerConnection?oZ(t,c,r):aZ(t,c,r),d=$J(e,l),h=qJ(d);return new Promise((m,g)=>H(this,void 0,void 0,function*(){var b,_;try{let R=!1;const E=C=>H(this,void 0,void 0,function*(){if(R)return;R=!0;const N=C instanceof Event?C.currentTarget:C,D=HJ(N,"Abort handler called");this.streamWriter&&!this.isDisconnected?this.sendLeave().then(()=>this.close(D)).catch(S=>{this.log.error(S),this.close()}):this.close(),A(),g(dt.cancelled(D))});i?.addEventListener("abort",E);const A=()=>{clearTimeout(M),i?.removeEventListener("abort",E)},M=setTimeout(()=>{E(dt.timeout("room connection has timed out (signal)"))},r.websocketTimeout),F=(C,N)=>{this.handleSignalConnected(C,M,N)},j=new URL(d);j.searchParams.has("access_token")&&j.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(j),Object.assign({reconnect:r.reconnect,reconnectReason:r.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new nZ(d);try{this.ws.closed.then(L=>{var U;this.isEstablishingConnection&&g(dt.internal("Websocket got closed during a (re)connection attempt: ".concat(L.reason))),L.closeCode!==1e3&&(this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:L.reason,code:L.closeCode,wasClean:L.closeCode===1e3,state:this.state})),this.state===on.CONNECTED&&this.handleOnClose((U=L.reason)!==null&&U!==void 0?U:"Unexpected WS error"))}).catch(L=>{this.isEstablishingConnection&&g(dt.internal("Websocket error during a (re)connection attempt: ".concat(L)))});const C=yield this.ws.opened.catch(L=>H(this,void 0,void 0,function*(){if(this.state!==on.CONNECTED){this.state=on.DISCONNECTED,clearTimeout(M);const U=yield this.handleConnectionError(L,h);g(U);return}this.handleWSError(L),g(L)}));if(clearTimeout(M),!C)return;const N=C.readable.getReader();this.streamWriter=C.writable.getWriter();const D=yield N.read();if(N.releaseLock(),!D.value)throw dt.internal("no message received as first message");const S=wA(D.value),k=this.validateFirstMessage(S,(b=r.reconnect)!==null&&b!==void 0?b:!1);if(!k.isValid){g(k.error);return}((_=S.message)===null||_===void 0?void 0:_.case)==="join"&&(this.pingTimeoutDuration=S.message.value.pingTimeout,this.pingIntervalDuration=S.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})));const P=k.shouldProcessFirstMessage?S:void 0;F(C,P),m(k.response)}catch(C){g(C)}finally{A()}}finally{s()}}))})}startReadingLoop(e,t){return H(this,void 0,void 0,function*(){for(t&&this.handleSignalResponse(t);;){this.signalLatency&&(yield Er(this.signalLatency));const{done:r,value:i}=yield e.read();if(r)break;const s=wA(i);this.handleSignalResponse(s)}})}close(){return H(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Close method called on signal client";return(function*(){if([on.DISCONNECTING||on.DISCONNECTED].includes(e.state)){e.log.debug("ignoring signal close as it's already in disconnecting state");return}const i=yield e.closingLock.lock();try{if(e.clearPingInterval(),t&&(e.state=on.DISCONNECTING),e.ws){e.ws.close({closeCode:1e3,reason:r});const s=e.ws.closed;e.ws=void 0,e.streamWriter=void 0,yield Promise.race([s,Er(sZ)])}}catch(s){e.log.debug("websocket error while closing",Object.assign(Object.assign({},e.logContext),{error:s}))}finally{t&&(e.state=on.DISCONNECTED),i()}})()})}sendOffer(e,t){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:Bu(e,t)})}sendAnswer(e,t){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:Bu(e,t)})}sendIceCandidate(e,t){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new D0({candidateInit:JSON.stringify(e),target:t})})}sendMuteTrack(e,t){return this.sendRequest({case:"mute",value:new O0({sid:e,muted:t})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,t){return H(this,arguments,void 0,function(r,i){var s=this;let c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return(function*(){const l=s.getNextRequestId();return yield s.sendRequest({case:"updateMetadata",value:new xT({requestId:l,metadata:r,name:i,attributes:c})}),l})()})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,t){return this.sendRequest({case:"updateLayers",value:new ED({trackSid:e,layers:t})})}sendUpdateSubscriptionPermissions(e,t){return this.sendRequest({case:"subscriptionPermission",value:new ND({allParticipants:e,trackPermissions:t})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:xn.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new MD({timestamp:xn.parse(Date.now()),rtt:xn.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,t){return this.sendRequest({case:"updateAudioTrack",value:new bT({trackSid:e,features:t})})}sendLeave(){return this.sendRequest({case:"leave",value:new L0({reason:vs.CLIENT_INITIATED,action:Zu.DISCONNECT})})}sendRequest(e){return H(this,arguments,void 0,function(t){var r=this;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return(function*(){if(!i&&!iZ(t)&&r.state===on.RECONNECTING){r.queuedRequests.push(()=>H(r,void 0,void 0,function*(){yield this.sendRequest(t,!0)}));return}if(i||(yield r.requestQueue.flush()),r.signalLatency&&(yield Er(r.signalLatency)),r.isDisconnected){r.log.debug("skipping signal request (type: ".concat(t.case,") - SignalClient disconnected"));return}if(!r.streamWriter){r.log.error("cannot send signal request before connected, type: ".concat(t?.case),r.logContext);return}const c=new vX({message:t});try{r.useJSON?yield r.streamWriter.write(c.toJsonString()):yield r.streamWriter.write(c.toBinary())}catch(l){r.log.error("error sending signal message",Object.assign(Object.assign({},r.logContext),{error:l}))}})()})}handleSignalResponse(e){var t,r;const i=e.message;if(i==null){this.log.debug("received unsupported message",this.logContext);return}let s=!1;if(i.case==="answer"){const c=NA(i.value);this.onAnswer&&this.onAnswer(c,i.value.id,i.value.midToTrackId)}else if(i.case==="offer"){const c=NA(i.value);this.onOffer&&this.onOffer(c,i.value.id,i.value.midToTrackId)}else if(i.case==="trickle"){const c=JSON.parse(i.value.candidateInit);this.onTrickle&&this.onTrickle(c,i.value.target)}else i.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((t=i.value.participants)!==null&&t!==void 0?t:[]):i.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(i.value):i.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((r=i.value.speakers)!==null&&r!==void 0?r:[]):i.case==="leave"?this.onLeave&&this.onLeave(i.value):i.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(i.value.sid,i.value.muted):i.case==="roomUpdate"?this.onRoomUpdate&&i.value.room&&this.onRoomUpdate(i.value.room):i.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(i.value):i.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(i.value):i.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(i.value):i.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(i.value):i.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(i.value):i.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(i.value):i.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(i.value):i.case==="pong"||(i.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(i.value.lastPingTimestamp.toString()),this.resetPingTimeout(),s=!0):i.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(i.value):i.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(i.value.trackSid):i.case==="roomMoved"?(this.onTokenRefresh&&this.onTokenRefresh(i.value.token),this.onRoomMoved&&this.onRoomMoved(i.value)):i.case==="mediaSectionsRequirement"?this.onMediaSectionsRequirement&&this.onMediaSectionsRequirement(i.value):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:i.case})));s||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return H(this,void 0,void 0,function*(){if(this.state===on.DISCONNECTED)return;const t=this.onClose;yield this.close(void 0,e),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),t&&t(e)})}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=wr.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&wr.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=wr.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&wr.clearInterval(this.pingInterval)}handleSignalConnected(e,t,r){this.state=on.CONNECTED,clearTimeout(t),this.startPingInterval(),this.startReadingLoop(e.readable.getReader(),r)}validateFirstMessage(e,t){var r,i,s,c,l;return((r=e.message)===null||r===void 0?void 0:r.case)==="join"?{isValid:!0,response:e.message.value}:this.state===on.RECONNECTING&&((i=e.message)===null||i===void 0?void 0:i.case)!=="leave"?((s=e.message)===null||s===void 0?void 0:s.case)==="reconnect"?{isValid:!0,response:e.message.value}:(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),{isValid:!0,response:void 0,shouldProcessFirstMessage:!0}):this.isEstablishingConnection&&((c=e.message)===null||c===void 0?void 0:c.case)==="leave"?{isValid:!1,error:dt.leaveRequest("Received leave request while trying to (re)connect",e.message.value.reason)}:t?{isValid:!1,error:dt.internal("Unexpected first message")}:{isValid:!1,error:dt.internal("did not receive join response, got ".concat((l=e.message)===null||l===void 0?void 0:l.case," instead"))}}handleConnectionError(e,t){return H(this,void 0,void 0,function*(){try{const r=yield fetch(t);if(r.status.toFixed(0).startsWith("4")){const i=yield r.text();return dt.notAllowed(i,r.status)}else return e instanceof dt?e:dt.internal("Encountered unknown websocket error during connection: ".concat(e),{status:r.status,statusText:r.statusText})}catch(r){return r instanceof dt?r:dt.serverUnreachable(r instanceof Error?r.message:"server was not reachable")}})}}function NA(n){const e={type:"offer",sdp:n.sdp};switch(n.type){case"answer":case"offer":case"pranswer":case"rollback":e.type=n.type;break}return e}function Bu(n,e){return new _c({sdp:n.sdp,type:n.type,id:e})}function aZ(n,e,t){var r;const i=new URLSearchParams;return i.set("access_token",n),t.reconnect&&(i.set("reconnect","1"),t.sid&&i.set("sid",t.sid)),i.set("auto_subscribe",t.autoSubscribe?"1":"0"),i.set("sdk",sa()?"reactnative":"js"),i.set("version",e.version),i.set("protocol",e.protocol.toString()),e.deviceModel&&i.set("device_model",e.deviceModel),e.os&&i.set("os",e.os),e.osVersion&&i.set("os_version",e.osVersion),e.browser&&i.set("browser",e.browser),e.browserVersion&&i.set("browser_version",e.browserVersion),t.adaptiveStream&&i.set("adaptive_stream","1"),t.reconnectReason&&i.set("reconnect_reason",t.reconnectReason.toString()),!((r=navigator.connection)===null||r===void 0)&&r.type&&i.set("network",navigator.connection.type),i}function oZ(n,e,t){const r=new URLSearchParams;r.set("access_token",n);const i=new VX({clientInfo:e,connectionSettings:new DD({autoSubscribe:!!t.autoSubscribe,adaptiveStream:!!t.adaptiveStream}),reconnect:!!t.reconnect,participantSid:t.sid?t.sid:void 0});t.reconnectReason&&(i.reconnectReason=t.reconnectReason);const s=new zX({joinRequest:i.toBinary()});return r.set("join_request",btoa(new TextDecoder("utf-8").decode(s.toBinary()))),r}class IA{constructor(){this.buffer=[],this._totalSize=0}push(e){this.buffer.push(e),this._totalSize+=e.data.byteLength}pop(){const e=this.buffer.shift();return e&&(this._totalSize-=e.data.byteLength),e}getAll(){return this.buffer.slice()}popToSequence(e){for(;this.buffer.length>0&&this.buffer[0].sequence<=e;)this.pop()}alignBufferedAmount(e){for(;this.buffer.length>0;){const t=this.buffer[0];if(this._totalSize-t.data.byteLength<=e)break;this.pop()}}get length(){return this.buffer.length}}class cZ{constructor(e){this._map=new Map,this._lastCleanup=0,this.ttl=e}set(e,t){const r=Date.now();r-this._lastCleanup>this.ttl/2&&this.cleanup();const i=r+this.ttl;return this._map.set(e,{value:t,expiresAt:i}),this}get(e){const t=this._map.get(e);if(t){if(t.expiresAt<Date.now()){this._map.delete(e);return}return t.value}}has(e){const t=this._map.get(e);return t?t.expiresAt<Date.now()?(this._map.delete(e),!1):!0:!1}delete(e){return this._map.delete(e)}clear(){this._map.clear()}cleanup(){const e=Date.now();for(const[t,r]of this._map.entries())r.expiresAt<e&&this._map.delete(t);this._lastCleanup=e}get size(){return this.cleanup(),this._map.size}forEach(e){this.cleanup();for(const[t,r]of this._map.entries())r.expiresAt>=Date.now()&&e(r.value,t,this.asValueMap())}map(e){this.cleanup();const t=[],r=this.asValueMap();for(const[i,s]of r.entries())t.push(e(s,i,r));return t}asValueMap(){const e=new Map;for(const[t,r]of this._map.entries())r.expiresAt>=Date.now()&&e.set(t,r.value);return e}}var cs={},j1={},L1={exports:{}},PA;function AT(){if(PA)return L1.exports;PA=1;var n=L1.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=e.raddr!=null?" raddr %s rport %d":"%v%v",t+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(t+=" generation %d"),t+=e["network-id"]!=null?" network-id %d":"%v",t+=e["network-cost"]!=null?" network-cost %d":"%v",t}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return e.attribute!=null&&(t+=" %s",e.value!=null&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=e.id!=null?"id=%s %s":"%v%s",t+=e.mediaClockValue!=null?"=%s":"",t+=e.rateNumerator!=null?" rate=%s":"",t+=e.rateDenominator!=null?"/%s":"",t}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(n).forEach(function(e){var t=n[e];t.forEach(function(r){r.reg||(r.reg=/(.*)/),r.format||(r.format="%s")})}),L1.exports}var MA;function lZ(){return MA||(MA=1,(function(n){var e=function(l){return String(Number(l))===l?Number(l):l},t=function(l,d,h,m){if(m&&!h)d[m]=e(l[1]);else for(var g=0;g<h.length;g+=1)l[g+1]!=null&&(d[h[g]]=e(l[g+1]))},r=function(l,d,h){var m=l.name&&l.names;l.push&&!d[l.push]?d[l.push]=[]:m&&!d[l.name]&&(d[l.name]={});var g=l.push?{}:m?d[l.name]:d;t(h.match(l.reg),g,l.names,l.name),l.push&&d[l.push].push(g)},i=AT(),s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);n.parse=function(l){var d={},h=[],m=d;return l.split(/(\r\n|\r|\n)/).filter(s).forEach(function(g){var b=g[0],_=g.slice(2);b==="m"&&(h.push({rtp:[],fmtp:[]}),m=h[h.length-1]);for(var R=0;R<(i[b]||[]).length;R+=1){var E=i[b][R];if(E.reg.test(_))return r(E,m,_)}}),d.media=h,d};var c=function(l,d){var h=d.split(/=(.+)/,2);return h.length===2?l[h[0]]=e(h[1]):h.length===1&&d.length>1&&(l[h[0]]=void 0),l};n.parseParams=function(l){return l.split(/;\s?/).reduce(c,{})},n.parseFmtpConfig=n.parseParams,n.parsePayloads=function(l){return l.toString().split(" ").map(Number)},n.parseRemoteCandidates=function(l){for(var d=[],h=l.split(" ").map(e),m=0;m<h.length;m+=3)d.push({component:h[m],ip:h[m+1],port:h[m+2]});return d},n.parseImageAttributes=function(l){return l.split(" ").map(function(d){return d.substring(1,d.length-1).split(",").reduce(c,{})})},n.parseSimulcastStreamList=function(l){return l.split(";").map(function(d){return d.split(",").map(function(h){var m,g=!1;return h[0]!=="~"?m=e(h):(m=e(h.substring(1,h.length)),g=!0),{scid:m,paused:g}})})}})(j1)),j1}var U1,DA;function uZ(){if(DA)return U1;DA=1;var n=AT(),e=/%[sdv%]/g,t=function(c){var l=1,d=arguments,h=d.length;return c.replace(e,function(m){if(l>=h)return m;var g=d[l];switch(l+=1,m){case"%%":return"%";case"%s":return String(g);case"%d":return Number(g);case"%v":return""}})},r=function(c,l,d){var h=l.format instanceof Function?l.format(l.push?d:d[l.name]):l.format,m=[c+"="+h];if(l.names)for(var g=0;g<l.names.length;g+=1){var b=l.names[g];l.name?m.push(d[l.name][b]):m.push(d[l.names[g]])}else m.push(d[l.name]);return t.apply(null,m)},i=["v","o","s","i","u","e","p","c","b","t","r","z","a"],s=["i","c","b","a"];return U1=function(c,l){l=l||{},c.version==null&&(c.version=0),c.name==null&&(c.name=" "),c.media.forEach(function(g){g.payloads==null&&(g.payloads="")});var d=l.outerOrder||i,h=l.innerOrder||s,m=[];return d.forEach(function(g){n[g].forEach(function(b){b.name in c&&c[b.name]!=null?m.push(r(g,b,c)):b.push in c&&c[b.push]!=null&&c[b.push].forEach(function(_){m.push(r(g,b,_))})})}),c.media.forEach(function(g){m.push(r("m",n.m[0],g)),h.forEach(function(b){n[b].forEach(function(_){_.name in g&&g[_.name]!=null?m.push(r(b,_,g)):_.push in g&&g[_.push]!=null&&g[_.push].forEach(function(R){m.push(r(b,_,R))})})})}),m.join(`\r
`)+`\r
`},U1}var OA;function dZ(){if(OA)return cs;OA=1;var n=lZ(),e=uZ(),t=AT();return cs.grammar=t,cs.write=e,cs.parse=n.parse,cs.parseParams=n.parseParams,cs.parseFmtpConfig=n.parseFmtpConfig,cs.parsePayloads=n.parsePayloads,cs.parseRemoteCandidates=n.parseRemoteCandidates,cs.parseImageAttributes=n.parseImageAttributes,cs.parseSimulcastStreamList=n.parseSimulcastStreamList,cs}var Wo=dZ();function NT(n,e,t){var r,i,s;e===void 0&&(e=50),t===void 0&&(t={});var c=(r=t.isImmediate)!=null&&r,l=(i=t.callback)!=null&&i,d=t.maxWait,h=Date.now(),m=[];function g(){if(d!==void 0){var _=Date.now()-h;if(_+e>=d)return d-_}return e}var b=function(){var _=[].slice.call(arguments),R=this;return new Promise(function(E,A){var M=c&&s===void 0;if(s!==void 0&&clearTimeout(s),s=setTimeout(function(){if(s=void 0,h=Date.now(),!c){var j=n.apply(R,_);l&&l(j),m.forEach(function(C){return(0,C.resolve)(j)}),m=[]}},g()),M){var F=n.apply(R,_);return l&&l(F),E(F)}m.push({resolve:E,reject:A})})};return b.cancel=function(_){s!==void 0&&clearTimeout(s),m.forEach(function(R){return(0,R.reject)(_)}),m=[]},b}const hZ=.7,fZ=20,rd={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class jA extends da.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var r;super(),this.log=gt,this.ddExtID=0,this.latestOfferId=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=NT(i=>H(this,void 0,void 0,function*(){this.emit(rd.NegotiationStarted);try{yield this.createAndSendOffer()}catch(s){if(i)i(s);else throw s}}),fZ),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=eo((r=t.loggerName)!==null&&r!==void 0?r:_s.PCTransport),this.loggerOptions=t,this.config=e,this._pc=this.createPC(),this.offerLock=new Hr}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=t=>{var r;t.candidate&&((r=this.onIceCandidate)===null||r===void 0||r.call(this,t.candidate))},e.onicecandidateerror=t=>{var r;(r=this.onIceCandidateError)===null||r===void 0||r.call(this,t)},e.oniceconnectionstatechange=()=>{var t;(t=this.onIceConnectionStateChange)===null||t===void 0||t.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var t;(t=this.onSignalingStatechange)===null||t===void 0||t.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,e.connectionState)},e.ondatachannel=t=>{var r;(r=this.onDataChannel)===null||r===void 0||r.call(this,t)},e.ontrack=t=>{var r;(r=this.onTrack)===null||r===void 0||r.call(this,t)},e}get logContext(){var e,t;return Object.assign({},(t=(e=this.loggerOptions).loggerContextCb)===null||t===void 0?void 0:t.call(e))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(e){return H(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)})}setRemoteDescription(e,t){return H(this,void 0,void 0,function*(){var r;if(e.type==="answer"&&this.latestOfferId>0&&t>0&&t!==this.latestOfferId)return this.log.warn("ignoring answer for old offer",Object.assign(Object.assign({},this.logContext),{offerId:t,latestOfferId:this.latestOfferId})),!1;let i;if(e.type==="offer"){let{stereoMids:s,nackMids:c}=pZ(e);this.remoteStereoMids=s,this.remoteNackMids=c}else if(e.type==="answer"){const s=Wo.parse((r=e.sdp)!==null&&r!==void 0?r:"");s.media.forEach(c=>{const l=IT(c.mid);c.type==="audio"&&this.trackBitrates.some(d=>{if(!d.transceiver||l!=d.transceiver.mid)return!1;let h=0;if(c.rtp.some(g=>g.codec.toUpperCase()===d.codec.toUpperCase()?(h=g.payload,!0):!1),h===0)return!0;let m=!1;for(const g of c.fmtp)if(g.payload===h){g.config=g.config.split(";").filter(b=>!b.includes("maxaveragebitrate")).join(";"),d.maxbr>0&&(g.config+=";maxaveragebitrate=".concat(d.maxbr*1e3)),m=!0;break}return m||d.maxbr>0&&c.fmtp.push({payload:h,config:"maxaveragebitrate=".concat(d.maxbr*1e3)}),!0})}),i=Wo.write(s)}return yield this.setMungedSDP(e,i,!0),this.pendingCandidates.forEach(s=>{this.pc.addIceCandidate(s)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):e.type==="answer"&&(this.emit(rd.NegotiationComplete),e.sdp&&Wo.parse(e.sdp).media.forEach(c=>{c.type==="video"&&this.emit(rd.RTPVideoPayloadTypes,c.rtp)})),!0})}createAndSendOffer(e){return H(this,void 0,void 0,function*(){var t;const r=yield this.offerLock.lock();try{if(this.onOffer===void 0)return;if(e?.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const l=this._pc.remoteDescription;if(e?.iceRestart&&l)yield this._pc.setRemoteDescription(l);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const i=this.latestOfferId+1;this.latestOfferId=i;const s=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:s.sdp},this.logContext));const c=Wo.parse((t=s.sdp)!==null&&t!==void 0?t:"");if(c.media.forEach(l=>{UA(l),l.type==="audio"?LA(l,["all"],[]):l.type==="video"&&this.trackBitrates.some(d=>{if(!l.msid||!d.cid||!l.msid.includes(d.cid))return!1;let h=0;if(l.rtp.some(g=>g.codec.toUpperCase()===d.codec.toUpperCase()?(h=g.payload,!0):!1),h===0||(fs(d.codec)&&!wl()&&this.ensureVideoDDExtensionForSVC(l,c),!fs(d.codec)))return!0;const m=Math.round(d.maxbr*hZ);for(const g of l.fmtp)if(g.payload===h){g.config.includes("x-google-start-bitrate")||(g.config+=";x-google-start-bitrate=".concat(m));break}return!0})}),this.latestOfferId>i){this.log.warn("latestOfferId mismatch",Object.assign(Object.assign({},this.logContext),{latestOfferId:this.latestOfferId,offerId:i}));return}yield this.setMungedSDP(s,Wo.write(c)),this.onOffer(s,this.latestOfferId)}finally{r()}})}createAndSetAnswer(){return H(this,void 0,void 0,function*(){var e;const t=yield this.pc.createAnswer(),r=Wo.parse((e=t.sdp)!==null&&e!==void 0?e:"");return r.media.forEach(i=>{UA(i),i.type==="audio"&&LA(i,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(t,Wo.write(r)),t})}createDataChannel(e,t){return this.pc.createDataChannel(e,t)}addTransceiver(e,t){return this.pc.addTransceiver(e,t)}addTransceiverOfKind(e,t){return this.pc.addTransceiver(e,t)}addTrack(e){if(!this._pc)throw new ir("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var t;if(!this._pc)throw new ir("PC closed, cannot configure");return(t=this._pc)===null||t===void 0?void 0:t.setConfiguration(e)}canRemoveTrack(){var e;return!!(!((e=this._pc)===null||e===void 0)&&e.removeTrack)}removeTrack(e){var t;return(t=this._pc)===null||t===void 0?void 0:t.removeTrack(e)}getConnectionState(){var e,t;return(t=(e=this._pc)===null||e===void 0?void 0:e.connectionState)!==null&&t!==void 0?t:"closed"}getICEConnectionState(){var e,t;return(t=(e=this._pc)===null||e===void 0?void 0:e.iceConnectionState)!==null&&t!==void 0?t:"closed"}getSignallingState(){var e,t;return(t=(e=this._pc)===null||e===void 0?void 0:e.signalingState)!==null&&t!==void 0?t:"closed"}getTransceivers(){var e,t;return(t=(e=this._pc)===null||e===void 0?void 0:e.getTransceivers())!==null&&t!==void 0?t:[]}getSenders(){var e,t;return(t=(e=this._pc)===null||e===void 0?void 0:e.getSenders())!==null&&t!==void 0?t:[]}getLocalDescription(){var e;return(e=this._pc)===null||e===void 0?void 0:e.localDescription}getRemoteDescription(){var e;return(e=this.pc)===null||e===void 0?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return H(this,void 0,void 0,function*(){var e;if(!this._pc)return;let t="";const r=new Map,i=new Map;if((yield this._pc.getStats()).forEach(l=>{switch(l.type){case"transport":t=l.selectedCandidatePairId;break;case"candidate-pair":t===""&&l.selected&&(t=l.id),r.set(l.id,l);break;case"remote-candidate":i.set(l.id,"".concat(l.address,":").concat(l.port));break}}),t==="")return;const c=(e=r.get(t))===null||e===void 0?void 0:e.remoteCandidateId;if(c!==void 0)return i.get(c)})}setMungedSDP(e,t,r){return H(this,void 0,void 0,function*(){if(t){const i=e.sdp;e.sdp=t;try{this.log.debug("setting munged ".concat(r?"remote":"local"," description"),this.logContext),r?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e);return}catch(s){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:s,sdp:t})),e.sdp=i}}try{r?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(i){let s="unknown error";i instanceof Error?s=i.message:typeof i=="string"&&(s=i);const c={error:s,sdp:e.sdp};throw!r&&this.pc.remoteDescription&&(c.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:c})),new i_(s)}})}ensureVideoDDExtensionForSVC(e,t){var r,i;if(!((r=e.ext)===null||r===void 0?void 0:r.some(c=>c.uri===bA))){if(this.ddExtID===0){let c=0;t.media.forEach(l=>{var d;l.type==="video"&&((d=l.ext)===null||d===void 0||d.forEach(h=>{h.value>c&&(c=h.value)}))}),this.ddExtID=c+1}(i=e.ext)===null||i===void 0||i.push({value:this.ddExtID,uri:bA})}}}function LA(n,e,t){const r=IT(n.mid);let i=0;n.rtp.some(s=>s.codec==="opus"?(i=s.payload,!0):!1),i>0&&(n.rtcpFb||(n.rtcpFb=[]),t.includes(r)&&!n.rtcpFb.some(s=>s.payload===i&&s.type==="nack")&&n.rtcpFb.push({payload:i,type:"nack"}),(e.includes(r)||e.length===1&&e[0]==="all")&&n.fmtp.some(s=>s.payload===i?(s.config.includes("stereo=1")||(s.config+=";stereo=1"),!0):!1))}function pZ(n){var e;const t=[],r=[],i=Wo.parse((e=n.sdp)!==null&&e!==void 0?e:"");let s=0;return i.media.forEach(c=>{var l;const d=IT(c.mid);c.type==="audio"&&(c.rtp.some(h=>h.codec==="opus"?(s=h.payload,!0):!1),!((l=c.rtcpFb)===null||l===void 0)&&l.some(h=>h.payload===s&&h.type==="nack")&&r.push(d),c.fmtp.some(h=>h.payload===s?(h.config.includes("sprop-stereo=1")&&t.push(d),!0):!1))}),{stereoMids:t,nackMids:r}}function UA(n){if(n.connection){const e=n.connection.ip.indexOf(":")>=0;(n.connection.version===4&&e||n.connection.version===6&&!e)&&(n.connection.ip="0.0.0.0",n.connection.version=4)}}function IT(n){return typeof n=="number"?n.toFixed(0):n}const p_="vp8",mZ={audioPreset:s_.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:wT.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:p_,backupCodec:!0,preConnectBuffer:!1},SO={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},TO={deviceId:{ideal:"default"},resolution:$f.h720.resolution},gZ={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new WX,disconnectOnPageLeave:!0,webAudioMix:!1,singlePeerConnection:!1},PT={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var En;(function(n){n[n.NEW=0]="NEW",n[n.CONNECTING=1]="CONNECTING",n[n.CONNECTED=2]="CONNECTED",n[n.FAILED=3]="FAILED",n[n.CLOSING=4]="CLOSING",n[n.CLOSED=5]="CLOSED"})(En||(En={}));class vZ{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(e,t,r){var i;this.peerConnectionTimeout=PT.peerConnectionTimeout,this.log=gt,this.updateState=()=>{var s,c;const l=this.state,d=this.requiredTransports.map(h=>h.getConnectionState());d.every(h=>h==="connected")?this.state=En.CONNECTED:d.some(h=>h==="failed")?this.state=En.FAILED:d.some(h=>h==="connecting")?this.state=En.CONNECTING:d.every(h=>h==="closed")?this.state=En.CLOSED:d.some(h=>h==="closed")?this.state=En.CLOSING:d.every(h=>h==="new")&&(this.state=En.NEW),l!==this.state&&(this.log.debug("pc state change: from ".concat(En[l]," to ").concat(En[this.state]),this.logContext),(s=this.onStateChange)===null||s===void 0||s.call(this,this.state,this.publisher.getConnectionState(),(c=this.subscriber)===null||c===void 0?void 0:c.getConnectionState()))},this.log=eo((i=r.loggerName)!==null&&i!==void 0?i:_s.PCManager),this.loggerOptions=r,this.isPublisherConnectionRequired=t!=="subscriber-primary",this.isSubscriberConnectionRequired=t==="subscriber-primary",this.publisher=new jA(e,r),t!=="publisher-only"&&(this.subscriber=new jA(e,r),this.subscriber.onConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.subscriber.onIceCandidate=s=>{var c;(c=this.onIceCandidate)===null||c===void 0||c.call(this,s,hs.SUBSCRIBER)},this.subscriber.onDataChannel=s=>{var c;(c=this.onDataChannel)===null||c===void 0||c.call(this,s)},this.subscriber.onTrack=s=>{var c;(c=this.onTrack)===null||c===void 0||c.call(this,s)}),this.publisher.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=s=>{var c;(c=this.onIceCandidate)===null||c===void 0||c.call(this,s,hs.PUBLISHER)},this.publisher.onTrack=s=>{var c;(c=this.onTrack)===null||c===void 0||c.call(this,s)},this.publisher.onOffer=(s,c)=>{var l;(l=this.onPublisherOffer)===null||l===void 0||l.call(this,s,c)},this.state=En.NEW,this.connectionLock=new Hr,this.remoteOfferLock=new Hr}get logContext(){var e,t;return Object.assign({},(t=(e=this.loggerOptions).loggerContextCb)===null||t===void 0?void 0:t.call(e))}requirePublisher(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e,t){return this.publisher.setRemoteDescription(e,t)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return H(this,void 0,void 0,function*(){var e;if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const t=this.publisher;for(const r of t.getSenders())try{t.canRemoveTrack()&&t.removeTrack(r)}catch(i){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:i}))}}yield Promise.all([this.publisher.close(),(e=this.subscriber)===null||e===void 0?void 0:e.close()]),this.updateState()})}triggerIceRestart(){return H(this,void 0,void 0,function*(){this.subscriber&&(this.subscriber.restartingIce=!0),this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(e,t){return H(this,void 0,void 0,function*(){var r;t===hs.PUBLISHER?yield this.publisher.addIceCandidate(e):yield(r=this.subscriber)===null||r===void 0?void 0:r.addIceCandidate(e)})}createSubscriberAnswerFromOffer(e,t){return H(this,void 0,void 0,function*(){var r,i,s;this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:(r=this.subscriber)===null||r===void 0?void 0:r.getSignallingState().toString()}));const c=yield this.remoteOfferLock.lock();try{return(yield(i=this.subscriber)===null||i===void 0?void 0:i.setRemoteDescription(e,t))?yield(s=this.subscriber)===null||s===void 0?void 0:s.createAndSetAnswer():void 0}finally{c()}})}updateConfiguration(e,t){var r;this.publisher.setConfiguration(e),(r=this.subscriber)===null||r===void 0||r.setConfiguration(e),t&&this.triggerIceRestart()}ensurePCTransportConnection(e,t){return H(this,void 0,void 0,function*(){var r;const i=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((r=this.requiredTransports)===null||r===void 0?void 0:r.map(s=>this.ensureTransportConnected(s,e,t)))}finally{i()}})}negotiate(e){return H(this,void 0,void 0,function*(){return new Promise((t,r)=>H(this,void 0,void 0,function*(){const i=setTimeout(()=>{r("negotiation timed out")},this.peerConnectionTimeout),s=()=>{clearTimeout(i),r("negotiation aborted")};e.signal.addEventListener("abort",s),this.publisher.once(rd.NegotiationStarted,()=>{e.signal.aborted||this.publisher.once(rd.NegotiationComplete,()=>{clearTimeout(i),t()})}),yield this.publisher.negotiate(c=>{clearTimeout(i),r(c)})}))})}addPublisherTransceiver(e,t){return this.publisher.addTransceiver(e,t)}addPublisherTransceiverOfKind(e,t){return this.publisher.addTransceiverOfKind(e,t)}getMidForReceiver(e){const r=(this.subscriber?this.subscriber.getTransceivers():this.publisher.getTransceivers()).find(i=>i.receiver===e);return r?.mid}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,t){return this.publisher.createDataChannel(e,t)}getConnectedAddress(e){return e===hs.PUBLISHER?this.publisher.getConnectedAddress():e===hs.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&this.subscriber&&e.push(this.subscriber),e}ensureTransportConnected(e,t){return H(this,arguments,void 0,function(r,i){var s=this;let c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return(function*(){if(r.getConnectionState()!=="connected")return new Promise((d,h)=>H(s,void 0,void 0,function*(){const m=()=>{this.log.warn("abort transport connection",this.logContext),wr.clearTimeout(g),h(dt.cancelled("room connection has been cancelled"))};i?.signal.aborted&&m(),i?.signal.addEventListener("abort",m);const g=wr.setTimeout(()=>{i?.signal.removeEventListener("abort",m),h(dt.internal("could not establish pc connection"))},c);for(;this.state!==En.CONNECTED;)if(yield Er(50),i?.signal.aborted){h(dt.cancelled("room connection has been cancelled"));return}wr.clearTimeout(g),i?.signal.removeEventListener("abort",m),d()}))})()})}}const kO=5e3,yZ=3e4;class zt{static fetchRegionSettings(e,t,r){return H(this,void 0,void 0,function*(){const i=yield zt.fetchLock.lock();try{const s=yield fetch("".concat(bZ(e),"/regions"),{headers:{authorization:"Bearer ".concat(t)},signal:r});if(s.ok){const c=BJ(s.headers),l=c?c*1e3:kO;return{regionSettings:yield s.json(),updatedAtInMs:Date.now(),maxAgeInMs:l}}else throw s.status===401?dt.notAllowed("Could not fetch region settings: ".concat(s.statusText),s.status):dt.internal("Could not fetch region settings: ".concat(s.statusText))}catch(s){throw s instanceof dt?s:r?.aborted?dt.cancelled("Region fetching was aborted"):dt.serverUnreachable("Could not fetch region settings, ".concat(s instanceof Error?"".concat(s.name,": ").concat(s.message):s))}finally{i()}})}static scheduleRefetch(e,t,r){return H(this,void 0,void 0,function*(){const i=zt.settingsTimeouts.get(e.hostname);clearTimeout(i),zt.settingsTimeouts.set(e.hostname,setTimeout(()=>H(this,void 0,void 0,function*(){try{const s=yield zt.fetchRegionSettings(e,t);zt.updateCachedRegionSettings(e,t,s)}catch(s){if(s instanceof dt&&s.reason===gn.NotAllowed){gt.debug("token is not valid, cancelling auto region refresh");return}gt.debug("auto refetching of region settings failed",{error:s}),zt.scheduleRefetch(e,t,r)}}),r))})}static updateCachedRegionSettings(e,t,r){zt.cache.set(e.hostname,r),zt.scheduleRefetch(e,t,r.maxAgeInMs)}static stopRefetch(e){const t=zt.settingsTimeouts.get(e);t&&(clearTimeout(t),zt.settingsTimeouts.delete(e))}static scheduleCleanup(e){let t=zt.connectionTrackers.get(e);t&&(t.cleanupTimeout&&clearTimeout(t.cleanupTimeout),t.cleanupTimeout=setTimeout(()=>{const r=zt.connectionTrackers.get(e);r&&r.connectionCount===0&&(gt.debug("stopping region refetch after disconnect delay",{hostname:e}),zt.stopRefetch(e)),r&&(r.cleanupTimeout=void 0)},yZ))}static cancelCleanup(e){const t=zt.connectionTrackers.get(e);t?.cleanupTimeout&&(clearTimeout(t.cleanupTimeout),t.cleanupTimeout=void 0)}notifyConnected(){const e=this.serverUrl.hostname;let t=zt.connectionTrackers.get(e);t||(t={connectionCount:0},zt.connectionTrackers.set(e,t)),t.connectionCount++,zt.cancelCleanup(e)}notifyDisconnected(){const e=this.serverUrl.hostname,t=zt.connectionTrackers.get(e);t&&(t.connectionCount=Math.max(0,t.connectionCount-1),t.connectionCount===0&&zt.scheduleCleanup(e))}constructor(e,t){this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=t}updateToken(e){this.token=e}isCloud(){return Cd(this.serverUrl)}getServerUrl(){return this.serverUrl}fetchRegionSettings(e){return H(this,void 0,void 0,function*(){return zt.fetchRegionSettings(this.serverUrl,this.token,e)})}getNextBestRegionUrl(e){return H(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");let t=zt.cache.get(this.serverUrl.hostname);(!t||Date.now()-t.updatedAtInMs>t.maxAgeInMs)&&(t=yield this.fetchRegionSettings(e),zt.updateCachedRegionSettings(this.serverUrl,this.token,t));const r=t.regionSettings.regions.filter(i=>!this.attemptedRegions.find(s=>s.url===i.url));if(r.length>0){const i=r[0];return this.attemptedRegions.push(i),gt.debug("next region: ".concat(i.region)),i.url}else return null})}resetAttempts(){this.attemptedRegions=[]}setServerReportedRegions(e){zt.updateCachedRegionSettings(this.serverUrl,this.token,e)}}zt.cache=new Map;zt.settingsTimeouts=new Map;zt.connectionTrackers=new Map;zt.fetchLock=new Hr;function bZ(n){return"".concat(n.protocol.replace("ws","http"),"//").concat(n.host,"/settings")}class An extends Error{constructor(e,t,r){super(t),this.code=e,this.message=VA(t,An.MAX_MESSAGE_BYTES),this.data=r?VA(r,An.MAX_DATA_BYTES):void 0}static fromProto(e){return new An(e.code,e.message,e.data)}toProto(){return new mD({code:this.code,message:this.message,data:this.data})}static builtIn(e,t){return new An(An.ErrorCode[e],An.ErrorMessage[e],t)}}An.MAX_MESSAGE_BYTES=256;An.MAX_DATA_BYTES=15360;An.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404};An.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const CO=15360;function MT(n){return new TextEncoder().encode(n).length}function VA(n,e){if(MT(n)<=e)return n;let t=0,r=n.length;const i=new TextEncoder;for(;t<r;){const s=Math.floor((t+r+1)/2);i.encode(n.slice(0,s)).length<=e?t=s:r=s-1}return n.slice(0,t)}const DT=2e3;function V0(n,e){if(!e)return 0;let t,r;return"bytesReceived"in n?(t=n.bytesReceived,r=e.bytesReceived):"bytesSent"in n&&(t=n.bytesSent,r=e.bytesSent),t===void 0||r===void 0||n.timestamp===void 0||e.timestamp===void 0?0:(t-r)*8*1e3/(n.timestamp-e.timestamp)}const OT=typeof MediaRecorder<"u";class xZ{constructor(){throw new Error("MediaRecorder is not available in this environment")}}const _Z=OT?MediaRecorder:xZ;class SZ extends _Z{constructor(e,t){if(!OT)throw new Error("MediaRecorder is not available in this environment");super(new MediaStream([e.mediaStreamTrack]),t);let r,i;const s=()=>i===void 0,c=()=>{this.removeEventListener("dataavailable",r),this.removeEventListener("stop",c),this.removeEventListener("error",l),i?.close(),i=void 0},l=d=>{i?.error(d),this.removeEventListener("dataavailable",r),this.removeEventListener("stop",c),this.removeEventListener("error",l),i=void 0};this.byteStream=new ReadableStream({start:d=>{i=d,r=h=>H(this,void 0,void 0,function*(){let m;if(h.data.arrayBuffer){const g=yield h.data.arrayBuffer();m=new Uint8Array(g)}else if(h.data.byteArray)m=h.data.byteArray;else throw new Error("no data available!");s()||d.enqueue(m)}),this.addEventListener("dataavailable",r)},cancel:()=>{c()}}),this.addEventListener("stop",c),this.addEventListener("error",l)}}function TZ(){return OT}const kZ=1e3,CZ=1e4;class wO extends he{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}get hasPreConnectBuffer(){return!!this.localTrackRecorder}constructor(e,t,r){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,s=arguments.length>4?arguments[4]:void 0;super(e,t,s),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=NT(()=>H(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>H(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(De.Ended,this)},this.reacquireTrack=!1,this.providedByUser=i,this.muteLock=new Hr,this.pauseUpstreamLock=new Hr,this.trackChangeLock=new Hr,this.trackChangeLock.lock().then(c=>H(this,void 0,void 0,function*(){try{yield this.setMediaStreamTrack(e,!0)}finally{c()}})),this._constraints=e.getConstraints(),r&&(this._constraints=r)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==he.Kind.Video)return;const{width:e,height:t}=this._mediaStreamTrack.getSettings();if(e&&t)return{width:e,height:t}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,t;return(t=(e=this.processor)===null||e===void 0?void 0:e.processedTrack)!==null&&t!==void 0?t:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(e,t){return H(this,void 0,void 0,function*(){var r;if(e===this._mediaStreamTrack&&!t)return;this._mediaStreamTrack&&(this.attachedElements.forEach(s=>{td(this._mediaStreamTrack,s)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints());let i;if(this.processor&&e){if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(Fu(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),i=this.processor.processedTrack}this.sender&&((r=this.sender.transport)===null||r===void 0?void 0:r.state)!=="closed"&&(yield this.sender.replaceTrack(i??e)),!this.providedByUser&&this._mediaStreamTrack!==e&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(s=>{Fu(i??e,s)}))})}waitForDimensions(){return H(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:kZ;return(function*(){var r;if(e.kind===he.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((r=Gr())===null||r===void 0?void 0:r.os)==="iOS"&&(yield Er(10));const i=Date.now();for(;Date.now()-i<t;){const s=e.dimensions;if(s)return s;yield Er(50)}throw new Fa("unable to get track dimensions after timeout")})()})}setDeviceId(e){return H(this,void 0,void 0,function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===uc(e)||(this._constraints.deviceId=e,this.isMuted)?!0:(yield this.restartTrack(),uc(e)===this._mediaStreamTrack.getSettings().deviceId)})}getDeviceId(){return H(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){if(e.source===he.Source.ScreenShare)return;const{deviceId:r,groupId:i}=e._mediaStreamTrack.getSettings(),s=e.kind===he.Kind.Audio?"audioinput":"videoinput";return t?fr.getInstance().normalizeDeviceId(s,r,i):r})()})}mute(){return H(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return H(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(e,t){return H(this,void 0,void 0,function*(){const r=yield this.trackChangeLock.lock();try{if(!this.sender)throw new Fa("unable to replace an unpublished track");let i,s;return typeof t=="boolean"?i=t:t!==void 0&&(i=t.userProvidedTrack,s=t.stopProcessor),this.providedByUser=i??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),s&&this.processor&&(yield this.internalStopProcessor()),this}finally{r()}})}restart(e){return H(this,void 0,void 0,function*(){this.manuallyStopped=!1;const t=yield this.trackChangeLock.lock();try{e||(e=this._constraints);const{deviceId:r,facingMode:i}=e,s=YX(e,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const c={audio:!1,video:!1};this.kind===he.Kind.Video?c.video=r||i?{deviceId:r,facingMode:i}:!0:c.audio=r?Object.assign({deviceId:r},s):!0,this.attachedElements.forEach(h=>{td(this.mediaStreamTrack,h)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const d=(yield navigator.mediaDevices.getUserMedia(c)).getTracks()[0];return this.kind===he.Kind.Video&&(yield d.applyConstraints(s)),d.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(d),this._constraints=e,this.emit(De.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{t()}})}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),!(this.isMuted===e&&this._mediaStreamTrack.enabled!==e)&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?De.Muted:De.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return H(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),vO()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(e=this.processor)===null||e===void 0||e.destroy(),this.processor=void 0}pauseUpstream(){return H(this,void 0,void 0,function*(){var e;const t=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(De.UpstreamPaused,this);const r=Gr();if(r?.name==="Safari"&&aa(r.version,"12.0")<0)throw new CT("pauseUpstream is not supported on Safari < 12.");((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(null))}finally{t()}})}resumeUpstream(){return H(this,void 0,void 0,function*(){var e;const t=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(De.UpstreamResumed,this),((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{t()}})}getRTCStatsReport(){return H(this,void 0,void 0,function*(){var e;return!((e=this.sender)===null||e===void 0)&&e.getStats?yield this.sender.getStats():void 0})}setProcessor(e){return H(this,arguments,void 0,function(t){var r=this;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var s;const c=yield r.trackChangeLock.lock();try{r.log.debug("setting up processor",r.logContext);const l=document.createElement(r.kind),d={kind:r.kind,track:r._mediaStreamTrack,element:l,audioContext:r.audioContext};if(yield t.init(d),r.log.debug("processor initialized",r.logContext),r.processor&&(yield r.internalStopProcessor()),r.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(Fu(r._mediaStreamTrack,l),l.muted=!0,l.play().catch(h=>{h instanceof DOMException&&h.name==="AbortError"?(r.log.warn("failed to play processor element, retrying",Object.assign(Object.assign({},r.logContext),{error:h})),setTimeout(()=>{l.play().catch(m=>{r.log.error("failed to play processor element",Object.assign(Object.assign({},r.logContext),{err:m}))})},100)):r.log.error("failed to play processor element",Object.assign(Object.assign({},r.logContext),{error:h}))}),r.processor=t,r.processorElement=l,r.processor.processedTrack){for(const h of r.attachedElements)h!==r.processorElement&&i&&(td(r._mediaStreamTrack,h),Fu(r.processor.processedTrack,h));yield(s=r.sender)===null||s===void 0?void 0:s.replaceTrack(r.processor.processedTrack)}r.emit(De.TrackProcessorUpdate,r.processor)}finally{c()}})()})}getProcessor(){return this.processor}stopProcessor(){return H(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){const r=yield e.trackChangeLock.lock();try{yield e.internalStopProcessor(t)}finally{r()}})()})}internalStopProcessor(){return H(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){var r,i;e.processor&&(e.log.debug("stopping processor",e.logContext),(r=e.processor.processedTrack)===null||r===void 0||r.stop(),yield e.processor.destroy(),e.processor=void 0,t||((i=e.processorElement)===null||i===void 0||i.remove(),e.processorElement=void 0),yield e._mediaStreamTrack.applyConstraints(e._constraints),yield e.setMediaStreamTrack(e._mediaStreamTrack,!0),e.emit(De.TrackProcessorUpdate))})()})}startPreConnectBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;if(!TZ()){this.log.warn("MediaRecorder is not available, cannot start preconnect buffer",this.logContext);return}if(this.localTrackRecorder){this.log.warn("preconnect buffer already started");return}else{let t="audio/webm;codecs=opus";MediaRecorder.isTypeSupported(t)||(t="video/mp4"),this.localTrackRecorder=new SZ(this,{mimeType:t})}this.localTrackRecorder.start(e),this.autoStopPreConnectBuffer=setTimeout(()=>{this.log.warn("preconnect buffer timed out, stopping recording automatically",this.logContext),this.stopPreConnectBuffer()},CZ)}stopPreConnectBuffer(){clearTimeout(this.autoStopPreConnectBuffer),this.localTrackRecorder&&(this.localTrackRecorder.stop(),this.localTrackRecorder=void 0)}getPreConnectBuffer(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.byteStream}getPreConnectBufferMimeType(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.mimeType}}class jv extends wO{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,i=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;super(e,he.Kind.Audio,t,r,s),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>H(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let c;try{c=yield this.getSenderStats()}catch(l){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:l}));return}c&&this.prevStats&&(this._currentBitrate=V0(c,this.prevStats)),this.prevStats=c}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(De.AudioTrackFeatureUpdate,this,hr.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(De.AudioTrackFeatureUpdate,this,hr.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=i,this.checkForSilence()}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return H(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===he.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{t()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return H(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const r=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==uc(this._constraints.deviceId);return this.source===he.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||r)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{t()}})}restartTrack(e){return H(this,void 0,void 0,function*(){let t;if(e){const r=ET({audio:e});typeof r.audio!="boolean"&&(t=r.audio)}yield this.restart(t)})}restart(e){const t=Object.create(null,{restart:{get:()=>super.restart}});return H(this,void 0,void 0,function*(){const r=yield t.restart.call(this,e);return this.checkForSilence(),r})}startMonitor(){di()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},DT)))}setProcessor(e){return H(this,void 0,void 0,function*(){var t;const r=yield this.trackChangeLock.lock();try{if(!sa()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.internalStopProcessor());const i={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(i),this.processor=e,this.processor.processedTrack&&(yield(t=this.sender)===null||t===void 0?void 0:t.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(De.TrackProcessorUpdate,this.processor)}finally{r()}})}setAudioContext(e){this.audioContext=e}getSenderStats(){return H(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return;const t=yield this.sender.getStats();let r;return t.forEach(i=>{i.type==="outbound-rtp"&&(r={type:"audio",streamId:i.id,packetsSent:i.packetsSent,packetsLost:i.packetsLost,bytesSent:i.bytesSent,timestamp:i.timestamp,roundTripTime:i.roundTripTime,jitter:i.jitter})}),r})}checkForSilence(){return H(this,void 0,void 0,function*(){const e=yield pO(this);return e&&(this.isMuted||this.log.debug("silence detected on local audio track",this.logContext),this.emit(De.AudioSilenceDetected)),e})}}function wZ(n,e,t){switch(n.kind){case"audio":return new jv(n,e,!1,void 0,t);case"video":return new Lv(n,e,!1,t);default:throw new Fa("unsupported track type: ".concat(n.kind))}}const EZ=Object.values($f),RZ=Object.values(a_),AZ=Object.values(wT),NZ=[$f.h180,$f.h360],IZ=[a_.h180,a_.h360],PZ=n=>[{scaleResolutionDownBy:2,fps:n.encoding.maxFramerate}].map(t=>{var r,i;return new rn(Math.floor(n.width/t.scaleResolutionDownBy),Math.floor(n.height/t.scaleResolutionDownBy),Math.max(15e4,Math.floor(n.encoding.maxBitrate/(Math.pow(t.scaleResolutionDownBy,2)*(((r=n.encoding.maxFramerate)!==null&&r!==void 0?r:30)/((i=t.fps)!==null&&i!==void 0?i:30))))),t.fps,n.encoding.priority)}),m_=["q","h","f"];function g_(n,e,t,r){var i,s;let c=r?.videoEncoding;n&&(c=r?.screenShareEncoding);const l=r?.simulcast,d=r?.scalabilityMode,h=r?.videoCodec;if(!c&&!l&&!d||!e||!t)return[{}];c||(c=DZ(n,e,t,h),gt.debug("using video encoding",c));const m=c.maxFramerate,g=new rn(e,t,c.maxBitrate,c.maxFramerate,c.priority);if(d&&fs(h)){const R=new EO(d),E=[];if(R.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(d));const A=Gr();if(qf()||sa()||A?.name==="Chrome"&&aa(A?.version,"113")<0){const M=R.suffix=="h"?2:3,F=NJ(A);for(let j=0;j<R.spatial;j+=1)E.push({rid:m_[2-j],maxBitrate:c.maxBitrate/Math.pow(M,j),maxFramerate:g.encoding.maxFramerate,scaleResolutionDownBy:F?Math.pow(2,j):void 0});E[0].scalabilityMode=d}else E.push({maxBitrate:c.maxBitrate,maxFramerate:g.encoding.maxFramerate,scalabilityMode:d});return g.encoding.priority&&(E[0].priority=g.encoding.priority,E[0].networkPriority=g.encoding.priority),gt.debug("using svc encoding",{encodings:E}),E}if(!l)return[c];let b=[];n?b=(i=FA(r?.screenShareSimulcastLayers))!==null&&i!==void 0?i:zA(n,g):b=(s=FA(r?.videoSimulcastLayers))!==null&&s!==void 0?s:zA(n,g);let _;if(b.length>0){const R=b[0];b.length>1&&([,_]=b);const E=Math.max(e,t);if(E>=960&&_)return V1(e,t,[R,_,g],m);if(E>=480)return V1(e,t,[R,g],m)}return V1(e,t,[g])}function MZ(n,e,t){var r,i,s,c;if(!t.backupCodec||t.backupCodec===!0||t.backupCodec.codec===t.videoCodec)return;e!==t.backupCodec.codec&&gt.warn("requested a different codec than specified as backup",{serverRequested:e,backup:t.backupCodec.codec}),t.videoCodec=e,t.videoEncoding=t.backupCodec.encoding;const l=n.mediaStreamTrack.getSettings(),d=(r=l.width)!==null&&r!==void 0?r:(i=n.dimensions)===null||i===void 0?void 0:i.width,h=(s=l.height)!==null&&s!==void 0?s:(c=n.dimensions)===null||c===void 0?void 0:c.height;return n.source===he.Source.ScreenShare&&t.simulcast&&(t.simulcast=!1),g_(n.source===he.Source.ScreenShare,d,h,t)}function DZ(n,e,t,r){const i=OZ(n,e,t);let{encoding:s}=i[0];const c=Math.max(e,t);for(let l=0;l<i.length;l+=1){const d=i[l];if(s=d.encoding,d.width>=c)break}if(r)switch(r){case"av1":case"h265":s=Object.assign({},s),s.maxBitrate=s.maxBitrate*.7;break;case"vp9":s=Object.assign({},s),s.maxBitrate=s.maxBitrate*.85;break}return s}function OZ(n,e,t){if(n)return AZ;const r=e>t?e/t:t/e;return Math.abs(r-16/9)<Math.abs(r-4/3)?EZ:RZ}function zA(n,e){if(n)return PZ(e);const{width:t,height:r}=e,i=t>r?t/r:r/t;return Math.abs(i-16/9)<Math.abs(i-4/3)?NZ:IZ}function V1(n,e,t,r){const i=[];if(t.forEach((s,c)=>{if(c>=m_.length)return;const l=Math.min(n,e),h={rid:m_[c],scaleResolutionDownBy:Math.max(1,l/Math.min(s.width,s.height)),maxBitrate:s.encoding.maxBitrate},m=r&&s.encoding.maxFramerate?Math.min(r,s.encoding.maxFramerate):s.encoding.maxFramerate;m&&(h.maxFramerate=m);const g=Cl()||c===0;s.encoding.priority&&g&&(h.priority=s.encoding.priority,h.networkPriority=s.encoding.priority),i.push(h)}),sa()&&bO()==="ios"){let s;i.forEach(l=>{s?l.maxFramerate&&l.maxFramerate>s&&(s=l.maxFramerate):s=l.maxFramerate});let c=!0;i.forEach(l=>{var d;l.maxFramerate!=s&&(c&&(c=!1,gt.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),gt.info('Setting framerate of encoding "'.concat((d=l.rid)!==null&&d!==void 0?d:"",'" to ').concat(s)),l.maxFramerate=s)})}return i}function FA(n){if(n)return n.sort((e,t)=>{const{encoding:r}=e,{encoding:i}=t;return r.maxBitrate>i.maxBitrate?1:r.maxBitrate<i.maxBitrate?-1:r.maxBitrate===i.maxBitrate&&r.maxFramerate&&i.maxFramerate?r.maxFramerate>i.maxFramerate?1:-1:0})}class EO{constructor(e){const t=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!t)throw new Error("invalid scalability mode");if(this.spatial=parseInt(t[1]),this.temporal=parseInt(t[2]),t.length>3)switch(t[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=t[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat((e=this.suffix)!==null&&e!==void 0?e:"")}}function jZ(n){return n.source===he.Source.ScreenShare||n.constraints.height&&uc(n.constraints.height)>=1080?"maintain-resolution":"balanced"}const LZ=5e3;class Lv extends wO{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,i=arguments.length>3?arguments[3]:void 0;super(e,he.Kind.Video,t,r,i),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.isCpuConstrained=!1,this.optimizeForPerformance=!1,this.monitorSender=()=>H(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let s;try{s=yield this.getSenderStats()}catch(d){this.log.error("could not get video sender stats",Object.assign(Object.assign({},this.logContext),{error:d}));return}const c=new Map(s.map(d=>[d.rid,d])),l=s.some(d=>d.qualityLimitationReason==="cpu");if(l!==this.isCpuConstrained&&(this.isCpuConstrained=l,this.isCpuConstrained&&this.emit(De.CpuConstrained)),this.prevStats){let d=0;c.forEach((h,m)=>{var g;const b=(g=this.prevStats)===null||g===void 0?void 0:g.get(m);d+=V0(h,b)}),this._currentBitrate=d}this.prevStats=c}),this.senderLock=new Hr}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var t;if(this.signalClient=e,!di())return;const r=(t=this.sender)===null||t===void 0?void 0:t.getParameters();r&&(this.encodings=r.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},DT))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(e=>{e.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return H(this,void 0,void 0,function*(){var t,r,i,s,c;yield e.pauseUpstream.call(this);try{for(var l=!0,d=za(this.simulcastCodecs.values()),h;h=yield d.next(),t=h.done,!t;l=!0)s=h.value,l=!1,yield(c=s.sender)===null||c===void 0?void 0:c.replaceTrack(null)}catch(m){r={error:m}}finally{try{!l&&!t&&(i=d.return)&&(yield i.call(d))}finally{if(r)throw r.error}}})}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return H(this,void 0,void 0,function*(){var t,r,i,s,c;yield e.resumeUpstream.call(this);try{for(var l=!0,d=za(this.simulcastCodecs.values()),h;h=yield d.next(),t=h.done,!t;l=!0){s=h.value,l=!1;const m=s;yield(c=m.sender)===null||c===void 0?void 0:c.replaceTrack(m.mediaStreamTrack)}}catch(m){r={error:m}}finally{try{!l&&!t&&(i=d.return)&&(yield i.call(d))}finally{if(r)throw r.error}}})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return H(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===he.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{t()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return H(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.source===he.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{t()}})}setTrackMuted(e){super.setTrackMuted(e);for(const t of this.simulcastCodecs.values())t.mediaStreamTrack.enabled=!e}getSenderStats(){return H(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return[];const t=[],r=yield this.sender.getStats();return r.forEach(i=>{var s;if(i.type==="outbound-rtp"){const c={type:"video",streamId:i.id,frameHeight:i.frameHeight,frameWidth:i.frameWidth,framesPerSecond:i.framesPerSecond,framesSent:i.framesSent,firCount:i.firCount,pliCount:i.pliCount,nackCount:i.nackCount,packetsSent:i.packetsSent,bytesSent:i.bytesSent,qualityLimitationReason:i.qualityLimitationReason,qualityLimitationDurations:i.qualityLimitationDurations,qualityLimitationResolutionChanges:i.qualityLimitationResolutionChanges,rid:(s=i.rid)!==null&&s!==void 0?s:i.id,retransmittedPacketsSent:i.retransmittedPacketsSent,targetBitrate:i.targetBitrate,timestamp:i.timestamp},l=r.get(i.remoteId);l&&(c.jitter=l.jitter,c.packetsLost=l.packetsLost,c.roundTripTime=l.roundTripTime),t.push(c)}}),t.sort((i,s)=>{var c,l;return((c=s.frameWidth)!==null&&c!==void 0?c:0)-((l=i.frameWidth)!==null&&l!==void 0?l:0)}),t})}setPublishingQuality(e){const t=[];for(let r=Ai.LOW;r<=Ai.HIGH;r+=1)t.push(new _T({quality:r,enabled:r<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(fs(this.codec),t)}restartTrack(e){return H(this,void 0,void 0,function*(){var t,r,i,s,c;let l;if(e){const g=ET({video:e});typeof g.video!="boolean"&&(l=g.video)}yield this.restart(l),this.isCpuConstrained=!1;try{for(var d=!0,h=za(this.simulcastCodecs.values()),m;m=yield h.next(),t=m.done,!t;d=!0){s=m.value,d=!1;const g=s;g.sender&&((c=g.sender.transport)===null||c===void 0?void 0:c.state)!=="closed"&&(g.mediaStreamTrack=this.mediaStreamTrack.clone(),yield g.sender.replaceTrack(g.mediaStreamTrack))}}catch(g){r={error:g}}finally{try{!d&&!t&&(i=h.return)&&(yield i.call(h))}finally{if(r)throw r.error}}})}setProcessor(e){const t=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return H(this,arguments,void 0,function(r){var i=this;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var c,l,d,h,m,g;if(yield t.setProcessor.call(i,r,s),!((m=i.processor)===null||m===void 0)&&m.processedTrack)try{for(var b=!0,_=za(i.simulcastCodecs.values()),R;R=yield _.next(),c=R.done,!c;b=!0)h=R.value,b=!1,yield(g=h.sender)===null||g===void 0?void 0:g.replaceTrack(i.processor.processedTrack)}catch(E){l={error:E}}finally{try{!b&&!c&&(d=_.return)&&(yield d.call(_))}finally{if(l)throw l.error}}})()})}setDegradationPreference(e){return H(this,void 0,void 0,function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const t=this.sender.getParameters();t.degradationPreference=e,this.sender.setParameters(t)}catch(t){this.log.warn("failed to set degradationPreference",Object.assign({error:t},this.logContext))}})}addSimulcastTrack(e,t){if(this.simulcastCodecs.has(e)){this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);return}const r={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:t};return this.simulcastCodecs.set(e,r),r}setSimulcastTrackSender(e,t){const r=this.simulcastCodecs.get(e);r&&(r.sender=t,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},LZ))}setPublishingCodecs(e){return H(this,void 0,void 0,function*(){var t,r,i,s,c,l,d;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(fs(e[0].codec),e[0].qualities),[];this.subscribedCodecs=e;const h=[];try{for(t=!0,r=za(e);i=yield r.next(),s=i.done,!s;t=!0){d=i.value,t=!1;const m=d;if(!this.codec||this.codec===m.codec)yield this.setPublishingLayers(fs(m.codec),m.qualities);else{const g=this.simulcastCodecs.get(m.codec);if(this.log.debug("try setPublishingCodec for ".concat(m.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:g})),!g||!g.sender){for(const b of m.qualities)if(b.enabled){h.push(m.codec);break}}else g.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(m.codec),this.logContext),yield BA(g.sender,g.encodings,m.qualities,this.senderLock,fs(m.codec),this.log,this.logContext))}}}catch(m){c={error:m}}finally{try{!t&&!s&&(l=r.return)&&(yield l.call(r))}finally{if(c)throw c.error}}return h})}setPublishingLayers(e,t){return H(this,void 0,void 0,function*(){if(this.optimizeForPerformance){this.log.info("skipping setPublishingLayers due to optimized publishing performance",Object.assign(Object.assign({},this.logContext),{qualities:t}));return}this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:t})),!(!this.sender||!this.encodings)&&(yield BA(this.sender,this.encodings,t,this.senderLock,e,this.log,this.logContext))})}prioritizePerformance(){return H(this,void 0,void 0,function*(){if(!this.sender)throw new Error("sender not found");const e=yield this.senderLock.lock();try{this.optimizeForPerformance=!0;const t=this.sender.getParameters();t.encodings=t.encodings.map((r,i)=>{var s;return Object.assign(Object.assign({},r),{active:i===0,scaleResolutionDownBy:Math.max(1,Math.ceil(((s=this.mediaStreamTrack.getSettings().height)!==null&&s!==void 0?s:360)/360)),scalabilityMode:i===0&&fs(this.codec)?"L1T3":void 0,maxFramerate:i===0?15:0,maxBitrate:i===0?r.maxBitrate:0})}),this.log.debug("setting performance optimised encodings",Object.assign(Object.assign({},this.logContext),{encodings:t.encodings})),this.encodings=t.encodings,yield this.sender.setParameters(t)}catch(t){this.log.error("failed to set performance optimised encodings",Object.assign(Object.assign({},this.logContext),{error:t})),this.optimizeForPerformance=!1}finally{e()}})}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return H(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),vO()&&this.isInBackground&&this.source===he.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function BA(n,e,t,r,i,s,c){return H(this,void 0,void 0,function*(){const l=yield r.lock();s.debug("setPublishingLayersForSender",Object.assign(Object.assign({},c),{sender:n,qualities:t,senderEncodings:e}));try{const d=n.getParameters(),{encodings:h}=d;if(!h)return;if(h.length!==e.length){s.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},c),{encodings:h,senderEncodings:e}));return}let m=!1;!1&&h[0].scalabilityMode||(i&&t.some(_=>_.enabled)&&t.forEach(_=>_.enabled=!0),h.forEach((b,_)=>{var R;let E=(R=b.rid)!==null&&R!==void 0?R:"";E===""&&(E="q");const A=RO(E),M=t.find(F=>F.quality===A);M&&b.active!==M.enabled&&(m=!0,b.active=M.enabled,s.debug("setting layer ".concat(M.quality," to ").concat(b.active?"enabled":"disabled"),c),Cl()&&(M.enabled?(b.scaleResolutionDownBy=e[_].scaleResolutionDownBy,b.maxBitrate=e[_].maxBitrate,b.maxFrameRate=e[_].maxFrameRate):(b.scaleResolutionDownBy=4,b.maxBitrate=10,b.maxFrameRate=2)))})),m&&(d.encodings=h,s.debug("setting encodings",Object.assign(Object.assign({},c),{encodings:d.encodings})),yield n.setParameters(d))}finally{l()}})}function RO(n){switch(n){case"f":return Ai.HIGH;case"h":return Ai.MEDIUM;case"q":return Ai.LOW;default:return Ai.HIGH}}function $A(n,e,t,r){if(!t)return[new lc({quality:Ai.HIGH,width:n,height:e,bitrate:0,ssrc:0})];if(r){const i=t[0].scalabilityMode,s=new EO(i),c=[],l=s.suffix=="h"?1.5:2,d=s.suffix=="h"?2:3;for(let h=0;h<s.spatial;h+=1)c.push(new lc({quality:Math.min(Ai.HIGH,s.spatial-1)-h,width:Math.ceil(n/Math.pow(l,h)),height:Math.ceil(e/Math.pow(l,h)),bitrate:t[0].maxBitrate?Math.ceil(t[0].maxBitrate/Math.pow(d,h)):0,ssrc:0}));return c}return t.map(i=>{var s,c,l;const d=(s=i.scaleResolutionDownBy)!==null&&s!==void 0?s:1;let h=RO((c=i.rid)!==null&&c!==void 0?c:"");return new lc({quality:h,width:Math.ceil(n/d),height:Math.ceil(e/d),bitrate:(l=i.maxBitrate)!==null&&l!==void 0?l:0,ssrc:0})})}const qA="_lossy",HA="_reliable",UZ=2*1e3,z1="leave-reconnect",VZ=3e4,zZ=8*1024,FZ=256*1024;var Gi;(function(n){n[n.New=0]="New",n[n.Connected=1]="Connected",n[n.Disconnected=2]="Disconnected",n[n.Reconnecting=3]="Reconnecting",n[n.Closed=4]="Closed"})(Gi||(Gi={}));class BZ extends da.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(e){var t;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=PT.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.latestRemoteOfferId=0,this.subscriberPrimary=!1,this.pcState=Gi.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=gt,this.reliableDataSequence=1,this.reliableMessageBuffer=new IA,this.reliableReceivedState=new cZ(VZ),this.lossyDataStatCurrentBytes=0,this.lossyDataStatByterate=0,this.lossyDataDropCount=0,this.midToTrackId={},this.isWaitingForNetworkReconnect=!1,this.handleDataChannel=r=>H(this,[r],void 0,function(i){var s=this;let{channel:c}=i;return(function*(){if(c){if(c.label===HA)s.reliableDCSub=c;else if(c.label===qA)s.lossyDCSub=c;else return;s.log.debug("on data channel ".concat(c.id,", ").concat(c.label),s.logContext),c.onmessage=s.handleDataMessage}})()}),this.handleDataMessage=r=>H(this,void 0,void 0,function*(){var i,s,c,l,d;const h=yield this.dataProcessLock.lock();try{let m;if(r.data instanceof ArrayBuffer)m=r.data;else if(r.data instanceof Blob)m=yield r.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:r.data}));return}const g=Fr.fromBinary(new Uint8Array(m));if(g.sequence>0&&g.participantSid!==""){const b=this.reliableReceivedState.get(g.participantSid);if(b&&g.sequence<=b)return;this.reliableReceivedState.set(g.participantSid,g.sequence)}if(((i=g.value)===null||i===void 0?void 0:i.case)==="speaker")this.emit(Ve.ActiveSpeakersUpdate,g.value.value.speakers);else if(((s=g.value)===null||s===void 0?void 0:s.case)==="encryptedPacket"){if(!this.e2eeManager){this.log.error("Received encrypted packet but E2EE not set up",this.logContext);return}const b=yield(c=this.e2eeManager)===null||c===void 0?void 0:c.handleEncryptedData(g.value.value.encryptedValue,g.value.value.iv,g.participantIdentity,g.value.value.keyIndex),_=hD.fromBinary(b.payload),R=new Fr({value:_.value,participantIdentity:g.participantIdentity,participantSid:g.participantSid});((l=R.value)===null||l===void 0?void 0:l.case)==="user"&&GA(R,R.value.value),this.emit(Ve.DataPacketReceived,R,g.value.value.encryptionType)}else((d=g.value)===null||d===void 0?void 0:d.case)==="user"&&GA(g,g.value.value),this.emit(Ve.DataPacketReceived,g,sr.NONE)}finally{h()}}),this.handleDataError=r=>{const s=r.currentTarget.maxRetransmits===0?"lossy":"reliable";if(r instanceof ErrorEvent&&r.error){const{error:c}=r.error;this.log.error("DataChannel error on ".concat(s,": ").concat(r.message),Object.assign(Object.assign({},this.logContext),{error:c}))}else this.log.error("Unknown DataChannel error on ".concat(s),Object.assign(Object.assign({},this.logContext),{event:r}))},this.handleBufferedAmountLow=r=>{const s=r.currentTarget.maxRetransmits===0?wt.LOSSY:wt.RELIABLE;this.updateAndEmitDCBufferStatus(s)},this.handleDisconnect=(r,i)=>{if(this._isClosed)return;this.log.warn("".concat(r," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const s=d=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(d,"ms. giving up"),this.logContext),this.emit(Ve.Disconnected),this.close()},c=Date.now()-this.reconnectStart;let l=this.getNextRetryDelay({elapsedMs:c,retryCount:this.reconnectAttempts});if(l===null){s(c);return}r===z1&&(l=0),this.log.debug("reconnecting in ".concat(l,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=wr.setTimeout(()=>this.attemptReconnect(i).finally(()=>this.reconnectTimeout=void 0),l)},this.waitForRestarted=()=>new Promise((r,i)=>{this.pcState===Gi.Connected&&r();const s=()=>{this.off(Ve.Disconnected,c),r()},c=()=>{this.off(Ve.Restarted,s),i()};this.once(Ve.Restarted,s),this.once(Ve.Disconnected,c)}),this.updateAndEmitDCBufferStatus=r=>{if(r===wt.RELIABLE){const s=this.dataChannelForKind(r);s&&this.reliableMessageBuffer.alignBufferedAmount(s.bufferedAmount)}const i=this.isBufferStatusLow(r);typeof i<"u"&&i!==this.dcBufferStatus.get(r)&&(this.dcBufferStatus.set(r,i),this.emit(Ve.DCBufferStatusChanged,i,r))},this.isBufferStatusLow=r=>{const i=this.dataChannelForKind(r);if(i)return i.bufferedAmount<=i.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>H(this,void 0,void 0,function*(){!this.url||!(yield fetch(Hf(this.url),{method:"HEAD"}).then(i=>i.ok).catch(()=>!1))||(this.log.info("detected network reconnected"),(this.client.currentState===on.RECONNECTING||this.isWaitingForNetworkReconnect&&this.client.currentState===on.CONNECTED)&&(this.clearReconnectTimeout(),this.attemptReconnect(sl.RR_SIGNAL_DISCONNECTED),this.isWaitingForNetworkReconnect=!1))}),this.handleBrowserOffline=()=>H(this,void 0,void 0,function*(){if(this.url)try{yield Promise.race([fetch(Hf(this.url),{method:"HEAD"}),Er(4e3).then(()=>Promise.reject())])}catch{window.navigator.onLine===!1&&(this.log.info("detected network interruption"),this.isWaitingForNetworkReconnect=!0)}}),this.log=eo((t=e.loggerName)!==null&&t!==void 0?t:_s.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new RT(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.closingLock=new Hr,this.dataProcessLock=new Hr,this.dcBufferStatus=new Map([[wt.LOSSY,!0],[wt.RELIABLE,!0]]),this.client.onParticipantUpdate=r=>this.emit(Ve.ParticipantUpdate,r),this.client.onConnectionQuality=r=>this.emit(Ve.ConnectionQualityUpdate,r),this.client.onRoomUpdate=r=>this.emit(Ve.RoomUpdate,r),this.client.onSubscriptionError=r=>this.emit(Ve.SubscriptionError,r),this.client.onSubscriptionPermissionUpdate=r=>this.emit(Ve.SubscriptionPermissionUpdate,r),this.client.onSpeakersChanged=r=>this.emit(Ve.SpeakersChanged,r),this.client.onStreamStateUpdate=r=>this.emit(Ve.StreamStateChanged,r),this.client.onRequestResponse=r=>this.emit(Ve.SignalRequestResponse,r)}get logContext(){var e,t,r,i,s,c;return{room:(t=(e=this.latestJoinResponse)===null||e===void 0?void 0:e.room)===null||t===void 0?void 0:t.name,roomID:(i=(r=this.latestJoinResponse)===null||r===void 0?void 0:r.room)===null||i===void 0?void 0:i.sid,participant:(c=(s=this.latestJoinResponse)===null||s===void 0?void 0:s.participant)===null||c===void 0?void 0:c.identity,pID:this.participantSid}}join(e,t,r,i){return H(this,void 0,void 0,function*(){this.url=e,this.token=t,this.signalOpts=r,this.maxJoinAttempts=r.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const s=yield this.client.join(e,t,r,i);return this._isClosed=!1,this.latestJoinResponse=s,this.subscriberPrimary=s.subscriberPrimary,this.pcManager||(yield this.configure(s)),(!this.subscriberPrimary||s.fastPublish)&&this.negotiate().catch(c=>{gt.error(c,this.logContext)}),this.registerOnLineListener(),this.clientConfiguration=s.clientConfiguration,this.emit(Ve.SignalConnected,s),s}catch(s){if(s instanceof dt&&s.reason===gn.ServerUnreachable&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(e,t,r,i);throw s}})}close(){return H(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();if(this.isClosed){e();return}try{this._isClosed=!0,this.joinAttempts=0,this.emit(Ve.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),this.cleanupLossyDataStats(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}})}cleanupPeerConnections(){return H(this,void 0,void 0,function*(){var e;yield(e=this.pcManager)===null||e===void 0?void 0:e.close(),this.pcManager=void 0;const t=r=>{r&&(r.close(),r.onbufferedamountlow=null,r.onclose=null,r.onclosing=null,r.onerror=null,r.onmessage=null,r.onopen=null)};t(this.lossyDC),t(this.lossyDCSub),t(this.reliableDC),t(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0,this.reliableMessageBuffer=new IA,this.reliableDataSequence=1,this.reliableReceivedState.clear()})}cleanupLossyDataStats(){this.lossyDataStatByterate=0,this.lossyDataStatCurrentBytes=0,this.lossyDataStatInterval&&(clearInterval(this.lossyDataStatInterval),this.lossyDataStatInterval=void 0),this.lossyDataDropCount=0}cleanupClient(){return H(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new Fa("a track with the same ID has already been published");return new Promise((t,r)=>{const i=setTimeout(()=>{delete this.pendingTrackResolvers[e.cid],r(dt.timeout("publication of local track timed out, no response from server"))},1e4);this.pendingTrackResolvers[e.cid]={resolve:s=>{clearTimeout(i),t(s)},reject:()=>{clearTimeout(i),r(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)})}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:t}=this.pendingTrackResolvers[e.track.id];t&&t(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(t){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:t}))}return!1}updateMuteStatus(e,t){this.client.sendMuteTrack(e,t)}get dataSubscriberReadyState(){var e;return(e=this.reliableDCSub)===null||e===void 0?void 0:e.readyState}getConnectedServerAddress(){return H(this,void 0,void 0,function*(){var e;return(e=this.pcManager)===null||e===void 0?void 0:e.getConnectedAddress()})}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e){return H(this,void 0,void 0,function*(){var t,r;if(this.pcManager&&this.pcManager.currentState!==En.NEW)return;this.participantSid=(t=e.participant)===null||t===void 0?void 0:t.sid;const i=this.makeRTCConfiguration(e);this.pcManager=new vZ(i,this.options.singlePeerConnection?"publisher-only":e.subscriberPrimary?"subscriber-primary":"publisher-primary",this.loggerOptions),this.emit(Ve.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(s,c)=>{this.client.sendIceCandidate(s,c)},this.pcManager.onPublisherOffer=(s,c)=>{this.client.sendOffer(s,c)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(s,c,l)=>H(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(s),this.logContext),["closed","disconnected","failed"].includes(c)&&(this.publisherConnectionPromise=void 0),s===En.CONNECTED){const m=this.pcState===Gi.New;this.pcState=Gi.Connected,m&&this.emit(Ve.Connected,e)}else s===En.FAILED&&(this.pcState===Gi.Connected||this.pcState===Gi.Reconnecting)&&(this.pcState=Gi.Disconnected,this.handleDisconnect("peerconnection failed",l==="failed"?sl.RR_SUBSCRIBER_FAILED:sl.RR_PUBLISHER_FAILED));const d=this.client.isDisconnected||this.client.currentState===on.RECONNECTING,h=[En.FAILED,En.CLOSING,En.CLOSED].includes(s);d&&h&&!this._isClosed&&this.emit(Ve.Offline)}),this.pcManager.onTrack=s=>{s.streams.length!==0&&this.emit(Ve.MediaTrackAdded,s.track,s.streams[0],s.receiver)},$Z((r=e.serverInfo)===null||r===void 0?void 0:r.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=(e,t,r)=>H(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,midToTrackId:r})),this.midToTrackId=r,yield this.pcManager.setPublisherAnswer(e,t))}),this.client.onTrickle=(e,t)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:t})),this.pcManager.addIceCandidate(e,t))},this.client.onOffer=(e,t,r)=>H(this,void 0,void 0,function*(){if(this.latestRemoteOfferId=t,!this.pcManager)return;this.midToTrackId=r;const i=yield this.pcManager.createSubscriberAnswerFromOffer(e,t);i&&this.client.sendAnswer(i,t)}),this.client.onLocalTrackPublished=e=>{var t;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:(t=e.track)===null||t===void 0?void 0:t.sid})),!this.pendingTrackResolvers[e.cid]){this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));return}const{resolve:r}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],r(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit(Ve.LocalTrackUnpublished,e)},this.client.onLocalTrackSubscribed=e=>{this.emit(Ve.LocalTrackSubscribed,e)},this.client.onTokenRefresh=e=>{var t;this.token=e,(t=this.regionUrlProvider)===null||t===void 0||t.updateToken(e)},this.client.onRemoteMuteChanged=(e,t)=>{this.emit(Ve.RemoteMute,e,t)},this.client.onSubscribedQualityUpdate=e=>{this.emit(Ve.SubscribedQualityUpdate,e)},this.client.onRoomMoved=e=>{var t;this.participantSid=(t=e.participant)===null||t===void 0?void 0:t.sid,this.latestJoinResponse&&(this.latestJoinResponse.room=e.room),this.emit(Ve.RoomMoved,e)},this.client.onMediaSectionsRequirement=e=>{var t,r;const i={direction:"recvonly"};for(let s=0;s<e.numAudios;s++)(t=this.pcManager)===null||t===void 0||t.addPublisherTransceiverOfKind("audio",i);for(let s=0;s<e.numVideos;s++)(r=this.pcManager)===null||r===void 0||r.addPublisherTransceiverOfKind("video",i);this.negotiate()},this.client.onClose=()=>{this.handleDisconnect("signal",sl.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:e?.reason})),e.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions({updatedAtInMs:Date.now(),maxAgeInMs:kO,regionSettings:e.regions})),e.action){case Zu.DISCONNECT:this.emit(Ve.Disconnected,e?.reason),this.close();break;case Zu.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(z1);break;case Zu.RESUME:this.handleDisconnect(z1)}}}makeRTCConfiguration(e){var t;const r=Object.assign({},this.rtcConfig);if(!((t=this.signalOpts)===null||t===void 0)&&t.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),r.encodedInsertableStreams=!0),e.iceServers&&!r.iceServers){const i=[];e.iceServers.forEach(s=>{const c={urls:s.urls};s.username&&(c.username=s.username),s.credential&&(c.credential=s.credential),i.push(c)}),r.iceServers=i}return e.clientConfiguration&&e.clientConfiguration.forceRelay===Vf.ENABLED&&(r.iceTransportPolicy="relay"),r.sdpSemantics="unified-plan",r.continualGatheringPolicy="gather_continually",r}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(qA,{ordered:!1,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(HA,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow,this.cleanupLossyDataStats(),this.lossyDataStatInterval=setInterval(()=>{this.lossyDataStatByterate=this.lossyDataStatCurrentBytes,this.lossyDataStatCurrentBytes=0;const e=this.dataChannelForKind(wt.LOSSY);if(e){const t=this.lossyDataStatByterate/10;e.bufferedAmountLowThreshold=Math.min(Math.max(t,zZ),FZ)}},1e3))}createSender(e,t,r){return H(this,void 0,void 0,function*(){if(l_())return yield this.createTransceiverRTCRtpSender(e,t,r);if(u_())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(e.mediaStreamTrack);throw new ir("Required webRTC APIs not supported on this device")})}createSimulcastSender(e,t,r,i){return H(this,void 0,void 0,function*(){if(l_())return this.createSimulcastTransceiverSender(e,t,r,i);if(u_())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new ir("Cannot stream on this device")})}createTransceiverRTCRtpSender(e,t,r){return H(this,void 0,void 0,function*(){if(!this.pcManager)throw new ir("publisher is closed");const i=[];e.mediaStream&&i.push(e.mediaStream),wc(e)&&(e.codec=t.videoCodec);const s={direction:"sendonly",streams:i};return r&&(s.sendEncodings=r),(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,s)).sender})}createSimulcastTransceiverSender(e,t,r,i){return H(this,void 0,void 0,function*(){if(!this.pcManager)throw new ir("publisher is closed");const s={direction:"sendonly"};i&&(s.sendEncodings=i);const c=yield this.pcManager.addPublisherTransceiver(t.mediaStreamTrack,s);if(r.videoCodec)return e.setSimulcastTrackSender(r.videoCodec,c.sender),c.sender})}createRTCRtpSender(e){return H(this,void 0,void 0,function*(){if(!this.pcManager)throw new ir("publisher is closed");return this.pcManager.addPublisherTrack(e)})}attemptReconnect(e){return H(this,void 0,void 0,function*(){var t,r,i;if(!this._isClosed){if(this.attemptingReconnect){gt.warn("already attempting reconnect, returning early",this.logContext);return}(((t=this.clientConfiguration)===null||t===void 0?void 0:t.resumeConnection)===Vf.DISABLED||((i=(r=this.pcManager)===null||r===void 0?void 0:r.currentState)!==null&&i!==void 0?i:En.NEW)===En.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(s){this.reconnectAttempts+=1;let c=!0;s instanceof ir?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:s})),c=!1):s instanceof Pu||(this.fullReconnectOnNext=!0),c?this.handleDisconnect("reconnect",sl.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(Ve.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(t){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:t}))}return null}restartConnection(e){return H(this,void 0,void 0,function*(){var t,r,i;try{if(!this.url||!this.token)throw new ir("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(Ve.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let s;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new Pu;s=yield this.join(e??this.url,this.token,this.signalOpts)}catch(c){throw c instanceof dt&&c.reason===gn.NotAllowed?new ir("could not reconnect, token might be expired"):new Pu}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(Ve.SignalRestarted,s),yield this.waitForPCReconnected(),this.client.currentState!==on.CONNECTED)throw new Pu("Signal connection got severed during reconnect");(t=this.regionUrlProvider)===null||t===void 0||t.resetAttempts(),this.emit(Ve.Restarted)}catch(s){const c=yield(r=this.regionUrlProvider)===null||r===void 0?void 0:r.getNextBestRegionUrl();if(c){yield this.restartConnection(c);return}else throw(i=this.regionUrlProvider)===null||i===void 0||i.resetAttempts(),s}})}resumeConnection(e){return H(this,void 0,void 0,function*(){var t;if(!this.url||!this.token)throw new ir("could not reconnect, url or token not saved");if(!this.pcManager)throw new ir("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(Ve.Resuming);let r;try{this.setupSignalClientCallbacks(),r=yield this.client.reconnect(this.url,this.token,this.participantSid,e)}catch(i){let s="";throw i instanceof Error&&(s=i.message,this.log.error(i.message,Object.assign(Object.assign({},this.logContext),{error:i}))),i instanceof dt&&i.reason===gn.NotAllowed?new ir("could not reconnect, token might be expired"):i instanceof dt&&i.reason===gn.LeaveRequest?i:new Pu(s)}if(this.emit(Ve.SignalResumed),r){const i=this.makeRTCConfiguration(r);this.pcManager.updateConfiguration(i),this.latestJoinResponse&&(this.latestJoinResponse.serverInfo=r.serverInfo)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==on.CONNECTED)throw new Pu("Signal connection got severed during reconnect");this.client.setReconnected(),((t=this.reliableDC)===null||t===void 0?void 0:t.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),r?.lastMessageSeq&&this.resendReliableMessagesForResume(r.lastMessageSeq),this.emit(Ve.Resumed)})}waitForPCInitialConnection(e,t){return H(this,void 0,void 0,function*(){if(!this.pcManager)throw new ir("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(t,e)})}waitForPCReconnected(){return H(this,void 0,void 0,function*(){this.pcState=Gi.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield Er(UZ),!this.pcManager)throw new ir("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=Gi.Connected}catch(e){throw this.pcState=Gi.Disconnected,dt.internal("could not establish PC connection, ".concat(e.message))}})}publishRpcResponse(e,t,r,i){return H(this,void 0,void 0,function*(){const s=new Fr({destinationIdentities:[e],kind:wt.RELIABLE,value:{case:"rpcResponse",value:new vT({requestId:t,value:i?{case:"error",value:i.toProto()}:{case:"payload",value:r??""}})}});yield this.sendDataPacket(s,wt.RELIABLE)})}publishRpcAck(e,t){return H(this,void 0,void 0,function*(){const r=new Fr({destinationIdentities:[e],kind:wt.RELIABLE,value:{case:"rpcAck",value:new gT({requestId:t})}});yield this.sendDataPacket(r,wt.RELIABLE)})}sendDataPacket(e,t){return H(this,void 0,void 0,function*(){if(yield this.ensurePublisherConnected(t),this.e2eeManager&&this.e2eeManager.isDataChannelEncryptionEnabled){const s=XJ(e);if(s){const c=yield this.e2eeManager.encryptData(s.toBinary());e.value={case:"encryptedPacket",value:new dD({encryptedValue:c.payload,iv:c.iv,keyIndex:c.keyIndex})}}}t===wt.RELIABLE&&(e.sequence=this.reliableDataSequence,this.reliableDataSequence+=1);const r=e.toBinary(),i=this.dataChannelForKind(t);if(i){if(t===wt.RELIABLE)yield this.waitForBufferStatusLow(t),this.reliableMessageBuffer.push({data:r,sequence:e.sequence});else{if(!this.isBufferStatusLow(t)){this.lossyDataDropCount+=1,this.lossyDataDropCount%100===0&&this.log.warn("dropping lossy data channel messages, total dropped: ".concat(this.lossyDataDropCount),this.logContext);return}this.lossyDataStatCurrentBytes+=r.byteLength}if(this.attemptingReconnect)return;i.send(r)}this.updateAndEmitDCBufferStatus(t)})}resendReliableMessagesForResume(e){return H(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(wt.RELIABLE);const t=this.dataChannelForKind(wt.RELIABLE);t&&(this.reliableMessageBuffer.popToSequence(e),this.reliableMessageBuffer.getAll().forEach(r=>{t.send(r.data)})),this.updateAndEmitDCBufferStatus(wt.RELIABLE)})}waitForBufferStatusLow(e){return new Promise((t,r)=>H(this,void 0,void 0,function*(){if(this.isBufferStatusLow(e))t();else{const i=()=>r("Engine closed");for(this.once(Ve.Closing,i);!this.dcBufferStatus.get(e);)yield Er(10);this.off(Ve.Closing,i),t()}}))}ensureDataTransportConnected(e){return H(this,arguments,void 0,function(t){var r=this;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return(function*(){var s;if(!r.pcManager)throw new ir("PC manager is closed");const c=i?r.pcManager.subscriber:r.pcManager.publisher,l=i?"Subscriber":"Publisher";if(!c)throw dt.internal("".concat(l," connection not set"));let d=!1;!i&&!r.dataChannelForKind(t,i)&&(r.createDataChannels(),d=!0),!d&&!i&&!r.pcManager.publisher.isICEConnected&&r.pcManager.publisher.getICEConnectionState()!=="checking"&&(d=!0),d&&r.negotiate().catch(g=>{gt.error(g,r.logContext)});const h=r.dataChannelForKind(t,i);if(h?.readyState==="open")return;const m=new Date().getTime()+r.peerConnectionTimeout;for(;new Date().getTime()<m;){if(c.isICEConnected&&((s=r.dataChannelForKind(t,i))===null||s===void 0?void 0:s.readyState)==="open")return;yield Er(50)}throw dt.internal("could not establish ".concat(l," connection, state: ").concat(c.getICEConnectionState()))})()})}ensurePublisherConnected(e){return H(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==En.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return H(this,void 0,void 0,function*(){return new Promise((e,t)=>H(this,void 0,void 0,function*(){if(!this.pcManager){t(new i_("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const r=new AbortController,i=()=>{r.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&t("cannot negotiate on closed engine"),this.on(Ve.Closing,i),this.pcManager.publisher.once(rd.RTPVideoPayloadTypes,s=>{const c=new Map;s.forEach(l=>{const d=l.codec.toLowerCase();OJ(d)&&c.set(l.payload,d)}),this.emit(Ve.RTPVideoMapUpdate,c)});try{yield this.pcManager.negotiate(r),e()}catch(s){s instanceof i_&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",sl.RR_UNKNOWN),t(s)}finally{this.off(Ve.Closing,i)}}))})}dataChannelForKind(e,t){if(t){if(e===wt.LOSSY)return this.lossyDCSub;if(e===wt.RELIABLE)return this.reliableDCSub}else{if(e===wt.LOSSY)return this.lossyDC;if(e===wt.RELIABLE)return this.reliableDC}}sendSyncState(e,t){var r,i,s,c;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const l=this.pcManager.publisher.getLocalDescription(),d=this.pcManager.publisher.getRemoteDescription(),h=(r=this.pcManager.subscriber)===null||r===void 0?void 0:r.getRemoteDescription(),m=(i=this.pcManager.subscriber)===null||i===void 0?void 0:i.getLocalDescription(),g=(c=(s=this.signalOpts)===null||s===void 0?void 0:s.autoSubscribe)!==null&&c!==void 0?c:!0,b=new Array,_=new Array;e.forEach(R=>{R.isDesired!==g&&b.push(R.trackSid),R.isEnabled||_.push(R.trackSid)}),this.client.sendSyncState(new ST({answer:this.options.singlePeerConnection?d?Bu({sdp:d.sdp,type:d.type}):void 0:m?Bu({sdp:m.sdp,type:m.type}):void 0,offer:this.options.singlePeerConnection?l?Bu({sdp:l.sdp,type:l.type}):void 0:h?Bu({sdp:h.sdp,type:h.type}):void 0,subscription:new j0({trackSids:b,subscribe:!g,participantTracks:[]}),publishTracks:yJ(t),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:_,datachannelReceiveStates:this.reliableReceivedState.map((R,E)=>new ID({publisherSid:E,lastSeq:R}))}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],t=(r,i)=>{r?.id!==void 0&&r.id!==null&&e.push(new PD({label:r.label,id:r.id,target:i}))};return t(this.dataChannelForKind(wt.LOSSY),hs.PUBLISHER),t(this.dataChannelForKind(wt.RELIABLE),hs.PUBLISHER),t(this.dataChannelForKind(wt.LOSSY,!0),hs.SUBSCRIBER),t(this.dataChannelForKind(wt.RELIABLE,!0),hs.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&wr.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){di()&&(window.addEventListener("online",this.handleBrowserOnLine),window.addEventListener("offline",this.handleBrowserOffline))}deregisterOnLineListener(){di()&&(window.removeEventListener("online",this.handleBrowserOnLine),window.removeEventListener("offline",this.handleBrowserOffline))}getTrackIdForReceiver(e){var t;const r=(t=this.pcManager)===null||t===void 0?void 0:t.getMidForReceiver(e);if(r){const i=Object.entries(this.midToTrackId).find(s=>{let[c]=s;return c===r});if(i)return i[1]}}}function $Z(n){return n!==void 0&&n>13}function GA(n,e){const t=n.participantIdentity?n.participantIdentity:e.participantIdentity;n.participantIdentity=t,e.participantIdentity=t;const r=n.destinationIdentities.length!==0?n.destinationIdentities:e.destinationIdentities;n.destinationIdentities=r,e.destinationIdentities=r}class AO{get info(){return this._info}validateBytesReceived(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!(typeof this.totalByteSize!="number"||this.totalByteSize===0)){if(e&&this.bytesReceived<this.totalByteSize)throw new Ki("Not enough chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, only received ").concat(this.bytesReceived," bytes"),zr.Incomplete);if(this.bytesReceived>this.totalByteSize)throw new Ki("Extra chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, received ").concat(this.bytesReceived," bytes"),zr.LengthExceeded)}}constructor(e,t,r,i){this.reader=t,this.totalByteSize=r,this._info=e,this.bytesReceived=0,this.outOfBandFailureRejectingFuture=i}}class qZ extends AO{handleChunkReceived(e){var t;this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const r=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(t=this.onProgress)===null||t===void 0||t.call(this,r)}[Symbol.asyncIterator](){const e=this.reader.getReader();let t=new Qi,r=null,i=null;if(this.signal){const c=this.signal;i=()=>{var l;(l=t.reject)===null||l===void 0||l.call(t,c.reason)},c.addEventListener("abort",i),r=c}const s=()=>{e.releaseLock(),r&&i&&r.removeEventListener("abort",i),this.signal=void 0};return{next:()=>H(this,void 0,void 0,function*(){var c,l;try{const{done:d,value:h}=yield Promise.race([e.read(),t.promise,(l=(c=this.outOfBandFailureRejectingFuture)===null||c===void 0?void 0:c.promise)!==null&&l!==void 0?l:new Promise(()=>{})]);return d?(this.validateBytesReceived(!0),{done:!0,value:void 0}):(this.handleChunkReceived(h),{done:!1,value:h.content})}catch(d){throw s(),d}}),return(){return H(this,void 0,void 0,function*(){return s(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return H(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(function*(){var r,i,s,c;let l=new Set;const d=t.signal?e.withAbortSignal(t.signal):e;try{for(var h=!0,m=za(d),g;g=yield m.next(),r=g.done,!r;h=!0){c=g.value,h=!1;const b=c;l.add(b)}}catch(b){i={error:b}}finally{try{!h&&!r&&(s=m.return)&&(yield s.call(m))}finally{if(i)throw i.error}}return Array.from(l)})()})}}class HZ extends AO{constructor(e,t,r,i){super(e,t,r,i),this.receivedChunks=new Map}handleChunkReceived(e){var t;const r=$g(e.chunkIndex),i=this.receivedChunks.get(r);if(i&&i.version>e.version)return;this.receivedChunks.set(r,e),this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const s=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(t=this.onProgress)===null||t===void 0||t.call(this,s)}[Symbol.asyncIterator](){const e=this.reader.getReader(),t=new TextDecoder("utf-8",{fatal:!0});let r=new Qi,i=null,s=null;if(this.signal){const l=this.signal;s=()=>{var d;(d=r.reject)===null||d===void 0||d.call(r,l.reason)},l.addEventListener("abort",s),i=l}const c=()=>{e.releaseLock(),i&&s&&i.removeEventListener("abort",s),this.signal=void 0};return{next:()=>H(this,void 0,void 0,function*(){var l,d;try{const{done:h,value:m}=yield Promise.race([e.read(),r.promise,(d=(l=this.outOfBandFailureRejectingFuture)===null||l===void 0?void 0:l.promise)!==null&&d!==void 0?d:new Promise(()=>{})]);if(h)return this.validateBytesReceived(!0),{done:!0,value:void 0};{this.handleChunkReceived(m);let g;try{g=t.decode(m.content)}catch(b){throw new Ki("Cannot decode datastream chunk ".concat(m.chunkIndex," as text: ").concat(b),zr.DecodeFailed)}return{done:!1,value:g}}}catch(h){throw c(),h}}),return(){return H(this,void 0,void 0,function*(){return c(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return H(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(function*(){var r,i,s,c;let l="";const d=t.signal?e.withAbortSignal(t.signal):e;try{for(var h=!0,m=za(d),g;g=yield m.next(),r=g.done,!r;h=!0)c=g.value,h=!1,l+=c}catch(b){i={error:b}}finally{try{!h&&!r&&(s=m.return)&&(yield s.call(m))}finally{if(i)throw i.error}}return l})()})}}class GZ{constructor(){this.log=gt,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map}registerTextStreamHandler(e,t){if(this.textStreamHandlers.has(e))throw new Ki('A text stream handler for topic "'.concat(e,'" has already been set.'),zr.HandlerAlreadyRegistered);this.textStreamHandlers.set(e,t)}unregisterTextStreamHandler(e){this.textStreamHandlers.delete(e)}registerByteStreamHandler(e,t){if(this.byteStreamHandlers.has(e))throw new Ki('A byte stream handler for topic "'.concat(e,'" has already been set.'),zr.HandlerAlreadyRegistered);this.byteStreamHandlers.set(e,t)}unregisterByteStreamHandler(e){this.byteStreamHandlers.delete(e)}clearControllers(){this.byteStreamControllers.clear(),this.textStreamControllers.clear()}validateParticipantHasNoActiveDataStreams(e){var t,r,i,s;const c=Array.from(this.textStreamControllers.entries()).filter(d=>d[1].sendingParticipantIdentity===e),l=Array.from(this.byteStreamControllers.entries()).filter(d=>d[1].sendingParticipantIdentity===e);if(c.length>0||l.length>0){const d=new Ki("Participant ".concat(e," unexpectedly disconnected in the middle of sending data"),zr.AbnormalEnd);for(const[h,m]of l)(r=(t=m.outOfBandFailureRejectingFuture).reject)===null||r===void 0||r.call(t,d),this.byteStreamControllers.delete(h);for(const[h,m]of c)(s=(i=m.outOfBandFailureRejectingFuture).reject)===null||s===void 0||s.call(i,d),this.textStreamControllers.delete(h)}}handleDataStreamPacket(e,t){return H(this,void 0,void 0,function*(){switch(e.value.case){case"streamHeader":return this.handleStreamHeader(e.value.value,e.participantIdentity,t);case"streamChunk":return this.handleStreamChunk(e.value.value,t);case"streamTrailer":return this.handleStreamTrailer(e.value.value,t);default:throw new Error('DataPacket of value "'.concat(e.value.case,'" is not data stream related!'))}})}handleStreamHeader(e,t,r){return H(this,void 0,void 0,function*(){var i;if(e.contentHeader.case==="byteHeader"){const s=this.byteStreamHandlers.get(e.topic);if(!s){this.log.debug("ignoring incoming byte stream due to no handler for topic",e.topic);return}let c;const l=new Qi;l.promise.catch(m=>{this.log.error(m)});const d={id:e.streamId,name:(i=e.contentHeader.value.name)!==null&&i!==void 0?i:"unknown",mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:$g(e.timestamp),attributes:e.attributes,encryptionType:r},h=new ReadableStream({start:m=>{if(c=m,this.textStreamControllers.has(e.streamId))throw new Ki("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),zr.AlreadyOpened);this.byteStreamControllers.set(e.streamId,{info:d,controller:c,startTime:Date.now(),sendingParticipantIdentity:t,outOfBandFailureRejectingFuture:l})}});s(new qZ(d,h,$g(e.totalLength),l),{identity:t})}else if(e.contentHeader.case==="textHeader"){const s=this.textStreamHandlers.get(e.topic);if(!s){this.log.debug("ignoring incoming text stream due to no handler for topic",e.topic);return}let c;const l=new Qi;l.promise.catch(m=>{this.log.error(m)});const d={id:e.streamId,mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Number(e.timestamp),attributes:e.attributes,encryptionType:r},h=new ReadableStream({start:m=>{if(c=m,this.textStreamControllers.has(e.streamId))throw new Ki("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),zr.AlreadyOpened);this.textStreamControllers.set(e.streamId,{info:d,controller:c,startTime:Date.now(),sendingParticipantIdentity:t,outOfBandFailureRejectingFuture:l})}});s(new HZ(d,h,$g(e.totalLength),l),{identity:t})}})}handleStreamChunk(e,t){const r=this.byteStreamControllers.get(e.streamId);r&&(r.info.encryptionType!==t?(r.controller.error(new Ki("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(t,", got ").concat(r.info.encryptionType),zr.EncryptionTypeMismatch)),this.byteStreamControllers.delete(e.streamId)):e.content.length>0&&r.controller.enqueue(e));const i=this.textStreamControllers.get(e.streamId);i&&(i.info.encryptionType!==t?(i.controller.error(new Ki("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(t,", got ").concat(i.info.encryptionType),zr.EncryptionTypeMismatch)),this.textStreamControllers.delete(e.streamId)):e.content.length>0&&i.controller.enqueue(e))}handleStreamTrailer(e,t){const r=this.textStreamControllers.get(e.streamId);r&&(r.info.encryptionType!==t?r.controller.error(new Ki("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(t,", got ").concat(r.info.encryptionType),zr.EncryptionTypeMismatch)):(r.info.attributes=Object.assign(Object.assign({},r.info.attributes),e.attributes),r.controller.close(),this.textStreamControllers.delete(e.streamId)));const i=this.byteStreamControllers.get(e.streamId);i&&(i.info.encryptionType!==t?i.controller.error(new Ki("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(t,", got ").concat(i.info.encryptionType),zr.EncryptionTypeMismatch)):(i.info.attributes=Object.assign(Object.assign({},i.info.attributes),e.attributes),i.controller.close()),this.byteStreamControllers.delete(e.streamId))}}class NO{constructor(e,t,r){this.writableStream=e,this.defaultWriter=e.getWriter(),this.onClose=r,this.info=t}write(e){return this.defaultWriter.write(e)}close(){return H(this,void 0,void 0,function*(){var e;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),(e=this.onClose)===null||e===void 0||e.call(this)})}}class KZ extends NO{}class WZ extends NO{}const KA=15e3;class YZ{constructor(e,t){this.engine=e,this.log=t}setupEngine(e){this.engine=e}sendText(e,t){return H(this,void 0,void 0,function*(){var r;const i=crypto.randomUUID(),c=new TextEncoder().encode(e).byteLength,l=(r=t?.attachments)===null||r===void 0?void 0:r.map(()=>crypto.randomUUID()),d=new Array(l?l.length+1:1).fill(0),h=(g,b)=>{var _;d[b]=g;const R=d.reduce((E,A)=>E+A,0);(_=t?.onProgress)===null||_===void 0||_.call(t,R)},m=yield this.streamText({streamId:i,totalSize:c,destinationIdentities:t?.destinationIdentities,topic:t?.topic,attachedStreamIds:l,attributes:t?.attributes});return yield m.write(e),h(1,0),yield m.close(),t?.attachments&&l&&(yield Promise.all(t.attachments.map((g,b)=>H(this,void 0,void 0,function*(){return this._sendFile(l[b],g,{topic:t.topic,mimeType:g.type,onProgress:_=>{h(_,b+1)}})})))),m.info})}streamText(e){return H(this,void 0,void 0,function*(){var t,r,i;const s=(t=e?.streamId)!==null&&t!==void 0?t:crypto.randomUUID(),c={id:s,mimeType:"text/plain",timestamp:Date.now(),topic:(r=e?.topic)!==null&&r!==void 0?r:"",size:e?.totalSize,attributes:e?.attributes,encryptionType:!((i=this.engine.e2eeManager)===null||i===void 0)&&i.isDataChannelEncryptionEnabled?sr.GCM:sr.NONE},l=new Mv({streamId:s,mimeType:c.mimeType,topic:c.topic,timestamp:al(c.timestamp),totalLength:al(e?.totalSize),attributes:c.attributes,contentHeader:{case:"textHeader",value:new TD({version:e?.version,attachedStreamIds:e?.attachedStreamIds,replyToStreamId:e?.replyToStreamId,operationType:e?.type==="update"?Wx.UPDATE:Wx.CREATE})}}),d=e?.destinationIdentities,h=new Fr({destinationIdentities:d,value:{case:"streamHeader",value:l}});yield this.engine.sendDataPacket(h,wt.RELIABLE);let m=0;const g=this.engine,b=new WritableStream({write(E){return H(this,void 0,void 0,function*(){for(const A of FJ(E,KA)){const M=new Dv({content:A,streamId:s,chunkIndex:al(m)}),F=new Fr({destinationIdentities:d,value:{case:"streamChunk",value:M}});yield g.sendDataPacket(F,wt.RELIABLE),m+=1}})},close(){return H(this,void 0,void 0,function*(){const E=new Ov({streamId:s}),A=new Fr({destinationIdentities:d,value:{case:"streamTrailer",value:E}});yield g.sendDataPacket(A,wt.RELIABLE)})},abort(E){console.log("Sink error:",E)}});let _=()=>H(this,void 0,void 0,function*(){yield R.close()});g.once(Ve.Closing,_);const R=new KZ(b,c,()=>this.engine.off(Ve.Closing,_));return R})}sendFile(e,t){return H(this,void 0,void 0,function*(){const r=crypto.randomUUID();return yield this._sendFile(r,e,t),{id:r}})}_sendFile(e,t,r){return H(this,void 0,void 0,function*(){var i;const s=yield this.streamBytes({streamId:e,totalSize:t.size,name:t.name,mimeType:(i=r?.mimeType)!==null&&i!==void 0?i:t.type,topic:r?.topic,destinationIdentities:r?.destinationIdentities}),c=t.stream().getReader();for(;;){const{done:l,value:d}=yield c.read();if(l)break;yield s.write(d)}return yield s.close(),s.info})}streamBytes(e){return H(this,void 0,void 0,function*(){var t,r,i,s,c,l;const d=(t=e?.streamId)!==null&&t!==void 0?t:crypto.randomUUID(),h=e?.destinationIdentities,m={id:d,mimeType:(r=e?.mimeType)!==null&&r!==void 0?r:"application/octet-stream",topic:(i=e?.topic)!==null&&i!==void 0?i:"",timestamp:Date.now(),attributes:e?.attributes,size:e?.totalSize,name:(s=e?.name)!==null&&s!==void 0?s:"unknown",encryptionType:!((c=this.engine.e2eeManager)===null||c===void 0)&&c.isDataChannelEncryptionEnabled?sr.GCM:sr.NONE},g=new Mv({totalLength:al((l=m.size)!==null&&l!==void 0?l:0),mimeType:m.mimeType,streamId:d,topic:m.topic,timestamp:al(Date.now()),attributes:m.attributes,contentHeader:{case:"byteHeader",value:new kD({name:m.name})}}),b=new Fr({destinationIdentities:h,value:{case:"streamHeader",value:g}});yield this.engine.sendDataPacket(b,wt.RELIABLE);let _=0;const R=new Hr,E=this.engine,A=this.log,M=new WritableStream({write(j){return H(this,void 0,void 0,function*(){const C=yield R.lock();let N=0;try{for(;N<j.byteLength;){const D=j.slice(N,N+KA),S=new Fr({destinationIdentities:h,value:{case:"streamChunk",value:new Dv({content:D,streamId:d,chunkIndex:al(_)})}});yield E.sendDataPacket(S,wt.RELIABLE),_+=1,N+=D.byteLength}}finally{C()}})},close(){return H(this,void 0,void 0,function*(){const j=new Ov({streamId:d}),C=new Fr({destinationIdentities:h,value:{case:"streamTrailer",value:j}});yield E.sendDataPacket(C,wt.RELIABLE)})},abort(j){A.error("Sink error:",j)}});return new WZ(M,m)})}}class IO extends he{constructor(e,t,r,i,s){super(e,r,s),this.sid=t,this.receiver=i}get isLocal(){return!1}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?De.Muted:De.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const t=r=>{r.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",t),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(De.Ended,this))};e.addEventListener("removetrack",t)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return H(this,void 0,void 0,function*(){var e;return!((e=this.receiver)===null||e===void 0)&&e.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),DT)),bJ()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const e=()=>{var t;this.timeSyncHandle=requestAnimationFrame(()=>e());const r=(t=this.receiver)===null||t===void 0?void 0:t.getSynchronizationSources()[0];if(r){const{timestamp:i,rtpTimestamp:s}=r;s&&this.rtpTimestamp!==s&&(this.emit(De.TimeSyncUpdate,{timestamp:i,rtpTimestamp:s}),this.rtpTimestamp=s)}};e()}}class PO extends IO{constructor(e,t,r,i,s,c){super(e,t,he.Kind.Audio,r,c),this.monitorReceiver=()=>H(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const l=yield this.getReceiverStats();l&&this.prevStats&&this.receiver&&(this._currentBitrate=V0(l,this.prevStats)),this.prevStats=l}),this.audioContext=i,this.webAudioPluginNodes=[],s&&(this.sinkId=s.deviceId)}setVolume(e){var t;for(const r of this.attachedElements)this.audioContext?(t=this.gainNode)===null||t===void 0||t.gain.setTargetAtTime(e,0,.1):r.volume=e;sa()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(sa())return 1;let e=0;return this.attachedElements.forEach(t=>{t.volume>e&&(e=t.volume)}),e}setSinkId(e){return H(this,void 0,void 0,function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map(t=>{if(d_(t))return t.setSinkId(e)}))})}attach(e){const t=this.attachedElements.length===0;return e?super.attach(e):e=super.attach(),this.sinkId&&d_(e)&&e.setSinkId(this.sinkId).catch(r=>{this.log.error("Failed to set sink id on remote audio track",r,this.logContext)}),this.audioContext&&t&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let t;return e?(t=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(t=super.detach(),this.disconnectWebAudio()),t}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,t){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(t.srcObject);let r=this.sourceNode;this.webAudioPluginNodes.forEach(i=>{r.connect(i),r=i}),this.gainNode=e.createGain(),r.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),e.state!=="running"&&e.resume().then(()=>{e.state!=="running"&&this.emit(De.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(i=>{this.emit(De.AudioPlaybackFailed,i)})}disconnectWebAudio(){var e,t;(e=this.gainNode)===null||e===void 0||e.disconnect(),(t=this.sourceNode)===null||t===void 0||t.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return H(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let t;return e.forEach(r=>{r.type==="inbound-rtp"&&(t={type:"audio",streamId:r.id,timestamp:r.timestamp,jitter:r.jitter,bytesReceived:r.bytesReceived,concealedSamples:r.concealedSamples,concealmentEvents:r.concealmentEvents,silentConcealedSamples:r.silentConcealedSamples,silentConcealmentEvents:r.silentConcealmentEvents,totalAudioEnergy:r.totalAudioEnergy,totalSamplesDuration:r.totalSamplesDuration})}),t})}}const F1=100;class QZ extends IO{constructor(e,t,r,i,s){super(e,t,he.Kind.Video,r,s),this.elementInfos=[],this.monitorReceiver=()=>H(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const c=yield this.getReceiverStats();c&&this.prevStats&&this.receiver&&(this._currentBitrate=V0(c,this.prevStats)),this.prevStats=c}),this.debouncedHandleResize=NT(()=>{this.updateDimensions()},F1),this.adaptiveStreamSettings=i}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}setStreamState(e){super.setStreamState(e),this.log.debug("setStreamState",e),this.isAdaptiveStream&&e===he.StreamState.Active&&this.updateVisibility()}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach(t=>{e?td(this._mediaStreamTrack,t):Fu(this._mediaStreamTrack,t)})}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(t=>t.element===e)===void 0){const t=new XZ(e);this.observeElementInfo(t)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&this.elementInfos.find(t=>t===e)===void 0?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const t=this.elementInfos.filter(r=>r===e);for(const r of t)r.stopObserving();this.elementInfos=this.elementInfos.filter(r=>r!==e),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let t=[];if(e)return this.stopObservingElement(e),super.detach(e);t=super.detach();for(const r of t)this.stopObservingElement(r);return t}getDecoderImplementation(){var e;return(e=this.prevStats)===null||e===void 0?void 0:e.decoderImplementation}getReceiverStats(){return H(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let t,r="",i=new Map;return e.forEach(s=>{s.type==="inbound-rtp"?(r=s.codecId,t={type:"video",streamId:s.id,framesDecoded:s.framesDecoded,framesDropped:s.framesDropped,framesReceived:s.framesReceived,packetsReceived:s.packetsReceived,packetsLost:s.packetsLost,frameWidth:s.frameWidth,frameHeight:s.frameHeight,pliCount:s.pliCount,firCount:s.firCount,nackCount:s.nackCount,jitter:s.jitter,timestamp:s.timestamp,bytesReceived:s.bytesReceived,decoderImplementation:s.decoderImplementation}):s.type==="codec"&&i.set(s.id,s)}),t&&r!==""&&i.get(r)&&(t.mimeType=i.get(r).mimeType),t})}stopObservingElement(e){const t=this.elementInfos.filter(r=>r.element===e);for(const r of t)this.stopObservingElementInfo(r)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return H(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(e){var t,r;const i=this.elementInfos.reduce((d,h)=>Math.max(d,h.visibilityChangedAt||0),0),s=!((r=(t=this.adaptiveStreamSettings)===null||t===void 0?void 0:t.pauseVideoInBackground)!==null&&r!==void 0)||r?this.isInBackground:!1,c=this.elementInfos.some(d=>d.pictureInPicture),l=this.elementInfos.some(d=>d.visible)&&!s||c;if(!(this.lastVisible===l&&!e)){if(!l&&Date.now()-i<F1){wr.setTimeout(()=>{this.updateVisibility()},F1);return}this.lastVisible=l,this.emit(De.VisibilityChanged,l,this)}}updateDimensions(){var e,t;let r=0,i=0;const s=this.getPixelDensity();for(const c of this.elementInfos){const l=c.width()*s,d=c.height()*s;l+d>r+i&&(r=l,i=d)}((e=this.lastDimensions)===null||e===void 0?void 0:e.width)===r&&((t=this.lastDimensions)===null||t===void 0?void 0:t.height)===i||(this.lastDimensions={width:r,height:i},this.emit(De.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const t=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pixelDensity;return t==="screen"?_A():t||(_A()>2?2:1)}}class XZ{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,t){this.onVisibilityChanged=r=>{var i;const{target:s,isIntersecting:c}=r;s===this.element&&(this.isIntersecting=c,this.isPiP=Yh(this.element),this.visibilityChangedAt=Date.now(),(i=this.handleVisibilityChanged)===null||i===void 0||i.call(this))},this.onEnterPiP=()=>{var r,i,s;(i=(r=window.documentPictureInPicture)===null||r===void 0?void 0:r.window)===null||i===void 0||i.addEventListener("pagehide",this.onLeavePiP),this.isPiP=Yh(this.element),(s=this.handleVisibilityChanged)===null||s===void 0||s.call(this)},this.onLeavePiP=()=>{var r;this.isPiP=Yh(this.element),(r=this.handleVisibilityChanged)===null||r===void 0||r.call(this)},this.element=e,this.isIntersecting=t??v_(e),this.isPiP=di()&&Yh(e),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var e,t,r;this.isIntersecting=v_(this.element),this.isPiP=Yh(this.element),this.element.handleResize=()=>{var i;(i=this.handleResize)===null||i===void 0||i.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,TA().observe(this.element),SA().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),(e=window.documentPictureInPicture)===null||e===void 0||e.addEventListener("enter",this.onEnterPiP),(r=(t=window.documentPictureInPicture)===null||t===void 0?void 0:t.window)===null||r===void 0||r.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var e,t,r,i,s;(e=TA())===null||e===void 0||e.unobserve(this.element),(t=SA())===null||t===void 0||t.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),(r=window.documentPictureInPicture)===null||r===void 0||r.removeEventListener("enter",this.onEnterPiP),(s=(i=window.documentPictureInPicture)===null||i===void 0?void 0:i.window)===null||s===void 0||s.removeEventListener("pagehide",this.onLeavePiP)}}function Yh(n){var e,t;return document.pictureInPictureElement===n?!0:!((e=window.documentPictureInPicture)===null||e===void 0)&&e.window?v_(n,(t=window.documentPictureInPicture)===null||t===void 0?void 0:t.window):!1}function v_(n,e){const t=e||window;let r=n.offsetTop,i=n.offsetLeft;const s=n.offsetWidth,c=n.offsetHeight,{hidden:l}=n,{display:d}=getComputedStyle(n);for(;n.offsetParent;)n=n.offsetParent,r+=n.offsetTop,i+=n.offsetLeft;return r<t.pageYOffset+t.innerHeight&&i<t.pageXOffset+t.innerWidth&&r+c>t.pageYOffset&&i+s>t.pageXOffset&&!l&&d!=="none"}class La extends da.EventEmitter{constructor(e,t,r,i){var s;super(),this.metadataMuted=!1,this.encryption=sr.NONE,this.log=gt,this.handleMuted=()=>{this.emit(De.Muted)},this.handleUnmuted=()=>{this.emit(De.Unmuted)},this.log=eo((s=i?.loggerName)!==null&&s!==void 0?s:_s.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=t,this.trackName=r,this.source=he.Source.Unknown}setTrack(e){this.track&&(this.track.off(De.Muted,this.handleMuted),this.track.off(De.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(De.Muted,this.handleMuted),e.on(De.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),At(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==sr.NONE}get audioTrack(){if(ta(this.track))return this.track}get videoTrack(){if(wc(this.track))return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=he.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===he.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}(function(n){(function(e){e.Desired="desired",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed"})(n.SubscriptionStatus||(n.SubscriptionStatus={})),(function(e){e.Allowed="allowed",e.NotAllowed="not_allowed"})(n.PermissionStatus||(n.PermissionStatus={}))})(La||(La={}));class Uv extends La{get isUpstreamPaused(){var e;return(e=this.track)===null||e===void 0?void 0:e.isUpstreamPaused}constructor(e,t,r,i){super(e,t.sid,t.name,i),this.track=void 0,this.handleTrackEnded=()=>{this.emit(De.Ended)},this.handleCpuConstrained=()=>{this.track&&wc(this.track)&&this.emit(De.CpuConstrained,this.track)},this.updateInfo(t),this.setTrack(r)}setTrack(e){this.track&&(this.track.off(De.Ended,this.handleTrackEnded),this.track.off(De.CpuConstrained,this.handleCpuConstrained)),super.setTrack(e),e&&(e.on(De.Ended,this.handleTrackEnded),e.on(De.CpuConstrained,this.handleCpuConstrained))}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return H(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.mute()})}unmute(){return H(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.unmute()})}pauseUpstream(){return H(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.pauseUpstream()})}resumeUpstream(){return H(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.resumeUpstream()})}getTrackFeatures(){var e;if(ta(this.track)){const t=this.track.getSourceTrackSettings(),r=new Set;return t.autoGainControl&&r.add(hr.TF_AUTO_GAIN_CONTROL),t.echoCancellation&&r.add(hr.TF_ECHO_CANCELLATION),t.noiseSuppression&&r.add(hr.TF_NOISE_SUPPRESSION),t.channelCount&&t.channelCount>1&&r.add(hr.TF_STEREO),!((e=this.options)===null||e===void 0)&&e.dtx||r.add(hr.TF_NO_DTX),this.track.enhancedNoiseCancellation&&r.add(hr.TF_ENHANCED_NOISE_CANCELLATION),Array.from(r.values())}else return[]}}function z0(n,e){return H(this,void 0,void 0,function*(){n??(n={});let t=!1;const{audioProcessor:r,videoProcessor:i,optionsWithoutProcessor:s}=gO(n);let c=s.audio,l=s.video;if(r&&typeof s.audio=="object"&&(s.audio.processor=r),i&&typeof s.video=="object"&&(s.video.processor=i),n.audio&&typeof s.audio=="object"&&typeof s.audio.deviceId=="string"){const g=s.audio.deviceId;s.audio.deviceId={exact:g},t=!0,c=Object.assign(Object.assign({},s.audio),{deviceId:{ideal:g}})}if(s.video&&typeof s.video=="object"&&typeof s.video.deviceId=="string"){const g=s.video.deviceId;s.video.deviceId={exact:g},t=!0,l=Object.assign(Object.assign({},s.video),{deviceId:{ideal:g}})}s.audio===!0?s.audio={deviceId:"default"}:typeof s.audio=="object"&&s.audio!==null&&(s.audio=Object.assign(Object.assign({},s.audio),{deviceId:s.audio.deviceId||"default"})),s.video===!0?s.video={deviceId:"default"}:typeof s.video=="object"&&!s.video.deviceId&&(s.video.deviceId="default");const d=fO(s,SO,TO),h=ET(d),m=navigator.mediaDevices.getUserMedia(h);s.audio&&(fr.userMediaPromiseMap.set("audioinput",m),m.catch(()=>fr.userMediaPromiseMap.delete("audioinput"))),s.video&&(fr.userMediaPromiseMap.set("videoinput",m),m.catch(()=>fr.userMediaPromiseMap.delete("videoinput")));try{const g=yield m;return yield Promise.all(g.getTracks().map(b=>H(this,void 0,void 0,function*(){const _=b.kind==="audio";let R=_?d.audio:d.video;(typeof R=="boolean"||!R)&&(R={});let E;const A=_?h.audio:h.video;typeof A!="boolean"&&(E=A);const M=b.getSettings().deviceId;E?.deviceId&&uc(E.deviceId)!==M?E.deviceId=M:E||(E={deviceId:M});const F=wZ(b,E,e);return F.kind===he.Kind.Video?F.source=he.Source.Camera:F.kind===he.Kind.Audio&&(F.source=he.Source.Microphone),F.mediaStream=g,ta(F)&&r?yield F.setProcessor(r):wc(F)&&i&&(yield F.setProcessor(i)),F})))}catch(g){if(!t)throw g;return z0(Object.assign(Object.assign({},n),{audio:c,video:l}),e)}})}function JZ(n){return H(this,void 0,void 0,function*(){return(yield z0({audio:!1,video:!0}))[0]})}function ZZ(n){return H(this,void 0,void 0,function*(){return(yield z0({audio:!0,video:!1}))[0]})}var ps;(function(n){n.Excellent="excellent",n.Good="good",n.Poor="poor",n.Lost="lost",n.Unknown="unknown"})(ps||(ps={}));function eee(n){switch(n){case af.EXCELLENT:return ps.Excellent;case af.GOOD:return ps.Good;case af.POOR:return ps.Poor;case af.LOST:return ps.Lost;default:return ps.Unknown}}class MO extends da.EventEmitter{get logContext(){var e,t;return Object.assign({},(t=(e=this.loggerOptions)===null||e===void 0?void 0:e.loggerContextCb)===null||t===void 0?void 0:t.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(e=>e.isEncrypted)}get isAgent(){var e;return((e=this.permissions)===null||e===void 0?void 0:e.agent)||this.kind===zf.AGENT}get isActive(){var e;return((e=this.participantInfo)===null||e===void 0?void 0:e.state)===Ju.ACTIVE}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(e,t,r,i,s,c){let l=arguments.length>6&&arguments[6]!==void 0?arguments[6]:zf.STANDARD;var d;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=ps.Unknown,this.log=gt,this.log=eo((d=c?.loggerName)!==null&&d!==void 0?d:_s.Participant),this.loggerOptions=c,this.setMaxListeners(100),this.sid=e,this.identity=t,this.name=r,this.metadata=i,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=l,this._attributes=s??{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,t]of this.trackPublications)if(t.source===e)return t}getTrackPublicationByName(e){for(const[,t]of this.trackPublications)if(t.trackName===e)return t}waitUntilActive(){return this.isActive?Promise.resolve():this.activeFuture?this.activeFuture.promise:(this.activeFuture=new Qi,this.once(ye.Active,()=>{var e,t;(t=(e=this.activeFuture)===null||e===void 0?void 0:e.resolve)===null||t===void 0||t.call(e),this.activeFuture=void 0}),this.activeFuture.promise)}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const t=this.getTrackPublication(he.Source.Camera);return!(!((e=t?.isMuted)!==null&&e!==void 0)||e)}get isMicrophoneEnabled(){var e;const t=this.getTrackPublication(he.Source.Microphone);return!(!((e=t?.isMuted)!==null&&e!==void 0)||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(he.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(e){var t;return this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version?!1:(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.state===Ju.ACTIVE&&((t=this.participantInfo)===null||t===void 0?void 0:t.state)!==Ju.ACTIVE&&this.emit(ye.Active),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,!0)}_setMetadata(e){const t=this.metadata!==e,r=this.metadata;this.metadata=e,t&&this.emit(ye.ParticipantMetadataChanged,r)}_setName(e){const t=this.name!==e;this.name=e,t&&this.emit(ye.ParticipantNameChanged,e)}_setAttributes(e){const t=xJ(this.attributes,e);this._attributes=e,Object.keys(t).length>0&&this.emit(ye.AttributesChanged,t)}setPermissions(e){var t,r,i,s,c,l;const d=this.permissions,h=e.canPublish!==((t=this.permissions)===null||t===void 0?void 0:t.canPublish)||e.canSubscribe!==((r=this.permissions)===null||r===void 0?void 0:r.canSubscribe)||e.canPublishData!==((i=this.permissions)===null||i===void 0?void 0:i.canPublishData)||e.hidden!==((s=this.permissions)===null||s===void 0?void 0:s.hidden)||e.recorder!==((c=this.permissions)===null||c===void 0?void 0:c.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some((m,g)=>{var b;return m!==((b=this.permissions)===null||b===void 0?void 0:b.canPublishSources[g])})||e.canSubscribeMetrics!==((l=this.permissions)===null||l===void 0?void 0:l.canSubscribeMetrics);return this.permissions=e,h&&this.emit(ye.ParticipantPermissionsChanged,d),h}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(ye.IsSpeakingChanged,e))}setConnectionQuality(e){const t=this._connectionQuality;this._connectionQuality=eee(e),t!==this._connectionQuality&&this.emit(ye.ConnectionQualityChanged,this._connectionQuality)}setDisconnected(){var e,t;this.activeFuture&&((t=(e=this.activeFuture).reject)===null||t===void 0||t.call(e,new Error("Participant disconnected")),this.activeFuture=void 0)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach(t=>ta(t.track)&&t.track.setAudioContext(e))}addTrackPublication(e){e.on(De.Muted,()=>{this.emit(ye.TrackMuted,e)}),e.on(De.Unmuted,()=>{this.emit(ye.TrackUnmuted,e)});const t=e;switch(t.track&&(t.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case he.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case he.Kind.Video:this.videoTrackPublications.set(e.trackSid,e);break}}}function tee(n){var e,t,r;if(!n.participantSid&&!n.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new AD({participantIdentity:(e=n.participantIdentity)!==null&&e!==void 0?e:"",participantSid:(t=n.participantSid)!==null&&t!==void 0?t:"",allTracks:(r=n.allowAll)!==null&&r!==void 0?r:!1,trackSids:n.allowedTrackSids||[]})}class nee extends MO{constructor(e,t,r,i,s,c){super(e,t,void 0,void 0,void 0,{loggerName:i.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=sr.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new Qi)},this.handleReconnected=()=>{var l,d;(d=(l=this.reconnectFuture)===null||l===void 0?void 0:l.resolve)===null||d===void 0||d.call(l),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleClosing=()=>{var l,d,h,m,g,b;this.reconnectFuture&&(this.reconnectFuture.promise.catch(_=>this.log.warn(_.message,this.logContext)),(d=(l=this.reconnectFuture)===null||l===void 0?void 0:l.reject)===null||d===void 0||d.call(l,new Error("Got disconnected during reconnection attempt")),this.reconnectFuture=void 0),this.signalConnectedFuture&&((m=(h=this.signalConnectedFuture).reject)===null||m===void 0||m.call(h,new Error("Got disconnected without signal connected")),this.signalConnectedFuture=void 0),(b=(g=this.activeAgentFuture)===null||g===void 0?void 0:g.reject)===null||b===void 0||b.call(g,new Error("Got disconnected without active agent present")),this.activeAgentFuture=void 0,this.firstActiveAgent=void 0},this.handleSignalConnected=l=>{var d,h;l.participant&&this.updateInfo(l.participant),this.signalConnectedFuture||(this.signalConnectedFuture=new Qi),(h=(d=this.signalConnectedFuture).resolve)===null||h===void 0||h.call(d)},this.handleSignalRequestResponse=l=>{const{requestId:d,reason:h,message:m}=l,g=this.pendingSignalRequests.get(d);g&&(h!==TT.OK&&g.reject(new gA(m,h)),this.pendingSignalRequests.delete(d))},this.handleDataPacket=l=>{switch(l.value.case){case"rpcResponse":let d=l.value.value,h=null,m=null;d.value.case==="payload"?h=d.value.value:d.value.case==="error"&&(m=An.fromProto(d.value.value)),this.handleIncomingRpcResponse(d.requestId,h,m);break;case"rpcAck":let g=l.value.value;this.handleIncomingRpcAck(g.requestId);break}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(l=>tee(l)))},this.onTrackUnmuted=l=>{this.onTrackMuted(l,l.isUpstreamPaused)},this.onTrackMuted=(l,d)=>{if(d===void 0&&(d=!0),!l.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),At(l)));return}this.engine.updateMuteStatus(l.sid,d)},this.onTrackUpstreamPaused=l=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),At(l))),this.onTrackMuted(l,!0)},this.onTrackUpstreamResumed=l=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),At(l))),this.onTrackMuted(l,l.isMuted)},this.onTrackFeatureUpdate=l=>{const d=this.audioTrackPublications.get(l.sid);if(!d){this.log.warn("Could not update local audio track settings, missing publication for track ".concat(l.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack(d.trackSid,d.getTrackFeatures())},this.onTrackCpuConstrained=(l,d)=>{this.log.debug("track cpu constrained",Object.assign(Object.assign({},this.logContext),At(d))),this.emit(ye.LocalTrackCpuConstrained,l,d)},this.handleSubscribedQualityUpdate=l=>H(this,void 0,void 0,function*(){var d,h,m,g,b;if(!(!((b=this.roomOptions)===null||b===void 0)&&b.dynacast))return;const _=this.videoTrackPublications.get(l.trackSid);if(!_){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:l.trackSid}));return}if(!_.videoTrack)return;const R=yield _.videoTrack.setPublishingCodecs(l.subscribedCodecs);try{for(var E=!0,A=za(R),M;M=yield A.next(),d=M.done,!d;E=!0){g=M.value,E=!1;const F=g;mJ(F)&&(this.log.debug("publish ".concat(F," for ").concat(_.videoTrack.sid),Object.assign(Object.assign({},this.logContext),At(_))),yield this.publishAdditionalCodecForTrack(_.videoTrack,F,_.options))}}catch(F){h={error:F}}finally{try{!E&&!d&&(m=A.return)&&(yield m.call(A))}finally{if(h)throw h.error}}}),this.handleLocalTrackUnpublished=l=>{const d=this.trackPublications.get(l.trackSid);if(!d){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:l.trackSid}));return}this.unpublishTrack(d.track)},this.handleTrackEnded=l=>H(this,void 0,void 0,function*(){if(l.source===he.Source.ScreenShare||l.source===he.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),At(l))),this.unpublishTrack(l);else if(l.isUserProvided)yield l.mute();else if(Oa(l)||Go(l))try{if(di())try{const d=yield navigator?.permissions.query({name:l.source===he.Source.Camera?"camera":"microphone"});if(d&&d.state==="denied")throw this.log.warn("user has revoked access to ".concat(l.source),Object.assign(Object.assign({},this.logContext),At(l))),d.onchange=()=>{d.state!=="denied"&&(l.isMuted||l.restartTrack(),d.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}l.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),At(l))),Oa(l)?yield l.restartTrack({deviceId:"default"}):yield l.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),At(l))),yield l.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=r,this.roomOptions=i,this.setupEngine(r),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=s,this.roomOutgoingDataStreamManager=c}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==sr.NONE}getTrackPublication(e){const t=super.getTrackPublication(e);if(t)return t}getTrackPublicationByName(e){const t=super.getTrackPublicationByName(e);if(t)return t}setupEngine(e){var t;this.engine=e,this.engine.on(Ve.RemoteMute,(r,i)=>{const s=this.trackPublications.get(r);!s||!s.track||(i?s.mute():s.unmute())}),!((t=this.signalConnectedFuture)===null||t===void 0)&&t.isResolved&&(this.signalConnectedFuture=void 0),this.engine.on(Ve.Connected,this.handleReconnected).on(Ve.SignalConnected,this.handleSignalConnected).on(Ve.SignalRestarted,this.handleReconnected).on(Ve.SignalResumed,this.handleReconnected).on(Ve.Restarting,this.handleReconnecting).on(Ve.Resuming,this.handleReconnecting).on(Ve.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(Ve.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(Ve.Closing,this.handleClosing).on(Ve.SignalRequestResponse,this.handleSignalRequestResponse).on(Ve.DataPacketReceived,this.handleDataPacket)}setMetadata(e){return H(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:e})})}setName(e){return H(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:e})})}setAttributes(e){return H(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:e})})}requestMetadataUpdate(e){return H(this,arguments,void 0,function(t){var r=this;let{metadata:i,name:s,attributes:c}=t;return(function*(){return new Promise((l,d)=>H(r,void 0,void 0,function*(){var h,m;try{let g=!1;const b=yield this.engine.client.sendUpdateLocalMetadata((h=i??this.metadata)!==null&&h!==void 0?h:"",(m=s??this.name)!==null&&m!==void 0?m:"",c),_=performance.now();for(this.pendingSignalRequests.set(b,{resolve:l,reject:R=>{d(R),g=!0},values:{name:s,metadata:i,attributes:c}});performance.now()-_<5e3&&!g;){if((!s||this.name===s)&&(!i||this.metadata===i)&&(!c||Object.entries(c).every(R=>{let[E,A]=R;return this.attributes[E]===A||A===""&&!this.attributes[E]}))){this.pendingSignalRequests.delete(b),l();return}yield Er(50)}d(new gA("Request to update local metadata timed out","TimeoutError"))}catch(g){g instanceof Error&&d(g)}}))})()})}setCameraEnabled(e,t,r){return this.setTrackEnabled(he.Source.Camera,e,t,r)}setMicrophoneEnabled(e,t,r){return this.setTrackEnabled(he.Source.Microphone,e,t,r)}setScreenShareEnabled(e,t,r){return this.setTrackEnabled(he.Source.ScreenShare,e,t,r)}setE2EEEnabled(e){return H(this,void 0,void 0,function*(){this.encryptionType=e?sr.GCM:sr.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(e,t,r,i){return H(this,void 0,void 0,function*(){var s,c;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:t})),this.republishPromise&&(yield this.republishPromise);let l=this.getTrackPublication(e);if(t)if(l)yield l.unmute();else{let d;if(this.pendingPublishing.has(e)){const h=yield this.waitForPendingPublicationOfSource(e);return h||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e})),yield h?.unmute(),h}this.pendingPublishing.add(e);try{switch(e){case he.Source.Camera:d=yield this.createTracks({video:(s=r)!==null&&s!==void 0?s:!0});break;case he.Source.Microphone:d=yield this.createTracks({audio:(c=r)!==null&&c!==void 0?c:!0});break;case he.Source.ScreenShare:d=yield this.createScreenTracks(Object.assign({},r));break;default:throw new Fa(e)}}catch(h){throw d?.forEach(m=>{m.stop()}),h instanceof Error&&this.emit(ye.MediaDevicesError,h,c_(e)),this.pendingPublishing.delete(e),h}for(const h of d){const m=Object.assign(Object.assign({},this.roomOptions.publishDefaults),r);e===he.Source.Microphone&&ta(h)&&m.preConnectBuffer&&(this.log.info("starting preconnect buffer for microphone",Object.assign({},this.logContext)),h.startPreConnectBuffer())}try{const h=[];for(const g of d)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),At(g))),h.push(this.publishTrack(g,i));[l]=yield Promise.all(h)}catch(h){throw d?.forEach(m=>{m.stop()}),h}finally{this.pendingPublishing.delete(e)}}else if(!l?.track&&this.pendingPublishing.has(e)&&(l=yield this.waitForPendingPublicationOfSource(e),l||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e}))),l&&l.track)if(e===he.Source.ScreenShare){l=yield this.unpublishTrack(l.track);const d=this.getTrackPublication(he.Source.ScreenShareAudio);d&&d.track&&this.unpublishTrack(d.track)}else yield l.mute();return l})}enableCameraAndMicrophone(){return H(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(he.Source.Camera)||this.pendingPublishing.has(he.Source.Microphone))){this.pendingPublishing.add(he.Source.Camera),this.pendingPublishing.add(he.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map(t=>this.publishTrack(t)))}finally{this.pendingPublishing.delete(he.Source.Camera),this.pendingPublishing.delete(he.Source.Microphone)}}})}createTracks(e){return H(this,void 0,void 0,function*(){var t,r;e??(e={});const i=fO(e,(t=this.roomOptions)===null||t===void 0?void 0:t.audioCaptureDefaults,(r=this.roomOptions)===null||r===void 0?void 0:r.videoCaptureDefaults);try{return(yield z0(i,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext})).map(l=>(ta(l)&&(this.microphoneError=void 0,l.setAudioContext(this.audioContext),l.source=he.Source.Microphone,this.emit(ye.AudioStreamAcquired)),wc(l)&&(this.cameraError=void 0,l.source=he.Source.Camera),l))}catch(s){throw s instanceof Error&&(e.audio&&(this.microphoneError=s),e.video&&(this.cameraError=s)),s}})}createScreenTracks(e){return H(this,void 0,void 0,function*(){if(e===void 0&&(e={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new CT("getDisplayMedia not supported");e.resolution===void 0&&!AJ()&&(e.resolution=wT.h1080fps30.resolution);const t=vJ(e),r=yield navigator.mediaDevices.getDisplayMedia(t),i=r.getVideoTracks();if(i.length===0)throw new Fa("no video track found");const s=new Lv(i[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});s.source=he.Source.ScreenShare,e.contentHint&&(s.mediaStreamTrack.contentHint=e.contentHint);const c=[s];if(r.getAudioTracks().length>0){this.emit(ye.AudioStreamAcquired);const l=new jv(r.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});l.source=he.Source.ScreenShareAudio,c.push(l)}return c})}publishTrack(e,t){return H(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(e,t)})}publishOrRepublishTrack(e,t){return H(this,arguments,void 0,function(r,i){var s=this;let c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return(function*(){var l,d,h,m;Oa(r)&&r.setAudioContext(s.audioContext),yield(l=s.reconnectFuture)===null||l===void 0?void 0:l.promise,s.republishPromise&&!c&&(yield s.republishPromise),fl(r)&&s.pendingPublishPromises.has(r)&&(yield s.pendingPublishPromises.get(r));let g;if(r instanceof MediaStreamTrack)g=r.getConstraints();else{g=r.constraints;let M;switch(r.source){case he.Source.Microphone:M="audioinput";break;case he.Source.Camera:M="videoinput"}M&&s.activeDeviceMap.has(M)&&(g=Object.assign(Object.assign({},g),{deviceId:s.activeDeviceMap.get(M)}))}if(r instanceof MediaStreamTrack)switch(r.kind){case"audio":r=new jv(r,g,!0,s.audioContext,{loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});break;case"video":r=new Lv(r,g,!0,{loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});break;default:throw new Fa("unsupported MediaStreamTrack kind ".concat(r.kind))}else r.updateLoggerOptions({loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});let b;if(s.trackPublications.forEach(M=>{M.track&&M.track===r&&(b=M)}),b)return s.log.warn("track has already been published, skipping",Object.assign(Object.assign({},s.logContext),At(b))),b;const _=Object.assign(Object.assign({},s.roomOptions.publishDefaults),i),R="channelCount"in r.mediaStreamTrack.getSettings()&&r.mediaStreamTrack.getSettings().channelCount===2||r.mediaStreamTrack.getConstraints().channelCount===2,E=(d=_.forceStereo)!==null&&d!==void 0?d:R;E&&(_.dtx===void 0&&s.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},s.logContext),At(r))),_.red===void 0&&s.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(h=_.dtx)!==null&&h!==void 0||(_.dtx=!1),(m=_.red)!==null&&m!==void 0||(_.red=!1)),!IJ()&&s.roomOptions.e2ee&&(s.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},s.logContext)),_.simulcast=!1),_.source&&(r.source=_.source);const A=new Promise((M,F)=>H(s,void 0,void 0,function*(){try{if(this.engine.client.currentState!==on.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:At(r)}));let j=!1;const C=setTimeout(()=>{j=!0,r.stop(),F(new mA("publishing rejected as engine not connected within timeout",408))},15e3);if(yield this.waitUntilEngineConnected(),clearTimeout(C),j)return;const N=yield this.publish(r,_,E);M(N)}else try{const j=yield this.publish(r,_,E);M(j)}catch(j){F(j)}}catch(j){F(j)}}));s.pendingPublishPromises.set(r,A);try{return yield A}catch(M){throw M}finally{s.pendingPublishPromises.delete(r)}})()})}waitUntilEngineConnected(){return this.signalConnectedFuture||(this.signalConnectedFuture=new Qi),this.signalConnectedFuture.promise}hasPermissionsToPublish(e){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),At(e))),!1;const{canPublish:t,canPublishSources:r}=this.permissions;return t&&(r.length===0||r.map(i=>_J(i)).includes(e.source))?!0:(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),At(e))),!1)}publish(e,t,r){return H(this,void 0,void 0,function*(){var i,s,c,l,d,h,m,g,b,_;if(!this.hasPermissionsToPublish(e))throw new mA("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(P=>fl(e)&&P.source===e.source)&&e.source!==he.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),At(e))),t.stopMicTrackOnMute&&ta(e)&&(e.stopOnMute=!0),e.source===he.Source.ScreenShare&&Cl()&&(t.simulcast=!1),t.videoCodec==="av1"&&!wJ()&&(t.videoCodec=void 0),t.videoCodec==="vp9"&&!EJ()&&(t.videoCodec=void 0),t.videoCodec===void 0&&(t.videoCodec=p_),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(P=>t.videoCodec===vf(P.mime))||(t.videoCodec=vf(this.enabledPublishVideoCodecs[0].mime)));const E=t.videoCodec;e.on(De.Muted,this.onTrackMuted),e.on(De.Unmuted,this.onTrackUnmuted),e.on(De.Ended,this.handleTrackEnded),e.on(De.UpstreamPaused,this.onTrackUpstreamPaused),e.on(De.UpstreamResumed,this.onTrackUpstreamResumed),e.on(De.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const A=[],M=!(!((i=t.dtx)!==null&&i!==void 0)||i),F=e.getSourceTrackSettings();F.autoGainControl&&A.push(hr.TF_AUTO_GAIN_CONTROL),F.echoCancellation&&A.push(hr.TF_ECHO_CANCELLATION),F.noiseSuppression&&A.push(hr.TF_NOISE_SUPPRESSION),F.channelCount&&F.channelCount>1&&A.push(hr.TF_STEREO),M&&A.push(hr.TF_NO_DTX),Oa(e)&&e.hasPreConnectBuffer&&A.push(hr.TF_PRECONNECT_BUFFER);const j=new Ff({cid:e.mediaStreamTrack.id,name:t.name,type:he.kindToProto(e.kind),muted:e.isMuted,source:he.sourceToProto(e.source),disableDtx:M,encryption:this.encryptionType,stereo:r,disableRed:this.isE2EEEnabled||!(!((s=t.red)!==null&&s!==void 0)||s),stream:t?.stream,backupCodecPolicy:t?.backupCodecPolicy,audioFeatures:A});let C;if(e.kind===he.Kind.Video){let P={width:0,height:0};try{P=yield e.waitForDimensions()}catch{const U=(l=(c=this.roomOptions.videoCaptureDefaults)===null||c===void 0?void 0:c.resolution)!==null&&l!==void 0?l:$f.h720.resolution;P={width:U.width,height:U.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),At(e)),{dims:P}))}j.width=P.width,j.height=P.height,Go(e)&&(fs(E)&&(e.source===he.Source.ScreenShare&&(t.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),At(e))))),t.scalabilityMode=(d=t.scalabilityMode)!==null&&d!==void 0?d:"L3T3_KEY"),j.simulcastCodecs=[new Qx({codec:E,cid:e.mediaStreamTrack.id})],t.backupCodec===!0&&(t.backupCodec={codec:p_}),t.backupCodec&&E!==t.backupCodec.codec&&j.encryption===sr.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),j.simulcastCodecs.push(new Qx({codec:t.backupCodec.codec,cid:""})))),C=g_(e.source===he.Source.ScreenShare,j.width,j.height,t),j.layers=$A(j.width,j.height,C,fs(t.videoCodec))}else e.kind===he.Kind.Audio&&(C=[{maxBitrate:(h=t.audioPreset)===null||h===void 0?void 0:h.maxBitrate,priority:(g=(m=t.audioPreset)===null||m===void 0?void 0:m.priority)!==null&&g!==void 0?g:"high",networkPriority:(_=(b=t.audioPreset)===null||b===void 0?void 0:b.priority)!==null&&_!==void 0?_:"high"}]);if(!this.engine||this.engine.isClosed)throw new ir("cannot publish track when not connected");const N=()=>H(this,void 0,void 0,function*(){var P,L,U;if(!this.engine.pcManager)throw new ir("pcManager is not ready");if(e.sender=yield this.engine.createSender(e,t,C),this.emit(ye.LocalSenderCreated,e.sender,e),Go(e)&&((P=t.degradationPreference)!==null&&P!==void 0||(t.degradationPreference=jZ(e)),e.setDegradationPreference(t.degradationPreference)),C)if(Cl()&&e.kind===he.Kind.Audio){let z;for(const V of this.engine.pcManager.publisher.getTransceivers())if(V.sender===e.sender){z=V;break}z&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:z,codec:"opus",maxbr:!((L=C[0])===null||L===void 0)&&L.maxBitrate?C[0].maxBitrate/1e3:0})}else e.codec&&fs(e.codec)&&(!((U=C[0])===null||U===void 0)&&U.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:j.cid,codec:e.codec,maxbr:C[0].maxBitrate/1e3});yield this.engine.negotiate()});let D;const S=new Promise((P,L)=>H(this,void 0,void 0,function*(){var U;try{D=yield this.engine.addTrack(j),P(D)}catch(z){e.sender&&(!((U=this.engine.pcManager)===null||U===void 0)&&U.publisher)&&(this.engine.pcManager.publisher.removeTrack(e.sender),yield this.engine.negotiate().catch(V=>{this.log.error("failed to negotiate after removing track due to failed add track request",Object.assign(Object.assign(Object.assign({},this.logContext),At(e)),{error:V}))})),L(z)}}));if(this.enabledPublishVideoCodecs.length>0)D=(yield Promise.all([S,N()]))[0];else{D=yield S;let P;if(D.codecs.forEach(L=>{P===void 0&&(P=L.mimeType)}),P&&e.kind===he.Kind.Video){const L=vf(P);L!==E&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),At(e)),{codec:L})),t.videoCodec=L,C=g_(e.source===he.Source.ScreenShare,j.width,j.height,t))}yield N()}const k=new Uv(e.kind,D,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(k.on(De.CpuConstrained,P=>this.onTrackCpuConstrained(P,k)),k.options=t,e.sid=D.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:C,trackInfo:D})),Go(e)?e.startMonitor(this.engine.client):Oa(e)&&e.startMonitor(),this.addTrackPublication(k),this.emit(ye.LocalTrackPublished,k),Oa(e)&&D.audioFeatures.includes(hr.TF_PRECONNECT_BUFFER)){const P=e.getPreConnectBuffer(),L=e.getPreConnectBufferMimeType();this.on(ye.LocalTrackSubscribed,U=>{if(U.trackSid===D.sid){if(!e.hasPreConnectBuffer){this.log.warn("subscribe event came to late, buffer already closed",this.logContext);return}this.log.debug("finished recording preconnect buffer",Object.assign(Object.assign({},this.logContext),At(e))),e.stopPreConnectBuffer()}}),P&&new Promise((z,V)=>H(this,void 0,void 0,function*(){var le,ve,K,oe,ee,Me;try{this.log.debug("waiting for agent",Object.assign(Object.assign({},this.logContext),At(e)));const fe=setTimeout(()=>{V(new Error("agent not active within 10 seconds"))},1e4),Se=yield this.waitUntilActiveAgentPresent();clearTimeout(fe),this.log.debug("sending preconnect buffer",Object.assign(Object.assign({},this.logContext),At(e)));const Oe=yield this.streamBytes({name:"preconnect-buffer",mimeType:L,topic:"lk.agent.pre-connect-audio-buffer",destinationIdentities:[Se.identity],attributes:{trackId:k.trackSid,sampleRate:String((ee=F.sampleRate)!==null&&ee!==void 0?ee:"48000"),channels:String((Me=F.channelCount)!==null&&Me!==void 0?Me:"1")}});try{for(var je=!0,q=za(P),te;te=yield q.next(),le=te.done,!le;je=!0){oe=te.value,je=!1;const Te=oe;yield Oe.write(Te)}}catch(Te){ve={error:Te}}finally{try{!je&&!le&&(K=q.return)&&(yield K.call(q))}finally{if(ve)throw ve.error}}yield Oe.close(),z()}catch(fe){V(fe)}})).then(()=>{this.log.debug("preconnect buffer sent successfully",Object.assign(Object.assign({},this.logContext),At(e)))}).catch(z=>{this.log.error("error sending preconnect buffer",Object.assign(Object.assign(Object.assign({},this.logContext),At(e)),{error:z}))})}return k})}get isLocal(){return!0}publishAdditionalCodecForTrack(e,t,r){return H(this,void 0,void 0,function*(){var i;if(this.encryptionType!==sr.NONE)return;let s;if(this.trackPublications.forEach(_=>{_.track&&_.track===e&&(s=_)}),!s)throw new Fa("track is not published");if(!Go(e))throw new Fa("track is not a video track");const c=Object.assign(Object.assign({},(i=this.roomOptions)===null||i===void 0?void 0:i.publishDefaults),r),l=MZ(e,t,c);if(!l){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),At(e)));return}const d=e.addSimulcastTrack(t,l);if(!d)return;const h=new Ff({cid:d.mediaStreamTrack.id,type:he.kindToProto(e.kind),muted:e.isMuted,source:he.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:c.videoCodec,cid:d.mediaStreamTrack.id}]});if(h.layers=$A(h.width,h.height,l),!this.engine||this.engine.isClosed)throw new ir("cannot publish track when not connected");const m=()=>H(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(e,d,c,l),yield this.engine.negotiate()}),b=(yield Promise.all([this.engine.addTrack(h),m()]))[0];this.log.debug("published ".concat(t," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:l,trackInfo:b}))})}unpublishTrack(e,t){return H(this,void 0,void 0,function*(){var r,i;if(fl(e)){const h=this.pendingPublishPromises.get(e);h&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),At(e))),yield h)}const s=this.getPublicationForTrack(e),c=s?At(s):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),c)),!s||!s.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),c));return}e=s.track,e.off(De.Muted,this.onTrackMuted),e.off(De.Unmuted,this.onTrackUnmuted),e.off(De.Ended,this.handleTrackEnded),e.off(De.UpstreamPaused,this.onTrackUpstreamPaused),e.off(De.UpstreamResumed,this.onTrackUpstreamResumed),e.off(De.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),t===void 0&&(t=(i=(r=this.roomOptions)===null||r===void 0?void 0:r.stopLocalTrackOnUnpublish)!==null&&i!==void 0?i:!0),t?e.stop():e.stopMonitor();let l=!1;const d=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<En.FAILED&&d)try{for(const h of this.engine.pcManager.publisher.getTransceivers())h.sender===d&&(h.direction="inactive",l=!0);if(this.engine.removeTrack(d)&&(l=!0),Go(e)){for(const[,h]of e.simulcastCodecs)h.sender&&(this.engine.removeTrack(h.sender)&&(l=!0),h.sender=void 0);e.simulcastCodecs.clear()}}catch(h){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),c),{error:h}))}switch(this.trackPublications.delete(s.trackSid),s.kind){case he.Kind.Audio:this.audioTrackPublications.delete(s.trackSid);break;case he.Kind.Video:this.videoTrackPublications.delete(s.trackSid);break}return this.emit(ye.LocalTrackUnpublished,s),s.setTrack(void 0),l&&(yield this.engine.negotiate()),s})}unpublishTracks(e){return H(this,void 0,void 0,function*(){return(yield Promise.all(e.map(r=>this.unpublishTrack(r)))).filter(r=>!!r)})}republishAllTracks(e){return H(this,arguments,void 0,function(t){var r=this;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){r.republishPromise&&(yield r.republishPromise),r.republishPromise=new Promise((s,c)=>H(r,void 0,void 0,function*(){try{const l=[];this.trackPublications.forEach(d=>{d.track&&(t&&(d.options=Object.assign(Object.assign({},d.options),t)),l.push(d))}),yield Promise.all(l.map(d=>H(this,void 0,void 0,function*(){const h=d.track;yield this.unpublishTrack(h,!1),i&&!h.isMuted&&h.source!==he.Source.ScreenShare&&h.source!==he.Source.ScreenShareAudio&&(Oa(h)||Go(h))&&!h.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:d.trackSid})),yield h.restartTrack()),yield this.publishOrRepublishTrack(h,d.options,!0)}))),s()}catch(l){c(l)}finally{this.republishPromise=void 0}})),yield r.republishPromise})()})}publishData(e){return H(this,arguments,void 0,function(t){var r=this;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(function*(){const s=i.reliable?wt.RELIABLE:wt.LOSSY,c=i.destinationIdentities,l=i.topic;let d=new pT({participantIdentity:r.identity,payload:t,destinationIdentities:c,topic:l});const h=new Fr({kind:s,value:{case:"user",value:d}});yield r.engine.sendDataPacket(h,s)})()})}publishDtmf(e,t){return H(this,void 0,void 0,function*(){const r=new Fr({kind:wt.RELIABLE,value:{case:"sipDtmf",value:new pD({code:e,digit:t})}});yield this.engine.sendDataPacket(r,wt.RELIABLE)})}sendChatMessage(e,t){return H(this,void 0,void 0,function*(){const r={id:crypto.randomUUID(),message:e,timestamp:Date.now(),attachedFiles:t?.attachments},i=new Fr({value:{case:"chatMessage",value:new Pv(Object.assign(Object.assign({},r),{timestamp:xn.parse(r.timestamp)}))}});return yield this.engine.sendDataPacket(i,wt.RELIABLE),this.emit(ye.ChatMessage,r),r})}editChatMessage(e,t){return H(this,void 0,void 0,function*(){const r=Object.assign(Object.assign({},t),{message:e,editTimestamp:Date.now()}),i=new Fr({value:{case:"chatMessage",value:new Pv(Object.assign(Object.assign({},r),{timestamp:xn.parse(r.timestamp),editTimestamp:xn.parse(r.editTimestamp)}))}});return yield this.engine.sendDataPacket(i,wt.RELIABLE),this.emit(ye.ChatMessage,r),r})}sendText(e,t){return H(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendText(e,t)})}streamText(e){return H(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamText(e)})}sendFile(e,t){return H(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendFile(e,t)})}streamBytes(e){return H(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamBytes(e)})}performRpc(e){return H(this,arguments,void 0,function(t){var r=this;let{destinationIdentity:i,method:s,payload:c,responseTimeout:l=15e3}=t;return(function*(){return new Promise((m,g)=>H(r,void 0,void 0,function*(){var b,_,R,E;if(MT(c)>CO){g(An.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));return}if(!((_=(b=this.engine.latestJoinResponse)===null||b===void 0?void 0:b.serverInfo)===null||_===void 0)&&_.version&&aa((E=(R=this.engine.latestJoinResponse)===null||R===void 0?void 0:R.serverInfo)===null||E===void 0?void 0:E.version,"1.8.0")<0){g(An.builtIn("UNSUPPORTED_SERVER"));return}const A=Math.max(l,8e3),M=crypto.randomUUID();yield this.publishRpcRequest(i,M,s,c,A);const F=setTimeout(()=>{this.pendingAcks.delete(M),g(An.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(M),clearTimeout(j)},7e3);this.pendingAcks.set(M,{resolve:()=>{clearTimeout(F)},participantIdentity:i});const j=setTimeout(()=>{this.pendingResponses.delete(M),g(An.builtIn("RESPONSE_TIMEOUT"))},l);this.pendingResponses.set(M,{resolve:(C,N)=>{clearTimeout(j),this.pendingAcks.has(M)&&(this.log.warn("RPC response received before ack",M),this.pendingAcks.delete(M),clearTimeout(F)),N?g(N):m(C??"")},participantIdentity:i})}))})()})}registerRpcMethod(e,t){this.rpcHandlers.has(e)&&this.log.warn("you're overriding the RPC handler for method ".concat(e,", in the future this will throw an error")),this.rpcHandlers.set(e,t)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setTrackSubscriptionPermissions(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=t,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(e){const t=this.pendingAcks.get(e);t?(t.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}handleIncomingRpcResponse(e,t,r){const i=this.pendingResponses.get(e);i?(i.resolve(t,r),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}publishRpcRequest(e,t,r,i,s){return H(this,void 0,void 0,function*(){const c=new Fr({destinationIdentities:[e],kind:wt.RELIABLE,value:{case:"rpcRequest",value:new mT({id:t,method:r,payload:i,responseTimeoutMs:s,version:1})}});yield this.engine.sendDataPacket(c,wt.RELIABLE)})}handleParticipantDisconnected(e){for(const[t,{participantIdentity:r}]of this.pendingAcks)r===e&&this.pendingAcks.delete(t);for(const[t,{participantIdentity:r,resolve:i}]of this.pendingResponses)r===e&&(i(null,An.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(t))}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter(t=>t.mime.split("/")[0].toLowerCase()==="video")}updateInfo(e){return super.updateInfo(e)?(e.tracks.forEach(t=>{var r,i;const s=this.trackPublications.get(t.sid);if(s){const c=s.isMuted||((i=(r=s.track)===null||r===void 0?void 0:r.isUpstreamPaused)!==null&&i!==void 0?i:!1);c!==t.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),At(s)),{mutedOnServer:c})),this.engine.client.sendMuteTrack(t.sid,c))}}),!0):!1}setActiveAgent(e){var t,r,i,s;this.firstActiveAgent=e,e&&!this.firstActiveAgent&&(this.firstActiveAgent=e),e?(r=(t=this.activeAgentFuture)===null||t===void 0?void 0:t.resolve)===null||r===void 0||r.call(t,e):(s=(i=this.activeAgentFuture)===null||i===void 0?void 0:i.reject)===null||s===void 0||s.call(i,new Error("Agent disconnected")),this.activeAgentFuture=void 0}waitUntilActiveAgentPresent(){return this.firstActiveAgent?Promise.resolve(this.firstActiveAgent):(this.activeAgentFuture||(this.activeAgentFuture=new Qi),this.activeAgentFuture.promise)}getPublicationForTrack(e){let t;return this.trackPublications.forEach(r=>{const i=r.track;i&&(e instanceof MediaStreamTrack?(Oa(i)||Go(i))&&i.mediaStreamTrack===e&&(t=r):e===i&&(t=r))}),t}waitForPendingPublicationOfSource(e){return H(this,void 0,void 0,function*(){const r=Date.now();for(;Date.now()<r+1e4;){const i=Array.from(this.pendingPublishPromises.entries()).find(s=>{let[c]=s;return c.source===e});if(i)return i[1];yield Er(20)}})}}class Vv extends La{constructor(e,t,r,i){super(e,t.sid,t.name,i),this.track=void 0,this.allowed=!0,this.requestedDisabled=void 0,this.visible=!0,this.handleEnded=s=>{this.setTrack(void 0),this.emit(De.Ended,s)},this.handleVisibilityChange=s=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(s),this.logContext),this.visible=s,this.emitTrackUpdate()},this.handleVideoDimensionsChange=s=>{this.log.debug("adaptivestream video dimensions ".concat(s.width,"x").concat(s.height),this.logContext),this.videoDimensionsAdaptiveStream=s,this.emitTrackUpdate()},this.subscribed=r,this.updateInfo(t)}setSubscribed(e){const t=this.subscriptionStatus,r=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const i=new j0({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new gD({participantSid:"",trackSids:[this.trackSid]})]});this.emit(De.UpdateSubscription,i),this.emitSubscriptionUpdateIfChanged(t),this.emitPermissionUpdateIfChanged(r)}get subscriptionStatus(){return this.subscribed===!1?La.SubscriptionStatus.Unsubscribed:super.isSubscribed?La.SubscriptionStatus.Subscribed:La.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?La.PermissionStatus.Allowed:La.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return this.requestedDisabled!==void 0?!this.requestedDisabled:this.isAdaptiveStream?this.visible:!0}get isLocal(){return!1}setEnabled(e){!this.isManualOperationAllowed()||this.requestedDisabled===!e||(this.requestedDisabled=!e,this.emitTrackUpdate())}setVideoQuality(e){!this.isManualOperationAllowed()||this.requestedMaxQuality===e||(this.requestedMaxQuality=e,this.requestedVideoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var t,r;this.isManualOperationAllowed()&&(((t=this.requestedVideoDimensions)===null||t===void 0?void 0:t.width)===e.width&&((r=this.requestedVideoDimensions)===null||r===void 0?void 0:r.height)===e.height||(D1(this.track)&&(this.requestedVideoDimensions=e),this.requestedMaxQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&D1(this.track)&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){var e;return(e=this.requestedMaxQuality)!==null&&e!==void 0?e:Ai.HIGH}setTrack(e){const t=this.subscriptionStatus,r=this.permissionStatus,i=this.track;i!==e&&(i&&(i.off(De.VideoDimensionsChanged,this.handleVideoDimensionsChange),i.off(De.VisibilityChanged,this.handleVisibilityChange),i.off(De.Ended,this.handleEnded),i.detach(),i.stopMonitor(),this.emit(De.Unsubscribed,i)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(De.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(De.VisibilityChanged,this.handleVisibilityChange),e.on(De.Ended,this.handleEnded),this.emit(De.Subscribed,e)),this.emitPermissionUpdateIfChanged(r),this.emitSubscriptionUpdateIfChanged(t))}setAllowed(e){const t=this.subscriptionStatus,r=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(r),this.emitSubscriptionUpdateIfChanged(t)}setSubscriptionError(e){this.emit(De.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const t=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):t!==e.muted&&this.emit(e.muted?De.Muted:De.Unmuted)}emitSubscriptionUpdateIfChanged(e){const t=this.subscriptionStatus;e!==t&&this.emit(De.SubscriptionStatusChanged,t,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(De.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return D1(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new CD({trackSids:[this.trackSid],disabled:!this.isEnabled,fps:this.fps});if(this.kind===he.Kind.Video){let t=this.requestedVideoDimensions;if(this.videoDimensionsAdaptiveStream!==void 0)if(t)yA(this.videoDimensionsAdaptiveStream,t)&&(this.log.debug("using adaptive stream dimensions instead of requested",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),t=this.videoDimensionsAdaptiveStream);else if(this.requestedMaxQuality!==void 0&&this.trackInfo){const r=SJ(this.trackInfo,this.requestedMaxQuality);r&&yA(this.videoDimensionsAdaptiveStream,r)&&(this.log.debug("using adaptive stream dimensions instead of max quality layer",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),t=this.videoDimensionsAdaptiveStream)}else this.log.debug("using adaptive stream dimensions",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),t=this.videoDimensionsAdaptiveStream;t?(e.width=Math.ceil(t.width),e.height=Math.ceil(t.height)):this.requestedMaxQuality!==void 0?(this.log.debug("using requested max quality",Object.assign(Object.assign({},this.logContext),{quality:this.requestedMaxQuality})),e.quality=this.requestedMaxQuality):(this.log.debug("using default quality",Object.assign(Object.assign({},this.logContext),{quality:Ai.HIGH})),e.quality=Ai.HIGH)}this.emit(De.UpdateSettings,e)}}class zv extends MO{static fromParticipantInfo(e,t,r){return new zv(e,t.sid,t.identity,t.name,t.metadata,t.attributes,r,t.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,t,r,i,s,c,l){let d=arguments.length>7&&arguments[7]!==void 0?arguments[7]:zf.STANDARD;super(t,r||"",i,s,c,l,d),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(De.UpdateSettings,t=>{this.log.debug("send update settings",Object.assign(Object.assign(Object.assign({},this.logContext),At(e)),{settings:t})),this.signalClient.sendUpdateTrackSettings(t)}),e.on(De.UpdateSubscription,t=>{t.participantTracks.forEach(r=>{r.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(t)}),e.on(De.SubscriptionPermissionChanged,t=>{this.emit(ye.TrackSubscriptionPermissionChanged,e,t)}),e.on(De.SubscriptionStatusChanged,t=>{this.emit(ye.TrackSubscriptionStatusChanged,e,t)}),e.on(De.Subscribed,t=>{this.emit(ye.TrackSubscribed,t,e)}),e.on(De.Unsubscribed,t=>{this.emit(ye.TrackUnsubscribed,t,e)}),e.on(De.SubscriptionFailed,t=>{this.emit(ye.TrackSubscriptionFailed,e.trackSid,t)})}getTrackPublication(e){const t=super.getTrackPublication(e);if(t)return t}getTrackPublicationByName(e){const t=super.getTrackPublicationByName(e);if(t)return t}setVolume(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:he.Source.Microphone;this.volumeMap.set(t,e);const r=this.getTrackPublication(t);r&&r.track&&r.track.setVolume(e)}getVolume(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:he.Source.Microphone;const t=this.getTrackPublication(e);return t&&t.track?t.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,t,r,i,s,c){let l=this.getTrackPublicationBySid(t);if(l||t.startsWith("TR")||this.trackPublications.forEach(m=>{!l&&e.kind===m.kind.toString()&&(l=m)}),!l){if(c===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:t})),this.emit(ye.TrackSubscriptionFailed,t);return}c===void 0&&(c=20),setTimeout(()=>{this.addSubscribedMediaTrack(e,t,r,i,s,c-1)},150);return}if(e.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),At(l))),this.emit(ye.TrackSubscriptionFailed,t);return}const d=e.kind==="video";let h;return d?h=new QZ(e,t,i,s):h=new PO(e,t,i,this.audioContext,this.audioOutput),h.source=l.source,h.isMuted=l.isMuted,h.setMediaStream(r),h.start(),l.setTrack(h),this.volumeMap.has(l.source)&&h_(h)&&ta(h)&&h.setVolume(this.volumeMap.get(l.source)),l}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const t=new Map,r=new Map;return e.tracks.forEach(i=>{var s,c;let l=this.getTrackPublicationBySid(i.sid);if(l)l.updateInfo(i);else{const d=he.kindFromProto(i.type);if(!d)return;l=new Vv(d,i,(s=this.signalClient.connectOptions)===null||s===void 0?void 0:s.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(c=this.loggerOptions)===null||c===void 0?void 0:c.loggerName}),l.updateInfo(i),r.set(i.sid,l);const h=Array.from(this.trackPublications.values()).find(m=>m.source===l?.source);h&&l.source!==he.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(l.source),Object.assign(Object.assign({},this.logContext),{oldTrack:At(h),newTrack:At(l)})),this.addTrackPublication(l)}t.set(i.sid,l)}),this.trackPublications.forEach(i=>{t.has(i.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),At(i))),this.unpublishTrack(i.trackSid,!0))}),r.forEach(i=>{this.emit(ye.TrackPublished,i)}),!0}unpublishTrack(e,t){const r=this.trackPublications.get(e);if(!r)return;const{track:i}=r;switch(i&&(i.stop(),r.setTrack(void 0)),this.trackPublications.delete(e),r.kind){case he.Kind.Audio:this.audioTrackPublications.delete(e);break;case he.Kind.Video:this.videoTrackPublications.delete(e);break}t&&this.emit(ye.TrackUnpublished,r)}setAudioOutput(e){return H(this,void 0,void 0,function*(){this.audioOutput=e;const t=[];this.audioTrackPublications.forEach(r=>{var i;ta(r.track)&&h_(r.track)&&t.push(r.track.setSinkId((i=e.deviceId)!==null&&i!==void 0?i:"default"))}),yield Promise.all(t)})}emit(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:r})),super.emit(e,...r)}}var Ht;(function(n){n.Disconnected="disconnected",n.Connecting="connecting",n.Connected="connected",n.Reconnecting="reconnecting",n.SignalReconnecting="signalReconnecting"})(Ht||(Ht={}));const ree=4*1e3;class to extends da.EventEmitter{get hasE2EESetup(){return this.e2eeManager!==void 0}constructor(e){var t,r,i,s;if(super(),t=this,this.state=Ht.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=gt,this.bufferedEvents=[],this.isResuming=!1,this.rpcHandlers=new Map,this.connect=(c,l,d)=>H(this,void 0,void 0,function*(){var h;if(!RJ())throw sa()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const m=yield this.disconnectLock.lock();if(this.state===Ht.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),m(),Promise.resolve();if(this.connectFuture)return m(),this.connectFuture.promise;this.setAndEmitConnectionState(Ht.Connecting),((h=this.regionUrlProvider)===null||h===void 0?void 0:h.getServerUrl().toString())!==xO(c)&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),Cd(new URL(c))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new zt(c,l):this.regionUrlProvider.updateToken(l),this.regionUrlProvider.fetchRegionSettings().then(_=>{var R;(R=this.regionUrlProvider)===null||R===void 0||R.setServerReportedRegions(_)}).catch(_=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:_}))}));const g=(_,R,E)=>H(this,void 0,void 0,function*(){var A,M;this.abortController&&this.abortController.abort();const F=new AbortController;this.abortController=F,m?.();try{if(yield nd.getInstance().getBackOffPromise(c),F.signal.aborted)throw dt.cancelled("Connection attempt aborted");yield this.attemptConnection(E??c,l,d,F),this.abortController=void 0,_()}catch(j){if(this.regionUrlProvider&&j instanceof dt&&j.reason!==gn.Cancelled&&j.reason!==gn.NotAllowed){let C=null;try{this.log.debug("Fetching next region"),C=yield this.regionUrlProvider.getNextBestRegionUrl((A=this.abortController)===null||A===void 0?void 0:A.signal)}catch(N){if(N instanceof dt&&(N.status===401||N.reason===gn.Cancelled)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),R(N);return}}[gn.InternalError,gn.ServerUnreachable,gn.Timeout].includes(j.reason)&&(this.log.debug("Adding failed connection attempt to back off"),nd.getInstance().addFailedConnectionAttempt(c)),C&&!(!((M=this.abortController)===null||M===void 0)&&M.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(j.message,". Retrying with another region: ").concat(C),this.logContext),this.recreateEngine(),yield g(_,R,C)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,CA(j)),R(j))}else{let C=vs.UNKNOWN_REASON;j instanceof dt&&(C=CA(j)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,C),R(j)}}}),b=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new Qi((_,R)=>{g(_,R,b)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(c,l,d,h,m,g)=>H(this,void 0,void 0,function*(){var b,_,R;const E=yield d.join(c,l,{autoSubscribe:h.autoSubscribe,adaptiveStream:typeof m.adaptiveStream=="object"?!0:m.adaptiveStream,maxRetries:h.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:h.websocketTimeout,singlePeerConnection:m.singlePeerConnection},g.signal);let A=E.serverInfo;if(A||(A={version:E.serverVersion,region:E.serverRegion}),this.serverInfo=A,this.log.debug("connected to Livekit Server ".concat(Object.entries(A).map(M=>{let[F,j]=M;return"".concat(F,": ").concat(j)}).join(", ")),{room:(b=E.room)===null||b===void 0?void 0:b.name,roomSid:(_=E.room)===null||_===void 0?void 0:_.sid,identity:(R=E.participant)===null||R===void 0?void 0:R.identity}),!A.version)throw new uJ("unknown server version");return A.version==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),m.dynacast=!1),E}),this.applyJoinResponse=c=>{const l=c.participant;if(this.localParticipant.sid=l.sid,this.localParticipant.identity=l.identity,this.localParticipant.setEnabledPublishCodecs(c.enabledPublishCodecs),this.e2eeManager)try{this.e2eeManager.setSifTrailer(c.sifTrailer)}catch(d){this.log.error(d instanceof Error?d.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:d}))}this.handleParticipantUpdates([l,...c.otherParticipants]),c.room&&this.handleRoomUpdate(c.room)},this.attemptConnection=(c,l,d,h)=>H(this,void 0,void 0,function*(){var m,g;this.state===Ht.Reconnecting||this.isResuming||!((m=this.engine)===null||m===void 0)&&m.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((g=this.regionUrlProvider)===null||g===void 0)&&g.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},PT),d),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const b=yield this.connectSignal(c,l,this.engine,this.connOptions,this.options,h);this.applyJoinResponse(b),this.setupLocalParticipantEvents(),this.emit(pe.SignalConnected)}catch(b){yield this.engine.close(),this.recreateEngine();const _=h.signal.aborted?dt.cancelled("Signal connection aborted"):dt.serverUnreachable("could not establish signal connection");throw b instanceof Error&&(_.message="".concat(_.message,": ").concat(b.message)),b instanceof dt&&(_.reason=b.reason,_.status=b.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:b})),_}if(h.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),dt.cancelled("Connection attempt aborted");try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,h)}catch(b){throw yield this.engine.close(),this.recreateEngine(),b}di()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),di()&&window.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(Ht.Connected),this.emit(pe.Connected),nd.getInstance().resetFailedConnectionAttempts(c),this.registerConnectionReconcile(),this.regionUrlProvider&&this.regionUrlProvider.notifyConnected()}),this.disconnect=function(){for(var c=arguments.length,l=new Array(c),d=0;d<c;d++)l[d]=arguments[d];return H(t,[...l],void 0,function(){var h=this;let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){var g,b,_;const R=yield h.disconnectLock.lock();try{if(h.state===Ht.Disconnected){h.log.debug("already disconnected",h.logContext);return}if(h.log.info("disconnect from room",Object.assign({},h.logContext)),h.state===Ht.Connecting||h.state===Ht.Reconnecting||h.isResuming){const E="Abort connection attempt due to user initiated disconnect";h.log.warn(E,h.logContext),(g=h.abortController)===null||g===void 0||g.abort(E),(_=(b=h.connectFuture)===null||b===void 0?void 0:b.reject)===null||_===void 0||_.call(b,dt.cancelled("Client initiated disconnect")),h.connectFuture=void 0}h.engine&&(h.engine.client.isDisconnected||(yield h.engine.client.sendLeave()),yield h.engine.close()),h.handleDisconnect(m,vs.CLIENT_INITIATED),h.engine=void 0}finally{R()}})()})},this.onPageLeave=()=>H(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>H(this,void 0,void 0,function*(){const c=[],l=Gr();if(l&&l.os==="iOS"){const d="livekit-dummy-audio-el";let h=document.getElementById(d);if(!h){h=document.createElement("audio"),h.id=d,h.autoplay=!0,h.hidden=!0;const m=M1();m.enabled=!0;const g=new MediaStream([m]);h.srcObject=g,document.addEventListener("visibilitychange",()=>{h&&(h.srcObject=document.hidden?null:g,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(h),this.once(pe.Disconnected,()=>{h?.remove(),h=null})}c.push(h)}this.remoteParticipants.forEach(d=>{d.audioTrackPublications.forEach(h=>{h.track&&h.track.attachedElements.forEach(m=>{c.push(m)})})});try{yield Promise.all([this.acquireAudioContext(),...c.map(d=>(d.muted=!1,d.play()))]),this.handleAudioPlaybackStarted()}catch(d){throw this.handleAudioPlaybackFailed(d),d}}),this.startVideo=()=>H(this,void 0,void 0,function*(){const c=[];for(const l of this.remoteParticipants.values())l.videoTrackPublications.forEach(d=>{var h;(h=d.track)===null||h===void 0||h.attachedElements.forEach(m=>{c.includes(m)||c.push(m)})});yield Promise.all(c.map(l=>l.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(l=>{l.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const c of this.remoteParticipants.values())this.handleParticipantDisconnected(c.identity,c);this.setAndEmitConnectionState(Ht.Reconnecting)&&this.emit(pe.Reconnecting)},this.handleSignalRestarted=c=>H(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(c.serverRegion),Object.assign(Object.assign({},this.logContext),{region:c.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(c);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(l){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:l}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:c.serverRegion}))}catch{return}this.setAndEmitConnectionState(Ht.Connected),this.emit(pe.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=c=>{c.forEach(l=>{var d;if(l.identity===this.localParticipant.identity){this.localParticipant.updateInfo(l);return}l.identity===""&&(l.identity=(d=this.sidToIdentity.get(l.sid))!==null&&d!==void 0?d:"");let h=this.remoteParticipants.get(l.identity);l.state===Ju.DISCONNECTED?this.handleParticipantDisconnected(l.identity,h):h=this.getOrCreateParticipant(l.identity,l)})},this.handleActiveSpeakersUpdate=c=>{const l=[],d={};c.forEach(h=>{if(d[h.sid]=!0,h.sid===this.localParticipant.sid)this.localParticipant.audioLevel=h.level,this.localParticipant.setIsSpeaking(!0),l.push(this.localParticipant);else{const m=this.getRemoteParticipantBySid(h.sid);m&&(m.audioLevel=h.level,m.setIsSpeaking(!0),l.push(m))}}),d[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(h=>{d[h.sid]||(h.audioLevel=0,h.setIsSpeaking(!1))}),this.activeSpeakers=l,this.emitWhenConnected(pe.ActiveSpeakersChanged,l)},this.handleSpeakersChanged=c=>{const l=new Map;this.activeSpeakers.forEach(h=>{const m=this.remoteParticipants.get(h.identity);m&&m.sid!==h.sid||l.set(h.sid,h)}),c.forEach(h=>{let m=this.getRemoteParticipantBySid(h.sid);h.sid===this.localParticipant.sid&&(m=this.localParticipant),m&&(m.audioLevel=h.level,m.setIsSpeaking(h.active),h.active?l.set(h.sid,m):l.delete(h.sid))});const d=Array.from(l.values());d.sort((h,m)=>m.audioLevel-h.audioLevel),this.activeSpeakers=d,this.emitWhenConnected(pe.ActiveSpeakersChanged,d)},this.handleStreamStateUpdate=c=>{c.streamStates.forEach(l=>{const d=this.getRemoteParticipantBySid(l.participantSid);if(!d)return;const h=d.getTrackPublicationBySid(l.trackSid);if(!h||!h.track)return;const m=he.streamStateFromProto(l.state);h.track.setStreamState(m),m!==h.track.streamState&&(d.emit(ye.TrackStreamStateChanged,h,h.track.streamState),this.emitWhenConnected(pe.TrackStreamStateChanged,h,h.track.streamState,d))})},this.handleSubscriptionPermissionUpdate=c=>{const l=this.getRemoteParticipantBySid(c.participantSid);if(!l)return;const d=l.getTrackPublicationBySid(c.trackSid);d&&d.setAllowed(c.allowed)},this.handleSubscriptionError=c=>{const l=Array.from(this.remoteParticipants.values()).find(h=>h.trackPublications.has(c.trackSid));if(!l)return;const d=l.getTrackPublicationBySid(c.trackSid);d&&d.setSubscriptionError(c.err)},this.handleDataPacket=(c,l)=>{const d=this.remoteParticipants.get(c.participantIdentity);if(c.value.case==="user")this.handleUserPacket(d,c.value.value,c.kind,l);else if(c.value.case==="transcription")this.handleTranscription(d,c.value.value);else if(c.value.case==="sipDtmf")this.handleSipDtmf(d,c.value.value);else if(c.value.case==="chatMessage")this.handleChatMessage(d,c.value.value);else if(c.value.case==="metrics")this.handleMetrics(c.value.value,d);else if(c.value.case==="streamHeader"||c.value.case==="streamChunk"||c.value.case==="streamTrailer")this.handleDataStream(c,l);else if(c.value.case==="rpcRequest"){const h=c.value.value;this.handleIncomingRpcRequest(c.participantIdentity,h.id,h.method,h.payload,h.responseTimeoutMs,h.version)}},this.handleUserPacket=(c,l,d,h)=>{this.emit(pe.DataReceived,l.payload,c,d,l.topic,h),c?.emit(ye.DataReceived,l.payload,d,h)},this.handleSipDtmf=(c,l)=>{this.emit(pe.SipDTMFReceived,l,c),c?.emit(ye.SipDTMFReceived,l)},this.handleTranscription=(c,l)=>{const d=l.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(l.transcribedParticipantIdentity),h=d?.trackPublications.get(l.trackId),m=LJ(l,this.transcriptionReceivedTimes);h?.emit(De.TranscriptionReceived,m),d?.emit(ye.TranscriptionReceived,m,h),this.emit(pe.TranscriptionReceived,m,d,h)},this.handleChatMessage=(c,l)=>{const d=UJ(l);this.emit(pe.ChatMessage,d,c)},this.handleMetrics=(c,l)=>{this.emit(pe.MetricsReceived,c,l)},this.handleDataStream=(c,l)=>{this.incomingDataStreamManager.handleDataStreamPacket(c,l)},this.bufferedSegments=new Map,this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(pe.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=c=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:c})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(pe.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(pe.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(pe.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>H(this,void 0,void 0,function*(){var c;((c=Gr())===null||c===void 0?void 0:c.os)!=="iOS"&&(yield this.selectDefaultDevices()),this.emit(pe.MediaDevicesChanged)}),this.handleRoomUpdate=c=>{const l=this.roomInfo;this.roomInfo=c,l&&l.metadata!==c.metadata&&this.emitWhenConnected(pe.RoomMetadataChanged,c.metadata),l?.activeRecording!==c.activeRecording&&this.emitWhenConnected(pe.RecordingStatusChanged,c.activeRecording)},this.handleConnectionQualityUpdate=c=>{c.updates.forEach(l=>{if(l.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(l.quality);return}const d=this.getRemoteParticipantBySid(l.participantSid);d&&d.setConnectionQuality(l.quality)})},this.onLocalParticipantMetadataChanged=c=>{this.emit(pe.ParticipantMetadataChanged,c,this.localParticipant)},this.onLocalParticipantNameChanged=c=>{this.emit(pe.ParticipantNameChanged,c,this.localParticipant)},this.onLocalAttributesChanged=c=>{this.emit(pe.ParticipantAttributesChanged,c,this.localParticipant)},this.onLocalTrackMuted=c=>{this.emit(pe.TrackMuted,c,this.localParticipant)},this.onLocalTrackUnmuted=c=>{this.emit(pe.TrackUnmuted,c,this.localParticipant)},this.onTrackProcessorUpdate=c=>{var l;(l=c?.onPublish)===null||l===void 0||l.call(c,this)},this.onLocalTrackPublished=c=>H(this,void 0,void 0,function*(){var l,d,h,m,g,b;(l=c.track)===null||l===void 0||l.on(De.TrackProcessorUpdate,this.onTrackProcessorUpdate),(d=c.track)===null||d===void 0||d.on(De.Restarted,this.onLocalTrackRestarted),(g=(m=(h=c.track)===null||h===void 0?void 0:h.getProcessor())===null||m===void 0?void 0:m.onPublish)===null||g===void 0||g.call(m,this),this.emit(pe.LocalTrackPublished,c,this.localParticipant),Oa(c.track)&&(yield c.track.checkForSilence())&&this.emit(pe.LocalAudioSilenceDetected,c);const _=yield(b=c.track)===null||b===void 0?void 0:b.getDeviceId(!1),R=c_(c.source);R&&_&&_!==this.localParticipant.activeDeviceMap.get(R)&&(this.localParticipant.activeDeviceMap.set(R,_),this.emit(pe.ActiveDeviceChanged,R,_))}),this.onLocalTrackUnpublished=c=>{var l,d;(l=c.track)===null||l===void 0||l.off(De.TrackProcessorUpdate,this.onTrackProcessorUpdate),(d=c.track)===null||d===void 0||d.off(De.Restarted,this.onLocalTrackRestarted),this.emit(pe.LocalTrackUnpublished,c,this.localParticipant)},this.onLocalTrackRestarted=c=>H(this,void 0,void 0,function*(){const l=yield c.getDeviceId(!1),d=c_(c.source);d&&l&&l!==this.localParticipant.activeDeviceMap.get(d)&&(this.log.debug("local track restarted, setting ".concat(d," ").concat(l," active"),this.logContext),this.localParticipant.activeDeviceMap.set(d,l),this.emit(pe.ActiveDeviceChanged,d,l))}),this.onLocalConnectionQualityChanged=c=>{this.emit(pe.ConnectionQualityChanged,c,this.localParticipant)},this.onMediaDevicesError=(c,l)=>{this.emit(pe.MediaDevicesError,c,l)},this.onLocalParticipantPermissionsChanged=c=>{this.emit(pe.ParticipantPermissionsChanged,c,this.localParticipant)},this.onLocalChatMessageSent=c=>{this.emit(pe.ChatMessage,c,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},gZ),e),this.log=eo((r=this.options.loggerName)!==null&&r!==void 0?r:_s.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},SO),e?.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},TO),e?.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},mZ),e?.publishDefaults),this.maybeCreateEngine(),this.incomingDataStreamManager=new GZ,this.outgoingDataStreamManager=new YZ(this.engine,this.log),this.disconnectLock=new Hr,this.localParticipant=new nee("","",this.engine,this.options,this.rpcHandlers,this.outgoingDataStreamManager),(this.options.e2ee||this.options.encryption)&&this.setupE2EE(),this.engine.e2eeManager=this.e2eeManager,this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",uc(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",uc(this.options.audioCaptureDefaults.deviceId)),!((i=this.options.audioOutput)===null||i===void 0)&&i.deviceId&&this.switchActiveDevice("audiooutput",uc(this.options.audioOutput.deviceId)).catch(c=>this.log.warn("Could not set audio output: ".concat(c.message),this.logContext)),di()){const c=new AbortController;(s=navigator.mediaDevices)===null||s===void 0||s.addEventListener("devicechange",this.handleDeviceChange,{signal:c.signal}),to.cleanupRegistry&&to.cleanupRegistry.register(this,()=>{c.abort()})}}registerTextStreamHandler(e,t){return this.incomingDataStreamManager.registerTextStreamHandler(e,t)}unregisterTextStreamHandler(e){return this.incomingDataStreamManager.unregisterTextStreamHandler(e)}registerByteStreamHandler(e,t){return this.incomingDataStreamManager.registerByteStreamHandler(e,t)}unregisterByteStreamHandler(e){return this.incomingDataStreamManager.unregisterByteStreamHandler(e)}registerRpcMethod(e,t){if(this.rpcHandlers.has(e))throw Error("RPC handler already registered for method ".concat(e,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(e,t)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setE2EEEnabled(e){return H(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var e;const t=!!this.options.encryption,r=this.options.encryption||this.options.e2ee;r&&("e2eeManager"in r?(this.e2eeManager=r.e2eeManager,this.e2eeManager.isDataChannelEncryptionEnabled=t):this.e2eeManager=new JJ(r,t),this.e2eeManager.on(rc.ParticipantEncryptionStatusChanged,(i,s)=>{zJ(s)&&(this.isE2EEEnabled=i),this.emit(pe.ParticipantEncryptionStatusChanged,i,s)}),this.e2eeManager.on(rc.EncryptionError,(i,s)=>{const c=s?this.getParticipantByIdentity(s):void 0;this.emit(pe.EncryptionError,i,c)}),(e=this.e2eeManager)===null||e===void 0||e.setup(this))}get logContext(){var e;return{room:this.name,roomID:(e=this.roomInfo)===null||e===void 0?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,t;return(t=(e=this.roomInfo)===null||e===void 0?void 0:e.activeRecording)!==null&&t!==void 0?t:!1}getSid(){return H(this,void 0,void 0,function*(){return this.state===Ht.Disconnected?"":this.roomInfo&&this.roomInfo.sid!==""?this.roomInfo.sid:new Promise((e,t)=>{const r=i=>{i.sid!==""&&(this.engine.off(Ve.RoomUpdate,r),e(i.sid))};this.engine.on(Ve.RoomUpdate,r),this.once(pe.Disconnected,()=>{this.engine.off(Ve.RoomUpdate,r),t("Room disconnected before room server id was available")})})})}get name(){var e,t;return(t=(e=this.roomInfo)===null||e===void 0?void 0:e.name)!==null&&t!==void 0?t:""}get metadata(){var e;return(e=this.roomInfo)===null||e===void 0?void 0:e.metadata}get numParticipants(){var e,t;return(t=(e=this.roomInfo)===null||e===void 0?void 0:e.numParticipants)!==null&&t!==void 0?t:0}get numPublishers(){var e,t;return(t=(e=this.roomInfo)===null||e===void 0?void 0:e.numPublishers)!==null&&t!==void 0?t:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new BZ(this.options),this.engine.e2eeManager=this.e2eeManager,this.engine.on(Ve.ParticipantUpdate,this.handleParticipantUpdates).on(Ve.RoomUpdate,this.handleRoomUpdate).on(Ve.SpeakersChanged,this.handleSpeakersChanged).on(Ve.StreamStateChanged,this.handleStreamStateUpdate).on(Ve.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(Ve.SubscriptionError,this.handleSubscriptionError).on(Ve.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(Ve.MediaTrackAdded,(e,t,r)=>{this.onTrackAdded(e,t,r)}).on(Ve.Disconnected,e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)}).on(Ve.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(Ve.DataPacketReceived,this.handleDataPacket).on(Ve.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(Ht.SignalReconnecting)&&this.emit(pe.SignalReconnecting)}).on(Ve.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(Ht.Connected)&&this.emit(pe.Reconnected)}).on(Ve.SignalResumed,()=>{this.bufferedEvents=[],(this.state===Ht.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(Ve.Restarting,this.handleRestarting).on(Ve.SignalRestarted,this.handleSignalRestarted).on(Ve.Offline,()=>{this.setAndEmitConnectionState(Ht.Reconnecting)&&this.emit(pe.Reconnecting)}).on(Ve.DCBufferStatusChanged,(e,t)=>{this.emit(pe.DCBufferStatusChanged,e,t)}).on(Ve.LocalTrackSubscribed,e=>{const t=this.localParticipant.getTrackPublications().find(r=>{let{trackSid:i}=r;return i===e});if(!t){this.log.warn("could not find local track subscription for subscribed event",this.logContext);return}this.localParticipant.emit(ye.LocalTrackSubscribed,t),this.emitWhenConnected(pe.LocalTrackSubscribed,t,this.localParticipant)}).on(Ve.RoomMoved,e=>{this.log.debug("room moved",e),e.room&&this.handleRoomUpdate(e.room),this.remoteParticipants.forEach((t,r)=>{this.handleParticipantDisconnected(r,t)}),this.emit(pe.Moved,e.room.name),e.participant?this.handleParticipantUpdates([e.participant,...e.otherParticipants]):this.handleParticipantUpdates(e.otherParticipants)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine),this.outgoingDataStreamManager&&this.outgoingDataStreamManager.setupEngine(this.engine))}static getLocalDevices(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return fr.getInstance().getDevices(e,t)}prepareConnection(e,t){return H(this,void 0,void 0,function*(){if(this.state===Ht.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(Cd(new URL(e))&&t){this.regionUrlProvider=new zt(e,t);const r=yield this.regionUrlProvider.getNextBestRegionUrl();r&&this.state===Ht.Disconnected&&(this.regionUrl=r,yield fetch(Hf(r),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(r),this.logContext))}else yield fetch(Hf(e),{method:"HEAD"})}catch(r){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:r}))}}})}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,t){return H(this,void 0,void 0,function*(){let r=()=>H(this,void 0,void 0,function*(){}),i;switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":i=new Bs({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":i=new Bs({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":i=new Bs({scenario:{case:"serverLeave",value:!0}});break;case"migration":i=new Bs({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":r=()=>H(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),i=new Bs({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":r=()=>H(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),i=new Bs({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":i=new Bs({scenario:{case:"switchCandidateProtocol",value:e==="force-tls"?2:1}}),r=()=>H(this,void 0,void 0,function*(){const s=this.engine.client.onLeave;s&&s(new L0({reason:vs.CLIENT_INITIATED,action:Zu.RECONNECT}))});break;case"subscriber-bandwidth":if(t===void 0||typeof t!="number")throw new Error("subscriber-bandwidth requires a number as argument");i=new Bs({scenario:{case:"subscriberBandwidth",value:al(t)}});break;case"leave-full-reconnect":i=new Bs({scenario:{case:"leaveRequestFullReconnect",value:!0}})}i&&(yield this.engine.client.sendSimulateScenario(i),yield r())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,t){return H(this,arguments,void 0,function(r,i){var s=this;let c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return(function*(){var l,d,h,m,g,b,_;let R=!0,E=!1;const A=c?{exact:i}:i;if(r==="audioinput"){E=s.localParticipant.audioTrackPublications.size===0;const M=(l=s.getActiveDevice(r))!==null&&l!==void 0?l:s.options.audioCaptureDefaults.deviceId;s.options.audioCaptureDefaults.deviceId=A;const F=Array.from(s.localParticipant.audioTrackPublications.values()).filter(C=>C.source===he.Source.Microphone);try{R=(yield Promise.all(F.map(C=>{var N;return(N=C.audioTrack)===null||N===void 0?void 0:N.setDeviceId(A)}))).every(C=>C===!0)}catch(C){throw s.options.audioCaptureDefaults.deviceId=M,C}const j=F.some(C=>{var N,D;return(D=(N=C.track)===null||N===void 0?void 0:N.isMuted)!==null&&D!==void 0?D:!1});R&&j&&(E=!0)}else if(r==="videoinput"){E=s.localParticipant.videoTrackPublications.size===0;const M=(d=s.getActiveDevice(r))!==null&&d!==void 0?d:s.options.videoCaptureDefaults.deviceId;s.options.videoCaptureDefaults.deviceId=A;const F=Array.from(s.localParticipant.videoTrackPublications.values()).filter(C=>C.source===he.Source.Camera);try{R=(yield Promise.all(F.map(C=>{var N;return(N=C.videoTrack)===null||N===void 0?void 0:N.setDeviceId(A)}))).every(C=>C===!0)}catch(C){throw s.options.videoCaptureDefaults.deviceId=M,C}const j=F.some(C=>{var N,D;return(D=(N=C.track)===null||N===void 0?void 0:N.isMuted)!==null&&D!==void 0?D:!1});R&&j&&(E=!0)}else if(r==="audiooutput"){if(E=!0,!d_()&&!s.options.webAudioMix||s.options.webAudioMix&&s.audioContext&&!("setSinkId"in s.audioContext))throw new Error("cannot switch audio output, the current browser does not support it");s.options.webAudioMix&&(i=(h=yield fr.getInstance().normalizeDeviceId("audiooutput",i))!==null&&h!==void 0?h:""),(m=(_=s.options).audioOutput)!==null&&m!==void 0||(_.audioOutput={});const M=(g=s.getActiveDevice(r))!==null&&g!==void 0?g:s.options.audioOutput.deviceId;s.options.audioOutput.deviceId=i;try{s.options.webAudioMix&&((b=s.audioContext)===null||b===void 0||b.setSinkId(i)),yield Promise.all(Array.from(s.remoteParticipants.values()).map(F=>F.setAudioOutput({deviceId:i})))}catch(F){throw s.options.audioOutput.deviceId=M,F}}return E&&(s.localParticipant.activeDeviceMap.set(r,i),s.emit(pe.ActiveDeviceChanged,r,i)),R})()})}setupLocalParticipantEvents(){this.localParticipant.on(ye.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(ye.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(ye.AttributesChanged,this.onLocalAttributesChanged).on(ye.TrackMuted,this.onLocalTrackMuted).on(ye.TrackUnmuted,this.onLocalTrackUnmuted).on(ye.LocalTrackPublished,this.onLocalTrackPublished).on(ye.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(ye.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(ye.MediaDevicesError,this.onMediaDevicesError).on(ye.AudioStreamAcquired,this.startAudio).on(ye.ChatMessage,this.onLocalChatMessageSent).on(ye.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;(e=this.engine)===null||e===void 0||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,t,r){if(this.state===Ht.Connecting||this.state===Ht.Reconnecting){const g=()=>{this.log.debug("deferring on track for later",{mediaTrackId:e.id,mediaStreamId:t.id,tracksInStream:t.getTracks().map(_=>_.id)}),this.onTrackAdded(e,t,r),b()},b=()=>{this.off(pe.Reconnected,g),this.off(pe.Connected,g),this.off(pe.Disconnected,b)};this.once(pe.Reconnected,g),this.once(pe.Connected,g),this.once(pe.Disconnected,b);return}if(this.state===Ht.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}if(e.readyState==="ended"){this.log.info("skipping incoming track as it already ended",this.logContext);return}const i=CJ(t.id),s=i[0];let c=i[1],l=e.id;if(c&&c.startsWith("TR")&&(l=c),s===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const d=Array.from(this.remoteParticipants.values()).find(g=>g.sid===s);if(!d){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(s),this.logContext);return}if(!l.startsWith("TR")){const g=this.engine.getTrackIdForReceiver(r);if(!g){this.log.error("Tried to add a track whose 'sid' could not be found for a participant, that's not present. Sid: ".concat(s),this.logContext);return}l=g}l.startsWith("TR")||this.log.warn("Tried to add a track whose 'sid' could not be determined for a participant, that's not present. Sid: ".concat(s,", streamId: ").concat(c,", trackId: ").concat(l),Object.assign(Object.assign({},this.logContext),{rpID:s,streamId:c,trackId:l}));let h;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?h=this.options.adaptiveStream:h={});const m=d.addSubscribedMediaTrack(e,l,t,r,h);m?.isEncrypted&&!this.e2eeManager&&this.emit(pe.EncryptionError,new Error("Encrypted ".concat(m.source," track received from participant ").concat(d.sid,", but room does not have encryption enabled!")))}handleDisconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,t=arguments.length>1?arguments[1]:void 0;var r;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.incomingDataStreamManager.clearControllers(),this.state!==Ht.Disconnected){this.regionUrl=void 0,this.regionUrlProvider&&this.regionUrlProvider.notifyDisconnected();try{this.remoteParticipants.forEach(i=>{i.trackPublications.forEach(s=>{i.unpublishTrack(s.trackSid)})}),this.localParticipant.trackPublications.forEach(i=>{var s,c,l;i.track&&this.localParticipant.unpublishTrack(i.track,e),e?((s=i.track)===null||s===void 0||s.detach(),(c=i.track)===null||c===void 0||c.stop()):(l=i.track)===null||l===void 0||l.stopMonitor()}),this.localParticipant.off(ye.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(ye.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(ye.AttributesChanged,this.onLocalAttributesChanged).off(ye.TrackMuted,this.onLocalTrackMuted).off(ye.TrackUnmuted,this.onLocalTrackUnmuted).off(ye.LocalTrackPublished,this.onLocalTrackPublished).off(ye.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(ye.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(ye.MediaDevicesError,this.onMediaDevicesError).off(ye.AudioStreamAcquired,this.startAudio).off(ye.ChatMessage,this.onLocalChatMessageSent).off(ye.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),di()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(r=navigator.mediaDevices)===null||r===void 0||r.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(Ht.Disconnected),this.emit(pe.Disconnected,t)}}}handleParticipantDisconnected(e,t){var r;this.remoteParticipants.delete(e),t&&(this.incomingDataStreamManager.validateParticipantHasNoActiveDataStreams(e),t.trackPublications.forEach(i=>{t.unpublishTrack(i.trackSid,!0)}),this.emit(pe.ParticipantDisconnected,t),t.setDisconnected(),(r=this.localParticipant)===null||r===void 0||r.handleParticipantDisconnected(t.identity))}handleIncomingRpcRequest(e,t,r,i,s,c){return H(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(e,t),c!==1){yield this.engine.publishRpcResponse(e,t,null,An.builtIn("UNSUPPORTED_VERSION"));return}const l=this.rpcHandlers.get(r);if(!l){yield this.engine.publishRpcResponse(e,t,null,An.builtIn("UNSUPPORTED_METHOD"));return}let d=null,h=null;try{const m=yield l({requestId:t,callerIdentity:e,payload:i,responseTimeout:s});MT(m)>CO?(d=An.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),this.log.warn("RPC Response payload too large for ".concat(r))):h=m}catch(m){m instanceof An?d=m:(this.log.warn("Uncaught error returned by RPC handler for ".concat(r,". Returning APPLICATION_ERROR instead."),m),d=An.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(e,t,h,d)})}selectDefaultDevices(){return H(this,void 0,void 0,function*(){var e,t,r;const i=fr.getInstance().previousDevices,s=yield fr.getInstance().getDevices(void 0,!1),c=Gr();if(c?.name==="Chrome"&&c.os!=="iOS")for(let d of s){const h=i.find(m=>m.deviceId===d.deviceId);h&&h.label!==""&&h.kind===d.kind&&h.label!==d.label&&this.getActiveDevice(d.kind)==="default"&&this.emit(pe.ActiveDeviceChanged,d.kind,d.deviceId)}const l=["audiooutput","audioinput","videoinput"];for(let d of l){const h=gJ(d),m=this.localParticipant.getTrackPublication(h);if(m&&(!((e=m.track)===null||e===void 0)&&e.isUserProvided))continue;const g=s.filter(_=>_.kind===d),b=this.getActiveDevice(d);if(b===((t=i.filter(_=>_.kind===d)[0])===null||t===void 0?void 0:t.deviceId)&&g.length>0&&((r=g[0])===null||r===void 0?void 0:r.deviceId)!==b){yield this.switchActiveDevice(d,g[0].deviceId);continue}d==="audioinput"&&!qf()||d==="videoinput"||g.length>0&&!g.find(_=>_.deviceId===this.getActiveDevice(d))&&(d!=="audiooutput"||!qf())&&(yield this.switchActiveDevice(d,g[0].deviceId))}})}acquireAudioContext(){return H(this,void 0,void 0,function*(){var e,t;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(e=mO())!==null&&e!==void 0?e:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(i=>i.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&this.audioContext.state==="suspended")try{yield Promise.race([this.audioContext.resume(),Er(200)])}catch(i){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:i}))}const r=((t=this.audioContext)===null||t===void 0?void 0:t.state)==="running";r!==this.canPlaybackAudio&&(this.audioEnabled=r,this.emit(pe.AudioPlaybackStatusChanged,r))})}createParticipant(e,t){var r;let i;return t?i=zv.fromParticipantInfo(this.engine.client,t,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):i=new zv(this.engine.client,"",e,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&i.setAudioContext(this.audioContext),!((r=this.options.audioOutput)===null||r===void 0)&&r.deviceId&&i.setAudioOutput(this.options.audioOutput).catch(s=>this.log.warn("Could not set audio output: ".concat(s.message),this.logContext)),i}getOrCreateParticipant(e,t){if(this.remoteParticipants.has(e)){const i=this.remoteParticipants.get(e);return t&&i.updateInfo(t)&&this.sidToIdentity.set(t.sid,t.identity),i}const r=this.createParticipant(e,t);return this.remoteParticipants.set(e,r),this.sidToIdentity.set(t.sid,t.identity),this.emitWhenConnected(pe.ParticipantConnected,r),r.on(ye.TrackPublished,i=>{this.emitWhenConnected(pe.TrackPublished,i,r)}).on(ye.TrackSubscribed,(i,s)=>{i.kind===he.Kind.Audio?(i.on(De.AudioPlaybackStarted,this.handleAudioPlaybackStarted),i.on(De.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):i.kind===he.Kind.Video&&(i.on(De.VideoPlaybackFailed,this.handleVideoPlaybackFailed),i.on(De.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(pe.TrackSubscribed,i,s,r)}).on(ye.TrackUnpublished,i=>{this.emit(pe.TrackUnpublished,i,r)}).on(ye.TrackUnsubscribed,(i,s)=>{this.emit(pe.TrackUnsubscribed,i,s,r)}).on(ye.TrackMuted,i=>{this.emitWhenConnected(pe.TrackMuted,i,r)}).on(ye.TrackUnmuted,i=>{this.emitWhenConnected(pe.TrackUnmuted,i,r)}).on(ye.ParticipantMetadataChanged,i=>{this.emitWhenConnected(pe.ParticipantMetadataChanged,i,r)}).on(ye.ParticipantNameChanged,i=>{this.emitWhenConnected(pe.ParticipantNameChanged,i,r)}).on(ye.AttributesChanged,i=>{this.emitWhenConnected(pe.ParticipantAttributesChanged,i,r)}).on(ye.ConnectionQualityChanged,i=>{this.emitWhenConnected(pe.ConnectionQualityChanged,i,r)}).on(ye.ParticipantPermissionsChanged,i=>{this.emitWhenConnected(pe.ParticipantPermissionsChanged,i,r)}).on(ye.TrackSubscriptionStatusChanged,(i,s)=>{this.emitWhenConnected(pe.TrackSubscriptionStatusChanged,i,s,r)}).on(ye.TrackSubscriptionFailed,(i,s)=>{this.emit(pe.TrackSubscriptionFailed,i,r,s)}).on(ye.TrackSubscriptionPermissionChanged,(i,s)=>{this.emitWhenConnected(pe.TrackSubscriptionPermissionChanged,i,s,r)}).on(ye.Active,()=>{this.emitWhenConnected(pe.ParticipantActive,r),r.kind===zf.AGENT&&this.localParticipant.setActiveAgent(r)}),t&&r.updateInfo(t),r}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce((r,i)=>(r.push(...i.getTrackPublications()),r),[]),t=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,t)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const t of e.videoTrackPublications.values())t.isSubscribed&&VJ(t)&&t.emitTrackUpdate()}getRemoteParticipantBySid(e){const t=this.sidToIdentity.get(e);if(t)return this.remoteParticipants.get(t)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=wr.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,vs.STATE_MISMATCH))):e=0},ree)}clearConnectionReconcile(){this.connectionReconcileInterval&&wr.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e===this.state?!1:(this.state=e,this.emit(pe.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(e=>{let[t,r]=e;this.emit(t,...r)}),this.bufferedEvents=[]}emitWhenConnected(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];if(this.state===Ht.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,r]);else if(this.state===Ht.Connected)return this.emit(e,...r);return!1}simulateParticipants(e){return H(this,void 0,void 0,function*(){var t,r;const i=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),s=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new M0({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:xn.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new kl({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(pe.SignalConnected),this.emit(pe.Connected),this.setAndEmitConnectionState(Ht.Connected),i.video){const c=new Uv(he.Kind.Video,new zu({source:Xn.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:ds.AUDIO,name:"video-dummy"}),new Lv(i.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:kA(160*((t=s.aspectRatios[0])!==null&&t!==void 0?t:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(c),this.localParticipant.emit(ye.LocalTrackPublished,c)}if(i.audio){const c=new Uv(he.Kind.Audio,new zu({source:Xn.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:ds.AUDIO}),new jv(i.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:M1(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(c),this.localParticipant.emit(ye.LocalTrackPublished,c)}for(let c=0;c<s.count-1;c+=1){let l=new kl({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(c),state:Ju.ACTIVE,tracks:[],joinedAt:xn.parse(Date.now())});const d=this.getOrCreateParticipant(l.identity,l);if(s.video){const h=kA(160*((r=s.aspectRatios[c%s.aspectRatios.length])!==null&&r!==void 0?r:1),160,!1,!0),m=new zu({source:Xn.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:ds.AUDIO});d.addSubscribedMediaTrack(h,m.sid,new MediaStream([h]),new RTCRtpReceiver),l.tracks=[...l.tracks,m]}if(s.audio){const h=M1(),m=new zu({source:Xn.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:ds.AUDIO});d.addSubscribedMediaTrack(h,m.sid,new MediaStream([h]),new RTCRtpReceiver),l.tracks=[...l.tracks,m]}d.updateInfo(l)}})}emit(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];if(e!==pe.ActiveSpeakersChanged&&e!==pe.TranscriptionReceived){const s=DO(r).filter(c=>c!==void 0);(e===pe.TrackSubscribed||e===pe.TrackUnsubscribed)&&this.log.trace("subscribe trace: ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:s})),this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:s}))}return super.emit(e,...r)}}to.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry(n=>{n()});function DO(n){return n.map(e=>{if(e)return Array.isArray(e)?DO(e):typeof e=="object"?"logContext"in e?e.logContext:void 0:e})}var us;(function(n){n[n.IDLE=0]="IDLE",n[n.RUNNING=1]="RUNNING",n[n.SKIPPED=2]="SKIPPED",n[n.SUCCESS=3]="SUCCESS",n[n.FAILED=4]="FAILED"})(us||(us={}));class Ec extends da.EventEmitter{constructor(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=us.IDLE,this.logs=[],this.options={},this.url=e,this.token=t,this.name=this.constructor.name,this.room=new to(r.roomOptions),this.connectOptions=r.connectOptions,this.options=r}run(e){return H(this,void 0,void 0,function*(){if(this.status!==us.IDLE)throw Error("check is running already");this.setStatus(us.RUNNING);try{yield this.perform()}catch(t){t instanceof Error&&(this.options.errorsAsWarnings?this.appendWarning(t.message):this.appendError(t.message))}return yield this.disconnect(),yield new Promise(t=>setTimeout(t,500)),this.status!==us.SKIPPED&&this.setStatus(this.isSuccess()?us.SUCCESS:us.FAILED),e&&e(),this.getInfo()})}isSuccess(){return!this.logs.some(e=>e.level==="error")}connect(e){return H(this,void 0,void 0,function*(){return this.room.state===Ht.Connected?this.room:(e||(e=this.url),yield this.room.connect(e,this.token,this.connectOptions),this.room)})}disconnect(){return H(this,void 0,void 0,function*(){this.room&&this.room.state!==Ht.Disconnected&&(yield this.room.disconnect(),yield new Promise(e=>setTimeout(e,500)))})}skip(){this.setStatus(us.SKIPPED)}switchProtocol(e){return H(this,void 0,void 0,function*(){let t=!1,r=!1;if(this.room.on(pe.Reconnecting,()=>{t=!0}),this.room.once(pe.Reconnected,()=>{r=!0}),this.room.simulateScenario("force-".concat(e)),yield new Promise(s=>setTimeout(s,1e3)),!t)return;const i=Date.now()+1e4;for(;Date.now()<i;){if(r)return;yield Er(100)}throw new Error("Could not reconnect using ".concat(e," protocol after 10 seconds"))})}appendMessage(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}appendWarning(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}appendError(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}setStatus(e){this.status=e,this.emit("update",this.getInfo())}get engine(){var e;return(e=this.room)===null||e===void 0?void 0:e.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class iee extends Ec{get description(){return"Cloud regions"}perform(){return H(this,void 0,void 0,function*(){const e=new zt(this.url,this.token);if(!e.isCloud()){this.skip();return}const t=[],r=new Set;for(let s=0;s<3;s++){const c=yield e.getNextBestRegionUrl();if(!c)break;if(r.has(c))continue;r.add(c);const l=yield this.checkCloudRegion(c);this.appendMessage("".concat(l.region," RTT: ").concat(l.rtt,"ms, duration: ").concat(l.duration,"ms")),t.push(l)}t.sort((s,c)=>(s.duration-c.duration)*.5+(s.rtt-c.rtt)*.5);const i=t[0];this.bestStats=i,this.appendMessage("best Cloud region: ".concat(i.region))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkCloudRegion(e){return H(this,void 0,void 0,function*(){var t,r;yield this.connect(e),this.options.protocol==="tcp"&&(yield this.switchProtocol("tcp"));const i=(t=this.room.serverInfo)===null||t===void 0?void 0:t.region;if(!i)throw new Error("Region not found");const s=yield this.room.localParticipant.streamText({topic:"test"}),c=1e3,d=1e6/c,h="A".repeat(c),m=Date.now();for(let R=0;R<d;R++)yield s.write(h);yield s.close();const g=Date.now(),b=yield(r=this.room.engine.pcManager)===null||r===void 0?void 0:r.publisher.getStats(),_={region:i,rtt:1e4,duration:g-m};return b?.forEach(R=>{R.type==="candidate-pair"&&R.nominated&&(_.rtt=R.currentRoundTripTime*1e3)}),yield this.disconnect(),_})}}const B1=1e4;class see extends Ec{get description(){return"Connection via UDP vs TCP"}perform(){return H(this,void 0,void 0,function*(){const e=yield this.checkConnectionProtocol("udp"),t=yield this.checkConnectionProtocol("tcp");this.bestStats=e,e.qualityLimitationDurations.bandwidth-t.qualityLimitationDurations.bandwidth>.5||(e.packetsLost-t.packetsLost)/e.packetsSent>.01?(this.appendMessage("best connection quality via tcp"),this.bestStats=t):this.appendMessage("best connection quality via udp");const r=this.bestStats;this.appendMessage("upstream bitrate: ".concat((r.bitrateTotal/r.count/1e3/1e3).toFixed(2)," mbps")),this.appendMessage("RTT: ".concat((r.rttTotal/r.count*1e3).toFixed(2)," ms")),this.appendMessage("jitter: ".concat((r.jitterTotal/r.count*1e3).toFixed(2)," ms")),r.packetsLost>0&&this.appendWarning("packets lost: ".concat((r.packetsLost/r.packetsSent*100).toFixed(2),"%")),r.qualityLimitationDurations.bandwidth>1&&this.appendWarning("bandwidth limited ".concat((r.qualityLimitationDurations.bandwidth/(B1/1e3)*100).toFixed(2),"%")),r.qualityLimitationDurations.cpu>0&&this.appendWarning("cpu limited ".concat((r.qualityLimitationDurations.cpu/(B1/1e3)*100).toFixed(2),"%"))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkConnectionProtocol(e){return H(this,void 0,void 0,function*(){yield this.connect(),e==="tcp"?yield this.switchProtocol("tcp"):yield this.switchProtocol("udp");const t=document.createElement("canvas");t.width=1280,t.height=720;const r=t.getContext("2d");if(!r)throw new Error("Could not get canvas context");let i=0;const s=()=>{i=(i+1)%360,r.fillStyle="hsl(".concat(i,", 100%, 50%)"),r.fillRect(0,0,t.width,t.height),requestAnimationFrame(s)};s();const l=t.captureStream(30).getVideoTracks()[0],h=(yield this.room.localParticipant.publishTrack(l,{simulcast:!1,degradationPreference:"maintain-resolution",videoEncoding:{maxBitrate:2e6}})).track,m={protocol:e,packetsLost:0,packetsSent:0,qualityLimitationDurations:{},rttTotal:0,jitterTotal:0,bitrateTotal:0,count:0},g=setInterval(()=>H(this,void 0,void 0,function*(){const b=yield h.getRTCStatsReport();b?.forEach(_=>{_.type==="outbound-rtp"?(m.packetsSent=_.packetsSent,m.qualityLimitationDurations=_.qualityLimitationDurations,m.bitrateTotal+=_.targetBitrate,m.count++):_.type==="remote-inbound-rtp"&&(m.packetsLost=_.packetsLost,m.rttTotal+=_.roundTripTime,m.jitterTotal+=_.jitter)})}),1e3);return yield new Promise(b=>setTimeout(b,B1)),clearInterval(g),l.stop(),t.remove(),yield this.disconnect(),m})}}class aee extends Ec{get description(){return"Can publish audio"}perform(){return H(this,void 0,void 0,function*(){var e;const t=yield this.connect(),r=yield ZZ();if(yield pO(r,1e3))throw new Error("unable to detect audio from microphone");this.appendMessage("detected audio from microphone"),t.localParticipant.publishTrack(r),yield new Promise(l=>setTimeout(l,3e3));const s=yield(e=r.sender)===null||e===void 0?void 0:e.getStats();if(!s)throw new Error("Could not get RTCStats");let c=0;if(s.forEach(l=>{l.type==="outbound-rtp"&&(l.kind==="audio"||!l.kind&&l.mediaType==="audio")&&(c=l.packetsSent)}),c===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(c," audio packets"))})}}class oee extends Ec{get description(){return"Can publish video"}perform(){return H(this,void 0,void 0,function*(){var e;const t=yield this.connect(),r=yield JZ();yield this.checkForVideo(r.mediaStreamTrack),t.localParticipant.publishTrack(r),yield new Promise(c=>setTimeout(c,5e3));const i=yield(e=r.sender)===null||e===void 0?void 0:e.getStats();if(!i)throw new Error("Could not get RTCStats");let s=0;if(i.forEach(c=>{c.type==="outbound-rtp"&&(c.kind==="video"||!c.kind&&c.mediaType==="video")&&(s+=c.packetsSent)}),s===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(s," video packets"))})}checkForVideo(e){return H(this,void 0,void 0,function*(){const t=new MediaStream;t.addTrack(e.clone());const r=document.createElement("video");r.srcObject=t,r.muted=!0,r.autoplay=!0,r.playsInline=!0,r.setAttribute("playsinline","true"),document.body.appendChild(r),yield new Promise(i=>{r.onplay=()=>{setTimeout(()=>{var s,c,l,d;const h=document.createElement("canvas"),m=e.getSettings(),g=(c=(s=m.width)!==null&&s!==void 0?s:r.videoWidth)!==null&&c!==void 0?c:1280,b=(d=(l=m.height)!==null&&l!==void 0?l:r.videoHeight)!==null&&d!==void 0?d:720;h.width=g,h.height=b;const _=h.getContext("2d");_.drawImage(r,0,0);const E=_.getImageData(0,0,h.width,h.height).data;let A=!0;for(let M=0;M<E.length;M+=4)if(E[M]!==0||E[M+1]!==0||E[M+2]!==0){A=!1;break}A?this.appendError("camera appears to be producing only black frames"):this.appendMessage("received video frames"),i()},1e3)},r.play()}),t.getTracks().forEach(i=>i.stop()),r.remove()})}}class cee extends Ec{get description(){return"Resuming connection after interruption"}perform(){return H(this,void 0,void 0,function*(){var e;const t=yield this.connect();let r=!1,i=!1,s;const c=new Promise(h=>{setTimeout(h,5e3),s=h}),l=()=>{r=!0};t.on(pe.SignalReconnecting,l).on(pe.Reconnecting,l).on(pe.Reconnected,()=>{i=!0,s(!0)}),(e=t.engine.client.ws)===null||e===void 0||e.close();const d=t.engine.client.onClose;if(d&&d(""),yield c,r){if(!i||t.state!==Ht.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class lee extends Ec{get description(){return"Can connect via TURN"}perform(){return H(this,void 0,void 0,function*(){var e,t,r;Cd(new URL(this.url))&&(this.appendMessage("Using region specific url"),this.url=(e=yield new zt(this.url,this.token).getNextBestRegionUrl())!==null&&e!==void 0?e:this.url);const i=new RT,s=yield i.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3,singlePeerConnection:!1});let c=!1,l=!1,d=!1;for(let h of s.iceServers)for(let m of h.urls)m.startsWith("turn:")?(l=!0,d=!0):m.startsWith("turns:")&&(l=!0,d=!0,c=!0),m.startsWith("stun:")&&(d=!0);d?l&&!c&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield i.close(),!((r=(t=this.connectOptions)===null||t===void 0?void 0:t.rtcConfig)===null||r===void 0)&&r.iceServers||l?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(h=>setTimeout(h,0)))})}}class uee extends Ec{get description(){return"Establishing WebRTC connection"}perform(){return H(this,void 0,void 0,function*(){let e=!1,t=!1;this.room.on(pe.SignalConnected,()=>{var r;const i=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(s,c)=>{if(s.candidate){const l=new RTCIceCandidate(s);let d="".concat(l.protocol," ").concat(l.address,":").concat(l.port," ").concat(l.type);l.address&&(dee(l.address)?d+=" (private)":l.protocol==="tcp"&&l.tcpType==="passive"?(e=!0,d+=" (passive)"):l.protocol==="udp"&&(t=!0)),this.appendMessage(d)}i&&i(s,c)},!((r=this.room.engine.pcManager)===null||r===void 0)&&r.subscriber&&(this.room.engine.pcManager.subscriber.onIceCandidateError=s=>{s instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(s.errorCode," ").concat(s.errorText," ").concat(s.url))})});try{yield this.connect(),gt.info("now the room is connected")}catch(r){throw this.appendWarning("ports need to be open on firewall in order to connect."),r}e||this.appendWarning("Server is not configured for ICE/TCP"),t||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function dee(n){const e=n.split(".");if(e.length===4){if(e[0]==="10")return!0;if(e[0]==="192"&&e[1]==="168")return!0;if(e[0]==="172"){const t=parseInt(e[1],10);if(t>=16&&t<=31)return!0}}return!1}class hee extends Ec{get description(){return"Connecting to signal connection via WebSocket"}perform(){return H(this,void 0,void 0,function*(){var e,t,r;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let i=new RT,s;try{s=yield i.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3,singlePeerConnection:!1})}catch(c){if(Cd(new URL(this.url))){this.appendMessage("Initial connection failed with error ".concat(c.message,". Retrying with region fallback"));const d=yield new zt(this.url,this.token).getNextBestRegionUrl();d&&(s=yield i.join(d,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3,singlePeerConnection:!1}),this.appendMessage("Fallback to region worked. To avoid initial connections failing, ensure you're calling room.prepareConnection() ahead of time"))}}s?(this.appendMessage("Connected to server, version ".concat(s.serverVersion,".")),((e=s.serverInfo)===null||e===void 0?void 0:e.edition)===yD.Cloud&&(!((t=s.serverInfo)===null||t===void 0)&&t.region)&&this.appendMessage("LiveKit Cloud: ".concat((r=s.serverInfo)===null||r===void 0?void 0:r.region))):this.appendError("Websocket connection could not be established"),yield i.close()})}}class Kre extends da.EventEmitter{constructor(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=e,this.token=t,this.options=r}getNextCheckId(){const e=this.checkResults.size;return this.checkResults.set(e,{logs:[],status:us.IDLE,name:"",description:""}),e}updateCheck(e,t){this.checkResults.set(e,t),this.emit("checkUpdate",e,t)}isSuccess(){return Array.from(this.checkResults.values()).every(e=>e.status!==us.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(e){return H(this,void 0,void 0,function*(){const t=this.getNextCheckId(),r=new e(this.url,this.token,this.options),i=c=>{this.updateCheck(t,c)};r.on("update",i);const s=yield r.run();return r.off("update",i),s})}checkWebsocket(){return H(this,void 0,void 0,function*(){return this.createAndRunCheck(hee)})}checkWebRTC(){return H(this,void 0,void 0,function*(){return this.createAndRunCheck(uee)})}checkTURN(){return H(this,void 0,void 0,function*(){return this.createAndRunCheck(lee)})}checkReconnect(){return H(this,void 0,void 0,function*(){return this.createAndRunCheck(cee)})}checkPublishAudio(){return H(this,void 0,void 0,function*(){return this.createAndRunCheck(aee)})}checkPublishVideo(){return H(this,void 0,void 0,function*(){return this.createAndRunCheck(oee)})}checkConnectionProtocol(){return H(this,void 0,void 0,function*(){const e=yield this.createAndRunCheck(see);if(e.data&&"protocol"in e.data){const t=e.data;this.options.protocol=t.protocol}return e})}checkCloudRegion(){return H(this,void 0,void 0,function*(){return this.createAndRunCheck(iee)})}}function Nt(n,e,t){return(e=pee(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function fee(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function pee(n){var e=fee(n,"string");return typeof e=="symbol"?e:e+""}new TextEncoder;new TextDecoder;class Wr extends Error{constructor(e,t){var r;super(e,t),Nt(this,"code","ERR_JOSE_GENERIC"),this.name=this.constructor.name,(r=Error.captureStackTrace)===null||r===void 0||r.call(Error,this,this.constructor)}}Nt(Wr,"code","ERR_JOSE_GENERIC");class mee extends Wr{constructor(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:r,reason:i,payload:t}}),Nt(this,"code","ERR_JWT_CLAIM_VALIDATION_FAILED"),Nt(this,"claim",void 0),Nt(this,"reason",void 0),Nt(this,"payload",void 0),this.claim=r,this.reason=i,this.payload=t}}Nt(mee,"code","ERR_JWT_CLAIM_VALIDATION_FAILED");class gee extends Wr{constructor(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:r,reason:i,payload:t}}),Nt(this,"code","ERR_JWT_EXPIRED"),Nt(this,"claim",void 0),Nt(this,"reason",void 0),Nt(this,"payload",void 0),this.claim=r,this.reason=i,this.payload=t}}Nt(gee,"code","ERR_JWT_EXPIRED");class vee extends Wr{constructor(){super(...arguments),Nt(this,"code","ERR_JOSE_ALG_NOT_ALLOWED")}}Nt(vee,"code","ERR_JOSE_ALG_NOT_ALLOWED");class yee extends Wr{constructor(){super(...arguments),Nt(this,"code","ERR_JOSE_NOT_SUPPORTED")}}Nt(yee,"code","ERR_JOSE_NOT_SUPPORTED");class bee extends Wr{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"decryption operation failed",t=arguments.length>1?arguments[1]:void 0;super(e,t),Nt(this,"code","ERR_JWE_DECRYPTION_FAILED")}}Nt(bee,"code","ERR_JWE_DECRYPTION_FAILED");class xee extends Wr{constructor(){super(...arguments),Nt(this,"code","ERR_JWE_INVALID")}}Nt(xee,"code","ERR_JWE_INVALID");class _ee extends Wr{constructor(){super(...arguments),Nt(this,"code","ERR_JWS_INVALID")}}Nt(_ee,"code","ERR_JWS_INVALID");class See extends Wr{constructor(){super(...arguments),Nt(this,"code","ERR_JWT_INVALID")}}Nt(See,"code","ERR_JWT_INVALID");class Tee extends Wr{constructor(){super(...arguments),Nt(this,"code","ERR_JWK_INVALID")}}Nt(Tee,"code","ERR_JWK_INVALID");class kee extends Wr{constructor(){super(...arguments),Nt(this,"code","ERR_JWKS_INVALID")}}Nt(kee,"code","ERR_JWKS_INVALID");class Cee extends Wr{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"no applicable key found in the JSON Web Key Set",t=arguments.length>1?arguments[1]:void 0;super(e,t),Nt(this,"code","ERR_JWKS_NO_MATCHING_KEY")}}Nt(Cee,"code","ERR_JWKS_NO_MATCHING_KEY");class wee extends Wr{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"multiple matching keys found in the JSON Web Key Set",t=arguments.length>1?arguments[1]:void 0;super(e,t),Nt(this,Symbol.asyncIterator,void 0),Nt(this,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS")}}Nt(wee,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS");class Eee extends Wr{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"request timed out",t=arguments.length>1?arguments[1]:void 0;super(e,t),Nt(this,"code","ERR_JWKS_TIMEOUT")}}Nt(Eee,"code","ERR_JWKS_TIMEOUT");class Ree extends Wr{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"signature verification failed",t=arguments.length>1?arguments[1]:void 0;super(e,t),Nt(this,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED")}}Nt(Ree,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED");function Aee(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var t;const r=fl(n)?n.mediaStreamTrack:n,i=r.getSettings();let s={facingMode:(t=e.defaultFacingMode)!==null&&t!==void 0?t:"user",confidence:"low"};if("facingMode"in i){const c=i.facingMode;gt.trace("rawFacingMode",{rawFacingMode:c}),c&&typeof c=="string"&&Pee(c)&&(s={facingMode:c,confidence:"high"})}if(["low","medium"].includes(s.confidence)){gt.trace("Try to get facing mode from device label: (".concat(r.label,")"));const c=Iee(r.label);c!==void 0&&(s=c)}return s}const WA=new Map([["obs virtual camera",{facingMode:"environment",confidence:"medium"}]]),Nee=new Map([["iphone",{facingMode:"environment",confidence:"medium"}],["ipad",{facingMode:"environment",confidence:"medium"}]]);function Iee(n){var e;const t=n.trim().toLowerCase();if(t!=="")return WA.has(t)?WA.get(t):(e=Array.from(Nee.entries()).find(r=>{let[i]=r;return t.includes(i)}))===null||e===void 0?void 0:e[1]}function Pee(n){return n===void 0||["user","environment","left","right"].includes(n)}var sg=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function OO(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var y_={exports:{}},Mee=y_.exports,YA;function Dee(){return YA||(YA=1,(function(n){(function(e,t){n.exports?n.exports=t():e.log=t()})(Mee,function(){var e=function(){},t="undefined",r=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"],s={},c=null;function l(E,A){var M=E[A];if(typeof M.bind=="function")return M.bind(E);try{return Function.prototype.bind.call(M,E)}catch{return function(){return Function.prototype.apply.apply(M,[E,arguments])}}}function d(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function h(E){return E==="debug"&&(E="log"),typeof console===t?!1:E==="trace"&&r?d:console[E]!==void 0?l(console,E):console.log!==void 0?l(console,"log"):e}function m(){for(var E=this.getLevel(),A=0;A<i.length;A++){var M=i[A];this[M]=A<E?e:this.methodFactory(M,E,this.name)}if(this.log=this.debug,typeof console===t&&E<this.levels.SILENT)return"No console available for logging"}function g(E){return function(){typeof console!==t&&(m.call(this),this[E].apply(this,arguments))}}function b(E,A,M){return h(E)||g.apply(this,arguments)}function _(E,A){var M=this,F,j,C,N="loglevel";typeof E=="string"?N+=":"+E:typeof E=="symbol"&&(N=void 0);function D(U){var z=(i[U]||"silent").toUpperCase();if(!(typeof window===t||!N)){try{window.localStorage[N]=z;return}catch{}try{window.document.cookie=encodeURIComponent(N)+"="+z+";"}catch{}}}function S(){var U;if(!(typeof window===t||!N)){try{U=window.localStorage[N]}catch{}if(typeof U===t)try{var z=window.document.cookie,V=encodeURIComponent(N),le=z.indexOf(V+"=");le!==-1&&(U=/^([^;]+)/.exec(z.slice(le+V.length+1))[1])}catch{}return M.levels[U]===void 0&&(U=void 0),U}}function k(){if(!(typeof window===t||!N)){try{window.localStorage.removeItem(N)}catch{}try{window.document.cookie=encodeURIComponent(N)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function P(U){var z=U;if(typeof z=="string"&&M.levels[z.toUpperCase()]!==void 0&&(z=M.levels[z.toUpperCase()]),typeof z=="number"&&z>=0&&z<=M.levels.SILENT)return z;throw new TypeError("log.setLevel() called with invalid level: "+U)}M.name=E,M.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},M.methodFactory=A||b,M.getLevel=function(){return C??j??F},M.setLevel=function(U,z){return C=P(U),z!==!1&&D(C),m.call(M)},M.setDefaultLevel=function(U){j=P(U),S()||M.setLevel(U,!1)},M.resetLevel=function(){C=null,k(),m.call(M)},M.enableAll=function(U){M.setLevel(M.levels.TRACE,U)},M.disableAll=function(U){M.setLevel(M.levels.SILENT,U)},M.rebuild=function(){if(c!==M&&(F=P(c.getLevel())),m.call(M),c===M)for(var U in s)s[U].rebuild()},F=P(c?c.getLevel():"WARN");var L=S();L!=null&&(C=P(L)),m.call(M)}c=new _,c.getLogger=function(E){if(typeof E!="symbol"&&typeof E!="string"||E==="")throw new TypeError("You must supply a name when creating a logger.");var A=s[E];return A||(A=s[E]=new _(E,c.methodFactory)),A};var R=typeof window!==t?window.log:void 0;return c.noConflict=function(){return typeof window!==t&&window.log===c&&(window.log=R),c},c.getLoggers=function(){return s},c.default=c,c})})(y_)),y_.exports}var Oee=Dee();const jee=OO(Oee);var b_=function(n,e){return b_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])},b_(n,e)};function io(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");b_(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Lee(n,e,t,r){function i(s){return s instanceof t?s:new t(function(c){c(s)})}return new(t||(t=Promise))(function(s,c){function l(m){try{h(r.next(m))}catch(g){c(g)}}function d(m){try{h(r.throw(m))}catch(g){c(g)}}function h(m){m.done?s(m.value):i(m.value).then(l,d)}h((r=r.apply(n,[])).next())})}function jO(n,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,c=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return c.next=l(0),c.throw=l(1),c.return=l(2),typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function l(h){return function(m){return d([h,m])}}function d(h){if(r)throw new TypeError("Generator is already executing.");for(;c&&(c=0,h[0]&&(t=0)),t;)try{if(r=1,i&&(s=h[0]&2?i.return:h[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,h[1])).done)return s;switch(i=0,s&&(h=[h[0]&2,s.value]),h[0]){case 0:case 1:s=h;break;case 4:return t.label++,{value:h[1],done:!1};case 5:t.label++,i=h[1],h=[0];continue;case 7:h=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(h[0]===6||h[0]===2)){t=0;continue}if(h[0]===3&&(!s||h[1]>s[0]&&h[1]<s[3])){t.label=h[1];break}if(h[0]===6&&t.label<s[1]){t.label=s[1],s=h;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(h);break}s[2]&&t.ops.pop(),t.trys.pop();continue}h=e.call(n,t)}catch(m){h=[6,m],i=0}finally{r=s=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}}function wd(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ed(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],c;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(l){c={error:l}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(c)throw c.error}}return s}function Gf(n,e,t){if(arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return n.concat(s||Array.prototype.slice.call(e))}function id(n){return this instanceof id?(this.v=n,this):new id(n)}function Uee(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),i,s=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),l("next"),l("throw"),l("return",c),i[Symbol.asyncIterator]=function(){return this},i;function c(_){return function(R){return Promise.resolve(R).then(_,g)}}function l(_,R){r[_]&&(i[_]=function(E){return new Promise(function(A,M){s.push([_,E,A,M])>1||d(_,E)})},R&&(i[_]=R(i[_])))}function d(_,R){try{h(r[_](R))}catch(E){b(s[0][3],E)}}function h(_){_.value instanceof id?Promise.resolve(_.value.v).then(m,g):b(s[0][2],_)}function m(_){d("next",_)}function g(_){d("throw",_)}function b(_,R){_(R),s.shift(),s.length&&d(s[0][0],s[0][1])}}function Vee(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof wd=="function"?wd(n):n[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(s){t[s]=n[s]&&function(c){return new Promise(function(l,d){c=n[s](c),i(l,d,c.done,c.value)})}}function i(s,c,l,d){Promise.resolve(d).then(function(h){s({value:h,done:l})},c)}}function dn(n){return typeof n=="function"}function jT(n){var e=function(r){Error.call(r),r.stack=new Error().stack},t=n(e);return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var $1=jT(function(n){return function(e){n(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(t,r){return r+1+") "+t.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function Fv(n,e){if(n){var t=n.indexOf(e);0<=t&&n.splice(t,1)}}var pp=(function(){function n(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return n.prototype.unsubscribe=function(){var e,t,r,i,s;if(!this.closed){this.closed=!0;var c=this._parentage;if(c)if(this._parentage=null,Array.isArray(c))try{for(var l=wd(c),d=l.next();!d.done;d=l.next()){var h=d.value;h.remove(this)}}catch(E){e={error:E}}finally{try{d&&!d.done&&(t=l.return)&&t.call(l)}finally{if(e)throw e.error}}else c.remove(this);var m=this.initialTeardown;if(dn(m))try{m()}catch(E){s=E instanceof $1?E.errors:[E]}var g=this._finalizers;if(g){this._finalizers=null;try{for(var b=wd(g),_=b.next();!_.done;_=b.next()){var R=_.value;try{QA(R)}catch(E){s=s??[],E instanceof $1?s=Gf(Gf([],Ed(s)),Ed(E.errors)):s.push(E)}}}catch(E){r={error:E}}finally{try{_&&!_.done&&(i=b.return)&&i.call(b)}finally{if(r)throw r.error}}}if(s)throw new $1(s)}},n.prototype.add=function(e){var t;if(e&&e!==this)if(this.closed)QA(e);else{if(e instanceof n){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}},n.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},n.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},n.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&Fv(t,e)},n.prototype.remove=function(e){var t=this._finalizers;t&&Fv(t,e),e instanceof n&&e._removeParent(this)},n.EMPTY=(function(){var e=new n;return e.closed=!0,e})(),n})(),LO=pp.EMPTY;function UO(n){return n instanceof pp||n&&"closed"in n&&dn(n.remove)&&dn(n.add)&&dn(n.unsubscribe)}function QA(n){dn(n)?n():n.unsubscribe()}var zee={Promise:void 0},Fee={setTimeout:function(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];return setTimeout.apply(void 0,Gf([n,e],Ed(t)))},clearTimeout:function(n){return clearTimeout(n)},delegate:void 0};function VO(n){Fee.setTimeout(function(){throw n})}function x_(){}function qg(n){n()}var LT=(function(n){io(e,n);function e(t){var r=n.call(this)||this;return r.isStopped=!1,t?(r.destination=t,UO(t)&&t.add(r)):r.destination=qee,r}return e.create=function(t,r,i){return new __(t,r,i)},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,n.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e})(pp),Bee=(function(){function n(e){this.partialObserver=e}return n.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(r){ag(r)}},n.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(r){ag(r)}else ag(e)},n.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(t){ag(t)}},n})(),__=(function(n){io(e,n);function e(t,r,i){var s=n.call(this)||this,c;return dn(t)||!t?c={next:t??void 0,error:r??void 0,complete:i??void 0}:c=t,s.destination=new Bee(c),s}return e})(LT);function ag(n){VO(n)}function $ee(n){throw n}var qee={closed:!0,next:x_,error:$ee,complete:x_},UT=(function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"})();function VT(n){return n}function Hee(n){return n.length===0?VT:n.length===1?n[0]:function(e){return n.reduce(function(t,r){return r(t)},e)}}var gr=(function(){function n(e){e&&(this._subscribe=e)}return n.prototype.lift=function(e){var t=new n;return t.source=this,t.operator=e,t},n.prototype.subscribe=function(e,t,r){var i=this,s=Kee(e)?e:new __(e,t,r);return qg(function(){var c=i,l=c.operator,d=c.source;s.add(l?l.call(s,d):d?i._subscribe(s):i._trySubscribe(s))}),s},n.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},n.prototype.forEach=function(e,t){var r=this;return t=XA(t),new t(function(i,s){var c=new __({next:function(l){try{e(l)}catch(d){s(d),c.unsubscribe()}},error:s,complete:i});r.subscribe(c)})},n.prototype._subscribe=function(e){var t;return(t=this.source)===null||t===void 0?void 0:t.subscribe(e)},n.prototype[UT]=function(){return this},n.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Hee(e)(this)},n.prototype.toPromise=function(e){var t=this;return e=XA(e),new e(function(r,i){var s;t.subscribe(function(c){return s=c},function(c){return i(c)},function(){return r(s)})})},n.create=function(e){return new n(e)},n})();function XA(n){var e;return(e=n??zee.Promise)!==null&&e!==void 0?e:Promise}function Gee(n){return n&&dn(n.next)&&dn(n.error)&&dn(n.complete)}function Kee(n){return n&&n instanceof LT||Gee(n)&&UO(n)}function Wee(n){return dn(n?.lift)}function so(n){return function(e){if(Wee(e))return e.lift(function(t){try{return n(t,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function no(n,e,t,r,i){return new Yee(n,e,t,r,i)}var Yee=(function(n){io(e,n);function e(t,r,i,s,c,l){var d=n.call(this,t)||this;return d.onFinalize=c,d.shouldUnsubscribe=l,d._next=r?function(h){try{r(h)}catch(m){t.error(m)}}:n.prototype._next,d._error=s?function(h){try{s(h)}catch(m){t.error(m)}finally{this.unsubscribe()}}:n.prototype._error,d._complete=i?function(){try{i()}catch(h){t.error(h)}finally{this.unsubscribe()}}:n.prototype._complete,d}return e.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;n.prototype.unsubscribe.call(this),!r&&((t=this.onFinalize)===null||t===void 0||t.call(this))}},e})(LT),Qee=jT(function(n){return function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),zO=(function(n){io(e,n);function e(){var t=n.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return e.prototype.lift=function(t){var r=new JA(this,this);return r.operator=t,r},e.prototype._throwIfClosed=function(){if(this.closed)throw new Qee},e.prototype.next=function(t){var r=this;qg(function(){var i,s;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var c=wd(r.currentObservers),l=c.next();!l.done;l=c.next()){var d=l.value;d.next(t)}}catch(h){i={error:h}}finally{try{l&&!l.done&&(s=c.return)&&s.call(c)}finally{if(i)throw i.error}}}})},e.prototype.error=function(t){var r=this;qg(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=t;for(var i=r.observers;i.length;)i.shift().error(t)}})},e.prototype.complete=function(){var t=this;qg(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var r=t.observers;r.length;)r.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(t){return this._throwIfClosed(),n.prototype._trySubscribe.call(this,t)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var r=this,i=this,s=i.hasError,c=i.isStopped,l=i.observers;return s||c?LO:(this.currentObservers=null,l.push(t),new pp(function(){r.currentObservers=null,Fv(l,t)}))},e.prototype._checkFinalizedStatuses=function(t){var r=this,i=r.hasError,s=r.thrownError,c=r.isStopped;i?t.error(s):c&&t.complete()},e.prototype.asObservable=function(){var t=new gr;return t.source=this,t},e.create=function(t,r){return new JA(t,r)},e})(gr),JA=(function(n){io(e,n);function e(t,r){var i=n.call(this)||this;return i.destination=t,i.source=r,i}return e.prototype.next=function(t){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.next)===null||i===void 0||i.call(r,t)},e.prototype.error=function(t){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.error)===null||i===void 0||i.call(r,t)},e.prototype.complete=function(){var t,r;(r=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||r===void 0||r.call(t)},e.prototype._subscribe=function(t){var r,i;return(i=(r=this.source)===null||r===void 0?void 0:r.subscribe(t))!==null&&i!==void 0?i:LO},e})(zO),Xee=(function(n){io(e,n);function e(t){var r=n.call(this)||this;return r._value=t,r}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(t){var r=n.prototype._subscribe.call(this,t);return!r.closed&&t.next(this._value),r},e.prototype.getValue=function(){var t=this,r=t.hasError,i=t.thrownError,s=t._value;if(r)throw i;return this._throwIfClosed(),s},e.prototype.next=function(t){n.prototype.next.call(this,this._value=t)},e})(zO),Jee={now:function(){return Date.now()}},Zee=(function(n){io(e,n);function e(t,r){return n.call(this)||this}return e.prototype.schedule=function(t,r){return this},e})(pp),ZA={setInterval:function(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];return setInterval.apply(void 0,Gf([n,e],Ed(t)))},clearInterval:function(n){return clearInterval(n)},delegate:void 0},ete=(function(n){io(e,n);function e(t,r){var i=n.call(this,t,r)||this;return i.scheduler=t,i.work=r,i.pending=!1,i}return e.prototype.schedule=function(t,r){var i;if(r===void 0&&(r=0),this.closed)return this;this.state=t;var s=this.id,c=this.scheduler;return s!=null&&(this.id=this.recycleAsyncId(c,s,r)),this.pending=!0,this.delay=r,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(c,this.id,r),this},e.prototype.requestAsyncId=function(t,r,i){return i===void 0&&(i=0),ZA.setInterval(t.flush.bind(t,this),i)},e.prototype.recycleAsyncId=function(t,r,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return r;r!=null&&ZA.clearInterval(r)},e.prototype.execute=function(t,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(t,r);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,r){var i=!1,s;try{this.work(t)}catch(c){i=!0,s=c||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),s},e.prototype.unsubscribe=function(){if(!this.closed){var t=this,r=t.id,i=t.scheduler,s=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,Fv(s,this),r!=null&&(this.id=this.recycleAsyncId(i,r,null)),this.delay=null,n.prototype.unsubscribe.call(this)}},e})(Zee),eN=(function(){function n(e,t){t===void 0&&(t=n.now),this.schedulerActionCtor=e,this.now=t}return n.prototype.schedule=function(e,t,r){return t===void 0&&(t=0),new this.schedulerActionCtor(this,e).schedule(r,t)},n.now=Jee.now,n})(),tte=(function(n){io(e,n);function e(t,r){r===void 0&&(r=eN.now);var i=n.call(this,t,r)||this;return i.actions=[],i._active=!1,i}return e.prototype.flush=function(t){var r=this.actions;if(this._active){r.push(t);return}var i;this._active=!0;do if(i=t.execute(t.state,t.delay))break;while(t=r.shift());if(this._active=!1,i){for(;t=r.shift();)t.unsubscribe();throw i}},e})(eN),nte=new tte(ete);function rte(n){return n&&dn(n.schedule)}function ite(n){return n[n.length-1]}function zT(n){return rte(ite(n))?n.pop():void 0}var FT=(function(n){return n&&typeof n.length=="number"&&typeof n!="function"});function FO(n){return dn(n?.then)}function BO(n){return dn(n[UT])}function $O(n){return Symbol.asyncIterator&&dn(n?.[Symbol.asyncIterator])}function qO(n){return new TypeError("You provided "+(n!==null&&typeof n=="object"?"an invalid object":"'"+n+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function ste(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var HO=ste();function GO(n){return dn(n?.[HO])}function KO(n){return Uee(this,arguments,function(){var e,t,r,i;return jO(this,function(s){switch(s.label){case 0:e=n.getReader(),s.label=1;case 1:s.trys.push([1,,9,10]),s.label=2;case 2:return[4,id(e.read())];case 3:return t=s.sent(),r=t.value,i=t.done,i?[4,id(void 0)]:[3,5];case 4:return[2,s.sent()];case 5:return[4,id(r)];case 6:return[4,s.sent()];case 7:return s.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}function WO(n){return dn(n?.getReader)}function Rc(n){if(n instanceof gr)return n;if(n!=null){if(BO(n))return ate(n);if(FT(n))return ote(n);if(FO(n))return cte(n);if($O(n))return YO(n);if(GO(n))return lte(n);if(WO(n))return ute(n)}throw qO(n)}function ate(n){return new gr(function(e){var t=n[UT]();if(dn(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function ote(n){return new gr(function(e){for(var t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()})}function cte(n){return new gr(function(e){n.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,VO)})}function lte(n){return new gr(function(e){var t,r;try{for(var i=wd(n),s=i.next();!s.done;s=i.next()){var c=s.value;if(e.next(c),e.closed)return}}catch(l){t={error:l}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}e.complete()})}function YO(n){return new gr(function(e){dte(n,e).catch(function(t){return e.error(t)})})}function ute(n){return YO(KO(n))}function dte(n,e){var t,r,i,s;return Lee(this,void 0,void 0,function(){var c,l;return jO(this,function(d){switch(d.label){case 0:d.trys.push([0,5,6,11]),t=Vee(n),d.label=1;case 1:return[4,t.next()];case 2:if(r=d.sent(),!!r.done)return[3,4];if(c=r.value,e.next(c),e.closed)return[2];d.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return l=d.sent(),i={error:l},[3,11];case 6:return d.trys.push([6,,9,10]),r&&!r.done&&(s=t.return)?[4,s.call(t)]:[3,8];case 7:d.sent(),d.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function hc(n,e,t,r,i){r===void 0&&(r=0),i===void 0&&(i=!1);var s=e.schedule(function(){t(),i?n.add(this.schedule(null,r)):this.unsubscribe()},r);if(n.add(s),!i)return s}function QO(n,e){return e===void 0&&(e=0),so(function(t,r){t.subscribe(no(r,function(i){return hc(r,n,function(){return r.next(i)},e)},function(){return hc(r,n,function(){return r.complete()},e)},function(i){return hc(r,n,function(){return r.error(i)},e)}))})}function XO(n,e){return e===void 0&&(e=0),so(function(t,r){r.add(n.schedule(function(){return t.subscribe(r)},e))})}function hte(n,e){return Rc(n).pipe(XO(e),QO(e))}function fte(n,e){return Rc(n).pipe(XO(e),QO(e))}function pte(n,e){return new gr(function(t){var r=0;return e.schedule(function(){r===n.length?t.complete():(t.next(n[r++]),t.closed||this.schedule())})})}function mte(n,e){return new gr(function(t){var r;return hc(t,e,function(){r=n[HO](),hc(t,e,function(){var i,s,c;try{i=r.next(),s=i.value,c=i.done}catch(l){t.error(l);return}c?t.complete():t.next(s)},0,!0)}),function(){return dn(r?.return)&&r.return()}})}function JO(n,e){if(!n)throw new Error("Iterable cannot be null");return new gr(function(t){hc(t,e,function(){var r=n[Symbol.asyncIterator]();hc(t,e,function(){r.next().then(function(i){i.done?t.complete():t.next(i.value)})},0,!0)})})}function gte(n,e){return JO(KO(n),e)}function vte(n,e){if(n!=null){if(BO(n))return hte(n,e);if(FT(n))return pte(n,e);if(FO(n))return fte(n,e);if($O(n))return JO(n,e);if(GO(n))return mte(n,e);if(WO(n))return gte(n,e)}throw qO(n)}function ZO(n,e){return e?vte(n,e):Rc(n)}function tN(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=zT(n);return ZO(n,t)}function yte(n){return n instanceof Date&&!isNaN(n)}var bte=jT(function(n){return function(e){e===void 0&&(e=null),n(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=e}});function xte(n,e){var t=yte(n)?{first:n}:typeof n=="number"?{each:n}:n,r=t.first,i=t.each,s=t.with,c=s===void 0?_te:s,l=t.scheduler,d=l===void 0?nte:l,h=t.meta,m=h===void 0?null:h;if(r==null&&i==null)throw new TypeError("No timeout provided.");return so(function(g,b){var _,R,E=null,A=0,M=function(F){R=hc(b,d,function(){try{_.unsubscribe(),Rc(c({meta:m,lastValue:E,seen:A})).subscribe(b)}catch(j){b.error(j)}},F)};_=g.subscribe(no(b,function(F){R?.unsubscribe(),A++,b.next(E=F),i>0&&M(i)},void 0,void 0,function(){R!=null&&R.closed||R==null||R.unsubscribe(),E=null})),!A&&M(r!=null?typeof r=="number"?r:+r-d.now():i)})}function _te(n){throw new bte(n)}function Zi(n,e){return so(function(t,r){var i=0;t.subscribe(no(r,function(s){r.next(n.call(e,s,i++))}))})}var Ste=Array.isArray;function Tte(n,e){return Ste(e)?n.apply(void 0,Gf([],Ed(e))):n(e)}function kte(n){return Zi(function(e){return Tte(n,e)})}function Cte(n,e,t,r,i,s,c,l){var d=[],h=0,m=0,g=!1,b=function(){g&&!d.length&&!h&&e.complete()},_=function(E){return h<r?R(E):d.push(E)},R=function(E){h++;var A=!1;Rc(t(E,m++)).subscribe(no(e,function(M){e.next(M)},function(){A=!0},void 0,function(){if(A)try{h--;for(var M=function(){var F=d.shift();c||R(F)};d.length&&h<r;)M();b()}catch(F){e.error(F)}}))};return n.subscribe(no(e,_,function(){g=!0,b()})),function(){}}function BT(n,e,t){return t===void 0&&(t=1/0),dn(e)?BT(function(r,i){return Zi(function(s,c){return e(r,s,i,c)})(Rc(n(r,i)))},t):(typeof e=="number"&&(t=e),so(function(r,i){return Cte(r,i,n,t)}))}function wte(n){return BT(VT,n)}function Ete(){return wte(1)}function Bv(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return Ete()(ZO(n,zT(n)))}var Rte=["addListener","removeListener"],Ate=["addEventListener","removeEventListener"],Nte=["on","off"];function S_(n,e,t,r){if(dn(t)&&(r=t,t=void 0),r)return S_(n,e,t).pipe(kte(r));var i=Ed(Mte(n)?Ate.map(function(l){return function(d){return n[l](e,d,t)}}):Ite(n)?Rte.map(nN(n,e)):Pte(n)?Nte.map(nN(n,e)):[],2),s=i[0],c=i[1];if(!s&&FT(n))return BT(function(l){return S_(l,e,t)})(Rc(n));if(!s)throw new TypeError("Invalid event target");return new gr(function(l){var d=function(){for(var h=[],m=0;m<arguments.length;m++)h[m]=arguments[m];return l.next(1<h.length?h:h[0])};return s(d),function(){return c(d)}})}function nN(n,e){return function(t){return function(r){return n[t](e,r)}}}function Ite(n){return dn(n.addListener)&&dn(n.removeListener)}function Pte(n){return dn(n.on)&&dn(n.off)}function Mte(n){return dn(n.addEventListener)&&dn(n.removeEventListener)}function e6(n,e){return so(function(t,r){var i=0;t.subscribe(no(r,function(s){return n.call(e,s,i++)&&r.next(s)}))})}function Dte(n,e){return e===void 0&&(e=VT),n=n??Ote,so(function(t,r){var i,s=!0;t.subscribe(no(r,function(c){var l=e(c);(s||!n(i,l))&&(s=!1,i=l,r.next(c))}))})}function Ote(n,e){return n===e}function jte(n){return so(function(e,t){var r=!1,i=no(t,function(){i?.unsubscribe(),r=!0},x_);Rc(n).subscribe(i),e.subscribe(no(t,function(s){return r&&t.next(s)}))})}function Ac(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=zT(n);return so(function(r,i){(t?Bv(n,r,t):Bv(n,r)).subscribe(i)})}var t6=(n,e,t)=>new Promise((r,i)=>{var s=d=>{try{l(t.next(d))}catch(h){i(h)}},c=d=>{try{l(t.throw(d))}catch(h){i(h)}},l=d=>d.done?r(d.value):Promise.resolve(d.value).then(s,c);l((t=t.apply(n,e)).next())}),Lte="lk";function hi(n){return typeof n>"u"?!1:Ute(n)||Vte(n)}function Ute(n){var e;return n?n.hasOwnProperty("participant")&&n.hasOwnProperty("source")&&n.hasOwnProperty("track")&&typeof((e=n.publication)==null?void 0:e.track)<"u":!1}function Vte(n){return n?n.hasOwnProperty("participant")&&n.hasOwnProperty("source")&&n.hasOwnProperty("publication")&&typeof n.publication<"u":!1}function Kf(n){return n?n.hasOwnProperty("participant")&&n.hasOwnProperty("source")&&typeof n.publication>"u":!1}function Br(n){if(typeof n=="string"||typeof n=="number")return`${n}`;if(Kf(n))return`${n.participant.identity}_${n.source}_placeholder`;if(hi(n))return`${n.participant.identity}_${n.publication.source}_${n.publication.trackSid}`;throw new Error(`Can't generate a id for the given track reference: ${n}`)}function n6(n,e){return typeof e>"u"?!1:hi(n)?e.some(t=>t.participant.identity===n.participant.identity&&hi(t)&&t.publication.trackSid===n.publication.trackSid):Kf(n)?e.some(t=>t.participant.identity===n.participant.identity&&Kf(t)&&t.source===n.source):!1}function zte(n,e){return Kf(n)&&hi(e)&&e.participant.identity===n.participant.identity&&e.source===n.source}var Fte=[pe.ConnectionStateChanged,pe.RoomMetadataChanged,pe.ActiveSpeakersChanged,pe.ConnectionQualityChanged,pe.ParticipantConnected,pe.ParticipantDisconnected,pe.ParticipantPermissionsChanged,pe.ParticipantMetadataChanged,pe.ParticipantNameChanged,pe.ParticipantAttributesChanged,pe.TrackMuted,pe.TrackUnmuted,pe.TrackPublished,pe.TrackUnpublished,pe.TrackStreamStateChanged,pe.TrackSubscriptionFailed,pe.TrackSubscriptionPermissionChanged,pe.TrackSubscriptionStatusChanged],Bte=[...Fte,pe.LocalTrackPublished,pe.LocalTrackUnpublished];ye.TrackPublished,ye.TrackUnpublished,ye.TrackMuted,ye.TrackUnmuted,ye.TrackStreamStateChanged,ye.TrackSubscribed,ye.TrackUnsubscribed,ye.TrackSubscriptionPermissionChanged,ye.TrackSubscriptionFailed,ye.LocalTrackPublished,ye.LocalTrackUnpublished;var $te=[ye.ConnectionQualityChanged,ye.IsSpeakingChanged,ye.ParticipantMetadataChanged,ye.ParticipantPermissionsChanged,ye.TrackMuted,ye.TrackUnmuted,ye.TrackPublished,ye.TrackUnpublished,ye.TrackStreamStateChanged,ye.TrackSubscriptionFailed,ye.TrackSubscriptionPermissionChanged,ye.TrackSubscriptionStatusChanged];[...$te,ye.LocalTrackPublished,ye.LocalTrackUnpublished];var Tn=jee.getLogger("lk-components-js");Tn.setDefaultLevel("WARN");var qte=[{columns:1,rows:1},{columns:1,rows:2,orientation:"portrait"},{columns:2,rows:1,orientation:"landscape"},{columns:2,rows:2,minWidth:560},{columns:3,rows:3,minWidth:700},{columns:4,rows:4,minWidth:960},{columns:5,rows:5,minWidth:1100}];function r6(n,e,t,r){if(n.length<1)throw new Error("At least one grid layout definition must be provided.");const i=Hte(n);if(t<=0||r<=0)return i[0];let s=0;const c=t/r>1?"landscape":"portrait";let l=i.find((d,h,m)=>{s=h;const g=m.findIndex((b,_)=>{const R=!b.orientation||b.orientation===c,E=_>h,A=b.maxTiles===d.maxTiles;return E&&A&&R})!==-1;return d.maxTiles>=e&&!g});if(l===void 0)if(l=i[i.length-1],l)Tn.warn(`No layout found for: participantCount: ${e}, width/height: ${t}/${r} fallback to biggest available layout (${l}).`);else throw new Error("No layout or fallback layout found.");if((t<l.minWidth||r<l.minHeight)&&s>0){const d=i[s-1];l=r6(i.slice(0,s),d.maxTiles,t,r)}return l}function Hte(n){return[...n].map(e=>{var t,r;return{name:`${e.columns}x${e.rows}`,columns:e.columns,rows:e.rows,maxTiles:e.columns*e.rows,minWidth:(t=e.minWidth)!=null?t:0,minHeight:(r=e.minHeight)!=null?r:0,orientation:e.orientation}}).sort((e,t)=>e.maxTiles!==t.maxTiles?e.maxTiles-t.maxTiles:e.minWidth!==0||t.minWidth!==0?e.minWidth-t.minWidth:e.minHeight!==0||t.minHeight!==0?e.minHeight-t.minHeight:0)}var i6=(n=>(n.AgentState="lk.agent.state",n.PublishOnBehalf="lk.publish_on_behalf",n.TranscriptionFinal="lk.transcription_final",n.TranscriptionSegmentId="lk.segment_id",n.TranscribedTrackId="lk.transcribed_track_id",n))(i6||{});function s6(n){return typeof n=="object"}function a6(n){return Array.isArray(n)&&n.filter(s6).length>0}function Gte(n,e){return e.audioLevel-n.audioLevel}function Kte(n,e){return n.isSpeaking===e.isSpeaking?0:n.isSpeaking?-1:1}function Wte(n,e){var t,r,i,s;return n.lastSpokeAt!==void 0||e.lastSpokeAt!==void 0?((r=(t=e.lastSpokeAt)==null?void 0:t.getTime())!=null?r:0)-((s=(i=n.lastSpokeAt)==null?void 0:i.getTime())!=null?s:0):0}function T_(n,e){var t,r,i,s;return((r=(t=n.joinedAt)==null?void 0:t.getTime())!=null?r:0)-((s=(i=e.joinedAt)==null?void 0:i.getTime())!=null?s:0)}function Yte(n,e){return hi(n)?hi(e)?0:-1:hi(e)?1:0}function Qte(n,e){const t=n.participant.isCameraEnabled,r=e.participant.isCameraEnabled;return t!==r?t?-1:1:0}function Xte(n){const e=[],t=[],r=[],i=[];n.forEach(l=>{l.participant.isLocal&&l.source===he.Source.Camera?e.push(l):l.source===he.Source.ScreenShare?t.push(l):l.source===he.Source.Camera?r.push(l):i.push(l)});const s=Jte(t),c=Zte(r);return[...e,...s,...c,...i]}function Jte(n){const e=[],t=[];return n.forEach(r=>{r.participant.isLocal?e.push(r):t.push(r)}),e.sort((r,i)=>T_(r.participant,i.participant)),t.sort((r,i)=>T_(r.participant,i.participant)),[...t,...e]}function Zte(n){const e=[],t=[];return n.forEach(r=>{r.participant.isLocal?e.push(r):t.push(r)}),t.sort((r,i)=>r.participant.isSpeaking&&i.participant.isSpeaking?Gte(r.participant,i.participant):r.participant.isSpeaking!==i.participant.isSpeaking?Kte(r.participant,i.participant):r.participant.lastSpokeAt!==i.participant.lastSpokeAt?Wte(r.participant,i.participant):hi(r)!==hi(i)?Yte(r,i):r.participant.isCameraEnabled!==i.participant.isCameraEnabled?Qte(r,i):T_(r.participant,i.participant)),[...e,...t]}function ene(n,e){return n.reduce((t,r,i)=>i%e===0?[...t,[r]]:[...t.slice(0,-1),[...t.slice(-1)[0],r]],[])}function rN(n,e){const t=Math.max(n.length,e.length);return new Array(t).fill([]).map((r,i)=>[n[i],e[i]])}function $v(n,e,t){return n.filter(r=>!e.map(i=>t(i)).includes(t(r)))}function k_(n){return n.map(e=>typeof e=="string"||typeof e=="number"?`${e}`:Br(e))}function tne(n,e){return{dropped:$v(n,e,Br),added:$v(e,n,Br)}}function nne(n){return n.added.length!==0||n.dropped.length!==0}function C_(n,e){const t=e.findIndex(r=>Br(r)===Br(n));if(t===-1)throw new Error(`Element not part of the array: ${Br(n)} not in ${k_(e)}`);return t}function rne(n,e,t){const r=C_(n,t),i=C_(e,t);return t.splice(r,1,e),t.splice(i,1,n),t}function ine(n,e){const t=C_(n,e);return e.splice(t,1),e}function sne(n,e){return[...e,n]}function q1(n,e){return ene(n,e)}function ane(n,e,t){let r=one(n,e);if(r.length<e.length){const c=$v(e,r,Br);r=[...r,...c]}const i=q1(r,t),s=q1(e,t);if(rN(i,s).forEach(([c,l],d)=>{if(c&&l){const h=q1(r,t)[d],m=tne(h,l);nne(m)&&(Tn.debug(`Detected visual changes on page: ${d}, current: ${k_(c)}, next: ${k_(l)}`,{changes:m}),m.added.length===m.dropped.length&&rN(m.added,m.dropped).forEach(([g,b])=>{if(g&&b)r=rne(g,b,r);else throw new Error(`For a swap action we need a addition and a removal one is missing: ${g}, ${b}`)}),m.added.length===0&&m.dropped.length>0&&m.dropped.forEach(g=>{r=ine(g,r)}),m.added.length>0&&m.dropped.length===0&&m.added.forEach(g=>{r=sne(g,r)}))}}),r.length>e.length){const c=$v(r,e,Br);r=r.filter(l=>!c.map(Br).includes(Br(l)))}return r}function one(n,e){return n.map(t=>e.find(i=>Br(t)===Br(i)||typeof t!="number"&&Kf(t)&&hi(i)&&zte(t,i))??t)}function El(n){return`${Lte}-${n}`}function cne(n){const e=w_(n),t=c6(n.participant).pipe(Zi(()=>w_(n)),Ac(e));return{className:El(n.source===he.Source.Camera||n.source===he.Source.ScreenShare?"participant-media-video":"participant-media-audio"),trackObserver:t}}function w_(n){if(hi(n))return n.publication;{const{source:e,name:t,participant:r}=n;if(e&&t)return r.getTrackPublications().find(i=>i.source===e&&i.trackName===t);if(t)return r.getTrackPublicationByName(t);if(e)return r.getTrackPublication(e);throw new Error("At least one of source and name needs to be defined")}}function lne(n,...e){return new gr(t=>{const r=()=>{t.next(n)};return e.forEach(i=>{n.on(i,r)}),()=>{e.forEach(i=>{n.off(i,r)})}}).pipe(Ac(n))}function o6(n,e){return new gr(t=>{const r=(...i)=>{t.next(i)};return n.on(e,r),()=>{n.off(e,r)}})}function une(n,e,t=!0){const r=new gr(s=>{to.getLocalDevices(n,t).then(c=>{s.next(c),s.complete()}).catch(c=>{e?.(c),s.next([]),s.complete()})}),i=new gr(s=>{var c;const l=()=>t6(this,null,function*(){try{const d=yield to.getLocalDevices(n,t);s.next(d)}catch(d){e?.(d)}});if(typeof window<"u"){if(!window.isSecureContext)throw new Error("Accessing media devices is available only in secure contexts (HTTPS and localhost), in some or all supporting browsers. See: https://developer.mozilla.org/en-US/docs/Web/API/Navigator/mediaDevices");(c=navigator?.mediaDevices)==null||c.addEventListener("devicechange",l)}return()=>{var d;(d=navigator?.mediaDevices)==null||d.removeEventListener("devicechange",l)}});return Bv(r,i)}function dne(n,e){return o6(n,pe.ActiveDeviceChanged).pipe(e6(([t])=>t===e),Zi(([t,r])=>(Tn.debug("activeDeviceObservable | RoomEvent.ActiveDeviceChanged",{kind:t,deviceId:r}),r)))}function hne(n,e){return o6(n,pe.ParticipantEncryptionStatusChanged).pipe(e6(([,t])=>e?.identity===t?.identity||!t&&e?.identity===n.localParticipant.identity),Zi(([t])=>t),Ac(e!=null&&e.isLocal?e.isE2EEEnabled:!!(e!=null&&e.isEncrypted)))}function $T(n,...e){return new gr(t=>{const r=()=>{t.next(n)};return e.forEach(i=>{n.on(i,r)}),()=>{e.forEach(i=>{n.off(i,r)})}}).pipe(Ac(n))}function c6(n){return $T(n,ye.TrackMuted,ye.TrackUnmuted,ye.ParticipantPermissionsChanged,ye.TrackPublished,ye.TrackUnpublished,ye.LocalTrackPublished,ye.LocalTrackUnpublished,ye.MediaDevicesError,ye.TrackSubscriptionStatusChanged).pipe(Zi(e=>{const{isMicrophoneEnabled:t,isCameraEnabled:r,isScreenShareEnabled:i}=e,s=e.getTrackPublication(he.Source.Microphone),c=e.getTrackPublication(he.Source.Camera);return{isCameraEnabled:r,isMicrophoneEnabled:t,isScreenShareEnabled:i,cameraTrack:c,microphoneTrack:s,participant:e}}))}function fne(n){return n?$T(n,ye.ParticipantMetadataChanged,ye.ParticipantNameChanged).pipe(Zi(({name:e,identity:t,metadata:r})=>({name:e,identity:t,metadata:r})),Ac({name:n.name,identity:n.identity,metadata:n.metadata})):void 0}function pne(n){return l6(n,ye.ConnectionQualityChanged).pipe(Zi(([e])=>e),Ac(n.connectionQuality))}function l6(n,e){return new gr(t=>{const r=(...i)=>{t.next(i)};return n.on(e,r),()=>{n.off(e,r)}})}function u6(n){var e,t,r,i;return $T(n.participant,ye.TrackMuted,ye.TrackUnmuted,ye.TrackSubscribed,ye.TrackUnsubscribed,ye.LocalTrackPublished,ye.LocalTrackUnpublished).pipe(Zi(s=>{var c,l;const d=(c=n.publication)!=null?c:s.getTrackPublication(n.source);return(l=d?.isMuted)!=null?l:!0}),Ac((i=(r=(e=n.publication)==null?void 0:e.isMuted)!=null?r:(t=n.participant.getTrackPublication(n.source))==null?void 0:t.isMuted)!=null?i:!0))}function mne(n){return l6(n,ye.IsSpeakingChanged).pipe(Zi(([e])=>e))}function gne(n,e,t){const r=new Xee(void 0),i=dne(e,n),s=(c,...l)=>t6(this,[c,...l],function*(d,h={}){var m,g;if(e){Gr(),Tn.debug(`Switching active device of kind "${n}" with id ${d}.`),yield e.switchActiveDevice(n,d,h.exact);const b=(m=e.getActiveDevice(n))!=null?m:d;b!==d&&d!=="default"&&Tn.info(`We tried to select the device with id (${d}), but the browser decided to select the device with id (${b}) instead.`);let _;_=(g=e.localParticipant.getTrackPublication(he.Source.Microphone))==null?void 0:g.track;const R=d==="default"&&!_||d==="default"&&_?.mediaStreamTrack.label.startsWith("Default");r.next(R?d:b)}});return{className:El("media-device-select"),activeDeviceObservable:i,setActiveMediaDevice:s}}function vne(n){const e=El("connection-quality"),t=pne(n);return{className:e,connectionQualityObserver:t}}function yne(n){let e="track-muted-indicator-camera";switch(n.source){case he.Source.Camera:e="track-muted-indicator-camera";break;case he.Source.Microphone:e="track-muted-indicator-microphone";break}const t=El(e),r=u6(n);return{className:t,mediaMutedObserver:r}}function bne(n){return{className:"lk-participant-name",infoObserver:fne(n)}}function xne(){return{className:El("participant-tile")}}function _ne(){return{className:[El("button"),El("focus-toggle-button")].join(" ")}}function Sne(){return{className:"lk-room-container"}}function iN(n,e,t=!0){const r=[n.localParticipant,...Array.from(n.remoteParticipants.values())],i=[];return r.forEach(s=>{e.forEach(c=>{const l=Array.from(s.trackPublications.values()).filter(d=>d.source===c&&(!t||d.track)).map(d=>({participant:s,publication:d,source:d.source}));i.push(...l)})}),{trackReferences:i,participants:r}}function Tne(n,e,t){var r,i;const s=(r=t.additionalRoomEvents)!=null?r:Bte,c=(i=t.onlySubscribed)!=null?i:!0,l=Array.from(new Set([pe.ParticipantConnected,pe.ParticipantDisconnected,pe.ConnectionStateChanged,pe.LocalTrackPublished,pe.LocalTrackUnpublished,pe.TrackPublished,pe.TrackUnpublished,pe.TrackSubscriptionStatusChanged,...s]).values());return lne(n,...l).pipe(Zi(d=>{const h=iN(d,e,c);return Tn.debug(`TrackReference[] was updated. (length ${h.trackReferences.length})`,h),h}),Ac(iN(n,e,c)))}function kne(n,e=1e3){if(n===null)return tN(!1);const t=S_(n,"mousemove",{passive:!0}).pipe(Zi(()=>!0)),r=t.pipe(xte({each:e,with:()=>Bv(tN(!1),r.pipe(jte(t)))}),Dte());return r}const d6=T.createContext(void 0);function h6(){return T.useContext(d6)}const qT=T.createContext(void 0);function F0(){return T.useContext(qT)}function Ld(n){const e=F0(),t=n??e;if(!t)throw new Error("No TrackRef, make sure you are inside a TrackRefContext or pass the TrackRef explicitly");return t}const f6=T.createContext(void 0);function p6(){return T.useContext(f6)}function mp(n){const e=p6(),t=F0(),r=n??e??t?.participant;if(!r)throw new Error("No participant provided, make sure you are inside a participant context or pass the participant explicitly");return r}const m6=T.createContext(void 0);function g6(){return T.useContext(m6)}function HT(n){const e=g6(),t=n??e;if(!t)throw new Error("No room provided, make sure you are inside a Room context or pass the room explicitly");return t}T.createContext(void 0);const v6=T.createContext(void 0);function Cne(n){return T.useContext(v6)}function y6(n){var e,t,r="";if(typeof n=="string"||typeof n=="number")r+=n;else if(typeof n=="object")if(Array.isArray(n)){var i=n.length;for(e=0;e<i;e++)n[e]&&(t=y6(n[e]))&&(r&&(r+=" "),r+=t)}else for(t in n)n[t]&&(r&&(r+=" "),r+=t);return r}function b6(){for(var n,e,t=0,r="",i=arguments.length;t<i;t++)(n=arguments[t])&&(e=y6(n))&&(r&&(r+=" "),r+=e);return r}function wne(...n){return(...e)=>{for(const t of n)if(typeof t=="function")try{t(...e)}catch(r){console.error(r)}}}function B0(...n){const e={...n[0]};for(let t=1;t<n.length;t++){const r=n[t];for(const i in r){const s=e[i],c=r[i];typeof s=="function"&&typeof c=="function"&&i[0]==="o"&&i[1]==="n"&&i.charCodeAt(2)>=65&&i.charCodeAt(2)<=90?e[i]=wne(s,c):(i==="className"||i==="UNSAFE_className")&&typeof s=="string"&&typeof c=="string"?e[i]=b6(s,c):e[i]=c!==void 0?c:s}}return e}function Ene(n){return n!==void 0}function gp(...n){return B0(...n.filter(Ene))}function Rne(n,e,t){return T.Children.map(n,r=>T.isValidElement(r)&&T.Children.only(n)?(r.props.className&&(e??(e={}),e.className=b6(r.props.className,e.className),e.style={...r.props.style,...e.style}),T.cloneElement(r,{...e,key:t})):r)}function Ane(n,e){return n==="processor"&&e&&typeof e=="object"&&"name"in e?e.name:n==="e2ee"&&e?"e2ee-enabled":e}const Nne={connect:!0,audio:!1,video:!1};function x6(n){const{token:e,serverUrl:t,options:r,room:i,connectOptions:s,connect:c,audio:l,video:d,screen:h,onConnected:m,onDisconnected:g,onError:b,onMediaDeviceFailure:_,onEncryptionError:R,simulateParticipants:E,...A}={...Nne,...n};r&&i&&Tn.warn("when using a manually created room, the options object will be ignored. set the desired options directly when creating the room instead.");const[M,F]=T.useState(),j=T.useRef(c);T.useEffect(()=>{F(i??new to(r))},[i,JSON.stringify(r,Ane)]);const C=T.useMemo(()=>{const{className:N}=Sne();return B0(A,{className:N})},[A]);return T.useEffect(()=>{if(!M)return;const N=()=>{const L=M.localParticipant;Tn.debug("trying to publish local tracks"),Promise.all([L.setMicrophoneEnabled(!!l,typeof l!="boolean"?l:void 0),L.setCameraEnabled(!!d,typeof d!="boolean"?d:void 0),L.setScreenShareEnabled(!!h,typeof h!="boolean"?h:void 0)]).catch(U=>{Tn.warn(U),b?.(U)})},D=(L,U)=>{const z=Bf.getFailure(L);_?.(z,U)},S=L=>{R?.(L)},k=L=>{g?.(L)},P=()=>{m?.()};return M.on(pe.SignalConnected,N).on(pe.MediaDevicesError,D).on(pe.EncryptionError,S).on(pe.Disconnected,k).on(pe.Connected,P),()=>{M.off(pe.SignalConnected,N).off(pe.MediaDevicesError,D).off(pe.EncryptionError,S).off(pe.Disconnected,k).off(pe.Connected,P)}},[M,l,d,h,b,R,_,m,g]),T.useEffect(()=>{if(M){if(E){M.simulateParticipants({participants:{count:E},publish:{audio:!0,useRealTracks:!0}});return}if(c){if(j.current=!0,Tn.debug("connecting"),!e){Tn.debug("no token yet");return}if(!t){Tn.warn("no livekit url provided"),b?.(Error("no livekit url provided"));return}M.connect(t,e,s).catch(N=>{Tn.warn(N),j.current===!0&&b?.(N)})}else Tn.debug("disconnecting because connect is false"),j.current=!1,M.disconnect()}},[c,e,JSON.stringify(s),M,b,t,E]),T.useEffect(()=>{if(M)return()=>{Tn.info("disconnecting on onmount"),M.disconnect()}},[M]),{room:M,htmlProps:C}}const Ine=T.forwardRef(function(n,e){const{room:t,htmlProps:r}=x6(n);return T.createElement("div",{ref:e,...r},t&&T.createElement(m6.Provider,{value:t},T.createElement(v6.Provider,{value:n.featureFlags},n.children)))}),Pne=n=>{const e=T.useRef(n);return T.useEffect(()=>{e.current=n}),e};function Mne(n,e){const t=One(),r=Pne(e);return T.useLayoutEffect(()=>{let i=!1;const s=n.current;if(!s)return;function c(l,d){i||r.current(l,d)}return t?.subscribe(s,c),()=>{i=!0,t?.unsubscribe(s,c)}},[n.current,t,r]),t?.observer}function Dne(){let n=!1,e=[];const t=new Map;if(typeof window>"u")return;const r=new ResizeObserver((i,s)=>{e=e.concat(i),n||window.requestAnimationFrame(()=>{const c=new Set;for(let l=0;l<e.length;l++){if(c.has(e[l].target))continue;c.add(e[l].target);const d=t.get(e[l].target);d?.forEach(h=>h(e[l],s))}e=[],n=!1}),n=!0});return{observer:r,subscribe(i,s){r.observe(i);const c=t.get(i)??[];c.push(s),t.set(i,c)},unsubscribe(i,s){const c=t.get(i)??[];if(c.length===1){r.unobserve(i),t.delete(i);return}const l=c.indexOf(s);l!==-1&&c.splice(l,1),t.set(i,c)}}}let sN;const One=()=>sN||(sN=Dne()),jne=n=>{const[e,t]=T.useState({width:0,height:0});T.useLayoutEffect(()=>{if(n.current){const{width:i,height:s}=n.current.getBoundingClientRect();t({width:i,height:s})}},[n.current]);const r=T.useCallback(i=>t(i.contentRect),[]);return Mne(n,r),e};function Ud(n,e,t=!0){const[r,i]=T.useState(e);return T.useEffect(()=>{if(t&&i(e),typeof window>"u"||!n)return;const s=n.subscribe(i);return()=>s.unsubscribe()},[n,t]),r}function Lne(n={}){const e=mp(n.participant),{className:t,connectionQualityObserver:r}=T.useMemo(()=>vne(e),[e]),i=Ud(r,e.connectionQuality);return{className:t,quality:i}}function Une(n){if(n.publication instanceof Uv){const e=n.publication.track;if(e){const{facingMode:t}=Aee(e);return t}}return"undefined"}function Vne({trackRef:n,props:e}){const t=Ld(n),r=h6(),{className:i}=T.useMemo(()=>_ne(),[]),s=T.useMemo(()=>n6(t,r?.pin.state),[t,r?.pin.state]);return{mergedProps:T.useMemo(()=>B0(e,{className:i,onClick:c=>{var l,d,h,m,g;(l=e.onClick)==null||l.call(e,c),s?(h=r==null?void 0:(d=r.pin).dispatch)==null||h.call(d,{msg:"clear_pin"}):(g=r==null?void 0:(m=r.pin).dispatch)==null||g.call(m,{msg:"set_pin",trackReference:t})}}),[e,i,t,s,r?.pin]),inFocus:s}}function zne(n,e,t={}){const r=t.gridLayouts??qte,{width:i,height:s}=jne(n),c=r6(r,e,i,s);return T.useEffect(()=>{n.current&&c&&(n.current.style.setProperty("--lk-col-count",c?.columns.toString()),n.current.style.setProperty("--lk-row-count",c?.rows.toString()))},[n,c]),{layout:c,containerWidth:i,containerHeight:s}}function aN(n,e={}){var t,r;const i=typeof n=="string"?e.participant:n.participant,s=mp(i),c=typeof n=="string"?{participant:s,source:n}:n,[l,d]=T.useState(!!((t=c.publication)!=null&&t.isMuted||(r=s.getTrackPublication(c.source))!=null&&r.isMuted));return T.useEffect(()=>{const h=u6(c).subscribe(d);return()=>h.unsubscribe()},[Br(c)]),l}function Fne(n){const e=mp(n),t=T.useMemo(()=>mne(e),[e]);return Ud(t,e.isSpeaking)}function Bne(n={}){const e=HT(n.room),[t,r]=T.useState(e.localParticipant),[i,s]=T.useState(t.isMicrophoneEnabled),[c,l]=T.useState(t.isCameraEnabled),[d,h]=T.useState(t.isScreenShareEnabled),[m,g]=T.useState(t.lastMicrophoneError),[b,_]=T.useState(t.lastCameraError),[R,E]=T.useState(void 0),[A,M]=T.useState(void 0),F=j=>{l(j.isCameraEnabled),s(j.isMicrophoneEnabled),h(j.isScreenShareEnabled),M(j.cameraTrack),E(j.microphoneTrack),g(j.participant.lastMicrophoneError),_(j.participant.lastCameraError),r(j.participant)};return T.useEffect(()=>{const j=c6(e.localParticipant).subscribe(F);return()=>j.unsubscribe()},[e]),{isMicrophoneEnabled:i,isScreenShareEnabled:d,isCameraEnabled:c,microphoneTrack:R,cameraTrack:A,lastMicrophoneError:m,lastCameraError:b,localParticipant:t}}function $ne({kind:n,room:e,track:t,requestPermissions:r,onError:i}){const s=g6(),c=T.useMemo(()=>e??s??new to,[e,s]),l=T.useMemo(()=>une(n,i,r),[n,r,i]),d=Ud(l,[]),[h,m]=T.useState(c?.getActiveDevice(n)??"default"),{className:g,activeDeviceObservable:b,setActiveMediaDevice:_}=T.useMemo(()=>gne(n,c),[n,c,t]);return T.useEffect(()=>{const R=b.subscribe(E=>{E&&(Tn.info("setCurrentDeviceId",E),m(E))});return()=>{R?.unsubscribe()}},[b]),{devices:d,className:g,activeDeviceId:h,setActiveMediaDevice:_}}function qne(n,e,t={}){const r=T.useRef([]),i=T.useRef(-1),s=e!==i.current,c=typeof t.customSortFunction=="function"?t.customSortFunction(n):Xte(n);let l=[...c];if(s===!1)try{l=ane(r.current,c,e)}catch(d){Tn.error("Error while running updatePages(): ",d)}return s?r.current=c:r.current=l,i.current=e,l}function Hne(n,e){const[t,r]=T.useState(1),i=Math.max(Math.ceil(e.length/n),1);t>i&&r(i);const s=t*n,c=s-n,l=m=>{r(g=>m==="next"?g===i?g:g+1:g===1?g:g-1)},d=m=>{m>i?r(i):m<1?r(1):r(m)},h=qne(e,n).slice(c,s);return{totalPageCount:i,nextPage:()=>l("next"),prevPage:()=>l("previous"),setPage:d,firstItemIndex:c,lastItemIndex:s,tracks:h,currentPage:t}}function Gne({trackRef:n,onParticipantClick:e,disableSpeakingIndicator:t,htmlProps:r}){const i=Ld(n),s=T.useMemo(()=>{const{className:b}=xne();return B0(r,{className:b,onClick:_=>{var R;if((R=r.onClick)==null||R.call(r,_),typeof e=="function"){const E=i.publication??i.participant.getTrackPublication(i.source);e({participant:i.participant,track:E})}}})},[r,e,i.publication,i.source,i.participant]),c=i.participant.getTrackPublication(he.Source.Microphone),l=T.useMemo(()=>({participant:i.participant,source:he.Source.Microphone,publication:c}),[c,i.participant]),d=aN(i),h=aN(l),m=Fne(i.participant),g=Une(i);return{elementProps:{"data-lk-audio-muted":h,"data-lk-video-muted":d,"data-lk-speaking":t===!0?!1:m,"data-lk-local-participant":i.participant.isLocal,"data-lk-source":i.source,"data-lk-facing-mode":g,...s}}}function Kne(n,e={}){const t=T.useRef(null),r=T.useRef(null),i=e.minSwipeDistance??50,s=d=>{r.current=null,t.current=d.targetTouches[0].clientX},c=d=>{r.current=d.targetTouches[0].clientX},l=T.useCallback(()=>{if(!t.current||!r.current)return;const d=t.current-r.current,h=d>i,m=d<-i;h&&e.onLeftSwipe&&e.onLeftSwipe(),m&&e.onRightSwipe&&e.onRightSwipe()},[i,e]);T.useEffect(()=>{const d=n.current;return d&&(d.addEventListener("touchstart",s,{passive:!0}),d.addEventListener("touchmove",c,{passive:!0}),d.addEventListener("touchend",l,{passive:!0})),()=>{d&&(d.removeEventListener("touchstart",s),d.removeEventListener("touchmove",c),d.removeEventListener("touchend",l))}},[n,l])}function Wne(n){var e,t;const r=Ld(n),{className:i,mediaMutedObserver:s}=T.useMemo(()=>yne(r),[Br(r)]);return{isMuted:Ud(s,!!((e=r.publication)!=null&&e.isMuted||(t=r.participant.getTrackPublication(r.source))!=null&&t.isMuted)),className:i}}function _6(n=[he.Source.Camera,he.Source.Microphone,he.Source.ScreenShare,he.Source.ScreenShareAudio,he.Source.Unknown],e={}){const t=HT(e.room),[r,i]=T.useState([]),[s,c]=T.useState([]),l=T.useMemo(()=>n.map(d=>s6(d)?d.source:d),[JSON.stringify(n)]);return T.useEffect(()=>{const d=Tne(t,l,{additionalRoomEvents:e.updateOnlyOn,onlySubscribed:e.onlySubscribed}).subscribe(({trackReferences:h,participants:m})=>{Tn.debug("setting track bundles",h,m),i(h),c(m)});return()=>d.unsubscribe()},[t,JSON.stringify(e.onlySubscribed),JSON.stringify(e.updateOnlyOn),JSON.stringify(n)]),T.useMemo(()=>{if(a6(n)){const d=Qne(n,s),h=Array.from(r);return s.forEach(m=>{d.has(m.identity)&&(d.get(m.identity)??[]).forEach(g=>{if(r.find(({participant:_,publication:R})=>m.identity===_.identity&&R.source===g))return;Tn.debug(`Add ${g} placeholder for participant ${m.identity}.`);const b={participant:m,source:g};h.push(b)})}),h}else return r},[r,s,n])}function Yne(n,e){const t=new Set(n);for(const r of e)t.delete(r);return t}function Qne(n,e){const t=new Map;if(a6(n)){const r=n.filter(i=>i.withPlaceholder).map(i=>i.source);e.forEach(i=>{const s=i.getTrackPublications().map(l=>{var d;return(d=l.track)==null?void 0:d.source}).filter(l=>l!==void 0),c=Array.from(Yne(new Set(r),new Set(s)));c.length>0&&t.set(i.identity,c)})}return t}function Xne(n,e={}){const t=mp(n),r=HT(e.room),i=T.useMemo(()=>hne(r,t),[r,t]);return Ud(i,t.isLocal?t.isE2EEEnabled:!!(t!=null&&t.isEncrypted))}i6.AgentState;var og={exports:{}},oN;function Jne(){if(oN)return og.exports;oN=1;var n=typeof Reflect=="object"?Reflect:null,e=n&&typeof n.apply=="function"?n.apply:function(C,N,D){return Function.prototype.apply.call(C,N,D)},t;n&&typeof n.ownKeys=="function"?t=n.ownKeys:Object.getOwnPropertySymbols?t=function(C){return Object.getOwnPropertyNames(C).concat(Object.getOwnPropertySymbols(C))}:t=function(C){return Object.getOwnPropertyNames(C)};function r(C){console&&console.warn&&console.warn(C)}var i=Number.isNaN||function(C){return C!==C};function s(){s.init.call(this)}og.exports=s,og.exports.once=M,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var c=10;function l(C){if(typeof C!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof C)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(C){if(typeof C!="number"||C<0||i(C))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+C+".");c=C}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(C){if(typeof C!="number"||C<0||i(C))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+C+".");return this._maxListeners=C,this};function d(C){return C._maxListeners===void 0?s.defaultMaxListeners:C._maxListeners}s.prototype.getMaxListeners=function(){return d(this)},s.prototype.emit=function(C){for(var N=[],D=1;D<arguments.length;D++)N.push(arguments[D]);var S=C==="error",k=this._events;if(k!==void 0)S=S&&k.error===void 0;else if(!S)return!1;if(S){var P;if(N.length>0&&(P=N[0]),P instanceof Error)throw P;var L=new Error("Unhandled error."+(P?" ("+P.message+")":""));throw L.context=P,L}var U=k[C];if(U===void 0)return!1;if(typeof U=="function")e(U,this,N);else for(var z=U.length,V=R(U,z),D=0;D<z;++D)e(V[D],this,N);return!0};function h(C,N,D,S){var k,P,L;if(l(D),P=C._events,P===void 0?(P=C._events=Object.create(null),C._eventsCount=0):(P.newListener!==void 0&&(C.emit("newListener",N,D.listener?D.listener:D),P=C._events),L=P[N]),L===void 0)L=P[N]=D,++C._eventsCount;else if(typeof L=="function"?L=P[N]=S?[D,L]:[L,D]:S?L.unshift(D):L.push(D),k=d(C),k>0&&L.length>k&&!L.warned){L.warned=!0;var U=new Error("Possible EventEmitter memory leak detected. "+L.length+" "+String(N)+" listeners added. Use emitter.setMaxListeners() to increase limit");U.name="MaxListenersExceededWarning",U.emitter=C,U.type=N,U.count=L.length,r(U)}return C}s.prototype.addListener=function(C,N){return h(this,C,N,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(C,N){return h(this,C,N,!0)};function m(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function g(C,N,D){var S={fired:!1,wrapFn:void 0,target:C,type:N,listener:D},k=m.bind(S);return k.listener=D,S.wrapFn=k,k}s.prototype.once=function(C,N){return l(N),this.on(C,g(this,C,N)),this},s.prototype.prependOnceListener=function(C,N){return l(N),this.prependListener(C,g(this,C,N)),this},s.prototype.removeListener=function(C,N){var D,S,k,P,L;if(l(N),S=this._events,S===void 0)return this;if(D=S[C],D===void 0)return this;if(D===N||D.listener===N)--this._eventsCount===0?this._events=Object.create(null):(delete S[C],S.removeListener&&this.emit("removeListener",C,D.listener||N));else if(typeof D!="function"){for(k=-1,P=D.length-1;P>=0;P--)if(D[P]===N||D[P].listener===N){L=D[P].listener,k=P;break}if(k<0)return this;k===0?D.shift():E(D,k),D.length===1&&(S[C]=D[0]),S.removeListener!==void 0&&this.emit("removeListener",C,L||N)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(C){var N,D,S;if(D=this._events,D===void 0)return this;if(D.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):D[C]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete D[C]),this;if(arguments.length===0){var k=Object.keys(D),P;for(S=0;S<k.length;++S)P=k[S],P!=="removeListener"&&this.removeAllListeners(P);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(N=D[C],typeof N=="function")this.removeListener(C,N);else if(N!==void 0)for(S=N.length-1;S>=0;S--)this.removeListener(C,N[S]);return this};function b(C,N,D){var S=C._events;if(S===void 0)return[];var k=S[N];return k===void 0?[]:typeof k=="function"?D?[k.listener||k]:[k]:D?A(k):R(k,k.length)}s.prototype.listeners=function(C){return b(this,C,!0)},s.prototype.rawListeners=function(C){return b(this,C,!1)},s.listenerCount=function(C,N){return typeof C.listenerCount=="function"?C.listenerCount(N):_.call(C,N)},s.prototype.listenerCount=_;function _(C){var N=this._events;if(N!==void 0){var D=N[C];if(typeof D=="function")return 1;if(D!==void 0)return D.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]};function R(C,N){for(var D=new Array(N),S=0;S<N;++S)D[S]=C[S];return D}function E(C,N){for(;N+1<C.length;N++)C[N]=C[N+1];C.pop()}function A(C){for(var N=new Array(C.length),D=0;D<N.length;++D)N[D]=C[D].listener||C[D];return N}function M(C,N){return new Promise(function(D,S){function k(L){C.removeListener(N,P),S(L)}function P(){typeof C.removeListener=="function"&&C.removeListener("error",k),D([].slice.call(arguments))}j(C,N,P,{once:!0}),N!=="error"&&F(C,k,{once:!0})})}function F(C,N,D){typeof C.on=="function"&&j(C,"error",N,D)}function j(C,N,D,S){if(typeof C.on=="function")S.once?C.once(N,D):C.on(N,D);else if(typeof C.addEventListener=="function")C.addEventListener(N,function k(P){S.once&&C.removeEventListener(N,k),D(P)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof C)}return og.exports}Jne();const Zne=n=>T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor",...n},T.createElement("path",{d:"M1.354.646a.5.5 0 1 0-.708.708l14 14a.5.5 0 0 0 .708-.708L11 10.293V4.5A1.5 1.5 0 0 0 9.5 3H3.707zM0 4.5a1.5 1.5 0 0 1 .943-1.393l9.532 9.533c-.262.224-.603.36-.975.36h-8A1.5 1.5 0 0 1 0 11.5z"}),T.createElement("path",{d:"m15.2 3.6-2.8 2.1a1 1 0 0 0-.4.8v3a1 1 0 0 0 .4.8l2.8 2.1a.5.5 0 0 0 .8-.4V4a.5.5 0 0 0-.8-.4z"})),ere=n=>T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor",...n},T.createElement("path",{d:"M0 4.5A1.5 1.5 0 0 1 1.5 3h8A1.5 1.5 0 0 1 11 4.5v7A1.5 1.5 0 0 1 9.5 13h-8A1.5 1.5 0 0 1 0 11.5zM15.2 3.6l-2.8 2.1a1 1 0 0 0-.4.8v3a1 1 0 0 0 .4.8l2.8 2.1a.5.5 0 0 0 .8-.4V4a.5.5 0 0 0-.8-.4z"})),cN=n=>T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",...n},T.createElement("path",{fill:"currentcolor",fillRule:"evenodd",d:"M5.293 2.293a1 1 0 0 1 1.414 0l4.823 4.823a1.25 1.25 0 0 1 0 1.768l-4.823 4.823a1 1 0 0 1-1.414-1.414L9.586 8 5.293 3.707a1 1 0 0 1 0-1.414z",clipRule:"evenodd"})),tre=n=>T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",...n},T.createElement("g",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5},T.createElement("path",{d:"M10 1.75h4.25m0 0V6m0-4.25L9 7M6 14.25H1.75m0 0V10m0 4.25L7 9"}))),nre=n=>T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",...n},T.createElement("path",{fill:"currentcolor",fillRule:"evenodd",d:"M4 6.104V4a4 4 0 1 1 8 0v2.104c1.154.326 2 1.387 2 2.646v4.5A2.75 2.75 0 0 1 11.25 16h-6.5A2.75 2.75 0 0 1 2 13.25v-4.5c0-1.259.846-2.32 2-2.646ZM5.5 4a2.5 2.5 0 0 1 5 0v2h-5V4Z",clipRule:"evenodd"})),rre=n=>T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor",...n},T.createElement("path",{d:"M12.227 11.52a5.477 5.477 0 0 0 1.246-2.97.5.5 0 0 0-.995-.1 4.478 4.478 0 0 1-.962 2.359l-1.07-1.07C10.794 9.247 11 8.647 11 8V3a3 3 0 0 0-6 0v1.293L1.354.646a.5.5 0 1 0-.708.708l14 14a.5.5 0 0 0 .708-.708zM8 12.5c.683 0 1.33-.152 1.911-.425l.743.743c-.649.359-1.378.59-2.154.66V15h2a.5.5 0 0 1 0 1h-5a.5.5 0 0 1 0-1h2v-1.522a5.502 5.502 0 0 1-4.973-4.929.5.5 0 0 1 .995-.098A4.5 4.5 0 0 0 8 12.5z"}),T.createElement("path",{d:"M8.743 10.907 5 7.164V8a3 3 0 0 0 3.743 2.907z"})),ire=n=>T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor",...n},T.createElement("path",{fillRule:"evenodd",d:"M2.975 8.002a.5.5 0 0 1 .547.449 4.5 4.5 0 0 0 8.956 0 .5.5 0 1 1 .995.098A5.502 5.502 0 0 1 8.5 13.478V15h2a.5.5 0 0 1 0 1h-5a.5.5 0 0 1 0-1h2v-1.522a5.502 5.502 0 0 1-4.973-4.929.5.5 0 0 1 .448-.547z",clipRule:"evenodd"}),T.createElement("path",{d:"M5 3a3 3 0 1 1 6 0v5a3 3 0 0 1-6 0z"})),sre=n=>T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentcolor",...n},T.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zm6-5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zm6-6a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),T.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zm6-5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zm6-6a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"})),are=n=>T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentcolor",...n},T.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zm6-5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),T.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zm6-5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),T.createElement("g",{opacity:.25},T.createElement("path",{d:"M12 .5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),T.createElement("path",{d:"M12 .5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}))),ore=n=>T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentcolor",...n},T.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),T.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),T.createElement("g",{opacity:.25},T.createElement("path",{d:"M6 6.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),T.createElement("path",{d:"M6 6.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zm6-6a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),T.createElement("path",{d:"M12 .5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}))),cre=n=>T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor",...n},T.createElement("g",{opacity:.25},T.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-4Zm6-5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-9Zm6-6a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5V.5Z"}),T.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-4Zm6-5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-9Zm6-6a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5V.5Z"}))),S6=n=>T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:20,height:16,fill:"none",...n},T.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M0 2.75A2.75 2.75 0 0 1 2.75 0h14.5A2.75 2.75 0 0 1 20 2.75v10.5A2.75 2.75 0 0 1 17.25 16H2.75A2.75 2.75 0 0 1 0 13.25V2.75ZM2.75 1.5c-.69 0-1.25.56-1.25 1.25v10.5c0 .69.56 1.25 1.25 1.25h14.5c.69 0 1.25-.56 1.25-1.25V2.75c0-.69-.56-1.25-1.25-1.25H2.75Z",clipRule:"evenodd"}),T.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M9.47 4.22a.75.75 0 0 1 1.06 0l2.25 2.25a.75.75 0 0 1-1.06 1.06l-.97-.97v4.69a.75.75 0 0 1-1.5 0V6.56l-.97.97a.75.75 0 0 1-1.06-1.06l2.25-2.25Z",clipRule:"evenodd"})),lre=n=>T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:20,height:16,fill:"none",...n},T.createElement("g",{fill:"currentColor"},T.createElement("path",{d:"M7.28 4.22a.75.75 0 0 0-1.06 1.06L8.94 8l-2.72 2.72a.75.75 0 1 0 1.06 1.06L10 9.06l2.72 2.72a.75.75 0 1 0 1.06-1.06L11.06 8l2.72-2.72a.75.75 0 0 0-1.06-1.06L10 6.94z"}),T.createElement("path",{fillRule:"evenodd",d:"M2.75 0A2.75 2.75 0 0 0 0 2.75v10.5A2.75 2.75 0 0 0 2.75 16h14.5A2.75 2.75 0 0 0 20 13.25V2.75A2.75 2.75 0 0 0 17.25 0zM1.5 2.75c0-.69.56-1.25 1.25-1.25h14.5c.69 0 1.25.56 1.25 1.25v10.5c0 .69-.56 1.25-1.25 1.25H2.75c-.69 0-1.25-.56-1.25-1.25z",clipRule:"evenodd"}))),ure=n=>T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",...n},T.createElement("g",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5},T.createElement("path",{d:"M13.25 7H9m0 0V2.75M9 7l5.25-5.25M2.75 9H7m0 0v4.25M7 9l-5.25 5.25"}))),dre=T.forwardRef(function({trackRef:n,...e},t){const r=F0(),{mergedProps:i,inFocus:s}=Vne({trackRef:n??r,props:e});return T.createElement(d6.Consumer,null,c=>c!==void 0&&T.createElement("button",{ref:t,...i},e.children?e.children:s?T.createElement(ure,null):T.createElement(tre,null)))});function hre(n,e){switch(n){case he.Source.Microphone:return e?T.createElement(ire,null):T.createElement(rre,null);case he.Source.Camera:return e?T.createElement(ere,null):T.createElement(Zne,null);case he.Source.ScreenShare:return e?T.createElement(lre,null):T.createElement(S6,null);default:return}}function fre(n){switch(n){case ps.Excellent:return T.createElement(sre,null);case ps.Good:return T.createElement(are,null);case ps.Poor:return T.createElement(ore,null);default:return T.createElement(cre,null)}}const pre=T.forwardRef(function(n,e){const{className:t,quality:r}=Lne(n),i=T.useMemo(()=>({...gp(n,{className:t}),"data-lk-quality":r}),[r,n,t]);return T.createElement("div",{ref:e,...i},n.children??fre(r))}),lN=T.forwardRef(function({participant:n,...e},t){const r=mp(n),{className:i,infoObserver:s}=T.useMemo(()=>bne(r),[r]),{identity:c,name:l}=Ud(s,{name:r.name,identity:r.identity,metadata:r.metadata}),d=T.useMemo(()=>gp(e,{className:i,"data-lk-participant-name":l}),[e,i,l]);return T.createElement("span",{ref:t,...d},l!==""?l:c,e.children)}),mre=T.forwardRef(function({trackRef:n,show:e="always",...t},r){const{className:i,isMuted:s}=Wne(n),c=e==="always"||e==="muted"&&s||e==="unmuted"&&!s,l=T.useMemo(()=>gp(t,{className:i}),[i,t]);return c?T.createElement("div",{ref:r,...l,"data-lk-muted":s},t.children??hre(n.source,!s)):null}),gre=n=>T.createElement("svg",{width:320,height:320,viewBox:"0 0 320 320",preserveAspectRatio:"xMidYMid meet",fill:"none",xmlns:"http://www.w3.org/2000/svg",...n},T.createElement("path",{d:"M160 180C204.182 180 240 144.183 240 100C240 55.8172 204.182 20 160 20C115.817 20 79.9997 55.8172 79.9997 100C79.9997 144.183 115.817 180 160 180Z",fill:"white",fillOpacity:.25}),T.createElement("path",{d:"M97.6542 194.614C103.267 191.818 109.841 192.481 115.519 195.141C129.025 201.466 144.1 205 159.999 205C175.899 205 190.973 201.466 204.48 195.141C210.158 192.481 216.732 191.818 222.345 194.614C262.703 214.719 291.985 253.736 298.591 300.062C300.15 310.997 291.045 320 280 320H39.9997C28.954 320 19.8495 310.997 21.4087 300.062C28.014 253.736 57.2966 214.72 97.6542 194.614Z",fill:"white",fillOpacity:.25}));function T6(n,e={}){const[t,r]=T.useState(w_(n)),[i,s]=T.useState(t?.isMuted),[c,l]=T.useState(t?.isSubscribed),[d,h]=T.useState(t?.track),[m,g]=T.useState("landscape"),b=T.useRef(),{className:_,trackObserver:R}=T.useMemo(()=>cne(n),[n.participant.sid??n.participant.identity,n.source,hi(n)&&n.publication.trackSid]);return T.useEffect(()=>{const E=R.subscribe(A=>{Tn.debug("update track",A),r(A),s(A?.isMuted),l(A?.isSubscribed),h(A?.track)});return()=>E?.unsubscribe()},[R]),T.useEffect(()=>{var E,A;return d&&(b.current&&d.detach(b.current),(E=e.element)!=null&&E.current&&!(n.participant.isLocal&&d?.kind==="audio")&&d.attach(e.element.current)),b.current=(A=e.element)==null?void 0:A.current,()=>{b.current&&d?.detach(b.current)}},[d,e.element]),T.useEffect(()=>{var E,A;if(typeof((E=t?.dimensions)==null?void 0:E.width)=="number"&&typeof((A=t?.dimensions)==null?void 0:A.height)=="number"){const M=t.dimensions.width>t.dimensions.height?"landscape":"portrait";g(M)}},[t]),{publication:t,isMuted:i,isSubscribed:c,track:d,elementProps:gp(e.props,{className:_,"data-lk-local-participant":n.participant.isLocal,"data-lk-source":t?.source,...t?.kind==="video"&&{"data-lk-orientation":m}})}}var H1,uN;function vre(){if(uN)return H1;uN=1;var n="Expected a function",e=NaN,t="[object Symbol]",r=/^\s+|\s+$/g,i=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,c=/^0o[0-7]+$/i,l=parseInt,d=typeof sg=="object"&&sg&&sg.Object===Object&&sg,h=typeof self=="object"&&self&&self.Object===Object&&self,m=d||h||Function("return this")(),g=Object.prototype,b=g.toString,_=Math.max,R=Math.min,E=function(){return m.Date.now()};function A(N,D,S){var k,P,L,U,z,V,le=0,ve=!1,K=!1,oe=!0;if(typeof N!="function")throw new TypeError(n);D=C(D)||0,M(S)&&(ve=!!S.leading,K="maxWait"in S,L=K?_(C(S.maxWait)||0,D):L,oe="trailing"in S?!!S.trailing:oe);function ee(we){var Ge=k,Ke=P;return k=P=void 0,le=we,U=N.apply(Ke,Ge),U}function Me(we){return le=we,z=setTimeout(te,D),ve?ee(we):U}function je(we){var Ge=we-V,Ke=we-le,Ce=D-Ge;return K?R(Ce,L-Ke):Ce}function q(we){var Ge=we-V,Ke=we-le;return V===void 0||Ge>=D||Ge<0||K&&Ke>=L}function te(){var we=E();if(q(we))return fe(we);z=setTimeout(te,je(we))}function fe(we){return z=void 0,oe&&k?ee(we):(k=P=void 0,U)}function Se(){z!==void 0&&clearTimeout(z),le=0,k=V=P=z=void 0}function Oe(){return z===void 0?U:fe(E())}function Te(){var we=E(),Ge=q(we);if(k=arguments,P=this,V=we,Ge){if(z===void 0)return Me(V);if(K)return z=setTimeout(te,D),ee(V)}return z===void 0&&(z=setTimeout(te,D)),U}return Te.cancel=Se,Te.flush=Oe,Te}function M(N){var D=typeof N;return!!N&&(D=="object"||D=="function")}function F(N){return!!N&&typeof N=="object"}function j(N){return typeof N=="symbol"||F(N)&&b.call(N)==t}function C(N){if(typeof N=="number")return N;if(j(N))return e;if(M(N)){var D=typeof N.valueOf=="function"?N.valueOf():N;N=M(D)?D+"":D}if(typeof N!="string")return N===0?N:+N;N=N.replace(r,"");var S=s.test(N);return S||c.test(N)?l(N.slice(2),S?2:8):i.test(N)?e:+N}return H1=A,H1}var yre=vre();const dN=OO(yre);function bre(n){const e=T.useRef(n);e.current=n,T.useEffect(()=>()=>{e.current()},[])}function xre(n,e=500,t){const r=T.useRef();bre(()=>{r.current&&r.current.cancel()});const i=T.useMemo(()=>{const s=dN(n,e,t),c=(...l)=>s(...l);return c.cancel=()=>{s.cancel()},c.isPending=()=>!!r.current,c.flush=()=>s.flush(),c},[n,e,t]);return T.useEffect(()=>{r.current=dN(n,e,t)},[n,e,t]),i}function _re(n,e,t){const r=((h,m)=>h===m),i=n instanceof Function?n():n,[s,c]=T.useState(i),l=T.useRef(i),d=xre(c,e,t);return r(l.current,i)||(d(i),l.current=i),[s,d]}function Sre({threshold:n=0,root:e=null,rootMargin:t="0%",freezeOnceVisible:r=!1,initialIsIntersecting:i=!1,onChange:s}={}){var c;const[l,d]=T.useState(null),[h,m]=T.useState(()=>({isIntersecting:i,entry:void 0})),g=T.useRef();g.current=s;const b=((c=h.entry)==null?void 0:c.isIntersecting)&&r;T.useEffect(()=>{if(!l||!("IntersectionObserver"in window)||b)return;const E=new IntersectionObserver(A=>{const M=Array.isArray(E.thresholds)?E.thresholds:[E.thresholds];A.forEach(F=>{const j=F.isIntersecting&&M.some(C=>F.intersectionRatio>=C);m({isIntersecting:j,entry:F}),g.current&&g.current(j,F)})},{threshold:n,root:e,rootMargin:t});return E.observe(l),()=>{E.disconnect()}},[l,JSON.stringify(n),e,t,b,r]);const _=T.useRef(null);T.useEffect(()=>{var E;!l&&(E=h.entry)!=null&&E.target&&!r&&!b&&_.current!==h.entry.target&&(_.current=h.entry.target,m({isIntersecting:i,entry:void 0}))},[l,h.entry,r,b,i]);const R=[d,!!h.isIntersecting,h.entry];return R.ref=R[0],R.isIntersecting=R[1],R.entry=R[2],R}const Tre=T.forwardRef(function({onTrackClick:n,onClick:e,onSubscriptionStatusChanged:t,trackRef:r,manageSubscription:i,...s},c){const l=Ld(r),d=T.useRef(null);T.useImperativeHandle(c,()=>d.current);const h=Sre({root:d.current}),[m]=_re(h,3e3);T.useEffect(()=>{i&&l.publication instanceof Vv&&m?.isIntersecting===!1&&h?.isIntersecting===!1&&l.publication.setSubscribed(!1)},[m,l,i]),T.useEffect(()=>{i&&l.publication instanceof Vv&&h?.isIntersecting===!0&&l.publication.setSubscribed(!0)},[h,l,i]);const{elementProps:g,publication:b,isSubscribed:_}=T6(l,{element:d,props:s});T.useEffect(()=>{t?.(!!_)},[_,t]);const R=E=>{e?.(E),n?.({participant:l?.participant,track:b})};return T.createElement("video",{ref:d,...g,muted:!0,onClick:R})}),kre=T.forwardRef(function({trackRef:n,onSubscriptionStatusChanged:e,volume:t,...r},i){const s=Ld(n),c=T.useRef(null);T.useImperativeHandle(i,()=>c.current);const{elementProps:l,isSubscribed:d,track:h,publication:m}=T6(s,{element:c,props:r});return T.useEffect(()=>{e?.(!!d)},[d,e]),T.useEffect(()=>{h===void 0||t===void 0||(h instanceof PO?h.setVolume(t):Tn.warn("Volume can only be set on remote audio tracks."))},[t,h]),T.useEffect(()=>{m===void 0||r.muted===void 0||(m instanceof Vv?m.setEnabled(!r.muted):Tn.warn("Can only call setEnabled on remote track publications."))},[r.muted,m,h]),T.createElement("audio",{ref:c,...l})});function Cre(n){const e=!!p6();return n.participant&&!e?T.createElement(f6.Provider,{value:n.participant},n.children):T.createElement(T.Fragment,null,n.children)}function wre(n){const e=!!F0();return n.trackRef&&!e?T.createElement(qT.Provider,{value:n.trackRef},n.children):T.createElement(T.Fragment,null,n.children)}const Ere=T.forwardRef(function({trackRef:n,children:e,onParticipantClick:t,disableSpeakingIndicator:r,...i},s){var c,l;const d=Ld(n),{elementProps:h}=Gne({htmlProps:i,disableSpeakingIndicator:r,onParticipantClick:t,trackRef:d}),m=Xne(d.participant),g=h6(),b=(c=Cne())==null?void 0:c.autoSubscription,_=T.useCallback(R=>{d.source&&!R&&g&&g.pin.dispatch&&n6(d,g.pin.state)&&g.pin.dispatch({msg:"clear_pin"})},[d,g]);return T.createElement("div",{ref:s,style:{position:"relative"},...h},T.createElement(wre,{trackRef:d},T.createElement(Cre,{participant:d.participant},e??T.createElement(T.Fragment,null,hi(d)&&(((l=d.publication)==null?void 0:l.kind)==="video"||d.source===he.Source.Camera||d.source===he.Source.ScreenShare)?T.createElement(Tre,{trackRef:d,onSubscriptionStatusChanged:_,manageSubscription:b}):hi(d)&&T.createElement(kre,{trackRef:d,onSubscriptionStatusChanged:_}),T.createElement("div",{className:"lk-participant-placeholder"},T.createElement(gre,null)),T.createElement("div",{className:"lk-participant-metadata"},T.createElement("div",{className:"lk-participant-metadata-item"},d.source===he.Source.Camera?T.createElement(T.Fragment,null,m&&T.createElement(nre,{style:{marginRight:"0.25rem"}}),T.createElement(mre,{trackRef:{participant:d.participant,source:he.Source.Microphone},show:"muted"}),T.createElement(lN,null)):T.createElement(T.Fragment,null,T.createElement(S6,{style:{marginRight:"0.25rem"}}),T.createElement(lN,null,"'s screen"))),T.createElement(pre,{className:"lk-participant-metadata-item"}))),T.createElement(dre,{trackRef:d}))))});function Rre({tracks:n,...e}){return T.createElement(T.Fragment,null,n.map(t=>T.createElement(qT.Provider,{value:t,key:Br(t)},Rne(e.children))))}function Are({totalPageCount:n,nextPage:e,prevPage:t,currentPage:r,pagesContainer:i}){const[s,c]=T.useState(!1);return T.useEffect(()=>{let l;return i&&(l=kne(i.current,2e3).subscribe(c)),()=>{l&&l.unsubscribe()}},[i]),T.createElement("div",{className:"lk-pagination-control","data-lk-user-interaction":s},T.createElement("button",{className:"lk-button",onClick:t},T.createElement(cN,null)),T.createElement("span",{className:"lk-pagination-count"},`${r} of ${n}`),T.createElement("button",{className:"lk-button",onClick:e},T.createElement(cN,null)))}const Nre=T.forwardRef(function({totalPageCount:n,currentPage:e},t){const r=new Array(n).fill("").map((i,s)=>s+1===e?T.createElement("span",{"data-lk-active":!0,key:s}):T.createElement("span",{key:s}));return T.createElement("div",{ref:t,className:"lk-pagination-indicator"},r)});function Ire({tracks:n,...e}){const t=T.createRef(),r=T.useMemo(()=>gp(e,{className:"lk-grid-layout"}),[e]),{layout:i}=zne(t,n.length),s=Hne(i.maxTiles,n);return Kne(t,{onLeftSwipe:s.nextPage,onRightSwipe:s.prevPage}),T.createElement("div",{ref:t,"data-lk-pagination":s.totalPageCount>1,...r},T.createElement(Rre,{tracks:s.tracks},e.children),n.length>i.maxTiles&&T.createElement(T.Fragment,null,T.createElement(Nre,{totalPageCount:s.totalPageCount,currentPage:s.currentPage}),T.createElement(Are,{pagesContainer:t,...s})))}const Pre=({channel:n,serverId:e,user:t,onDisconnect:r})=>{const{isMuted:i,isDeafened:s,availableDevices:c,selectedMicId:l,setSelectedMicId:d}=Xi(),[h,m]=T.useState(""),[g,b]=T.useState(""),[_,R]=T.useState(null),E=`${e}:${n.id}`;return T.useEffect(()=>{(async()=>{try{let M;if(window.electron&&window.electron.generateLiveKitToken)M=await window.electron.generateLiveKitToken(E,t.uid);else throw new Error("Electron environment required");if(M.error)throw new Error(M.error);m(M.token),b(M.wsUrl)}catch(M){console.error("Failed to get LiveKit token:",M),R(M.message)}})()},[E,t]),_?f.jsxs("div",{className:"p-4 text-red-500",children:["Error: ",_]}):!h||!g?f.jsx("div",{className:"p-4 text-gray-400",children:"Connecting to Voice Server..."}):f.jsxs(Ine,{video:!1,audio:!i,token:h,serverUrl:g,"data-lk-theme":"default",style:{height:"calc(100vh - 100px)",width:"100%"},onDisconnected:r,children:[!s&&f.jsx(Mre,{}),f.jsx(Ore,{}),f.jsx(jre,{onLeave:r})]})},Mre=()=>{const{peerVolumes:n}=Xi(),e=_6([he.Source.Microphone],{onlySubscribed:!0}).filter(t=>!t.participant.isLocal);return f.jsx(f.Fragment,{children:e.map(t=>{const r=t.participant?.identity,i=r&&typeof n[r]<"u"?n[r]:1;return f.jsx(Dre,{trackRef:t,volume:i},t.publication.trackSid)})})},Dre=({trackRef:n,volume:e})=>{const t=T.useRef(null);T.useEffect(()=>{t.current&&(t.current.volume=e)},[e]);const r=n.publication.track;return T.useEffect(()=>{if(r&&t.current)return r.attach(t.current),()=>r.detach(t.current)},[r]),f.jsx("audio",{ref:t,autoPlay:!0,playsInline:!0})},Ore=()=>{const n=_6([{source:he.Source.Camera,withPlaceholder:!0},{source:he.Source.ScreenShare,withPlaceholder:!1}],{onlySubscribed:!1});return f.jsx(Ire,{tracks:n,style:{height:"calc(100% - 80px)"},children:f.jsx(Ere,{})})},jre=({onLeave:n})=>{const{isMuted:e,toggleAudio:t}=Xi(),{localParticipant:r}=Bne(),{devices:i,activeDeviceId:s,setActiveMediaDevice:c}=$ne({kind:"audioinput"}),[l,d]=T.useState(!1),[h,m]=T.useState(!1),[g,b]=T.useState(!1),[_,R]=T.useState([]);T.useEffect(()=>{r&&r.setMicrophoneEnabled(!e)},[e,r]);const E=async C=>{await c(C),b(!1)},{room:A}=x6(),{setTalkingPeers:M}=Xi();T.useEffect(()=>{if(!A)return;const C=N=>{const D={};N.forEach(S=>{S.identity&&(D[S.identity]=!0,S.isLocal&&(D.me=!0))}),M(S=>D)};return A.on("activeSpeakersChanged",C),()=>{A.off("activeSpeakersChanged",C)}},[A,M]);const F=async()=>{if(l)await r.setScreenShareEnabled(!1),d(!1);else try{if(window.electron?.desktopCapturer){const C=await window.electron.desktopCapturer.getSources({types:["window","screen"]});R(C),m(!0)}else console.warn("Desktop Capturer not found")}catch(C){console.error("Error getting sources:",C)}},j=async C=>{try{m(!1),await r.setScreenShareEnabled(!0,{audio:!0,video:{deviceId:C}}),d(!0)}catch(N){console.error("Failed to start screen share:",N)}};return f.jsxs("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 flex items-center gap-4 bg-black/80 p-3 rounded-full border border-gray-700 z-50 backdrop-blur-md",children:[f.jsxs("div",{className:"flex items-center bg-gray-700/50 rounded-full p-1 relative",children:[f.jsx("button",{onClick:t,className:`p-2 rounded-full transition-colors mx-1 ${e?"bg-red-500 hover:bg-red-600":"bg-gray-600 hover:bg-gray-500"}`,title:e?"Unmute":"Mute",children:e?f.jsx(Af,{className:"text-white",size:20}):f.jsx(_l,{className:"text-white",size:20})}),f.jsx("button",{onClick:()=>b(!g),className:"p-1 pr-2 rounded-r-full hover:bg-gray-600/50 text-gray-300",children:f.jsx(QP,{size:16})}),g&&f.jsxs("div",{className:"absolute bottom-full left-0 mb-3 w-64 bg-gray-900 border border-gray-700 rounded-lg shadow-xl overflow-hidden z-[60]",children:[f.jsx("div",{className:"px-3 py-2 text-xs font-semibold text-gray-400 uppercase bg-gray-800/50",children:"Select Microphone"}),i.map(C=>f.jsxs("button",{onClick:()=>E(C.deviceId),className:`w-full text-left px-4 py-2 text-sm truncate flex items-center justify-between ${s===C.deviceId?"text-brand-primary bg-brand-primary/10":"text-gray-200 hover:bg-gray-800"}`,children:[f.jsx("span",{className:"truncate flex-1",children:C.label||`Mic ${C.deviceId.slice(0,5)}...`}),s===C.deviceId&&f.jsx("div",{className:"w-2 h-2 rounded-full bg-brand-primary"})]},C.deviceId))]})]}),f.jsx("button",{onClick:F,className:`p-3 rounded-full transition-colors ${l?"bg-green-500 hover:bg-green-600":"bg-gray-700 hover:bg-gray-600"}`,title:"Share Screen",children:l?f.jsx(WP,{className:"text-white",size:24}):f.jsx(If,{className:"text-white",size:24})}),f.jsx("button",{onClick:n,className:"p-3 rounded-full bg-red-600 hover:bg-red-700 transition-colors",title:"Disconnect",children:f.jsx(ff,{className:"text-white",size:24})}),h&&f.jsxs("div",{className:"fixed inset-0 bg-black/90 z-[100] flex flex-col items-center justify-center p-10",children:[f.jsx("h3",{className:"text-white text-xl mb-4 font-bold",children:"Select Screen to Share"}),f.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 overflow-y-auto max-h-[70vh] w-full max-w-4xl p-4",children:_.map(C=>f.jsxs("div",{onClick:()=>j(C.id),className:"cursor-pointer border border-gray-700 rounded-lg p-2 hover:bg-gray-800 hover:border-brand-primary transition-all flex flex-col gap-2",children:[f.jsx("img",{src:C.thumbnail.toDataURL(),alt:C.name,className:"w-full rounded bg-black object-contain aspect-video"}),f.jsx("span",{className:"text-gray-300 text-sm truncate text-center",children:C.name})]},C.id))}),f.jsx("button",{onClick:()=>m(!1),className:"mt-6 px-6 py-2 bg-gray-600 rounded hover:bg-gray-500 text-white",children:"Cancel"})]})]})};function Lre(){const{currentUser:n,userProfile:e,loading:t}=Ar(),[r,i]=T.useState("login");return t?f.jsx("div",{className:"min-h-screen bg-dark-bg flex items-center justify-center",children:f.jsx("div",{className:"text-dark-text text-xl",children:"Loading..."})}):n&&e?.isBanned?f.jsx("div",{className:"min-h-screen bg-dark-bg flex items-center justify-center p-4",children:f.jsxs("div",{className:"bg-dark-sidebar p-8 rounded-xl max-w-md w-full text-center border border-admin",children:[f.jsx("div",{className:"text-6xl mb-4",children:""}),f.jsx("h1",{className:"text-2xl font-bold text-dark-text mb-2",children:"Account Banned"}),f.jsx("p",{className:"text-dark-muted mb-6",children:"Your account has been banned from this server. Please contact an administrator if you believe this is a mistake."}),f.jsx("button",{onClick:()=>window.location.reload(),className:"px-6 py-2 bg-brand-primary text-white rounded-lg hover:bg-brand-hover transition-colors",children:"Refresh"})]})}):n?f.jsx(nB,{children:f.jsx(wq,{children:f.jsx(zre,{children:f.jsx(cQ,{})})})}):f.jsxs(f.Fragment,{children:[r==="login"&&f.jsx(q$,{onSwitchToRegister:()=>i("register"),onSwitchToReset:()=>i("reset")}),r==="register"&&f.jsx(H$,{onSwitchToLogin:()=>i("login")}),r==="reset"&&f.jsx(G$,{onSwitchToLogin:()=>i("login")})]})}function Ure(){return f.jsx(XB,{children:f.jsx(uQ,{children:f.jsx(ZF,{children:f.jsx(Vre,{children:f.jsx(Lre,{})})})})})}const Vre=({children:n})=>{const{currentUser:e}=Ar();return T.useEffect(()=>{lQ.initialize(e?.uid)},[e]),n},zre=({children:n})=>{const{activeRoom:e,leaveVoiceChannel:t}=Xi(),{currentUser:r}=Ar(),[i,s]=T.useState(null),[c,l]=T.useState(!0);return T.useEffect(()=>{const d=()=>l(!1);return window.addEventListener("OPEN_VOICE_ROOM",d),()=>window.removeEventListener("OPEN_VOICE_ROOM",d)},[]),T.useEffect(()=>{(async()=>{if(!e){s(null),l(!0);return}try{s({id:e.channelId}),l(!0)}catch(h){console.error(h)}})()},[e]),f.jsxs(f.Fragment,{children:[n,e&&r&&f.jsx("div",{className:Ct("fixed inset-0 z-[9999] bg-black/90 flex items-center justify-center transition-all duration-300",c?"pointer-events-none opacity-0":"pointer-events-auto opacity-100"),children:f.jsxs("div",{className:"w-full h-full relative",children:[f.jsxs("div",{className:"absolute top-4 right-4 z-[60] flex items-center gap-2",children:[f.jsxs("button",{onClick:()=>l(!0),className:"bg-gray-700/50 hover:bg-gray-600 text-white px-3 py-2 rounded flex items-center gap-2 backdrop-blur-sm",children:[f.jsx(AB,{size:20}),f.jsx("span",{className:"text-sm",children:"Minimize"})]}),f.jsx("button",{onClick:t,className:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 backdrop-blur-sm shadow-lg",children:"Disconnect"})]}),f.jsx(Pre,{channel:i||{id:e.channelId},serverId:e.serverId,user:r,onDisconnect:t})]})})]})};u9.createRoot(document.getElementById("root")).render(f.jsx(T.StrictMode,{children:f.jsx(Ure,{})}));
